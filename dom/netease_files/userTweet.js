(function(a,b){function k(a,b,f){if(d[a])throw new Error("Module "+a+" has been defined already.");c(b)&&(f=b),d[a]={factory:f,inited:!1},a===e&&j(a)}function j(a){var e={},f=d[a];if(c(d[a].factory)){var g=d[a].factory.apply(b,[i,e,b]);f.ret=g===b?e:g}else f.ret=d[a].factory;f.inited=!0}function i(a){if(!d[a])throw new Error("Module "+a+" is not defined.");var b=d[a];b.inited===!1&&j(a);return b.ret}function c(a){return Object.prototype.toString.call(a)==="[object Function]"}if(!a.define){var d={},e=null,f=document.getElementsByTagName("script");for(var g=0,h=f.length;g<h&&!e;g++)e=f[g].getAttribute("data-main");if(!e)throw new Error("No data-main attribute in script tag.");a.define=k}})(window);define("task/group/common",function(a,b,c){a("task/log"),a("task/user/setLoginUser"),a("task/user/setGroupInfo"),a("task/error"),a("task/dynImage"),a("task/setHeight"),a("task/widget/scrollTop"),a("task/hack/ie"),a("task/user/iTag"),a("task/shortURL"),a("task/linkTarget"),a("task/widget/searchBox"),a("task/widget/widgetFolder"),a("task/setSkin"),a("task/user/floatIntro"),a("task/widget/menu"),a("task/user/setGroupRemark"),a("widget/mail/recommend/RecommendTask.js")});define("task/log",function(a,b,c){var d=a("task/Task");(new d("keyFromLogger",function(){var b=a("external/jquery"),c=a("utils/log/Logger"),d=c.keyFrom,e=["buzz225.intra.t.163.com","t.163.com","buzz.mail.163.com"];b(document).delegate("a[href]","click",function(a){var d=b(a.currentTarget),e=d.attr("href");if(e.indexOf("javascript")!==0&&e.indexOf("/urlcheck?p=")===-1&&!d.data("unlog")){var f=d.data("method");f=typeof f!="undefined"?f:"click",c.triggerLog(d,{method:f})}}),(new Image).src="/page.do?PAGE="+d("body")})).add()});define("task/Task",function(a,b,c){var d=a("basic/oop/Class"),e=d.extend({init:function(a,b,c,d){this.name=a,d=d||[],c=c||null,this.func=function(){b.apply(c,d)}},run:function(){this.func()},add:function(){a("task/TaskManager").add(this)}});return e});define("basic/oop/Class",function(a,b,c){function f(a,b){return function(){var c=this._super;this._super=a;var d=b.apply(this,arguments);this._super=c;return d}}var d=!1,e=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,g=function(){};g.extend=function(a){function h(){!d&&this.init&&this.init.apply(this,arguments)}var b=this.prototype;d=!0;var c=new this;d=!1;for(var g in a)c[g]=typeof a[g]=="function"&&typeof b[g]=="function"&&e.test(a[g])?f(b[g],a[g]):a[g];h.prototype=c,h.constructor=h,h.extend=arguments.callee;return h};return g});define("task/TaskManager",function(a,b,c){var d=a("external/jquery"),e=a("utils/log/Logger"),f={taskResult:{},taskList:[],add:function(a){this.taskList.push(a)},run:function(){var a=this.taskList.shift();if(this.taskList.length>0){var b=this;setTimeout(function(){b.run()},0)}var c=new Date,d=0,f=null;try{a.run()}catch(g){typeof console!="undefined"&&console.error&&console.error("error in task ",a.name,":",g,g.stack),f=g}d=new Date-c,this.taskResult[a.name]={duration:d,result:f===null?"success":f.name+":"+f.message+"|@|"+f.stack},this.taskList.length===0&&e.doLog({keyFrom:e.keyFrom(document.body),action:"taskRecord",taskResult:this.taskResult})}};return f});define("external/jquery",function(a,b,c,d){function dc(a){return r.isWindow(a)?a:a.nodeType===9?a.defaultView||a.parentWindow:!1}function da(a,b){var c,d={height:a},e=0;b=b?1:0;for(;e<4;e+=2-b)c=bX[e],d["margin"+c]=d["padding"+c]=a;b&&(d.opacity=d.width=a);return d}function c_(a,b,c,d,e){return new c_.prototype.init(a,b,c,d,e)}function c$(a,b,c){var d,e,f,g,h,i,j,k,l,m=this,n=a.style,o={},p=[],q=a.nodeType&&b_(a);c.queue||(k=r._queueHooks(a,"fx"),k.unqueued==null&&(k.unqueued=0,l=k.empty.fire,k.empty.fire=function(){k.unqueued||l()}),k.unqueued++,m.always(function(){m.always(function(){k.unqueued--,r.queue(a,"fx").length||k.empty.fire()})})),a.nodeType===1&&("height"in b||"width"in b)&&(c.overflow=[n.overflow,n.overflowX,n.overflowY],r.css(a,"display")==="inline"&&r.css(a,"float")==="none"&&(!r.support.inlineBlockNeedsLayout||ce(a.nodeName)==="inline"?n.display="inline-block":n.zoom=1)),c.overflow&&(n.overflow="hidden",r.support.shrinkWrapBlocks||m.done(function(){n.overflow=c.overflow[0],n.overflowX=c.overflow[1],n.overflowY=c.overflow[2]}));for(d in b){f=b[d];if(cR.exec(f)){delete b[d],i=i||f==="toggle";if(f===(q?"hide":"show"))continue;p.push(d)}}g=p.length;if(g){h=r._data(a,"fxshow")||r._data(a,"fxshow",{}),"hidden"in h&&(q=h.hidden),i&&(h.hidden=!q),q?r(a).show():m.done(function(){r(a).hide()}),m.done(function(){var b;r.removeData(a,"fxshow",!0);for(b in o)r.style(a,b,o[b])});for(d=0;d<g;d++)e=p[d],j=m.createTween(e,q?h[e]:0),o[e]=h[e]||r.style(a,e),e in h||(h[e]=j.start,q&&(j.end=j.start,j.start=e==="width"||e==="height"?1:0))}}function cZ(a,b){var c,d,e,f,g;for(c in a){d=r.camelCase(c),e=b[d],f=a[c],r.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=r.cssHooks[d];if(g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}}function cY(a,b,c){var d,e=0,f=0,g=cU.length,h=r.Deferred().always(function(){delete i.elem}),i=function(){var b=cP||cW(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,e=1-d,f=0,g=j.tweens.length;for(;f<g;f++)j.tweens[f].run(e);h.notifyWith(a,[j,e,c]);if(e<1&&g)return c;h.resolveWith(a,[j]);return!1},j=h.promise({elem:a,props:r.extend({},b),opts:r.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:cP||cW(),duration:c.duration,tweens:[],createTween:function(b,c,d){var e=r.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);j.tweens.push(e);return e},stop:function(b){var c=0,d=b?j.tweens.length:0;for(;c<d;c++)j.tweens[c].run(1);b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]);return this}}),k=j.props;cZ(k,j.opts.specialEasing);for(;e<g;e++){d=cU[e].call(j,a,k,j.opts);if(d)return d}cX(j,k),r.isFunction(j.opts.start)&&j.opts.start.call(a,j),r.fx.timer(r.extend(i,{anim:j,queue:j.opts.queue,elem:a}));return j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}function cX(a,b){r.each(b,function(b,c){var d=(cV[b]||[]).concat(cV["*"]),e=0,f=d.length;for(;e<f;e++)if(d[e].call(a,b,c))return})}function cW(){setTimeout(function(){cP=d},0);return cP=r.now()}function cO(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(a){}}function cN(){try{return new window.XMLHttpRequest}catch(a){}}function cF(a,b){var c,d,e,f,g=a.dataTypes.slice(),h=g[0],i={},j=0;a.dataFilter&&(b=a.dataFilter(b,a.dataType));if(g[1])for(c in a.converters)i[c.toLowerCase()]=a.converters[c];for(;e=g[++j];)if(e!=="*"){if(h!=="*"&&h!==e){c=i[h+" "+e]||i["* "+e];if(!c)for(d in i){f=d.split(" ");if(f[1]===e){c=i[h+" "+f[0]]||i["* "+f[0]];if(c){c===!0?c=i[d]:i[d]!==!0&&(e=f[0],g.splice(j--,0,e));break}}}if(c!==!0)if(c&&a["throws"])b=c(b);else try{b=c(b)}catch(k){return{state:"parsererror",error:c?k:"No conversion from "+h+" to "+e}}}h=e}return{state:"success",data:b}}function cE(a,b,c){var e,f,g,h,i=a.contents,j=a.dataTypes,k=a.responseFields;for(f in k)f in c&&(b[k[f]]=c[f]);while(j[0]==="*")j.shift(),e===d&&(e=a.mimeType||b.getResponseHeader("content-type"));if(e)for(f in i)if(i[f]&&i[f].test(e)){j.unshift(f);break}if(j[0]in c)g=j[0];else{for(f in c){if(!j[0]||a.converters[f+" "+j[0]]){g=f;break}h||(h=f)}g=g||h}if(g){g!==j[0]&&j.unshift(g);return c[g]}}function cD(a,b){var c,e,f=r.ajaxSettings.flatOptions||{};for(c in b)b[c]!==d&&((f[c]?a:e||(e={}))[c]=b[c]);e&&r.extend(!0,a,e)}function cC(a,b,c,e,f,g){f=f||b.dataTypes[0],g=g||{},g[f]=!0;var h,i=a[f],j=0,k=i?i.length:0,l=a===cx;for(;j<k&&(l||!h);j++)h=i[j](b,c,e),typeof h=="string"&&(!l||g[h]?h=d:(b.dataTypes.unshift(h),h=cC(a,b,c,e,h,g)));(l||!h)&&!g["*"]&&(h=cC(a,b,c,e,"*",g));return h}function cB(a){return function(b,c){typeof b!="string"&&(c=b,b="*");var d,e,f,g=b.toLowerCase().split(u),h=0,i=g.length;if(r.isFunction(c))for(;h<i;h++)d=g[h],f=/^\+/.test(d),f&&(d=d.substr(1)||"*"),e=a[d]=a[d]||[],e[f?"unshift":"push"](c)}}function ck(a,b,c,d){var e;if(r.isArray(b))r.each(b,function(b,e){c||cg.test(a)?d(a,e):ck(a+"["+(typeof e=="object"?b:"")+"]",e,c,d)});else if(!c&&r.type(b)==="object")for(e in b)ck(a+"["+e+"]",b[e],c,d);else d(a,b)}function ce(a){if(bU[a])return bU[a];var b=r("<"+a+">").appendTo(g.body),c=b.css("display");b.remove();if(c==="none"||c===""){bK=g.body.appendChild(bK||r.extend(g.createElement("iframe"),{frameBorder:0,width:0,height:0}));if(!bL||!bK.createElement)bL=(bK.contentWindow||bK.contentDocument).document,bL.write("<!doctype html><html><body>"),bL.close();b=bL.body.appendChild(bL.createElement(a)),c=bJ(b,"display"),g.body.removeChild(bK)}bU[a]=c;return c}function cd(a,b,c){var d=b==="width"?a.offsetWidth:a.offsetHeight,e=!0,f=r.support.boxSizing&&r.css(a,"boxSizing")==="border-box";if(d<=0||d==null){d=bJ(a,b);if(d<0||d==null)d=a.style[b];if(bS.test(d))return d;e=f&&(r.support.boxSizingReliable||d===a.style[b]),d=parseFloat(d)||0}return d+cc(a,b,c||(f?"border":"content"),e)+"px"}function cc(a,b,c,d){var e=c===(d?"border":"content")?4:b==="width"?1:0,f=0;for(;e<4;e+=2)c==="margin"&&(f+=r.css(a,c+bX[e],!0)),d?(c==="content"&&(f-=parseFloat(bJ(a,"padding"+bX[e]))||0),c!=="margin"&&(f-=parseFloat(bJ(a,"border"+bX[e]+"Width"))||0)):(f+=parseFloat(bJ(a,"padding"+bX[e]))||0,c!=="padding"&&(f+=parseFloat(bJ(a,"border"+bX[e]+"Width"))||0));return f}function cb(a,b,c){var d=bR.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function ca(a,b){var c,d,e=[],f=0,g=a.length;for(;f<g;f++){c=a[f];if(!c.style)continue;e[f]=r._data(c,"olddisplay"),b?(!e[f]&&c.style.display==="none"&&(c.style.display=""),c.style.display===""&&b_(c)&&(e[f]=r._data(c,"olddisplay",ce(c.nodeName)))):(d=bJ(c,"display"),!e[f]&&d!=="none"&&r._data(c,"olddisplay",d))}for(f=0;f<g;f++){c=a[f];if(!c.style)continue;if(!b||c.style.display==="none"||c.style.display==="")c.style.display=b?e[f]||"":"none"}return a}function b_(a,b){a=b||a;return r.css(a,"display")==="none"||!r.contains(a.ownerDocument,a)}function b$(a,b){if(b in a)return b;var c=b.charAt(0).toUpperCase()+b.slice(1),d=b,e=bY.length;while(e--){b=bY[e]+c;if(b in a)return b}return d}function bI(a){bx.test(a.type)&&(a.defaultChecked=a.checked)}function bH(a){return typeof a.getElementsByTagName!="undefined"?a.getElementsByTagName("*"):typeof a.querySelectorAll!="undefined"?a.querySelectorAll("*"):[]}function bG(a,b){var c;b.nodeType===1&&(b.clearAttributes&&b.clearAttributes(),b.mergeAttributes&&b.mergeAttributes(a),c=b.nodeName.toLowerCase(),c==="object"?(b.parentNode&&(b.outerHTML=a.outerHTML),r.support.html5Clone&&a.innerHTML&&!r.trim(b.innerHTML)&&(b.innerHTML=a.innerHTML)):c==="input"&&bx.test(a.type)?(b.defaultChecked=b.checked=a.checked,b.value!==a.value&&(b.value=a.value)):c==="option"?b.selected=a.defaultSelected:c==="input"||c==="textarea"?b.defaultValue=a.defaultValue:c==="script"&&b.text!==a.text&&(b.text=a.text),b.removeAttribute(r.expando))}function bF(a,b){if(b.nodeType===1&&!!r.hasData(a)){var c,d,e,f=r._data(a),g=r._data(b,f),h=f.events;if(h){delete g.handle,g.events={};for(c in h)for(d=0,e=h[c].length;d<e;d++)r.event.add(b,c,h[c][d])}g.data&&(g.data=r.extend({},g.data))}}function bE(a,b){return a.getElementsByTagName(b)[0]||a.appendChild(a.ownerDocument.createElement(b))}function bm(a){var b=bn.split("|"),c=a.createDocumentFragment();if(c.createElement)while(b.length)c.createElement(b.pop());return c}function bl(a,b,c){b=b||0;if(r.isFunction(b))return r.grep(a,function(a,d){var e=!!b.call(a,d,a);return e===c});if(b.nodeType)return r.grep(a,function(a,d){return a===b===c});if(typeof b=="string"){var d=r.grep(a,function(a){return a.nodeType===1});if(bg.test(b))return r.filter(b,d,!c);b=r.filter(b,d)}return r.grep(a,function(a,d){return r.inArray(a,b)>=0===c})}function bk(a,b){do a=a[b];while(a&&a.nodeType!==1);return a}function bj(a){return!a||!a.parentNode||a.parentNode.nodeType===11}function bd(){return!0}function bc(){return!1}function M(a){var b;for(b in a){if(b==="data"&&r.isEmptyObject(a[b]))continue;if(b!=="toJSON")return!1}return!0}function L(a,b,c){if(c===d&&a.nodeType===1){var e="data-"+b.replace(K,"-$1").toLowerCase();c=a.getAttribute(e);if(typeof c=="string"){try{c=c==="true"?!0:c==="false"?!1:c==="null"?null:+c+""===c?+c:J.test(c)?r.parseJSON(c):c}catch(f){}r.data(a,b,c)}else c=d}return c}function I(a){var b=H[a]={};r.each(a.split(u),function(a,c){b[c]=!0});return b}var e,f,g=window.document,h=window.location,i=window.navigator,j=window.jQuery,k=window.$,l=Array.prototype.push,m=Array.prototype.slice,n=Array.prototype.indexOf,o=Object.prototype.toString,p=Object.prototype.hasOwnProperty,q=String.prototype.trim,r=function(a,b){return new r.fn.init(a,b,e)},s=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,t=/\S/,u=/\s+/,v=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,w=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,x=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,y=/^[\],:{}\s]*$/,z=/(?:^|:|,)(?:\s*\[)+/g,A=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,B=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,C=/^-ms-/,D=/-([\da-z])/gi,E=function(a,b){return(b+"").toUpperCase()},F=function(){g.addEventListener?(g.removeEventListener("DOMContentLoaded",F,!1),r.ready()):g.readyState==="complete"&&(g.detachEvent("onreadystatechange",F),r.ready())},G={};r.fn=r.prototype={constructor:r,init:function(a,b,c){var e,f,h,i;if(!a)return this;if(a.nodeType){this.context=this[0]=a,this.length=1;return this}if(typeof a=="string"){a.charAt(0)==="<"&&a.charAt(a.length-1)===">"&&a.length>=3?e=[null,a,null]:e=w.exec(a);if(e&&(e[1]||!b)){if(e[1]){b=b instanceof r?b[0]:b,i=b&&b.nodeType?b.ownerDocument||b:g,a=r.parseHTML(e[1],i,!0),x.test(e[1])&&r.isPlainObject(b)&&this.attr.call(a,b,!0);return r.merge(this,a)}f=g.getElementById(e[2]);if(f&&f.parentNode){if(f.id!==e[2])return c.find(a);this.length=1,this[0]=f}this.context=g,this.selector=a;return this}return!b||b.jquery?(b||c).find(a):this.constructor(b).find(a)}if(r.isFunction(a))return c.ready(a);a.selector!==d&&(this.selector=a.selector,this.context=a.context);return r.makeArray(a,this)},selector:"",jquery:"1.8.3",length:0,size:function(){return this.length},toArray:function(){return m.call(this)},get:function(a){return a==null?this.toArray():a<0?this[this.length+a]:this[a]},pushStack:function(a,b,c){var d=r.merge(this.constructor(),a);d.prevObject=this,d.context=this.context,b==="find"?d.selector=this.selector+(this.selector?" ":"")+c:b&&(d.selector=this.selector+"."+b+"("+c+")");return d},each:function(a,b){return r.each(this,a,b)},ready:function(a){r.ready.promise().done(a);return this},eq:function(a){a=+a;return a===-1?this.slice(a):this.slice(a,a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(m.apply(this,arguments),"slice",m.call(arguments).join(","))},map:function(a){return this.pushStack(r.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:l,sort:[].sort,splice:[].splice},r.fn.init.prototype=r.fn,r.extend=r.fn.extend=function(){var a,b,c,e,f,g,h=arguments[0]||{},i=1,j=arguments.length,k=!1;typeof h=="boolean"&&(k=h,h=arguments[1]||{},i=2),typeof h!="object"&&!r.isFunction(h)&&(h={}),j===i&&(h=this,--i);for(;i<j;i++)if((a=arguments[i])!=null)for(b in a){c=h[b],e=a[b];if(h===e)continue;k&&e&&(r.isPlainObject(e)||(f=r.isArray(e)))?(f?(f=!1,g=c&&r.isArray(c)?c:[]):g=c&&r.isPlainObject(c)?c:{},h[b]=r.extend(k,g,e)):e!==d&&(h[b]=e)}return h},r.extend({noConflict:function(a){window.$===r&&(window.$=k),a&&window.jQuery===r&&(window.jQuery=j);return r},isReady:!1,readyWait:1,holdReady:function(a){a?r.readyWait++:r.ready(!0)},ready:function(a){if(a===!0?!--r.readyWait:!r.isReady){if(!g.body)return setTimeout(r.ready,1);r.isReady=!0;if(a!==!0&&--r.readyWait>0)return;f.resolveWith(g,[r]),r.fn.trigger&&r(g).trigger("ready").off("ready")}},isFunction:function(a){return r.type(a)==="function"},isArray:Array.isArray||function(a){return r.type(a)==="array"},isWindow:function(a){return a!=null&&a==a.window},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return a==null?String(a):G[o.call(a)]||"object"},isPlainObject:function(a){if(!a||r.type(a)!=="object"||a.nodeType||r.isWindow(a))return!1;try{if(a.constructor&&!p.call(a,"constructor")&&!p.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(b){return!1}var c;for(c in a);return c===d||p.call(a,c)},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},error:function(a){throw new Error(a)},parseHTML:function(a,b,c){var d;if(!a||typeof a!="string")return null;typeof b=="boolean"&&(c=b,b=0),b=b||g;if(d=x.exec(a))return[b.createElement(d[1])];d=r.buildFragment([a],b,c?null:[]);return r.merge([],(d.cacheable?r.clone(d.fragment):d.fragment).childNodes)},parseJSON:function(a){if(!a||typeof a!="string")return null;a=r.trim(a);if(window.JSON&&window.JSON.parse)return window.JSON.parse(a);if(y.test(a.replace(A,"@").replace(B,"]").replace(z,"")))return(new Function("return "+a))();r.error("Invalid JSON: "+a)},parseXML:function(a){var b,c;if(!a||typeof a!="string")return null;try{window.DOMParser?(c=new DOMParser,b=c.parseFromString(a,"text/xml")):(b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a))}catch(e){b=d}(!b||!b.documentElement||b.getElementsByTagName("parsererror").length)&&r.error("Invalid XML: "+a);return b},noop:function(){},globalEval:function(a){a&&t.test(a)&&(window.execScript||function(a){window.eval.call(window,a)})(a)},camelCase:function(a){return a.replace(C,"ms-").replace(D,E)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,c){var e,f=0,g=a.length,h=g===d||r.isFunction(a);if(c){if(h){for(e in a)if(b.apply(a[e],c)===!1)break}else for(;f<g;)if(b.apply(a[f++],c)===!1)break}else if(h){for(e in a)if(b.call(a[e],e,a[e])===!1)break}else for(;f<g;)if(b.call(a[f],f,a[f++])===!1)break;return a},trim:q&&!q.call("﻿ ")?function(a){return a==null?"":q.call(a)}:function(a){return a==null?"":(a+"").replace(v,"")},makeArray:function(a,b){var c,d=b||[];a!=null&&(c=r.type(a),a.length==null||c==="string"||c==="function"||c==="regexp"||r.isWindow(a)?l.call(d,a):r.merge(d,a));return d},inArray:function(a,b,c){var d;if(b){if(n)return n.call(b,a,c);d=b.length,c=c?c<0?Math.max(0,d+c):c:0;for(;c<d;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,b){var c=b.length,e=a.length,f=0;if(typeof c=="number")for(;f<c;f++)a[e++]=b[f];else while(b[f]!==d)a[e++]=b[f++];a.length=e;return a},grep:function(a,b,c){var d,e=[],f=0,g=a.length;c=!!c;for(;f<g;f++)d=!!b(a[f],f),c!==d&&e.push(a[f]);return e},map:function(a,b,c){var e,f,g=[],h=0,i=a.length,j=a instanceof r||i!==d&&typeof i=="number"&&(i>0&&a[0]&&a[i-1]||i===0||r.isArray(a));if(j)for(;h<i;h++)e=b(a[h],h,c),e!=null&&(g[g.length]=e);else for(f in a)e=b(a[f],f,c),e!=null&&(g[g.length]=e);return g.concat.apply([],g)},guid:1,proxy:function(a,b){var c,e,f;typeof b=="string"&&(c=a[b],b=a,a=c);if(!r.isFunction(a))return d;e=m.call(arguments,2),f=function(){return a.apply(b,e.concat(m.call(arguments)))},f.guid=a.guid=a.guid||r.guid++;return f},access:function(a,b,c,e,f,g,h){var i,j=c==null,k=0,l=a.length;if(c&&typeof c=="object"){for(k in c)r.access(a,b,k,c[k],1,g,e);f=1}else if(e!==d){i=h===d&&r.isFunction(e),j&&(i?(i=b,b=function(a,b,c){return i.call(r(a),c)}):(b.call(a,e),b=null));if(b)for(;k<l;k++)b(a[k],c,i?e.call(a[k],k,b(a[k],c)):e,h);f=1}return f?a:j?b.call(a):l?b(a[0],c):g},now:function(){return(new Date).getTime()}}),r.ready.promise=function(a){if(!f){f=r.Deferred();if(g.readyState==="complete")setTimeout(r.ready,1);else if(g.addEventListener)g.addEventListener("DOMContentLoaded",F,!1),window.addEventListener("load",r.ready,!1);else{g.attachEvent("onreadystatechange",F),window.attachEvent("onload",r.ready);var b=!1;try{b=window.frameElement==null&&g.documentElement}catch(c){}b&&b.doScroll&&function d(){if(!r.isReady){try{b.doScroll("left")}catch(a){return setTimeout(d,50)}r.ready()}}()}}return f.promise(a)},r.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(a,b){G["[object "+b+"]"]=b.toLowerCase()}),e=r(g);var H={};r.Callbacks=function(a){a=typeof a=="string"?H[a]||I(a):r.extend({},a);var b,c,e,f,g,h,i=[],j=!a.once&&[],k=function(d){b=a.memory&&d,c=!0,h=f||0,f=0,g=i.length,e=!0;for(;i&&h<g;h++)if(i[h].apply(d[0],d[1])===!1&&a.stopOnFalse){b=!1;break}e=!1,i&&(j?j.length&&k(j.shift()):b?i=[]:l.disable())},l={add:function(){if(i){var c=i.length;(function d(b){r.each(b,function(b,c){var e=r.type(c);e==="function"?(!a.unique||!l.has(c))&&i.push(c):c&&c.length&&e!=="string"&&d(c)})})(arguments),e?g=i.length:b&&(f=c,k(b))}return this},remove:function(){i&&r.each(arguments,function(a,b){var c;while((c=r.inArray(b,i,c))>-1)i.splice(c,1),e&&(c<=g&&g--,c<=h&&h--)});return this},has:function(a){return r.inArray(a,i)>-1},empty:function(){i=[];return this},disable:function(){i=j=b=d;return this},disabled:function(){return!i},lock:function(){j=d,b||l.disable();return this},locked:function(){return!j},fireWith:function(a,b){b=b||[],b=[a,b.slice?b.slice():b],i&&(!c||j)&&(e?j.push(b):k(b));return this},fire:function(){l.fireWith(this,arguments);return this},fired:function(){return!!c}};return l},r.extend({Deferred:function(a){var b=[["resolve","done",r.Callbacks("once memory"),"resolved"],["reject","fail",r.Callbacks("once memory"),"rejected"],["notify","progress",r.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){e.done(arguments).fail(arguments);return this},then:function(){var a=arguments;return r.Deferred(function(c){r.each(b,function(b,d){var f=d[0],g=a[b];e[d[1]](r.isFunction(g)?function(){var a=g.apply(this,arguments);a&&r.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[f+"With"](this===e?c:this,[a])}:c[f])}),a=null}).promise()},promise:function(a){return a!=null?r.extend(a,d):d}},e={};d.pipe=d.then,r.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[a^1][2].disable,b[2][2].lock),e[f[0]]=g.fire,e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e);return e},when:function(a){var b=0,c=m.call(arguments),d=c.length,e=d!==1||a&&r.isFunction(a.promise)?d:0,f=e===1?a:r.Deferred(),g=function(a,b,c){return function(d){b[a]=this,c[a]=arguments.length>1?m.call(arguments):d,c===h?f.notifyWith(b,c):--e||f.resolveWith(b,c)}},h,i,j;if(d>1){h=Array(d),i=Array(d),j=Array(d);for(;b<d;b++)c[b]&&r.isFunction(c[b].promise)?c[b].promise().done(g(b,j,c)).fail(f.reject).progress(g(b,i,h)):--e}e||f.resolveWith(j,c);return f.promise()}}),r.support=function(){var a,b,c,d,e,f,h,i,j,k,l,m=g.createElement("div");m.setAttribute("className","t"),m.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",b=m.getElementsByTagName("*"),c=m.getElementsByTagName("a")[0];if(!b||!c||!b.length)return{};d=g.createElement("select"),e=d.appendChild(g.createElement("option")),f=m.getElementsByTagName("input")[0],c.style.cssText="top:1px;float:left;opacity:.5",a={leadingWhitespace:m.firstChild.nodeType===3,tbody:!m.getElementsByTagName("tbody").length,htmlSerialize:!!m.getElementsByTagName("link").length,style:/top/.test(c.getAttribute("style")),hrefNormalized:c.getAttribute("href")==="/a",opacity:/^0.5/.test(c.style.opacity),cssFloat:!!c.style.cssFloat,checkOn:f.value==="on",optSelected:e.selected,getSetAttribute:m.className!=="t",enctype:!!g.createElement("form").enctype,html5Clone:g.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",boxModel:g.compatMode==="CSS1Compat",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},f.checked=!0,a.noCloneChecked=f.cloneNode(!0).checked,d.disabled=!0,a.optDisabled=!e.disabled;try{delete m.test}catch(n){a.deleteExpando=!1}!m.addEventListener&&m.attachEvent&&m.fireEvent&&(m.attachEvent("onclick",l=function(){a.noCloneEvent=!1}),m.cloneNode(!0).fireEvent("onclick"),m.detachEvent("onclick",l)),f=g.createElement("input"),f.value="t",f.setAttribute("type","radio"),a.radioValue=f.value==="t",f.setAttribute("checked","checked"),f.setAttribute("name","t"),m.appendChild(f),h=g.createDocumentFragment(),h.appendChild(m.lastChild),a.checkClone=h.cloneNode(!0).cloneNode(!0).lastChild.checked,a.appendChecked=f.checked,h.removeChild(f),h.appendChild(m);if(m.attachEvent)for(j in{submit:!0,change:!0,focusin:!0})i="on"+j,k=i in m,k||(m.setAttribute(i,"return;"),k=typeof m[i]=="function"),a[j+"Bubbles"]=k;r(function(){var b,c,d,e,f="padding:0;margin:0;border:0;display:block;overflow:hidden;",h=g.getElementsByTagName("body")[0];!h||(b=g.createElement("div"),b.style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px",h.insertBefore(b,h.firstChild),c=g.createElement("div"),b.appendChild(c),c.innerHTML="<table><tr><td></td><td>t</td></tr></table>",d=c.getElementsByTagName("td"),d[0].style.cssText="padding:0;margin:0;border:0;display:none",k=d[0].offsetHeight===0,d[0].style.display="",d[1].style.display="none",a.reliableHiddenOffsets=k&&d[0].offsetHeight===0,c.innerHTML="",c.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",a.boxSizing=c.offsetWidth===4,a.doesNotIncludeMarginInBodyOffset=h.offsetTop!==1,window.getComputedStyle&&(a.pixelPosition=(window.getComputedStyle(c,null)||{}).top!=="1%",a.boxSizingReliable=(window.getComputedStyle(c,null)||{width:"4px"}).width==="4px",e=g.createElement("div"),e.style.cssText=c.style.cssText=f,e.style.marginRight=e.style.width="0",c.style.width="1px",c.appendChild(e),a.reliableMarginRight=!parseFloat((window.getComputedStyle(e,null)||{}).marginRight)),typeof c.style.zoom!="undefined"&&(c.innerHTML="",c.style.cssText=f+"width:1px;padding:1px;display:inline;zoom:1",a.inlineBlockNeedsLayout=c.offsetWidth===3,c.style.display="block",c.style.overflow="visible",c.innerHTML="<div></div>",c.firstChild.style.width="5px",a.shrinkWrapBlocks=c.offsetWidth!==3,b.style.zoom=1),h.removeChild(b),b=c=d=e=null)}),h.removeChild(m),b=c=d=e=f=h=m=null;return a}();var J=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,K=/([A-Z])/g;r.extend({cache:{},deletedIds:[],uuid:0,expando:"jQuery"+(r.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){a=a.nodeType?r.cache[a[r.expando]]:a[r.expando];return!!a&&!M(a)},data:function(a,b,c,e){if(!!r.acceptData(a)){var f,g,h=r.expando,i=typeof b=="string",j=a.nodeType,k=j?r.cache:a,l=j?a[h]:a[h]&&h;if((!l||!k[l]||!e&&!k[l].data)&&i&&c===d)return;l||(j?a[h]=l=r.deletedIds.pop()||r.guid++:l=h),k[l]||(k[l]={},j||(k[l].toJSON=r.noop));if(typeof b=="object"||typeof b=="function")e?k[l]=r.extend(k[l],b):k[l].data=r.extend(k[l].data,b);f=k[l],e||(f.data||(f.data={}),f=f.data),c!==d&&(f[r.camelCase(b)]=c),i?(g=f[b],g==null&&(g=f[r.camelCase(b)])):g=f;return g}},removeData:function(a,b,c){if(!!r.acceptData(a)){var d,e,f,g=a.nodeType,h=g?r.cache:a,i=g?a[r.expando]:r.expando;if(!h[i])return;if(b){d=c?h[i]:h[i].data;if(d){r.isArray(b)||(b in d?b=[b]:(b=r.camelCase(b),b in d?b=[b]:b=b.split(" ")));for(e=0,f=b.length;e<f;e++)delete d[b[e]];if(!(c?M:r.isEmptyObject)(d))return}}if(!c){delete h[i].data;if(!M(h[i]))return}g?r.cleanData([a],!0):r.support.deleteExpando||h!=h.window?delete h[i]:h[i]=null}},_data:function(a,b,c){return r.data(a,b,c,!0)},acceptData:function(a){var b=a.nodeName&&r.noData[a.nodeName.toLowerCase()];return!b||b!==!0&&a.getAttribute("classid")===b}}),r.fn.extend({data:function(a,b){var c,e,f,g,h,i=this[0],j=0,k=null;if(a===d){if(this.length){k=r.data(i);if(i.nodeType===1&&!r._data(i,"parsedAttrs")){f=i.attributes;for(h=f.length;j<h;j++)g=f[j].name,g.indexOf("data-")||(g=r.camelCase(g.substring(5)),L(i,g,k[g]));r._data(i,"parsedAttrs",!0)}}return k}if(typeof a=="object")return this.each(function(){r.data(this,a)});c=a.split(".",2),c[1]=c[1]?"."+c[1]:"",e=c[1]+"!";return r.access(this,function(b){if(b===d){k=this.triggerHandler("getData"+e,[c[0]]),k===d&&i&&(k=r.data(i,a),k=L(i,a,k));return k===d&&c[1]?this.data(c[0]):k}c[1]=b,this.each(function(){var d=r(this);d.triggerHandler("setData"+e,c),r.data(this,a,b),d.triggerHandler("changeData"+e,c)})},null,b,arguments.length>1,null,!1)},removeData:function(a){return this.each(function(){r.removeData(this,a)})}}),r.extend({queue:function(a,b,c){var d;if(a){b=(b||"fx")+"queue",d=r._data(a,b),c&&(!d||r.isArray(c)?d=r._data(a,b,r.makeArray(c)):d.push(c));return d||[]}},dequeue:function(a,b){b=b||"fx";var c=r.queue(a,b),d=c.length,e=c.shift(),f=r._queueHooks(a,b),g=function(){r.dequeue(a,b)};e==="inprogress"&&(e=c.shift(),d--),e&&(b==="fx"&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return r._data(a,c)||r._data(a,c,{empty:r.Callbacks("once memory").add(function(){r.removeData(a,b+"queue",!0),r.removeData(a,c,!0)})})}}),r.fn.extend({queue:function(a,b){var c=2;typeof a!="string"&&(b=a,a="fx",c--);if(arguments.length<c)return r.queue(this[0],a);return b===d?this:this.each(function(){var c=r.queue(this,a,b);r._queueHooks(this,a),a==="fx"&&c[0]!=="inprogress"&&r.dequeue(this,a)})},dequeue:function(a){return this.each(function(){r.dequeue(this,a)})},delay:function(a,b){a=r.fx?r.fx.speeds[a]||a:a,b=b||"fx";return this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,e=1,f=r.Deferred(),g=this,h=this.length,i=function(){--e||f.resolveWith(g,[g])};typeof a!="string"&&(b=a,a=d),a=a||"fx";while(h--)c=r._data(g[h],a+"queueHooks"),c&&c.empty&&(e++,c.empty.add(i));i();return f.promise(b)}});var N,O,P,Q=/[\t\r\n]/g,R=/\r/g,S=/^(?:button|input)$/i,T=/^(?:button|input|object|select|textarea)$/i,U=/^a(?:rea|)$/i,V=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,W=r.support.getSetAttribute;r.fn.extend({attr:function(a,b){return r.access(this,r.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){r.removeAttr(this,a)})},prop:function(a,b){return r.access(this,r.prop,a,b,arguments.length>1)},removeProp:function(a){a=r.propFix[a]||a;return this.each(function(){try{this[a]=d,delete this[a]}catch(b){}})},addClass:function(a){var b,c,d,e,f,g,h;if(r.isFunction(a))return this.each(function(b){r(this).addClass(a.call(this,b,this.className))});if(a&&typeof a=="string"){b=a.split(u);for(c=0,d=this.length;c<d;c++){e=this[c];if(e.nodeType===1)if(!e.className&&b.length===1)e.className=a;else{f=" "+e.className+" ";for(g=0,h=b.length;g<h;g++)f.indexOf(" "+b[g]+" ")<0&&(f+=b[g]+" ");e.className=r.trim(f)}}}return this},removeClass:function(a){var b,c,e,f,g,h,i;if(r.isFunction(a))return this.each(function(b){r(this).removeClass(a.call(this,b,this.className))});if(a&&typeof a=="string"||a===d){b=(a||"").split(u);for(h=0,i=this.length;h<i;h++){e=this[h];if(e.nodeType===1&&e.className){c=(" "+e.className+" ").replace(Q," ");for(f=0,g=b.length;f<g;f++)while(c.indexOf(" "+b[f]+" ")>=0)c=c.replace(" "+b[f]+" "," ");e.className=a?r.trim(c):""}}}return this},toggleClass:function(a,b){var c=typeof a,d=typeof b=="boolean";if(r.isFunction(a))return this.each(function(c){r(this).toggleClass(a.call(this,c,this.className,b),b)});return this.each(function(){if(c==="string"){var e,f=0,g=r(this),h=b,i=a.split(u);while(e=i[f++])h=d?h:!g.hasClass(e),g[h?"addClass":"removeClass"](e)}else if(c==="undefined"||c==="boolean")this.className&&r._data(this,"__className__",this.className),this.className=this.className||a===!1?"":r._data(this,"__className__")||""})},hasClass:function(a){var b=" "+a+" ",c=0,d=this.length;for(;c<d;c++)if(this[c].nodeType===1&&(" "+this[c].className+" ").replace(Q," ").indexOf(b)>=0)return!0;return!1},val:function(a){var b,c,e,f=this[0];{if(!!arguments.length){e=r.isFunction(a);return this.each(function(c){var f,g=r(this);if(this.nodeType===1){e?f=a.call(this,c,g.val()):f=a,f==null?f="":typeof f=="number"?f+="":r.isArray(f)&&(f=r.map(f,function(a){return a==null?"":a+""})),b=r.valHooks[this.type]||r.valHooks[this.nodeName.toLowerCase()];if(!b||!("set"in b)||b.set(this,f,"value")===d)this.value=f}})}if(f){b=r.valHooks[f.type]||r.valHooks[f.nodeName.toLowerCase()];if(b&&"get"in b&&(c=b.get(f,"value"))!==d)return c;c=f.value;return typeof c=="string"?c.replace(R,""):c==null?"":c}}}}),r.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return!b||b.specified?a.value:a.text}},select:{get:function(a){var b,c,d=a.options,e=a.selectedIndex,f=a.type==="select-one"||e<0,g=f?null:[],h=f?e+1:d.length,i=e<0?h:f?e:0;for(;i<h;i++){c=d[i];if((c.selected||i===e)&&(r.support.optDisabled?!c.disabled:c.getAttribute("disabled")===null)&&(!c.parentNode.disabled||!r.nodeName(c.parentNode,"optgroup"))){b=r(c).val();if(f)return b;g.push(b)}}return g},set:function(a,b){var c=r.makeArray(b);r(a).find("option").each(function(){this.selected=r.inArray(r(this).val(),c)>=0}),c.length||(a.selectedIndex=-1);return c}}},attrFn:{},attr:function(a,b,c,e){var f,g,h,i=a.nodeType;if(!!a&&i!==3&&i!==8&&i!==2){if(e&&r.isFunction(r.fn[b]))return r(a)[b](c);if(typeof a.getAttribute=="undefined")return r.prop(a,b,c);h=i!==1||!r.isXMLDoc(a),h&&(b=b.toLowerCase(),g=r.attrHooks[b]||(V.test(b)?O:N));if(c!==d){if(c===null){r.removeAttr(a,b);return}if(g&&"set"in g&&h&&(f=g.set(a,c,b))!==d)return f;a.setAttribute(b,c+"");return c}if(g&&"get"in g&&h&&(f=g.get(a,b))!==null)return f;f=a.getAttribute(b);return f===null?d:f}},removeAttr:function(a,b){var c,d,e,f,g=0;if(b&&a.nodeType===1){d=b.split(u);for(;g<d.length;g++)e=d[g],e&&(c=r.propFix[e]||e,f=V.test(e),f||r.attr(a,e,""),a.removeAttribute(W?e:c),f&&c in a&&(a[c]=!1))}},attrHooks:{type:{set:function(a,b){if(S.test(a.nodeName)&&a.parentNode)r.error("type property can't be changed");else if(!r.support.radioValue&&b==="radio"&&r.nodeName(a,"input")){var c=a.value;a.setAttribute("type",b),c&&(a.value=c);return b}}},value:{get:function(a,b){if(N&&r.nodeName(a,"button"))return N.get(a,b);return b in a?a.value:null},set:function(a,b,c){if(N&&r.nodeName(a,"button"))return N.set(a,b,c);a.value=b}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(a,b,c){var e,f,g,h=a.nodeType;if(!!a&&h!==3&&h!==8&&h!==2){g=h!==1||!r.isXMLDoc(a),g&&(b=r.propFix[b]||b,f=r.propHooks[b]);return c!==d?f&&"set"in f&&(e=f.set(a,c,b))!==d?e:a[b]=c:f&&"get"in f&&(e=f.get(a,b))!==null?e:a[b]}},propHooks:{tabIndex:{get:function(a){var b=a.getAttributeNode("tabindex");return b&&b.specified?parseInt(b.value,10):T.test(a.nodeName)||U.test(a.nodeName)&&a.href?0:d}}}}),O={get:function(a,b){var c,e=r.prop(a,b);return e===!0||typeof e!="boolean"&&(c=a.getAttributeNode(b))&&c.nodeValue!==!1?b.toLowerCase():d},set:function(a,b,c){var d;b===!1?r.removeAttr(a,c):(d=r.propFix[c]||c,d in a&&(a[d]=!0),a.setAttribute(c,c.toLowerCase()));return c}},W||(P={name:!0,id:!0,coords:!0},N=r.valHooks.button={get:function(a,b){var c;c=a.getAttributeNode(b);return c&&(P[b]?c.value!=="":c.specified)?c.value:d},set:function(a,b,c){var d=a.getAttributeNode(c);d||(d=g.createAttribute(c),a.setAttributeNode(d));return d.value=b+""}},r.each(["width","height"],function(a,b){r.attrHooks[b]=r.extend(r.attrHooks[b],{set:function(a,c){if(c===""){a.setAttribute(b,"auto");return c}}})}),r.attrHooks.contenteditable={get:N.get,set:function(a,b,c){b===""&&(b="false"),N.set(a,b,c)}}),r.support.hrefNormalized||r.each(["href","src","width","height"],function(a,b){r.attrHooks[b]=r.extend(r.attrHooks[b],{get:function(a){var c=a.getAttribute(b,2);return c===null?d:c}})}),r.support.style||(r.attrHooks.style={get:function(a){return a.style.cssText.toLowerCase()||d},set:function(a,b){return a.style.cssText=b+""}}),r.support.optSelected||(r.propHooks.selected=r.extend(r.propHooks.selected,{get:function(a){var b=a.parentNode;b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex);return null}})),r.support.enctype||(r.propFix.enctype="encoding"),r.support.checkOn||r.each(["radio","checkbox"],function(){r.valHooks[this]={get:function(a){return a.getAttribute("value")===null?"on":a.value}}}),r.each(["radio","checkbox"],function(){r.valHooks[this]=r.extend(r.valHooks[this],{set:function(a,b){if(r.isArray(b))return a.checked=r.inArray(r(a).val(),b)>=0}})});var X=/^(?:textarea|input|select)$/i,Y=/^([^\.]*|)(?:\.(.+)|)$/,Z=/(?:^|\s)hover(\.\S+|)\b/,$=/^key/,_=/^(?:mouse|contextmenu)|click/,ba=/^(?:focusinfocus|focusoutblur)$/,bb=function(a){return r.event.special.hover?a:a.replace(Z,"mouseenter$1 mouseleave$1")};r.event={add:function(a,b,c,e,f){var g,h,i,j,k,l,m,n,o,p,q;if(!(a.nodeType===3||a.nodeType===8||!b||!c||!(g=r._data(a)))){c.handler&&(o=c,c=o.handler,f=o.selector),c.guid||(c.guid=r.guid++),i=g.events,i||(g.events=i={}),h=g.handle,h||(g.handle=h=function(a){return typeof r!="undefined"&&(!a||r.event.triggered!==a.type)?r.event.dispatch.apply(h.elem,arguments):d},h.elem=a),b=r.trim(bb(b)).split(" ");for(j=0;j<b.length;j++){k=Y.exec(b[j])||[],l=k[1],m=(k[2]||"").split(".").sort(),q=r.event.special[l]||{},l=(f?q.delegateType:q.bindType)||l,q=r.event.special[l]||{},n=r.extend({type:l,origType:k[1],data:e,handler:c,guid:c.guid,selector:f,needsContext:f&&r.expr.match.needsContext.test(f),namespace:m.join(".")},o),p=i[l];if(!p){p=i[l]=[],p.delegateCount=0;if(!q.setup||q.setup.call(a,e,m,h)===!1)a.addEventListener?a.addEventListener(l,h,!1):a.attachEvent&&a.attachEvent("on"+l,h)}q.add&&(q.add.call(a,n),n.handler.guid||(n.handler.guid=c.guid)),f?p.splice(p.delegateCount++,0,n):p.push(n),r.event.global[l]=!0}a=null}},global:{},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=r.hasData(a)&&r._data(a);if(!!q&&!!(m=q.events)){b=r.trim(bb(b||"")).split(" ");for(f=0;f<b.length;f++){g=Y.exec(b[f])||[],h=i=g[1],j=g[2];if(!h){for(h in m)r.event.remove(a,h+b[f],c,d,!0);continue}n=r.event.special[h]||{},h=(d?n.delegateType:n.bindType)||h,o=m[h]||[],k=o.length,j=j?new RegExp("(^|\\.)"+j.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null;for(l=0;l<o.length;l++)p=o[l],(e||i===p.origType)&&(!c||c.guid===p.guid)&&(!j||j.test(p.namespace))&&(!d||d===p.selector||d==="**"&&p.selector)&&(o.splice(l--,1),p.selector&&o.delegateCount--,n.remove&&n.remove.call(a,p));o.length===0&&k!==o.length&&((!n.teardown||n.teardown.call(a,j,q.handle)===!1)&&r.removeEvent(a,h,q.handle),delete m[h])}r.isEmptyObject(m)&&(delete q.handle,r.removeData(a,"events",!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(a,b,c,e){if(!c||c.nodeType!==3&&c.nodeType!==8){var f,h,i,j,k,l,m,n,o,p,q=a.type||a,s=[];if(ba.test(q+r.event.triggered))return;q.indexOf("!")>=0&&(q=q.slice(0,-1),h=!0),q.indexOf(".")>=0&&(s=q.split("."),q=s.shift(),s.sort());if((!c||r.event.customEvent[q])&&!r.event.global[q])return;a=typeof a=="object"?a[r.expando]?a:new r.Event(q,a):new r.Event(q),a.type=q,a.isTrigger=!0,a.exclusive=h,a.namespace=s.join("."),a.namespace_re=a.namespace?new RegExp("(^|\\.)"+s.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,l=q.indexOf(":")<0?"on"+q:"";if(!c){f=r.cache;for(i in f)f[i].events&&f[i].events[q]&&r.event.trigger(a,b,f[i].handle.elem,!0);return}a.result=d,a.target||(a.target=c),b=b!=null?r.makeArray(b):[],b.unshift(a),m=r.event.special[q]||{};if(m.trigger&&m.trigger.apply(c,b)===!1)return;o=[[c,m.bindType||q]];if(!e&&!m.noBubble&&!r.isWindow(c)){p=m.delegateType||q,j=ba.test(p+q)?c:c.parentNode;for(k=c;j;j=j.parentNode)o.push([j,p]),k=j;k===(c.ownerDocument||g)&&o.push([k.defaultView||k.parentWindow||window,p])}for(i=0;i<o.length&&!a.isPropagationStopped();i++)j=o[i][0],a.type=o[i][1],n=(r._data(j,"events")||{})[a.type]&&r._data(j,"handle"),n&&n.apply(j,b),n=l&&j[l],n&&r.acceptData(j)&&n.apply&&n.apply(j,b)===!1&&a.preventDefault();a.type=q,!e&&!a.isDefaultPrevented()&&(!m._default||m._default.apply(c.ownerDocument,b)===!1)&&(q!=="click"||!r.nodeName(c,"a"))&&r.acceptData(c)&&l&&c[q]&&(q!=="focus"&&q!=="blur"||a.target.offsetWidth!==0)&&!r.isWindow(c)&&(k=c[l],k&&(c[l]=null),r.event.triggered=q,c[q](),r.event.triggered=d,k&&(c[l]=k));return a.result}},dispatch:function(a){a=r.event.fix(a||window.event);var b,c,e,f,g,h,i,j,k,l,n=(r._data(this,"events")||{})[a.type]||[],o=n.delegateCount,p=m.call(arguments),q=!a.exclusive&&!a.namespace,s=r.event.special[a.type]||{},t=[];p[0]=a,a.delegateTarget=this;if(!s.preDispatch||s.preDispatch.call(this,a)!==!1){if(o&&(!a.button||a.type!=="click"))for(e=a.target;e!=this;e=e.parentNode||this)if(e.disabled!==!0||a.type!=="click"){g={},i=[];for(b=0;b<o;b++)j=n[b],k=j.selector,g[k]===d&&(g[k]=j.needsContext?r(k,this).index(e)>=0:r.find(k,this,null,[e]).length),g[k]&&i.push(j);i.length&&t.push({elem:e,matches:i})}n.length>o&&t.push({elem:this,matches:n.slice(o)});for(b=0;b<t.length&&!a.isPropagationStopped();b++){h=t[b],a.currentTarget=h.elem;for(c=0;c<h.matches.length&&!a.isImmediatePropagationStopped();c++){j=h.matches[c];if(q||!a.namespace&&!j.namespace||a.namespace_re&&a.namespace_re.test(j.namespace))a.data=j.data,a.handleObj=j,f=((r.event.special[j.origType]||{}).handle||j.handler).apply(h.elem,p),f!==d&&(a.result=f,f===!1&&(a.preventDefault(),a.stopPropagation()))}}s.postDispatch&&s.postDispatch.call(this,a);return a.result}},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){a.which==null&&(a.which=b.charCode!=null?b.charCode:b.keyCode);return a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,b){var c,e,f,h=b.button,i=b.fromElement;a.pageX==null&&b.clientX!=null&&(c=a.target.ownerDocument||g,e=c.documentElement,f=c.body,a.pageX=b.clientX+(e&&e.scrollLeft||f&&f.scrollLeft||0)-(e&&e.clientLeft||f&&f.clientLeft||0),a.pageY=b.clientY+(e&&e.scrollTop||f&&f.scrollTop||0)-(e&&e.clientTop||f&&f.clientTop||0)),!a.relatedTarget&&i&&(a.relatedTarget=i===a.target?b.toElement:i),!a.which&&h!==d&&(a.which=h&1?1:h&2?3:h&4?2:0);return a}},fix:function(a){if(a[r.expando])return a;var b,c,d=a,e=r.event.fixHooks[a.type]||{},f=e.props?this.props.concat(e.props):this.props;a=r.Event(d);for(b=f.length;b;)c=f[--b],a[c]=d[c];a.target||(a.target=d.srcElement||g),a.target.nodeType===3&&(a.target=a.target.parentNode),a.metaKey=!!a.metaKey;return e.filter?e.filter(a,d):a},special:{load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(a,b,c){r.isWindow(this)&&(this.onbeforeunload=c)},teardown:function(a,b){this.onbeforeunload===b&&(this.onbeforeunload=null)}}},simulate:function(a,b,c,d){var e=r.extend(new r.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?r.event.trigger(e,null,b):r.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},r.event.handle=r.event.dispatch,r.removeEvent=g.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){var d="on"+b;a.detachEvent&&(typeof a[d]=="undefined"&&(a[d]=null),a.detachEvent(d,c))},r.Event=function(a,b){if(!(this instanceof r.Event))return new r.Event(a,b);a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault()?bd:bc):this.type=a,b&&r.extend(this,b),this.timeStamp=a&&a.timeStamp||r.now(),this[r.expando]=!0},r.Event.prototype={preventDefault:function(){this.isDefaultPrevented=bd;var a=this.originalEvent;!a||(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=bd;var a=this.originalEvent;!a||(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=bd,this.stopPropagation()},isDefaultPrevented:bc,isPropagationStopped:bc,isImmediatePropagationStopped:bc},r.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){r.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj,g=f.selector;if(!e||e!==d&&!r.contains(d,e))a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b;return c}}}),r.support.submitBubbles||(r.event.special.submit={setup:function(){if(r.nodeName(this,"form"))return!1;r.event.add(this,"click._submit keypress._submit",function(a){var b=a.target,c=r.nodeName(b,"input")||r.nodeName(b,"button")?b.form:d;c&&!r._data(c,"_submit_attached")&&(r.event.add(c,"submit._submit",function(a){a._submit_bubble=!0}),r._data(c,"_submit_attached",!0))})},postDispatch:function(a){a._submit_bubble&&(delete a._submit_bubble,this.parentNode&&!a.isTrigger&&r.event.simulate("submit",this.parentNode,a,!0))},teardown:function(){if(r.nodeName(this,"form"))return!1;r.event.remove(this,"._submit")}}),r.support.changeBubbles||(r.event.special.change={setup:function(){if(X.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio")r.event.add(this,"propertychange._change",function(a){a.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),r.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1),r.event.simulate("change",this,a,!0)});return!1}r.event.add(this,"beforeactivate._change",function(a){var b=a.target;X.test(b.nodeName)&&!r._data(b,"_change_attached")&&(r.event.add(b,"change._change",function(a){this.parentNode&&!a.isSimulated&&!a.isTrigger&&r.event.simulate("change",this.parentNode,a,!0)}),r._data(b,"_change_attached",!0))})},handle:function(a){var b=a.target;if(this!==b||a.isSimulated||a.isTrigger||b.type!=="radio"&&b.type!=="checkbox")return a.handleObj.handler.apply(this,arguments)},teardown:function(){r.event.remove(this,"._change");return!X.test(this.nodeName)}}),r.support.focusinBubbles||r.each({focus:"focusin",blur:"focusout"},function(a,b){var c=0,d=function(a){r.event.simulate(b,a.target,r.event.fix(a),!0)};r.event.special[b]={setup:function(){c++===0&&g.addEventListener(a,d,!0)},teardown:function(){--c===0&&g.removeEventListener(a,d,!0)}}}),r.fn.extend({on:function(a,b,c,e,f){var g,h;if(typeof a=="object"){typeof b!="string"&&(c=c||b,b=d);for(h in a)this.on(h,b,c,a[h],f);return this}c==null&&e==null?(e=b,c=b=d):e==null&&(typeof b=="string"?(e=c,c=d):(e=c,c=b,b=d));if(e===!1)e=bc;else if(!e)return this;f===1&&(g=e,e=function(a){r().off(a);return g.apply(this,arguments)},e.guid=g.guid||(g.guid=r.guid++));return this.each(function(){r.event.add(this,a,e,c,b)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,b,c){var e,f;if(a&&a.preventDefault&&a.handleObj){e=a.handleObj,r(a.delegateTarget).off(e.namespace?e.origType+"."+e.namespace:e.origType,e.selector,e.handler);return this}if(typeof a=="object"){for(f in a)this.off(f,b,a[f]);return this}if(b===!1||typeof b=="function")c=b,b=d;c===!1&&(c=bc);return this.each(function(){r.event.remove(this,a,c,b)})},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},live:function(a,b,c){r(this.context).on(a,this.selector,b,c);return this},die:function(a,b){r(this.context).off(a,this.selector||"**",b);return this},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return arguments.length===1?this.off(a,"**"):this.off(b,a||"**",c)},trigger:function(a,b){return this.each(function(){r.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0])return r.event.trigger(a,b,this[0],!0)},toggle:function(a){var b=arguments,c=a.guid||r.guid++,d=0,e=function(c){var e=(r._data(this,"lastToggle"+a.guid)||0)%d;r._data(this,"lastToggle"+a.guid,e+1),c.preventDefault();return b[e].apply(this,arguments)||!1};e.guid=c;while(d<b.length)b[d++].guid=c;return this.click(e)},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}}),r.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){r.fn[b]=function(a,c){c==null&&(c=a,a=null);return arguments.length>0?this.on(b,null,a,c):this.trigger(b)},$.test(b)&&(r.event.fixHooks[b]=r.event.keyHooks),_.test(b)&&(r.event.fixHooks[b]=r.event.mouseHooks)}),function(a,b){function bq(){}function bp(a,b,c,d,f){var g,h,j,k,l,m=bh(a),n=m.length;if(!d&&m.length===1){h=m[0]=m[0].slice(0);if(h.length>2&&(j=h[0]).type==="ID"&&b.nodeType===9&&!f&&e.relative[h[1].type]){b=e.find.ID(j.matches[0].replace(V,""),b,f)[0];if(!b)return c;a=a.slice(h.shift().length)}for(g=W.POS.test(a)?-1:h.length-1;g>=0;g--){j=h[g];if(e.relative[k=j.type])break;if(l=e.find[k])if(d=l(j.matches[0].replace(V,""),R.test(h[0].type)&&b.parentNode||b,f)){h.splice(g,1),a=d.length&&h.join("");if(!a){w.apply(c,x.call(d,0));return c}break}}}i(a,m)(d,b,f,c,R.test(a));return c}function bo(a,b,c){var d=0,e=b.length;for(;d<e;d++)bc(a,b[d],c);return c}function bn(a,b){var d=b.length>0,f=a.length>0,g=function(h,i,j,k,m){var n,o,p,r=[],s=0,u="0",x=h&&[],y=m!=null,z=l,A=h||f&&e.find.TAG("*",m&&i.parentNode||i),B=t+=z==null?1:Math.E;y&&(l=i!==q&&i,c=g.el);for(;(n=A[u])!=null;u++){if(f&&n){for(o=0;p=a[o];o++)if(p(n,i,j)){k.push(n);break}y&&(t=B,c=++g.el)}d&&((n=!p&&n)&&s--,h&&x.push(n))}s+=u;if(d&&u!==s){for(o=0;p=b[o];o++)p(x,r,i,j);if(h){if(s>0)while(u--)!x[u]&&!r[u]&&(r[u]=v.call(k));r=bk(r)}w.apply(k,r),y&&!h&&r.length>0&&s+b.length>1&&bc.uniqueSort(k)}y&&(t=B,l=z);return x};g.el=0;return d?z(g):g}function bm(a){var b,c,d,f=a.length,g=e.relative[a[0].type],h=g||e.relative[" "],i=g?1:0,j=bi(function(a){return a===b},h,!0),k=bi(function(a){return y.call(b,a)>-1},h,!0),m=[function(a,c,d){return!g&&(d||c!==l)||((b=c).nodeType?j(a,c,d):k(a,c,d))}];for(;i<f;i++)if(c=e.relative[a[i].type])m=[bi(bj(m),c)];else{c=e.filter[a[i].type].apply(null,a[i].matches);if(c[o]){d=++i;for(;d<f;d++)if(e.relative[a[d].type])break;return bl(i>1&&bj(m),i>1&&a.slice(0,i-1).join("").replace(L,"$1"),c,i<d&&bm(a.slice(i,d)),d<f&&bm(a=a.slice(d)),d<f&&a.join(""))}m.push(c)}return bj(m)}function bl(a,b,c,d,e,f){d&&!d[o]&&(d=bl(d)),e&&!e[o]&&(e=bl(e,f));return z(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||bo(b||"*",h.nodeType?[h]:h,[]),q=a&&(f||!b)?bk(p,m,a,h,i):p,r=c?e||(f?a:o||d)?[]:g:q;c&&c(q,r,h,i);if(d){j=bk(r,n),d(j,[],h,i),k=j.length;while(k--)if(l=j[k])r[n[k]]=!(q[n[k]]=l)}if(f){if(e||a){if(e){j=[],k=r.length;while(k--)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}k=r.length;while(k--)(l=r[k])&&(j=e?y.call(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}else r=bk(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):w.apply(g,r)})}function bk(a,b,c,d,e){var f,g=[],h=0,i=a.length,j=b!=null;for(;h<i;h++)if(f=a[h])if(!c||c(f,d,e))g.push(f),j&&b.push(h);return g}function bj(a){return a.length>1?function(b,c,d){var e=a.length;while(e--)if(!a[e](b,c,d))return!1;return!0}:a[0]}function bi(a,b,d){var e=b.dir,f=d&&b.dir==="parentNode",g=u++;return b.first?function(b,c,d){while(b=b[e])if(f||b.nodeType===1)return a(b,c,d)}:function(b,d,h){if(!h){var i,j=t+" "+g+" ",k=j+c;while(b=b[e])if(f||b.nodeType===1){if((i=b[o])===k)return b.sizset;if(typeof i=="string"&&i.indexOf(j)===0){if(b.sizset)return b}else{b[o]=k;if(a(b,d,h)){b.sizset=!0;return b}b.sizset=!1}}}else while(b=b[e])if(f||b.nodeType===1)if(a(b,d,h))return b}}function bh(a,b){var c,d,f,g,h,i,j,k=C[o][a+" "];if(k)return b?0:k.slice(0);h=a,i=[],j=e.preFilter;while(h){if(!c||(d=M.exec(h)))d&&(h=h.slice(d[0].length)||h),i.push(f=[]);c=!1;if(d=N.exec(h))f.push(c=new p(d.shift())),h=h.slice(c.length),c.type=d[0].replace(L," ");for(g in e.filter)(d=W[g].exec(h))&&(!j[g]||(d=j[g](d)))&&(f.push(c=new p(d.shift())),h=h.slice(c.length),c.type=g,c.matches=d);if(!c)break}return b?h.length:h?bc.error(a):C(a,i).slice(0)}function bg(a,b,c){if(a===b)return c;var d=a.nextSibling;while(d){if(d===b)return-1;d=d.nextSibling}return 1}function bf(a){return z(function(b){b=+b;return z(function(c,d){var e,f=a([],c.length,b),g=f.length;while(g--)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function be(a){return function(b){var c=b.nodeName.toLowerCase();return(c==="input"||c==="button")&&b.type===a}}function bd(a){return function(b){var c=b.nodeName.toLowerCase();return c==="input"&&b.type===a}}function bc(a,b,c,d){c=c||[],b=b||q;var e,f,i,j,k=b.nodeType;if(!a||typeof a!="string")return c;if(k!==1&&k!==9)return[];i=g(b);if(!i&&!d)if(e=P.exec(a))if(j=e[1]){if(k===9){f=b.getElementById(j);if(!f||!f.parentNode)return c;if(f.id===j){c.push(f);return c}}else if(b.ownerDocument&&(f=b.ownerDocument.getElementById(j))&&h(b,f)&&f.id===j){c.push(f);return c}}else{if(e[2]){w.apply(c,x.call(b.getElementsByTagName(a),0));return c}if((j=e[3])&&_&&b.getElementsByClassName){w.apply(c,x.call(b.getElementsByClassName(j),0));return c}}return bp(a.replace(L,"$1"),b,c,d,i)}var c,d,e,f,g,h,i,j,k,l,m=!0,n="undefined",o=("sizcache"+Math.random()).replace(".",""),p=String,q=a.document,s=q.documentElement,t=0,u=0,v=[].pop,w=[].push,x=[].slice,y=[].indexOf||function(a){var b=0,c=this.length;for(;b<c;b++)if(this[b]===a)return b;return-1},z=function(a,b){a[o]=b==null||b;return a},A=function(){var a={},b=[];return z(function(c,d){b.push(c)>e.cacheLength&&delete a[b.shift()];return a[c+" "]=d},a)},B=A(),C=A(),D=A(),E="[\\x20\\t\\r\\n\\f]",F="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+",G=F.replace("w","w#"),H="([*^$|!~]?=)",I="\\["+E+"*("+F+")"+E+"*(?:"+H+E+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+G+")|)|)"+E+"*\\]",J=":("+F+")(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:"+I+")|[^:]|\\\\.)*|.*))\\)|)",K=":(even|odd|eq|gt|lt|nth|first|last)(?:\\("+E+"*((?:-\\d)?\\d*)"+E+"*\\)|)(?=[^-]|$)",L=new RegExp("^"+E+"+|((?:^|[^\\\\])(?:\\\\.)*)"+E+"+$","g"),M=new RegExp("^"+E+"*,"+E+"*"),N=new RegExp("^"+E+"*([\\x20\\t\\r\\n\\f>+~])"+E+"*"),O=new RegExp(J),P=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,Q=/^:not/,R=/[\x20\t\r\n\f]*[+~]/,S=/:not\($/,T=/h\d/i,U=/input|select|textarea|button/i,V=/\\(?!\\)/g,W={ID:new RegExp("^#("+F+")"),CLASS:new RegExp("^\\.("+F+")"),NAME:new RegExp("^\\[name=['\"]?("+F+")['\"]?\\]"),TAG:new RegExp("^("+F.replace("w","w*")+")"),ATTR:new RegExp("^"+I),PSEUDO:new RegExp("^"+J),POS:new RegExp(K,"i"),CHILD:new RegExp("^:(only|nth|first|last)-child(?:\\("+E+"*(even|odd|(([+-]|)(\\d*)n|)"+E+"*(?:([+-]|)"+E+"*(\\d+)|))"+E+"*\\)|)","i"),needsContext:new RegExp("^"+E+"*[>+~]|"+K,"i")},X=function(a){var b=q.createElement("div");try{return a(b)}catch(c){return!1}finally{b=null}},Y=X(function(a){a.appendChild(q.createComment(""));return!a.getElementsByTagName("*").length}),Z=X(function(a){a.innerHTML="<a href='#'></a>";return a.firstChild&&typeof a.firstChild.getAttribute!==n&&a.firstChild.getAttribute("href")==="#"}),$=X(function(a){a.innerHTML="<select></select>";var b=typeof a.lastChild.getAttribute("multiple");return b!=="boolean"&&b!=="string"}),_=X(function(a){a.innerHTML="<div class='hidden e'></div><div class='hidden'></div>";if(!a.getElementsByClassName||!a.getElementsByClassName("e").length)return!1;a.lastChild.className="e";return a.getElementsByClassName("e").length===2}),ba=X(function(a){a.id=o+0,a.innerHTML="<a name='"+o+"'></a><div name='"+o+"'></div>",s.insertBefore(a,s.firstChild);var b=q.getElementsByName&&q.getElementsByName(o).length===2+q.getElementsByName(o+0).length;d=!q.getElementById(o),s.removeChild(a);return b});try{x.call(s.childNodes,0)[0].nodeType}catch(bb){x=function(a){var b,c=[];for(;b=this[a];a++)c.push(b);return c}}bc.matches=function(a,b){return bc(a,null,null,b)},bc.matchesSelector=function(a,b){return bc(b,null,null,[a]).length>0},f=bc.getText=function(a){var b,c="",d=0,e=a.nodeType;if(e){if(e===1||e===9||e===11){if(typeof a.textContent=="string")return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=f(a)}else if(e===3||e===4)return a.nodeValue}else for(;b=a[d];d++)c+=f(b);return c},g=bc.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?b.nodeName!=="HTML":!1},h=bc.contains=s.contains?function(a,b){var c=a.nodeType===9?a.documentElement:a,d=b&&b.parentNode;return a===d||!!(d&&d.nodeType===1&&c.contains&&c.contains(d))}:s.compareDocumentPosition?function(a,b){return b&&!!(a.compareDocumentPosition(b)&16)}:function(a,b){while(b=b.parentNode)if(b===a)return!0;return!1},bc.attr=function(a,b){var c,d=g(a);d||(b=b.toLowerCase());if(c=e.attrHandle[b])return c(a);if(d||$)return a.getAttribute(b);c=a.getAttributeNode(b);return c?typeof a[b]=="boolean"?a[b]?b:null:c.specified?c.value:null:null},e=bc.selectors={cacheLength:50,createPseudo:z,match:W,attrHandle:Z?{}:{href:function(a){return a.getAttribute("href",2)},type:function(a){return a.getAttribute("type")}},find:{ID:d?function(a,b,c){if(typeof b.getElementById!==n&&!c){var d=b.getElementById(a);return d&&d.parentNode?[d]:[]}}:function(a,c,d){if(typeof c.getElementById!==n&&!d){var e=c.getElementById(a);return e?e.id===a||typeof e.getAttributeNode!==n&&e.getAttributeNode("id").value===a?[e]:b:[]}},TAG:Y?function(a,b){if(typeof b.getElementsByTagName!==n)return b.getElementsByTagName(a)}:function(a,b){var c=b.getElementsByTagName(a);if(a==="*"){var d,e=[],f=0;for(;d=c[f];f++)d.nodeType===1&&e.push(d);return e}return c},NAME:ba&&function(a,b){if(typeof b.getElementsByName!==n)return b.getElementsByName(name)},CLASS:_&&function(a,b,c){if(typeof b.getElementsByClassName!==n&&!c)return b.getElementsByClassName(a)}},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){a[1]=a[1].replace(V,""),a[3]=(a[4]||a[5]||"").replace(V,""),a[2]==="~="&&(a[3]=" "+a[3]+" ");return a.slice(0,4)},CHILD:function(a){a[1]=a[1].toLowerCase(),a[1]==="nth"?(a[2]||bc.error(a[0]),a[3]=+(a[3]?a[4]+(a[5]||1):2*(a[2]==="even"||a[2]==="odd")),a[4]=+(a[6]+a[7]||a[2]==="odd")):a[2]&&bc.error(a[0]);return a},PSEUDO:function(a){var b,c;if(W.CHILD.test(a[0]))return null;if(a[3])a[2]=a[3];else if(b=a[4])O.test(b)&&(c=bh(b,!0))&&(c=b.indexOf(")",b.length-c)-b.length)&&(b=b.slice(0,c),a[0]=a[0].slice(0,c)),a[2]=b;return a.slice(0,3)}},filter:{ID:d?function(a){a=a.replace(V,"");return function(b){return b.getAttribute("id")===a}}:function(a){a=a.replace(V,"");return function(b){var c=typeof b.getAttributeNode!==n&&b.getAttributeNode("id");return c&&c.value===a}},TAG:function(a){if(a==="*")return function(){return!0};a=a.replace(V,"").toLowerCase();return function(b){return b.nodeName&&b.nodeName.toLowerCase()===a}},CLASS:function(a){var b=B[o][a+" "];return b||(b=new RegExp("(^|"+E+")"+a+"("+E+"|$)"))&&B(a,function(a){return b.test(a.className||typeof a.getAttribute!==n&&a.getAttribute("class")||"")})},ATTR:function(a,b,c){return function(d,e){var f=bc.attr(d,a);if(f==null)return b==="!=";if(!b)return!0;f+="";return b==="="?f===c:b==="!="?f!==c:b==="^="?c&&f.indexOf(c)===0:b==="*="?c&&f.indexOf(c)>-1:b==="$="?c&&f.substr(f.length-c.length)===c:b==="~="?(" "+f+" ").indexOf(c)>-1:b==="|="?f===c||f.substr(0,c.length+1)===c+"-":!1}},CHILD:function(a,b,c,d){if(a==="nth")return function(a){var b,e,f=a.parentNode;if(c===1&&d===0)return!0;if(f){e=0;for(b=f.firstChild;b;b=b.nextSibling)if(b.nodeType===1){e++;if(a===b)break}}e-=d;return e===c||e%c===0&&e/c>=0};return function(b){var c=b;switch(a){case"only":case"first":while(c=c.previousSibling)if(c.nodeType===1)return!1;if(a==="first")return!0;c=b;case"last":while(c=c.nextSibling)if(c.nodeType===1)return!1;return!0}}},PSEUDO:function(a,b){var c,d=e.pseudos[a]||e.setFilters[a.toLowerCase()]||bc.error("unsupported pseudo: "+a);if(d[o])return d(b);if(d.length>1){c=[a,a,"",b];return e.setFilters.hasOwnProperty(a.toLowerCase())?z(function(a,c){var e,f=d(a,b),g=f.length;while(g--)e=y.call(a,f[g]),a[e]=!(c[e]=f[g])}):function(a){return d(a,0,c)}}return d}},pseudos:{not:z(function(a){var b=[],c=[],d=i(a.replace(L,"$1"));return d[o]?z(function(a,b,c,e){var f,g=d(a,null,e,[]),h=a.length;while(h--)if(f=g[h])a[h]=!(b[h]=f)}):function(a,e,f){b[0]=a,d(b,null,f,c);return!c.pop()}}),has:z(function(a){return function(b){return bc(a,b).length>0}}),contains:z(function(a){return function(b){return(b.textContent||b.innerText||f(b)).indexOf(a)>-1}}),enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return b==="input"&&!!a.checked||b==="option"&&!!a.selected},selected:function(a){a.parentNode&&a.parentNode.selectedIndex;return a.selected===!0},parent:function(a){return!e.pseudos.empty(a)},empty:function(a){var b;a=a.firstChild;while(a){if(a.nodeName>"@"||(b=a.nodeType)===3||b===4)return!1;a=a.nextSibling}return!0},header:function(a){return T.test(a.nodeName)},text:function(a){var b,c;return a.nodeName.toLowerCase()==="input"&&(b=a.type)==="text"&&((c=a.getAttribute("type"))==null||c.toLowerCase()===b)},radio:bd("radio"),checkbox:bd("checkbox"),file:bd("file"),password:bd("password"),image:bd("image"),submit:be("submit"),reset:be("reset"),button:function(a){var b=a.nodeName.toLowerCase();return b==="input"&&a.type==="button"||b==="button"},input:function(a){return U.test(a.nodeName)},focus:function(a){var b=a.ownerDocument;return a===b.activeElement&&(!b.hasFocus||b.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},active:function(a){return a===a.ownerDocument.activeElement},first:bf(function(){return[0]}),last:bf(function(a,b){return[b-1]}),eq:bf(function(a,b,c){return[c<0?c+b:c]}),even:bf(function(a,b){for(var c=0;c<b;c+=2)a.push(c);return a}),odd:bf(function(a,b){for(var c=1;c<b;c+=2)a.push(c);return a}),lt:bf(function(a,b,c){for(var d=c<0?c+b:c;--d>=0;)a.push(d);return a}),gt:bf(function(a,b,c){for(var d=c<0?c+b:c;++d<b;)a.push(d);return a})}},j=s.compareDocumentPosition?function(a,b){if(a===b){k=!0;return 0}return(!a.compareDocumentPosition||!b.compareDocumentPosition?a.compareDocumentPosition:a.compareDocumentPosition(b)&4)?-1:1}:function(a,b){if(a===b){k=!0;return 0}if(a.sourceIndex&&b.sourceIndex)return a.sourceIndex-b.sourceIndex;var c,d,e=[],f=[],g=a.parentNode,h=b.parentNode,i=g;if(g===h)return bg(a,b);if(!g)return-1;if(!h)return 1;while(i)e.unshift(i),i=i.parentNode;i=h;while(i)f.unshift(i),i=i.parentNode;c=e.length,d=f.length;for(var j=0;j<c&&j<d;j++)if(e[j]!==f[j])return bg(e[j],f[j]);return j===c?bg(a,f[j],-1):bg(e[j],b,1)},[0,0].sort(j),m=!k,bc.uniqueSort=function(a){var b,c=[],d=1,e=0;k=m,a.sort(j);if(k){for(;b=a[d];d++)b===a[d-1]&&(e=c.push(d));while(e--)a.splice(c[e],1)}return a},bc.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},i=bc.compile=function(a,b){var c,d=[],e=[],f=D[o][a+" "];if(!f){b||(b=bh(a)),c=b.length;while(c--)f=bm(b[c]),f[o]?d.push(f):e.push(f);f=D(a,bn(e,d))}return f},q.querySelectorAll&&function(){var a,b=bp,c=/'|\\/g,d=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,e=[":focus"],f=[":active"],h=s.matchesSelector||s.mozMatchesSelector||s.webkitMatchesSelector||s.oMatchesSelector||s.msMatchesSelector;X(function(a){a.innerHTML="<select><option selected=''></option></select>",a.querySelectorAll("[selected]").length||e.push("\\["+E+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),a.querySelectorAll(":checked").length||e.push(":checked")}),X(function(a){a.innerHTML="<p test=''></p>",a.querySelectorAll("[test^='']").length&&e.push("[*^$]="+E+"*(?:\"\"|'')"),a.innerHTML="<input type='hidden'/>",a.querySelectorAll(":enabled").length||e.push(":enabled",":disabled")}),e=new RegExp(e.join("|")),bp=function(a,d,f,g,h){if(!g&&!h&&!e.test(a)){var i,j,k=!0,l=o,m=d,n=d.nodeType===9&&a;if(d.nodeType===1&&d.nodeName.toLowerCase()!=="object"){i=bh(a),(k=d.getAttribute("id"))?l=k.replace(c,"\\$&"):d.setAttribute("id",l),l="[id='"+l+"'] ",j=i.length;while(j--)i[j]=l+i[j].join("");m=R.test(a)&&d.parentNode||d,n=i.join(",")}if(n)try{w.apply(f,x.call(m.querySelectorAll(n),0));return f}catch(p){}finally{k||d.removeAttribute("id")}}return b(a,d,f,g,h)},h&&(X(function(b){a=h.call(b,"div");try{h.call(b,"[test!='']:sizzle"),f.push("!=",J)}catch(c){}}),f=new RegExp(f.join("|")),bc.matchesSelector=function(b,c){c=c.replace(d,"='$1']");if(!g(b)&&!f.test(c)&&!e.test(c))try{var i=h.call(b,c);if(i||a||b.document&&b.document.nodeType!==11)return i}catch(j){}return bc(c,null,null,[b]).length>0})}(),e.pseudos.nth=e.pseudos.eq,e.filters=bq.prototype=e.pseudos,e.setFilters=new bq,bc.attr=r.attr,r.find=bc,r.expr=bc.selectors,r.expr[":"]=r.expr.pseudos,r.unique=bc.uniqueSort,r.text=bc.getText,r.isXMLDoc=bc.isXML,r.contains=bc.contains}(window);var be=/Until$/,bf=/^(?:parents|prev(?:Until|All))/,bg=/^.[^:#\[\.,]*$/,bh=r.expr.match.needsContext,bi={children:!0,contents:!0,next:!0,prev:!0};r.fn.extend({find:function(a){var b,c,d,e,f,g,h=this;if(typeof a!="string")return r(a).filter(function(){for(b=0,c=h.length;b<c;b++)if(r.contains(h[b],this))return!0});g=this.pushStack("","find",a);for(b=0,c=this.length;b<c;b++){d=g.length,r.find(a,this[b],g);if(b>0)for(e=d;e<g.length;e++)for(f=0;f<d;f++)if(g[f]===g[e]){g.splice(e--,1);break}}return g},has:function(a){var b,c=r(a,this),d=c.length;return this.filter(function(){for(b=0;b<d;b++)if(r.contains(this,c[b]))return!0})},not:function(a){return this.pushStack(bl(this,a,!1),"not",a)},filter:function(a){return this.pushStack(bl(this,a,!0),"filter",a)},is:function(a){return!!a&&(typeof a=="string"?bh.test(a)?r(a,this.context).index(this[0])>=0:r.filter(a,this).length>0:this.filter(a).length>0)},closest:function(a,b){var c,d=0,e=this.length,f=[],g=bh.test(a)||typeof a!="string"?r(a,b||this.context):0;for(;d<e;d++){c=this[d];while(c&&c.ownerDocument&&c!==b&&c.nodeType!==11){if(g?g.index(c)>-1:r.find.matchesSelector(c,a)){f.push(c);break}c=c.parentNode}}f=f.length>1?r.unique(f):f;return this.pushStack(f,"closest",a)},index:function(a){if(!a)return this[0]&&this[0].parentNode?this.prevAll().length:-1;if(typeof a=="string")return r.inArray(this[0],r(a));return r.inArray(a.jquery?a[0]:a,this)},add:function(a,b){var c=typeof a=="string"?r(a,b):r.makeArray(a&&a.nodeType?[a]:a),d=r.merge(this.get(),c);return this.pushStack(bj(c[0])||bj(d[0])?d:r.unique(d))},addBack:function(a){return this.add(a==null?this.prevObject:this.prevObject.filter(a))}}),r.fn.andSelf=r.fn.addBack,r.each({parent:function(a){var b=a.parentNode;return b&&b.nodeType!==11?b:null},parents:function(a){return r.dir(a,"parentNode")},parentsUntil:function(a,b,c){return r.dir(a,"parentNode",c)},next:function(a){return bk(a,"nextSibling")},prev:function(a){return bk(a,"previousSibling")},nextAll:function(a){return r.dir(a,"nextSibling")},prevAll:function(a){return r.dir(a,"previousSibling")},nextUntil:function(a,b,c){return r.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return r.dir(a,"previousSibling",c)},siblings:function(a){return r.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return r.sibling(a.firstChild)},contents:function(a){return r.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:r.merge([],a.childNodes)}},function(a,b){r.fn[a]=function(c,d){var e=r.map(this,b,c);be.test(a)||(d=c),d&&typeof d=="string"&&(e=r.filter(d,e)),e=this.length>1&&!bi[a]?r.unique(e):e,this.length>1&&bf.test(a)&&(e=e.reverse());return this.pushStack(e,a,m.call(arguments).join(","))}}),r.extend({filter:function(a,b,c){c&&(a=":not("+a+")");return b.length===1?r.find.matchesSelector(b[0],a)?[b[0]]:[]:r.find.matches(a,b)},dir:function(a,b,c){var e=[],f=a[b];while(f&&f.nodeType!==9&&(c===d||f.nodeType!==1||!r(f).is(c)))f.nodeType===1&&e.push(f),f=f[b];return e},sibling:function(a,b){var c=[];for(;a;a=a.nextSibling)a.nodeType===1&&a!==b&&c.push(a);return c}});var bn="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",bo=/ jQuery\d+="(?:null|\d+)"/g,bp=/^\s+/,bq=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,br=/<([\w:]+)/,bs=/<tbody/i,bt=/<|&#?\w+;/,bu=/<(?:script|style|link)/i,bv=/<(?:script|object|embed|option|style)/i,bw=new RegExp("<(?:"+bn+")[\\s/>]","i"),bx=/^(?:checkbox|radio)$/,by=/checked\s*(?:[^=]|=\s*.checked.)/i,bz=/\/(java|ecma)script/i,bA=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,bB={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},bC=bm(g),bD=bC.appendChild(g.createElement("div"));bB.optgroup=bB.option,bB.tbody=bB.tfoot=bB.colgroup=bB.caption=bB.thead,bB.th=bB.td,r.support.htmlSerialize||(bB._default=[1,"X<div>","</div>"]),r.fn.extend({text:function(a){return r.access(this,function(a){return a===d?r.text(this):this.empty().append((this[0]&&this[0].ownerDocument||g).createTextNode(a))},null,a,arguments.length)},wrapAll:function(a){if(r.isFunction(a))return this.each(function(b){r(this).wrapAll(a.call(this,b))});if(this[0]){var b=r(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&a.firstChild.nodeType===1)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){if(r.isFunction(a))return this.each(function(b){r(this).wrapInner(a.call(this,b))});return this.each(function(){var b=r(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=r.isFunction(a);return this.each(function(c){r(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){r.nodeName(this,"body")||r(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(a){(this.nodeType===1||this.nodeType===11)&&this.appendChild(a)})},prepend:function(){return this.domManip(arguments,!0,function(a){(this.nodeType===1||this.nodeType===11)&&this.insertBefore(a,this.firstChild)})},before:function(){if(!bj(this[0]))return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this)});if(arguments.length){var a=r.clean(arguments);return this.pushStack(r.merge(a,this),"before",this.selector)}},after:function(){if(!bj(this[0]))return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this.nextSibling)});if(arguments.length){var a=r.clean(arguments);return this.pushStack(r.merge(this,a),"after",this.selector)}},remove:function(a,b){var c,d=0;for(;(c=this[d])!=null;d++)if(!a||r.filter(a,[c]).length)!b&&c.nodeType===1&&(r.cleanData(c.getElementsByTagName("*")),r.cleanData([c])),c.parentNode&&c.parentNode.removeChild(c);return this},empty:function(){var a,b=0;for(;(a=this[b])!=null;b++){a.nodeType===1&&r.cleanData(a.getElementsByTagName("*"));while(a.firstChild)a.removeChild(a.firstChild)}return this},clone:function(a,b){a=a==null?!1:a,b=b==null?a:b;return this.map(function(){return r.clone(this,a,b)})},html:function(a){return r.access(this,function(a){var b=this[0]||{},c=0,e=this.length;if(a===d)return b.nodeType===1?b.innerHTML.replace(bo,""):d;if(typeof a=="string"&&!bu.test(a)&&(r.support.htmlSerialize||!bw.test(a))&&(r.support.leadingWhitespace||!bp.test(a))&&!bB[(br.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(bq,"<$1></$2>");try{for(;c<e;c++)b=this[c]||{},b.nodeType===1&&(r.cleanData(b.getElementsByTagName("*")),b.innerHTML=a);b=0}catch(f){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(a){if(!bj(this[0])){if(r.isFunction(a))return this.each(function(b){var c=r(this),d=c.html();c.replaceWith(a.call(this,b,d))});typeof a!="string"&&(a=r(a).detach());return this.each(function(){var b=this.nextSibling,c=this.parentNode;r(this).remove(),b?r(b).before(a):r(c).append(a)})}return this.length?this.pushStack(r(r.isFunction(a)?a():a),"replaceWith",a):this},detach:function(a){return this.remove(a,!0)},domManip:function(a,b,c){a=[].concat.apply([],a);var e,f,g,h,i=0,j=a[0],k=[],l=this.length;if(!r.support.checkClone&&l>1&&typeof j=="string"&&by.test(j))return this.each(function(){r(this).domManip(a,b,c)});if(r.isFunction(j))return this.each(function(e){var f=r(this);a[0]=j.call(this,e,b?f.html():d),f.domManip(a,b,c)});if(this[0]){e=r.buildFragment(a,this,k),g=e.fragment,f=g.firstChild,g.childNodes.length===1&&(g=f);if(f){b=b&&r.nodeName(f,"tr");for(h=e.cacheable||l-1;i<l;i++)c.call(b&&r.nodeName(this[i],"table")?bE(this[i],"tbody"):this[i],i===h?g:r.clone(g,!0,!0))}g=f=null,k.length&&r.each(k,function(a,b){b.src?r.ajax?r.ajax({url:b.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):r.error("no ajax"):r.globalEval((b.text||b.textContent||b.innerHTML||"").replace(bA,"")),b.parentNode&&b.parentNode.removeChild(b)})}return this}}),r.buildFragment=function(a,b,c){var e,f,h,i=a[0];b=b||g,b=!b.nodeType&&b[0]||b,b=b.ownerDocument||b,a.length===1&&typeof i=="string"&&i.length<512&&b===g&&i.charAt(0)==="<"&&!bv.test(i)&&(r.support.checkClone||!by.test(i))&&(r.support.html5Clone||!bw.test(i))&&(f=!0,e=r.fragments[i],h=e!==d),e||(e=b.createDocumentFragment(),r.clean(a,b,e,c),f&&(r.fragments[i]=h&&e));return{fragment:e,cacheable:f}},r.fragments={},r.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){r.fn[a]=function(c){var d,e=0,f=[],g=r(c),h=g.length,i=this.length===1&&this[0].parentNode;if((i==null||i&&i.nodeType===11&&i.childNodes.length===1)&&h===1){g[b](this[0]);return this}for(;e<h;e++)d=(e>0?this.clone(!0):this).get(),r(g[e])[b](d),f=f.concat(d);return this.pushStack(f,a,g.selector)}}),r.extend({clone:function(a,b,c){var d,e,f,g;r.support.html5Clone||r.isXMLDoc(a)||!bw.test("<"+a.nodeName+">")?g=a.cloneNode(!0):(bD.innerHTML=a.outerHTML,bD.removeChild(g=bD.firstChild));if((!r.support.noCloneEvent||!r.support.noCloneChecked)&&(a.nodeType===1||a.nodeType===11)&&!r.isXMLDoc(a)){bG(a,g),d=bH(a),e=bH(g);for(f=0;d[f];++f)e[f]&&bG(d[f],e[f])}if(b){bF(a,g);if(c){d=bH(a),e=bH(g);for(f=0;d[f];++f)bF(d[f],e[f])}}d=e=null;return g},clean:function(a,b,c,d){var e,f,h,i,j,k,l,m,n,o,p,q,s=b===g&&bC,t=[];if(!b||typeof b.createDocumentFragment=="undefined")b=g;for(e=0;(h=a[e])!=null;e++){typeof h=="number"&&(h+="");if(!h)continue;if(typeof h=="string")if(!bt.test(h))h=b.createTextNode(h);else{s=s||bm(b),l=b.createElement("div"),s.appendChild(l),h=h.replace(bq,"<$1></$2>"),i=(br.exec(h)||["",""])[1].toLowerCase(),j=bB[i]||bB._default,k=j[0],l.innerHTML=j[1]+h+j[2];while(k--)l=l.lastChild;if(!r.support.tbody){m=bs.test(h),n=i==="table"&&!m?l.firstChild&&l.firstChild.childNodes:j[1]==="<table>"&&!m?l.childNodes:[];for(f=n.length-1;f>=0;--f)r.nodeName(n[f],"tbody")&&!n[f].childNodes.length&&n[f].parentNode.removeChild(n[f])}!r.support.leadingWhitespace&&bp.test(h)&&l.insertBefore(b.createTextNode(bp.exec(h)[0]),l.firstChild),h=l.childNodes,l.parentNode.removeChild(l)}h.nodeType?t.push(h):r.merge(t,h)}l&&(h=l=s=null);if(!r.support.appendChecked)for(e=0;(h=t[e])!=null;e++)r.nodeName(h,"input")?bI(h):typeof h.getElementsByTagName!="undefined"&&r.grep(h.getElementsByTagName("input"),bI);if(c){p=function(a){if(!a.type||bz.test(a.type))return d?d.push(a.parentNode?a.parentNode.removeChild(a):a):c.appendChild(a)};for(e=0;(h=t[e])!=null;e++)if(!r.nodeName(h,"script")||!p(h))c.appendChild(h),typeof h.getElementsByTagName!="undefined"&&(q=r.grep(r.merge([],h.getElementsByTagName("script")),p),t.splice.apply(t,[e+1,0].concat(q)),e+=q.length)}return t},cleanData:function(a,b){var c,d,e,f,g=0,h=r.expando,i=r.cache,j=r.support.deleteExpando,k=r.event.special;for(;(e=a[g])!=null;g++)if(b||r.acceptData(e)){d=e[h],c=d&&i[d];if(c){if(c.events)for(f in c.events)k[f]?r.event.remove(e,f):r.removeEvent(e,f,c.handle);i[d]&&(delete i[d],j?delete e[h]:e.removeAttribute?e.removeAttribute(h):e[h]=null,r.deletedIds.push(d))}}}}),function(){var a,b;r.uaMatch=function(a){a=a.toLowerCase();var b=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},a=r.uaMatch(i.userAgent),b={},a.browser&&(b[a.browser]=!0,b.version=a.version),b.chrome?b.webkit=!0:b.webkit&&(b.safari=!0),r.browser=b,r.sub=function(){function a(b,c){return new a.fn.init(b,c)}r.extend(!0,a,this),a.superclass=this,a.fn=a.prototype=this(),a.fn.constructor=a,a.sub=this.sub,a.fn.init=function(b,d){d&&d instanceof r&&!(d instanceof a)&&(d=a(d));return r.fn.init.call(this,b,d,c)},a.fn.init.prototype=a.fn;var c=a(g);return a}}();var bJ,bK,bL,bM=/alpha\([^)]*\)/i,bN=/opacity=([^)]*)/,bO=/^(top|right|bottom|left)$/,bP=/^(none|table(?!-c[ea]).+)/,bQ=/^margin/,bR=new RegExp("^("+s+")(.*)$","i"),bS=new RegExp("^("+s+")(?!px)[a-z%]+$","i"),bT=new RegExp("^([-+])=("+s+")","i"),bU={BODY:"block"},bV={position:"absolute",visibility:"hidden",display:"block"},bW={letterSpacing:0,fontWeight:400},bX=["Top","Right","Bottom","Left"],bY=["Webkit","O","Moz","ms"],bZ=r.fn.toggle;r.fn.extend({css:function(a,b){return r.access(this,function(a,b,c){return c!==d?r.style(a,b,c):r.css(a,b)},a,b,arguments.length>1)},show:function(){return ca(this,!0)},hide:function(){return ca(this)},toggle:function(a,b){var c=typeof a=="boolean";if(r.isFunction(a)&&r.isFunction(b))return bZ.apply(this,arguments);return this.each(function(){(c?a:b_(this))?r(this).show():r(this).hide()})}}),r.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=bJ(a,"opacity");return c===""?"1":c}}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":r.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,b,c,e){if(!!a&&a.nodeType!==3&&a.nodeType!==8&&!!a.style){var f,g,h,i=r.camelCase(b),j=a.style;b=r.cssProps[i]||(r.cssProps[i]=b$(j,i)),h=r.cssHooks[b]||r.cssHooks[i];if(c===d){if(h&&"get"in h&&(f=h.get(a,!1,e))!==d)return f;return j[b]}g=typeof c,g==="string"&&(f=bT.exec(c))&&(c=(f[1]+1)*f[2]+parseFloat(r.css(a,b)),g="number");if(c==null||g==="number"&&isNaN(c))return;g==="number"&&!r.cssNumber[i]&&(c+="px");if(!h||!("set"in h)||(c=h.set(a,c,e))!==d)try{j[b]=c}catch(k){}}},css:function(a,b,c,e){var f,g,h,i=r.camelCase(b);b=r.cssProps[i]||(r.cssProps[i]=b$(a.style,i)),h=r.cssHooks[b]||r.cssHooks[i],h&&"get"in h&&(f=h.get(a,!0,e)),f===d&&(f=bJ(a,b)),f==="normal"&&b in bW&&(f=bW[b]);if(c||e!==d){g=parseFloat(f);return c||r.isNumeric(g)?g||0:f}return f},swap:function(a,b,c){var d,e,f={};for(e in b)f[e]=a.style[e],a.style[e]=b[e];d=c.call(a);for(e in b)a.style[e]=f[e];return d}}),window.getComputedStyle?bJ=function(a,b){var c,d,e,f,g=window.getComputedStyle(a,null),h=a.style;g&&(c=g.getPropertyValue(b)||g[b],c===""&&!r.contains(a.ownerDocument,a)&&(c=r.style(a,b)),bS.test(c)&&bQ.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=c,c=g.width,h.width=d,h.minWidth=e,h.maxWidth=f));return c}:g.documentElement.currentStyle&&(bJ=function(a,b){var c,d,e=a.currentStyle&&a.currentStyle[b],f=a.style;e==null&&f&&f[b]&&(e=f[b]),bS.test(e)&&!bO.test(b)&&(c=f.left,d=a.runtimeStyle&&a.runtimeStyle.left,d&&(a.runtimeStyle.left=a.currentStyle.left),f.left=b==="fontSize"?"1em":e,e=f.pixelLeft+"px",f.left=c,d&&(a.runtimeStyle.left=d));return e===""?"auto":e}),r.each(["height","width"],function(a,b){r.cssHooks[b]={get:function(a,c,d){if(c)return a.offsetWidth===0&&bP.test(bJ(a,"display"))?r.swap(a,bV,function(){return cd(a,b,d)}):cd(a,b,d)},set:function(a,c,d){return cb(a,c,d?cc(a,b,d,r.support.boxSizing&&r.css(a,"boxSizing")==="border-box"):0)}}}),r.support.opacity||(r.cssHooks.opacity={get:function(a,b){return bN.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=r.isNumeric(b)?"alpha(opacity="+b*100+")":"",f=d&&d.filter||c.filter||"";c.zoom=1;if(b>=1&&r.trim(f.replace(bM,""))===""&&c.removeAttribute){c.removeAttribute("filter");if(d&&!d.filter)return}c.filter=bM.test(f)?f.replace(bM,e):f+" "+e}}),r(function(){r.support.reliableMarginRight||(r.cssHooks.marginRight={get:function(a,b){return r.swap(a,{display:"inline-block"},function(){if(b)return bJ(a,"marginRight")})}}),!r.support.pixelPosition&&r.fn.position&&r.each(["top","left"],function(a,b){r.cssHooks[b]={get:function(a,c){if(c){var d=bJ(a,b);return bS.test(d)?r(a).position()[b]+"px":d}}}})}),r.expr&&r.expr.filters&&(r.expr.filters.hidden=function(a){return a.offsetWidth===0&&a.offsetHeight===0||!r.support.reliableHiddenOffsets&&(a.style&&a.style.display||bJ(a,"display"))==="none"},r.expr.filters.visible=function(a){return!r.expr.filters.hidden(a)}),r.each({margin:"",padding:"",border:"Width"},function(a,b){r.cssHooks[a+b]={expand:function(c){var d,e=typeof c=="string"?c.split(" "):[c],f={};for(d=0;d<4;d++)f[a+bX[d]+b]=e[d]||e[d-2]||e[0];return f}},bQ.test(a)||(r.cssHooks[a+b].set=cb)});var cf=/%20/g,cg=/\[\]$/,ch=/\r?\n/g,ci=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,cj=/^(?:select|textarea)/i;r.fn.extend({serialize:function(){return r.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?r.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||cj.test(this.nodeName)||ci.test(this.type))}).map(function(a,b){var c=r(this).val();return c==null?null:r.isArray(c)?r.map(c,function(a,c){return{name:b.name,value:a.replace(ch,"\r\n")}}):{name:b.name,value:c.replace(ch,"\r\n")}}).get()}}),r.param=function(a,b){var c,e=[],f=function(a,b){b=r.isFunction(b)?b():b==null?"":b,e[e.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};b===d&&(b=r.ajaxSettings&&r.ajaxSettings.traditional);if(r.isArray(a)||a.jquery&&!r.isPlainObject(a))r.each(a,function(){f(this.name,this.value)});else for(c in a)ck(c,a[c],b,f);return e.join("&").replace(cf,"+")};var cl,cm,cn=/#.*$/,co=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,cp=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,cq=/^(?:GET|HEAD)$/,cr=/^\/\//,cs=/\?/,ct=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,cu=/([?&])_=[^&]*/,cv=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,cw=r.fn.load,cx={},cy={},cz=["*/"]+["*"];try{cm=h.href}catch(cA){cm=g.createElement("a"),cm.href="",cm=cm.href}cl=cv.exec(cm.toLowerCase())||[],r.fn.load=function(a,b,c){if(typeof a!="string"&&cw)return cw.apply(this,arguments);if(!this.length)return this;var e,f,g,h=this,i=a.indexOf(" ");i>=0&&(e=a.slice(i,a.length),a=a.slice(0,i)),r.isFunction(b)?(c=b,b=d):b&&typeof b=="object"&&(f="POST"),r.ajax({url:a,type:f,dataType:"html",data:b,complete:function(a,b){c&&h.each(c,g||[a.responseText,b,a])}}).done(function(a){g=arguments,h.html(e?r("<div>").append(a.replace(ct,"")).find(e):a)});return this},r.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){r.fn[b]=function(a){return this.on(b,a)}}),r.each(["get","post"],function(a,b){r[b]=function(a,c,e,f){r.isFunction(c)&&(f=f||e,e=c,c=d);return r.ajax({type:b,url:a,data:c,success:e,dataType:f})}}),r.extend({getScript:function(a,b){return r.get(a,d,b,"script")},getJSON:function(a,b,c){return r.get(a,b,c,"json")},ajaxSetup:function(a,b){b?cD(a,r.ajaxSettings):(b=a,a=r.ajaxSettings),cD(a,b);return a},ajaxSettings:{url:cm,isLocal:cp.test(cl[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":cz},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":window.String,"text html":!0,"text json":r.parseJSON,"text xml":r.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:cB(cx),ajaxTransport:cB(cy),ajax:function(a,b){function y(a,b,f,i){var k,s,t,u,w,y=b;if(v!==2){v=2,h&&clearTimeout(h),g=d,e=i||"",x.readyState=a>0?4:0,f&&(u=cE(l,x,f));if(a>=200&&a<300||a===304)l.ifModified&&(w=x.getResponseHeader("Last-Modified"),w&&(r.lastModified[c]=w),w=x.getResponseHeader("Etag"),w&&(r.etag[c]=w)),a===304?(y="notmodified",k=!0):(k=cF(l,u),y=k.state,s=k.data,t=k.error,k=!t);else{t=y;if(!y||a)y="error",a<0&&(a=0)}x.status=a,x.statusText=(b||y)+"",k?o.resolveWith(m,[s,y,x]):o.rejectWith(m,[x,y,t]),x.statusCode(q),q=d,j&&n.trigger("ajax"+(k?"Success":"Error"),[x,l,k?s:t]),p.fireWith(m,[x,y]),j&&(n.trigger("ajaxComplete",[x,l]),--r.active||r.event.trigger("ajaxStop"))}}typeof a=="object"&&(b=a,a=d),b=b||{};var c,e,f,g,h,i,j,k,l=r.ajaxSetup({},b),m=l.context||l,n=m!==l&&(m.nodeType||m instanceof r)?r(m):r.event,o=r.Deferred(),p=r.Callbacks("once memory"),q=l.statusCode||{},s={},t={},v=0,w="canceled",x={readyState:0,setRequestHeader:function(a,b){if(!v){var c=a.toLowerCase();a=t[c]=t[c]||a,s[a]=b}return this},getAllResponseHeaders:function(){return v===2?e:null},getResponseHeader:function(a){var b;if(v===2){if(!f){f={};while(b=co.exec(e))f[b[1].toLowerCase()]=b[2]}b=f[a.toLowerCase()]}return b===d?null:b},overrideMimeType:function(a){v||(l.mimeType=a);return this},abort:function(a){a=a||w,g&&g.abort(a),y(0,a);return this}};o.promise(x),x.success=x.done,x.error=x.fail,x.complete=p.add,x.statusCode=function(a){if(a){var b;if(v<2)for(b in a)q[b]=[q[b],a[b]];else b=a[x.status],x.always(b)}return this},l.url=((a||l.url)+"").replace(cn,"").replace(cr,cl[1]+"//"),l.dataTypes=r.trim(l.dataType||"*").toLowerCase().split(u),l.crossDomain==null&&(i=cv.exec(l.url.toLowerCase()),l.crossDomain=!(!i||i[1]===cl[1]&&i[2]===cl[2]&&(i[3]||(i[1]==="http:"?80:443))==(cl[3]||(cl[1]==="http:"?80:443)))),l.data&&l.processData&&typeof l.data!="string"&&(l.data=r.param(l.data,l.traditional)),cC(cx,l,b,x);if(v===2)return x;j=l.global,l.type=l.type.toUpperCase(),l.hasContent=!cq.test(l.type),j&&r.active++===0&&r.event.trigger("ajaxStart");if(!l.hasContent){l.data&&(l.url+=(cs.test(l.url)?"&":"?")+l.data,delete l.data),c=l.url;if(l.cache===!1){var z=r.now(),A=l.url.replace(cu,"$1_="+z);l.url=A+(A===l.url?(cs.test(l.url)?"&":"?")+"_="+z:"")}}(l.data&&l.hasContent&&l.contentType!==!1||b.contentType)&&x.setRequestHeader("Content-Type",l.contentType),l.ifModified&&(c=c||l.url,r.lastModified[c]&&x.setRequestHeader("If-Modified-Since",r.lastModified[c]),r.etag[c]&&x.setRequestHeader("If-None-Match",r.etag[c])),x.setRequestHeader("Accept",l.dataTypes[0]&&l.accepts[l.dataTypes[0]]?l.accepts[l.dataTypes[0]]+(l.dataTypes[0]!=="*"?", "+cz+"; q=0.01":""):l.accepts["*"]);for(k in l.headers)x.setRequestHeader(k,l.headers[k]);if(l.beforeSend&&(l.beforeSend.call(m,x,l)===!1||v===2))return x.abort();w="abort";for(k in{success:1,error:1,complete:1})x[k](l[k]);g=cC(cy,l,b,x);if(!g)y(-1,"No Transport");else{x.readyState=1,j&&n.trigger("ajaxSend",[x,l]),l.async&&l.timeout>0&&(h=setTimeout(function(){x.abort("timeout")},l.timeout));try{v=1,g.send(s,y)}catch(B){if(v<2)y(-1,B);else throw B}}return x},active:0,lastModified:{},etag:{}});var cG=[],cH=/\?/,cI=/(=)\?(?=&|$)|\?\?/,cJ=r.now();r.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=cG.pop()||r.expando+"_"+cJ++;this[a]=!0;return a}}),r.ajaxPrefilter("json jsonp",function(a,b,c){var e,f,g,h=a.data,i=a.url,j=a.jsonp!==!1,k=j&&cI.test(i),l=j&&!k&&typeof h=="string"&&!(a.contentType||"").indexOf("application/x-www-form-urlencoded")&&cI.test(h);if(a.dataTypes[0]==="jsonp"||k||l){e=a.jsonpCallback=r.isFunction(a.jsonpCallback)?a.jsonpCallback():a.jsonpCallback,f=window[e],k?a.url=i.replace(cI,"$1"+e):l?a.data=h.replace(cI,"$1"+e):j&&(a.url+=(cH.test(i)?"&":"?")+a.jsonp+"="+e),a.converters["script json"]=function(){g||r.error(e+" was not called");return g[0]},a.dataTypes[0]="json",window[e]=function(){g=arguments},c.always(function(){window[e]=f,a[e]&&(a.jsonpCallback=b.jsonpCallback,cG.push(e)),g&&r.isFunction(f)&&f(g[0]),g=f=d});return"script"}}),r.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(a){r.globalEval(a);return a}}}),r.ajaxPrefilter("script",function(a){a.cache===d&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),r.ajaxTransport("script",function(a){if(a.crossDomain){var b,c=g.head||g.getElementsByTagName("head")[0]||g.documentElement;return{send:function(e,f){b=g.createElement("script"),b.async="async",a.scriptCharset&&(b.charset=a.scriptCharset),b.src=a.url,b.onload=b.onreadystatechange=function(a,e){if(e||!b.readyState||/loaded|complete/.test(b.readyState))b.onload=b.onreadystatechange=null,c&&b.parentNode&&c.removeChild(b),b=d,e||f(200,"success")},c.insertBefore(b,c.firstChild)},abort:function(){b&&b.onload(0,1)}}}});var cK,cL=window.ActiveXObject?function(){for(var a in cK)cK[a](0,1)}:!1,cM=0;r.ajaxSettings.xhr=window.ActiveXObject?function(){return!this.isLocal&&cN()||cO()}:cN,function(a){r.extend(r.support,{ajax:!!a,cors:!!a&&"withCredentials"in a})}(r.ajaxSettings.xhr()),r.support.ajax&&r.ajaxTransport(function(a){if(!a.crossDomain||r.support.cors){var b;return{send:function(c,e){var f,g,h=a.xhr();a.username?h.open(a.type,a.url,a.async,a.username,a.password):h.open(a.type,a.url,a.async);if(a.xhrFields)for(g in a.xhrFields)h[g]=a.xhrFields[g];a.mimeType&&h.overrideMimeType&&h.overrideMimeType(a.mimeType),!a.crossDomain&&!c["X-Requested-With"]&&(c["X-Requested-With"]="XMLHttpRequest");try{for(g in c)h.setRequestHeader(g,c[g])}catch(i){}h.send(a.hasContent&&a.data||null),b=function(c,g){var i,j,k,l,m;try{if(b&&(g||h.readyState===4)){b=d,f&&(h.onreadystatechange=r.noop,cL&&delete cK[f]);if(g)h.readyState!==4&&h.abort();else{i=h.status,k=h.getAllResponseHeaders(),l={},m=h.responseXML,m&&m.documentElement&&(l.xml=m);try{l.text=h.responseText}catch(n){}try{j=h.statusText}catch(n){j=""}!i&&a.isLocal&&!a.crossDomain?i=l.text?200:404:i===1223&&(i=204)}}}catch(o){g||e(-1,o)}l&&e(i,j,l,k)},a.async?h.readyState===4?setTimeout(b,0):(f=++cM,cL&&(cK||(cK={},r(window).unload(cL)),cK[f]=b),h.onreadystatechange=b):b()},abort:function(){b&&b(0,1)}}}});var cP,cQ,cR=/^(?:toggle|show|hide)$/,cS=new RegExp("^(?:([-+])=|)("+s+")([a-z%]*)$","i"),cT=/queueHooks$/,cU=[c$],cV={"*":[function(a,b){var c,d,e=this.createTween(a,b),f=cS.exec(b),g=e.cur(),h=+g||0,i=1,j=20;if(f){c=+f[2],d=f[3]||(r.cssNumber[a]?"":"px");if(d!=="px"&&h){h=r.css(e.elem,a,!0)||c||1;do i=i||".5",h=h/i,r.style(e.elem,a,h+d);while(i!==(i=e.cur()/g)&&i!==1&&--j)}e.unit=d,e.start=h,e.end=f[1]?h+(f[1]+1)*c:c}return e}]};r.Animation=r.extend(cY,{tweener:function(a,b){r.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");var c,d=0,e=a.length;for(;d<e;d++)c=a[d],cV[c]=cV[c]||[],cV[c].unshift(b)},prefilter:function(a,b){b?cU.unshift(a):cU.push(a)}}),r.Tween=c_,c_.prototype={constructor:c_,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(r.cssNumber[c]?"":"px")},cur:function(){var a=c_.propHooks[this.prop];return a&&a.get?a.get(this):c_.propHooks._default.get(this)},run:function(a){var b,c=c_.propHooks[this.prop];this.options.duration?this.pos=b=r.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):this.pos=b=a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):c_.propHooks._default.set(this);return this}},c_.prototype.init.prototype=c_.prototype,c_.propHooks={_default:{get:function(a){var b;if(a.elem[a.prop]!=null&&(!a.elem.style||a.elem.style[a.prop]==null))return a.elem[a.prop];b=r.css(a.elem,a.prop,!1,"");return!b||b==="auto"?0:b},set:function(a){r.fx.step[a.prop]?r.fx.step[a.prop](a):a.elem.style&&(a.elem.style[r.cssProps[a.prop]]!=null||r.cssHooks[a.prop])?r.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},c_.propHooks.scrollTop=c_.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},r.each(["toggle","show","hide"],function(a,b){var c=r.fn[b];r.fn[b]=function(d,e,f){return d==null||typeof d=="boolean"||!a&&r.isFunction(d)&&r.isFunction(e)?c.apply(this,arguments):this.animate(da(b,!0),d,e,f)}}),r.fn.extend({fadeTo:function(a,b,c,d){return this.filter(b_).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=r.isEmptyObject(a),f=r.speed(b,c,d),g=function(){var b=cY(this,r.extend({},a),f);e&&b.stop(!0)};return e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var e=function(a){var b=a.stop;delete a.stop,b(c)};typeof a!="string"&&(c=b,b=a,a=d),b&&a!==!1&&this.queue(a||"fx",[]);return this.each(function(){var b=!0,d=a!=null&&a+"queueHooks",f=r.timers,g=r._data(this);if(d)g[d]&&g[d].stop&&e(g[d]);else for(d in g)g[d]&&g[d].stop&&cT.test(d)&&e(g[d]);for(d=f.length;d--;)f[d].elem===this&&(a==null||f[d].queue===a)&&(f[d].anim.stop(c),b=!1,f.splice(d,1));(b||!c)&&r.dequeue(this,a)})}}),r.each({slideDown:da("show"),slideUp:da("hide"),slideToggle:da("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){r.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),r.speed=function(a,b,c){var d=a&&typeof a=="object"?r.extend({},a):{complete:c||!c&&b||r.isFunction(a)&&a,duration:a,easing:c&&b||b&&!r.isFunction(b)&&b};d.duration=r.fx.off?0:typeof d.duration=="number"?d.duration:d.duration in r.fx.speeds?r.fx.speeds[d.duration]:r.fx.speeds._default;if(d.queue==null||d.queue===!0)d.queue="fx";d.old=d.complete,d.complete=function(){r.isFunction(d.old)&&d.old.call(this),d.queue&&r.dequeue(this,d.queue)};return d},r.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},r.timers=[],r.fx=c_.prototype.init,r.fx.tick=function(){var a,b=r.timers,c=0;cP=r.now();for(;c<b.length;c++)a=b[c],!a()&&b[c]===a&&b.splice(c--,1);b.length||r.fx.stop(),cP=d},r.fx.timer=function(a){a()&&r.timers.push(a)&&!cQ&&(cQ=setInterval(r.fx.tick,r.fx.interval))},r.fx.interval=13,r.fx.stop=function(){clearInterval(cQ),cQ=null},r.fx.speeds={slow:600,fast:200,_default:400},r.fx.step={},r.expr&&r.expr.filters&&(r.expr.filters.animated=function(a){return r.grep(r.timers,function(b){return a===b.elem}).length});var db=/^(?:body|html)$/i;r.fn.offset=function(a){if(arguments.length)return a===d?this:this.each(function(b){r.offset.setOffset(this,a,b)});var b,c,e,f,g,h,i,j={top:0,left:0},k=this[0],l=k&&k.ownerDocument;if(!!l){if((c=l.body)===k)return r.offset.bodyOffset(k);b=l.documentElement;if(!r.contains(b,k))return j;typeof k.getBoundingClientRect!="undefined"&&(j=k.getBoundingClientRect()),e=dc(l),f=b.clientTop||c.clientTop||0,g=b.clientLeft||c.clientLeft||0,h=e.pageYOffset||b.scrollTop,i=e.pageXOffset||b.scrollLeft;return{top:j.top+h-f,left:j.left+i-g}}},r.offset={bodyOffset:function(a){var b=a.offsetTop,c=a.offsetLeft;r.support.doesNotIncludeMarginInBodyOffset&&(b+=parseFloat(r.css(a,"marginTop"))||0,c+=parseFloat(r.css(a,"marginLeft"))||0);return{top:b,left:c}},setOffset:function(a,b,c){var d=r.css(a,"position");d==="static"&&(a.style.position="relative");var e=r(a),f=e.offset(),g=r.css(a,"top"),h=r.css(a,"left"),i=(d==="absolute"||d==="fixed")&&r.inArray("auto",[g,h])>-1,j={},k={},l,m;i?(k=e.position(),l=k.top,m=k.left):(l=parseFloat(g)||0,m=parseFloat(h)||0),r.isFunction(b)&&(b=b.call(a,c,f)),b.top!=null&&(j.top=b.top-f.top+l),b.left!=null&&(j.left=b.left-f.left+m),"using"in b?b.using.call(a,j):e.css(j)}},r.fn.extend({position:function(){if(!!this[0]){var a=this[0],b=this.offsetParent(),c=this.offset(),d=db.test(b[0].nodeName)?{top:0,left:0}:b.offset();c.top-=parseFloat(r.css(a,"marginTop"))||0,c.left-=parseFloat(r.css(a,"marginLeft"))||0,d.top+=parseFloat(r.css(b[0],"borderTopWidth"))||0,d.left+=parseFloat(r.css(b[0],"borderLeftWidth"))||0;return{top:c.top-d.top,left:c.left-d.left}}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||g.body;while(a&&!db.test(a.nodeName)&&r.css(a,"position")==="static")a=a.offsetParent;return a||g.body})}}),r.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,b){var c=/Y/.test(b);r.fn[a]=function(e){return r.access(this,function(a,e,f){var g=dc(a);if(f===d)return g?b in g?g[b]:g.document.documentElement[e]:a[e];g?g.scrollTo(c?r(g).scrollLeft():f,c?f:r(g).scrollTop()):a[e]=f},a,e,arguments.length,null)}}),r.each({Height:"height",Width:"width"},function(a,b){r.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,e){r.fn[e]=function(e,f){var g=arguments.length&&(c||typeof e!="boolean"),h=c||(e===!0||f===!0?"margin":"border");return r.access(this,function(b,c,e){var f;if(r.isWindow(b))return b.document.documentElement["client"+a];if(b.nodeType===9){f=b.documentElement;return Math.max(b.body["scroll"+a],f["scroll"+a],b.body["offset"+a],f["offset"+a],f["client"+a])}return e===d?r.css(b,c,e,h):r.style(b,c,e,h)},b,g?e:d,g,null)}})}),typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return r});return r});define("utils/log/Logger",function(a,b,c){var d=a("external/jquery"),e=a("utils/Utils"),f={homeTimelinePage:"pHometl",groupTimelinePage:"pGrouptl",userColumnTimelinePage:"pColumntl",columnTimelinePage:"pColumntl",userTimelinePage:"pUsertl2",favTimelinePage:"pFavtl",feedTimelinePage:"pFeed",replyByMeTimelinePage:"pReply",reply2MeTimelinePage:"pReplied",tweetAtTimelinePage:"pAttl",replyAtTimelinePage:"pAtReplytl",userTweetPage:"pUsertl",singleTweetPage:"pStatus",sessionPage:"pInBox",userFollowingPage:"pFollowing",userFollowersPage:"pFollowed",searchTweetPage:"pSearchTweet",searchUserPage:"pSearchUser",searchAppPage:"pSearchApp",findPage:"pFindUser",guessPage:"pGuess",authUserPage:"pAuthUser",importPage:"pContact",profilePage:"pSetting.profile",urlPage:"pSetting.url",passwordPage:"pSetting.password",tagsPage:"pSetting.tag",idCardPage:"pSetting.idCard",avatarPage:"pSetting.face",privacyPage:"pSetting.privacy",blockingPage:"pSetting.blocking",noticePage:"pSetting.notice",browsingPage:"pSetting.browsing",pushPage:"pSetting.push",connectionsPage:"pSetting.connections",widgetPage:"pSetting.widget",cardPage:"pSetting.card",discoverPage:"pDiscover",darenServicePage:"pDarenVip",rssJustLookTimelinePage:"pDiscover.htl"},g={headNav:"nav",rankMenuList:"rank.menu",mobileMenuList:"mobile.menu",mainTweetList:"mainList",userGuessContainer:"wGuess",relationList:"wRecForYou",recommendForYou:"wRecForYou",userRecommend:"wRec",topicRecommend:"wHotTopic",userTag:"wTag",userFollowing:"wFollowing",userFollowed:"wFollowed",followingLocationContainer:"wFoPoi",userTopicListContainer:"wFoTopic",floatAdContainer:"wFloatAd",selfInfoContainer:"wSelfInfo",appContainer:"wRecApp",eventContainer:"wEvent",textAdContainer:"textAd",ztPicContainer:"ztPic",userInfo:"wUserInfo",mainUserContainer:"mainUser",replyListWrap:"replyList",retweetListWrap:"retweetList",mobileAdContainer:"wMobile",helpContainer:"wFeedback",floatIntroTipBox:"floatIntro",groupListBox:"grouptab",mainGuessList:"mainGuessList",userSimilarContainer:"wNewfollow",headSearch:"wSbox",search_form:"pSbox",userBadgeContainter:"medal",userTweetRecommend:"followRec",singleHotTopic:"footerTips",rssContainter:"wDiscover",darenServiceUserList:"daren",darenServiceTweetList:"tweet",welcomeBox:"revisit",pushNews:"highlightNews",userRecommendBox:"wRecGuide"},h=d.extend({},f,g),i=function(a){var b=d(a).first();if(b[0]==window)return"window";var c=d.map(b.parents().andSelf(),function(a){return d(a).data("keyfrom")||h[a.id]||undefined});return c.join(".")},j=function(a){var b=d.param(a,!0);(new Image).src="/perform.do?"+b},k=function(a,b){var c="/page.do?keyfrom="+i(a);if(b&&d.isPlainObject(b))for(var f in b)c+="&"+f+"="+b[f];e.analytics.send(c)};return{keyFrom:i,doLog:j,triggerLog:k,keyFromMap:h}});define("utils/Utils",function(a,b,c){var d=a("external/jquery"),e=a("utils/Cookie"),f={},g=d(window),h=d(document);f.URL_REG=/(http)s?:\/\/(?:[\w-]+\.?)+[\.\/\?%&=#@\[\]\-+_!:*~\w-]+|(www)\.(?:[\w-]+\.?)+[\.\/\?%&=#@\[\]\-+_!:*~\w-]+/gi,f.URL_TOSHORT_REG=/(http)s?:\/\/(?:[\w-]+\.?)+[\.\/\?%&=#@$();,\[\]\-+_!:*~\w-]+/g,f.EMAIL_REG=/^[a-zA-Z0-9_\-\.]{1,}@[a-zA-Z0-9_\-]{1,}\.[a-zA-Z0-9_\-.]{1,}$/,f.USER_REG=/([@＠])([\-\u4e00-\u9fa5a-zA-Z0-9]{1,24})/g,f.IMG_REG=/http:\/\/(126.fm\/[a-zA-Z0-9]{4,6})|http:\/\/[a-zA-Z0-9]*\.(ph|bimg).126.net\/[_\-a-zA-Z0-9]+==\/[0-9]+\.(gif|jpg|bmp|jpeg|jpe|png)/g,f.OIMAGE_REG=/^http:\/\/timge[0-9].126.net\/image?.+/,f.EMO_REG=/\[([\u4e00-\u9fa5a-zA-Z0-9]+)\]/g,f.CONV_REG=/([#＃])([^#＃\s]+)([#＃]?)/g,f.SHOWNAME_REG=/^[\u4e00-\u9fa5a-zA-Z0-9]+$/,f.REALNAME_REG=/^[\u4e00-\u9fa5]+$/,f.MSN_REG=/\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/,f.QQ_REG=/^[0-9]+$/,f.MOBILE_REG=/^0*(13|14|15|18)\d{9}$/,f.IDNUMBER_REG=/^\w{1,18}$/i,f.IDCARD_REG=/^(\d{18,18}|\d{15,15}|\d{17,17}[xX])$/,f.SPE_CHARS_REG=/&#[0-9]{1,3};/g,f.FULLWIDTH_REG=/[\uFE30-\uFFA0\u2E80-\u9FFF\uac00-\ud7ff\u3000‘“”’]/g,f.OIMAGE_DOMAIN=["timge1","timge2","timge3","timge4","timge5","timge6","timge7","timge8","timge9"],f.LOADING_BIG='<div class="loadingBox"><span><em class="icon-loadingB"></em>$text$</span></div>',f.LOADING_SMALL='<div class="loadingBoxS"><span><em class="icon-loadingS"></em>$text$</span></div>',f.mail={isMail:d("body").data("page")==="mail"?!0:!1,getVersion:e.get("mail_style"),clientHeight:function(){return this.getVersion==="js5"?g.height():parseInt(netease.mail.api.Core.$.Cookie.get("mail_pos").split("_")[2])||0},scrollTop:function(){if(this.getVersion==="js5")return h.scrollTop();var a=parseInt(netease.mail.api.Core.$.Cookie.get("mail_pos").split("_")[1])-75;return a>=0?a:0}},function(a){var b=1e3,c=b*60,d=c*60,e=24*d,f=function(a,e){var f=new Date(a),g=new Date(e),h=a-e;if(h>d){var i=f.getDay()-g.getDay(),j=g.getHours(),k=g.getMinutes();j=j>=10?j:"0"+j,k=k>=10?k:"0"+k,j=j+":"+k;if(i>1||i<0){var l=g.getMonth()+1,m=g.getDate();l=l>10?l:"0"+l,m=m>10?m:"0"+m;return g.getFullYear()+"-"+l+"-"+m+" "+j}return i===1?"昨天 "+j:"今天 "+j}return h>c?parseInt(h/c,10)+"分钟前":h>b?parseInt(h/b,10)+"秒前":"1秒前"},g={};a.formatPrettyTime=function(a,b){var c=a+"."+b;g[c]===undefined&&(g[c]=f(a,b));return g[c]}}(f),f.getStrBeforeSelector=function(a){return null},f.trimAll=function(a){return a.replace(/\s/gi,"")},f.countChars=function(a,b,c){var d=a.replace(/[\u4e00-\u9fa5\s]/g,"**").length,e=[],f=0;if(d<=b)return a;for(var g=0;g<d;g++){var h=a.charAt(g);/[^\x00-\xff]/.test(h)?f+=2:f+=1,e.push(h);if(f>=b)break}return c?e.join(""):e.join("")+"..."},f.strLen=function(a){var b=a.replace(/[^\x00-\xff]/g,"**").length;return b},f.validateEmail=function(a){if(typeof a!="string")return!1;return f.EMAIL_REG.test(a)},f.validateName=function(a){var b="";typeof a!="string"?b="昵称不能为空":/^[\u4e00-\u9fa5a-zA-Z0-9]+$/.test(a)?a.replace(/[\u4e00-\u9fa5]/g,"**").length>24&&(b="请输入不超过24个字符的昵称"):b="昵称错误，只支持中文，数字和字母";return b},f.random=function(a){return Math.floor(a*(Math.random()%1))},f.randomOimageUrl=function(){var a={};return function(b,c,d,e){if(typeof b!="string"||b==="")throw"OimageUrl is Error!!!";var g=e+c+"|"+d+b;if(!a[g]){var h=b.substr(b.length-1,1).charCodeAt()%9;a[g]="http://"+f.OIMAGE_DOMAIN[h]+".126.net/image?"+(typeof c=="number"?"w="+c:"")+(typeof d=="number"?"&h="+d:"")+"&url="+encodeURIComponent(b)+"&gif="+(e?0:1)+"&quality=85"}return a[g]}}(),f.updateCount=function(a,b){b!==0?a.show().html("("+b+")"):a.hide()},f.updateNewCount=function(a,b,c){b!==0?(b=b>99?"99+":b,b=c?b:"("+b+")",a.show().html(b)):a.hide()},f.buildCursor=function(a){return a.id+":"+a.timestamp},f.S4=function(){return((1+Math.random())*65536|0).toString(16).substring(1)},f.pageWidth=function(){return parseFloat(document.documentElement.clientWidth)},f.pageHeight=function(){return Math.max(document.documentElement.scrollHeight,document.documentElement.clientHeight)},f.windowWidth=function(){return parseFloat(screen.width)},f.windowHeight=function(){return self.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body.clientHeight},f.scrollY=function(){return self.pageYOffset||document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop},f.scrollX=function(){return self.pageXOffset||document.documentElement&&document.documentElement.scrollLeft||document.body.scrollLeft},f.getXY=function(a){var b=a.offsetLeft,c=a.offsetTop;while((a=a.offsetParent)!=null)b+=a.offsetLeft,c+=a.offsetTop;return{top:c,left:b}},f.scrollTo=function(a){f.mail.isMail?Webmail.evalScript("top.frames.index.window.scrollTo(0, 0);"):d.scrollTo(a)},f.encodeSpecialHtmlChar=function(a){if(a){var b=["<",">"],c=["&lt;","&gt;"],d=c.length;for(var e=0;e<d;e++)a=a.replace(new RegExp(b[e],"g"),c[e]);return a}return""},f.decodeSpecialHtmlChar=function(a){if(a){var b=["&lt;","&gt;"],c=["<",">"],d=c.length;for(var e=0;e<d;e++)a=a.replace(new RegExp(b[e],"g"),c[e]);return a}return""},f.getMovie=function(a){var b=navigator.appName.indexOf("Microsoft")!=-1;return b?window[a]:document[a]},f.analytics={imgArray:[new Image,new Image,new Image,new Image,new Image],send:function(a){if(typeof a=="undefined")throw"no analytics address";var b=this.imgArray[f.random(5)];a.match(/^http:\/\/.+/)?b.src=a:b.src="http://"+location.host+(/^\//.test(a)?a:"/"+a)}},f.recommendReason=function(a,b){var a=parseInt(a),b=typeof b!="undefined"&&b!==null?parseInt(b):0,c={1:"有"+b+"个共同好友",2:"有"+b+"个相同关注",3:b+"个间接关注人",12:"Ta是来自博客的好友",7:"Ta是来自跟贴的好友",13:"Ta是来自邮箱微博好友",11:"Ta在你附近",8:"Ta是你的校友",9:"Ta是你的同事",10:"你们有相同标签",14:"你可能对Ta感兴趣"};return c[a]},f.getBigBoss=function(){var a=d("#boss").text();return d.trim(a)},f.preLoad=function(a){var b='<div class="preLoad">';for(var c=0;c<a.length;c++)a[c].match(f.URL_REG)?b+='<img src="'+a[c]+'"/>':b+='<div class="'+a[c]+'"></div>';b+="</div>",d(document.body).append(b)},f.parseURL=function(a){var b=/^(?:([A-Za-z]+):(\/{0,3}))?([0-9.\-A-Za-z]+\.[0-9A-Za-z]+)?(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/,c=["url","scheme","slash","host","port","path","query","hash"],d=b.exec(a),e={};for(var f=0,g=c.length;f<g;f++)e[c[f]]=d[f]||"";return e},f.getScript=function(){var a={};return function(b,c,e){(!c||!a[b])&&d.ajax({url:b,dataType:"script",success:function(){a[b]=!0,e&&e()},cache:!0})}}(),f.onBindInputAction=function(a,b,c){var e="#ABABAB",f="#333",g=a.data("blank")||null;a.css("color",e).val(g),a.bind("focus",function(){a.css("color",f),g&&d.trim(this.value)===g&&(this.value=""),b&&b()}).bind("blur",function(){a.css("color",e),g&&d.trim(this.value)===""&&(this.value=g),c&&c()})},f.getSortedKey=function(a,b){var c=[];for(var d in a)c.push(parseInt(d));if(b==="b2s")return c.sort(function(a,b){return b-a});if(b==="s2b")return c.sort(function(a,b){return a-b})};return f});define("utils/Cookie",function(a,b,c){var d=a("external/jquery"),e={set:function(a,b,c){var d="";if(c){var e=0,f=new Date;c==="today"&&(c=1,e=f.getHours()*3600+f.getMinutes()*60+f.getSeconds()),f.setTime(f.getTime()+c*24*60*60*1e3-e*1e3),d="; expires="+f.toGMTString()}document.cookie=a+"="+b+d+"; path=/"},get:function(a){var b=a+"=",c=document.cookie.split(";");for(var d=0;d<c.length;d++){var e=c[d];while(e.charAt(0)===" ")e=e.substring(1,e.length);if(e.indexOf(b)===0)return decodeURIComponent(e.substring(b.length,e.length))}return null},del:function(a){this.set(a,"",-1)}};return e});define("task/user/setLoginUser",function(a,b,c){var d=a("task/Task");(new d("setLoginUser",function(){var b=a("external/jquery"),c=a("model/UserData"),d=b("#data_loginUser"),e=b("#data_loginEmail");if(d.size()){var f=d.html().replace(/\r\n|\n|\r/g,""),g=new c(b.parseJSON(f));c.setLoginUser(g)}else e.size()&&(c.passport=b.trim(e.text()))})).add()});define("model/UserData",function(a,b,c){var d=a("external/jquery"),e=a("basic/oop/Class"),f=a("utils/Utils"),g={},h={},i=e.extend({init:function(a){this.id=i.update(a)},get:function(){return g[this.id]},bindUpdate:function(a){i.bindUpdate(this.id,a)}}),j=["isFollowing","isBlocking","followingCount","groupInfos","remark"];i.update=function(a){if(a.avatar!==undefined){var b=a.avatarSize?a.avatarSize:54;a.avatar===""?a.avatar=f.randomOimageUrl("http://mimg.126.net/p/butter/1008031648/img/face_big.gif",b,b):a.avatar.match(f.OIMAGE_REG)||(a.avatar=f.randomOimageUrl(a.avatar,b,b))}var c=!1,e=[];if(g[a.id]!==undefined){var h=g[a.id];for(var k=0,l=j.length;k<l;k++){var m=j[k];a[m]!==undefined&&h[m]!==undefined&&a[m].toString()!=h[m].toString()&&(e.push(m),c=!0)}}g[a.id]=d.extend(g[a.id],a),c&&i.publishUpdate(a.id,e);return a.id},i.bindUpdate=function(a,b){var c=h[a]||[];c.push(b),h[a]=c},i.publishUpdate=function(a,b){var c=h[a];if(c!==undefined)for(var d=0,e=c.length;d<e;d++)c[d](i.get(a),b)},i.get=function(a){return g[a]||null},i.getByNickName=function(a){for(var b in g)if(g[b].nickName==a)return g[b];return null},i.loginUserId=null,i.getLoginUser=function(){if(i.loginUserId===null)return null;return i.get(i.loginUserId)},i.setLoginUser=function(a){a&&a.id&&(a.isLoginUser=!0,i.loginUserId=i.update(a))},i.passport=null;return i});define("task/user/setGroupInfo",function(a,b,c){var d=a("task/Task");(new d("setGroupInfo",function(){var b=a("external/jquery"),c=a("model/GroupData"),d=b("#data_groupInfo");d.size()>0&&c.setGroupInfo(b.parseJSON(d.html()))})).add()});define("model/GroupData",function(a,b,c){var d=a("external/jquery"),e=a("basic/oop/Class"),f=a("utils/Utils"),g={},h=null,i=[],j={},k=e.extend({});k.update=function(a){var b=!1;if(g[a.id]!==undefined){var c=g[a.id];for(var e=0,f=varKeys.length;e<f;e++){var h=varKeys[e];if(a[h]!==undefined&&a[h]!==c[h]){b=!0;break}}}g[a.id]=d.extend(g[a.id],a),b&&k.publishUpdate(a.id);return a.id},k.exitById=function(a){for(var b=0,c=i.length;b<c;b++)if(i[b].gId==a)return!0;return!1},k.getNameById=function(a){for(var b=0,c=i.length;b<c;b++)if(i[b].gId==a)return i[b].name;return""},k.setNewGroupName=function(a,b){h.currentName=b;for(var c=0,d=i.length;c<d;c++)if(i[c].gId==a){i[c].name=b;break}},k.getGroupList=function(a){return i},k.setGroupInfo=function(a){h=a,i=h.list},k.getGroupInfo=function(a){return h},k.publishUpdate=function(a){};return k});define("task/error",function(a,b,c){var d=a("task/Task"),e=a("task/TaskManager");e.add(new d("bindErrorManager",function(){var b=a("utils/error/ErrorManager");b.bindEvent()}))});define("utils/error/ErrorManager",function(a,b,c){var d=a("external/jquery"),e=a("basic/oop/Class"),f=a("widget/floatBox/login/LoginBox"),g=a("guide/RegisterGuide"),h=a("qun/widget/JoinBox"),i=a("model/UserData"),j=a("widget/tip/NaviTip"),k={networkErrorCount:0,bindEvent:function(){d(document).bind("error",d.proxy(this.handleError,this))},handleError:function(a,b,c){var e=null;if(b==="needLogin")if(i.passport){var k=g.getInstance("#regGuide");k.$elem.scrollToShow(),k.blink()}else e=f.getInstance(),e.show();else if(b==="needJoin")e=h.getInstance(),e.show();else if(d.isPlainObject(c)){if(b==="network"&&this.networkErrorCount<2){this.networkErrorCount++;return}j.show(c)}}};return k});define("widget/floatBox/login/LoginBox",function(a,b,c){var d=a("external/jquery"),e=a("widget/floatBox/Box"),f=a("utils/Utils"),g=a("widget/floatBox/login/EmailSuggestList"),h=a("utils/tmpl"),i=e.extend({suggest:null,$input:null,$password:null,$checkBox:null,$suggestWrap:null,preRender:function(){this.data.url=f.encodeSpecialHtmlChar(window.location.href);return{content:h.formatTemplate(a("_tmpl/loginBox"),this.data),title:"登录"}},postRender:function(){this.$elem.addClass("poplayer-loginbox"),this.$formElem=this.$elem.find("form"),this.$inputElem=this.$elem.find("input:text"),this.$passwordElem=this.$elem.find("input:password"),this.$checkbox=this.$elem.find("input:checkbox"),this.$tipUsername=this.$elem.find(".js-tips-username").hide(),this.$tipPassport=this.$elem.find(".js-tips-passport").hide(),this.$suggestWrap=this.$elem.find(".js-list"),this.suggest=new g(this.$suggestWrap.find("ul")),this.$suggestWrap.show().detach()},bindEvent:function(){this._super(),this.$elem.delegate(".login-trigger","click",d.proxy(this.onSubmit,this)),this.$inputElem.bind("keyup",d.proxy(this.onInput,this)).bind("focus",d.proxy(function(){this.$tipUsername.hide()},this)),this.$inputElem.bind("blur",d.proxy(this.onBlur,this)),this.$inputElem.bind("focus",d.proxy(this.onFocus,this)),this.$passwordElem.bind("keyup",d.proxy(this.onPassInput,this)).bind("focus",d.proxy(function(){this.$tipPassport.hide()},this)),this.$suggestWrap.bind("select.EmailSuggestList",d.proxy(this.onSelect,this))},onCheckVal:function(){var a=d.trim(this.$inputElem.val()),b=this.$passwordElem.val(),c=this.$checkbox.prop("checked");if(a===""){this.onTextTips(this.$tipUsername,"error","通行证不能为空");return!1}if(!f.validateEmail(a)){this.onTextTips(this.$tipUsername,"error","邮箱格式有误");return!1}if(b===""){this.onTextTips(this.$tipPassport,"error","密码不能为空");return!1}this.onTextTips(this.$tipUsername,"hide"),this.onTextTips(this.$tipPassport,"hide");return!0},onInputTrigger:function(a){var b=this;clearTimeout(this.inputTimer),this.inputTimer=setTimeout(function(){b.onInput(a)},100)},onInput:function(a){var b=d.trim(this.$inputElem.val());a.which==13&&d("#loginbox_suggestResult").size()===0&&this.onSubmit(a);b.length===0?this.hideSuggest():this.showSuggest(b)},onPassInput:function(a){a.which==13&&this.onSubmit(a)},onSubmit:function(a){if(!!this.onCheckVal()){this.$formElem.submit();return!1}},showSuggest:function(a){var b=this.$inputElem.offset();b.top+=this.$inputElem.height(),this.$suggestWrap.appendTo("body").css({top:b.top,left:b.left}).width(this.$inputElem.innerWidth()).show().css("z-index","2000"),this.suggest.show(a,14)},hideSuggest:function(){clearTimeout(this.hideSuggestTimer);var a=this;this.hideSuggestTimer=setTimeout(function(){a.$suggestWrap.detach(),a.suggest.unbindEvent()},150)},onSelect:function(a,b){this.$inputElem.val(b),this.hideSuggest(),setTimeout(d.proxy(function(){this.$passwordElem.focus()},this),200)},onFocus:function(a){this.onInput(a)},onBlur:function(a){this.hideSuggest()},show:function(){this._super(),this.$inputElem.focus().scrollToShow()},hide:function(){this.hideSuggest(),this._super()}}),j=null;return{getInstance:function(a,b){j!==null&&j.hide(),j=new i(a,b);return j}}});define("widget/floatBox/Box",function(a,b,c){var d=a("external/jquery"),e=a("utils/tmpl"),f=a("widget/Box"),g=a("utils/Utils"),h=f.extend({renderTmpl:function(b){return d(e.formatTemplate(a("_tmpl/box"),d.extend({content:""},b)))},onLayerClick:function(){throw new Error("Not Implemented")},showLoading:function(){if(!this.$loadingLayer){var a=this.config.tipText||"保存中，请稍等...";this.$loadingLayer=d('<div class="poplayer-loading" style="visibility:hidden">\n                     <div class="poplayer-loading-layer js-loading-layer"></div>\n                     <div class="poplayer-loading-tip js-loading-tip"><div class="loadingBoxS"><span><em class="icon-loadingS"></em>'+a+"</span></div></div>\n                  </div>");var b=this.$elem.find(".js-body");b.append(this.$loadingLayer);var c=this.$loadingLayer.find(".js-loading-tip");this.$loadingLayer.find(".js-loading-layer").andSelf().css({width:b.innerWidth(),height:b.innerHeight()}),c.css({marginLeft:"-"+c.width()/2+"px",marginTop:"-"+c.height()/2+"px"})}this.$loadingLayer.css({visibility:"visible"})},hideLoading:function(){this.$loadingLayer.css({visibility:"hidden"})},show:function(){this._super();if(!!this.$elem){this.$elem.appendTo("body");var a=d(window),b=d(document),c=a.width(),e=b.height(),f=this.$elem.find(".js-table");this.$elem.find(".js-layer").css({height:e,width:c}),this.$elem.find(".js-iframe").css({height:e,width:c});var h=g.mail.isMail?g.mail.clientHeight():a.height(),i=g.mail.isMail?g.mail.scrollTop():b.scrollTop(),j=(h-f.height())/2-10;j=Math.max(j,0)+i,f.css({top:j}),this.$elem.css({visibility:"visible"}),this.resizeHandler=d.proxy(function(){this.$elem.find(".js-layer").css({height:b.height(),width:a.width()}),this.$elem.find("iframe").css({height:b.height(),width:a.width()})},this),a.bind("resize",this.resizeHandler)}},hide:function(){this._super(),d(window).unbind("resize",this.resizeHandler)}});return h});typeof process!="undefined"&&process.title==="node"&&(define=function(a){exports.formatTemplate=a().formatTemplate,exports.replaceString=a().replaceString}),define("utils/tmpl",function(a,b,c){function n(a,b){b=b||{};if(typeof a=="function")return a(b);return m(a,b)}function m(b,c){var e="",f=document.getElementById("tmpl_"+b),g=!/\W\//.test(b)&&f?d[b]=d[b]||m(f.innerHTML):new Function("tmplData","tmpl",l(b));if(c)try{return g(c,n)}catch(h){typeof console!==undefined&&console.error&&console.error("error in templates",b,":",h,h.stack);var i=a("utils/log/Logger");i.doLog({keyFrom:i.keyFrom(document.body),action:"tmplError",tmplName:b,message:h.message,stack:h.stack})}return g}function l(a){return"var p=[];with(tmplData){p.push('"+a.replace(f,"").replace(g,"").replace(e," ").replace(h,">$1<").split("<%").join("\t").replace(i,"$1\r").replace(j,"',$1,'").split("\t").join("');\n").split("%>").join("\np.push('").split("\r").join("\\'")+"');}return p.join('');"}function k(){var a={};for(var b=0;b<arguments.length;b++){var c=arguments[b];if(c&&typeof c=="object")for(var d in c)c[d]!==undefined&&c.hasOwnProperty(d)&&(a[d]=c[d])}return a}var d={},e=/[\r\t\n]/g,f=/^\s+/,g=/\s+$/,h=/>\s*(.*?)\s*</g,i=/((^|%>)[^\t]*)'/g,j=/\t=(.*?)%>/g;return{formatTemplate:n,parseTemplate:n,replaceString:l}});define("widget/Box",function(a,b,c){var d=a("external/jquery"),e=a("basic/oop/Class"),f=a("utils/tmpl"),g=a("widget/tip/NaviTip"),h=e.extend({init:function(a,b){this.data=a||{},this.config=b||{},this.$elem=null},render:function(){if(this.$elem===null){var a=this.preRender(),b=d.extend(a,this.data);this.$elem=this.renderTmpl(b),this.postRender(),this.bindEvent()}return this.$elem},renderTmpl:function(){throw new Error("abstract function!")},preRender:function(){return{}},postRender:function(){},bindEvent:function(){this.$elem.delegate(".close-trigger","click",d.proxy(this.hide,this))},show:function(){this.render(),this.hideHandler=d.proxy(function(a){a.which===27&&this.hide()},this),d(document).bind("keydown",this.hideHandler)},hide:function(){this.$elem!==null&&this.$elem.detach(),d(document).unbind("keydown",this.hideHandler)},onTip:function(a){g.show(a)},onTextTips:function(a,b,c){b==="hide"?a.hide():(c=c||"",b==="correct"?a.show().find(".js-text").removeClass("text-tips-error").html('<em class="icon-correctS"></em>'+c):b==="error"&&a.show().find(".js-text").addClass("text-tips-error").html('<em class="icon-forbidS"></em>'+c))}});return h});define("widget/tip/NaviTip",function(a,b,c){var d=a("external/jquery"),e=a("basic/oop/Class"),f=a("utils/Utils"),g=e.extend({init:function(a,b){this.$elem=null,this.data=a,this.config=b,this._timer=null},render:function(){this.$elem=d('<div class="navi-tips js-top-tips"></div>').appendTo("body"),!f.mail.isMail&&d.browser.msie&&d.browser.version<7&&(this.defaultTop=d("#headNav").height(),d(window).bind("scroll resize",d.proxy(this.onSetTopPosition,this)));return this.$elem},show:function(a,b){this.$elem===null&&this.render();!a||a===""?this.$elem.hide():(this._timer&&clearTimeout(this._timer),this.$elem.removeClass("navi-tips-error"),b=b||"success",this.$elem.html(a),b==="error"&&this.$elem.addClass("navi-tips-error"),this.onSetPosition(),this.$elem.hide().fadeIn(700),this.onClose())},onClose:function(){var a=this;this._timer=setTimeout(function(){a.$elem.fadeOut(1e3)},2e3)},onSetPosition:function(){if(f.mail.isMail){var a=f.mail.scrollTop();a<40?a=40:a=0,this.$elem.css("top",a+"px")}this.$elem.css("marginLeft","-"+this.$elem.innerWidth()/2+"px")},onSetTopPosition:function(){var a=f.scrollY()||this.defaultTop;this.$elem.css("top",a+"px")}}),h=null;return{getInstance:function(){h==null&&(h=new g);return h},show:function(a,b){d.isPlainObject(arguments[0])?this.getInstance().show(arguments[0].text,arguments[0].type):this.getInstance().show(a,b)}}});define("_tmpl/box",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div class="poplayer"><iframe class="poplayer-iframe js-iframe" scrolling="no" frameborder="0"></iframe><div class="poplayer-shade js-layer"></div><table class="poplayer-table js-table"><tbody><tr><td class="poplayer-top-left"></td><td class="poplayer-top-center"></td><td class="poplayer-top-right"></td></tr><tr><td class="poplayer-middle-left"></td><td class="poplayer-middle-center"><div class="poplayer-body js-body"><div class="poplayer-hd"><h3>',title,'</h3><a class="poplayer-close icon-close close-trigger" title="关闭" href="javascript:;"></a></div><div class="poplayer-bd">',content,'</div></div></td><td class="poplayer-middle-right"></td></tr><tr><td class="poplayer-bottom-left"></td><td class="poplayer-bottom-center"></td><td class="poplayer-bottom-right"></td></tr></tbody></table></div>');return p.join("")}});define("widget/floatBox/login/EmailSuggestList",function(a,b,c){var d=a("external/jquery"),e=a("widget/suggest/SuggestList"),f=a("utils/Utils"),g=e.extend({EMAIL_DOMAIN:["163.com","126.com","yeah.net","qq.com","vip.163.com","vip.126.com","188.com","gmail.com","sina.com","hotmail.com"],onEnter:function(a){var b=this.$elem.children(".current"),c=b.text(),d=b.attr("data-org"),e=c.split("@")[1],f=d+"@"+e;this.$elem.trigger("select.EmailSuggestList",[f])},show:function(a,b){var a=f.encodeSpecialHtmlChar(a),c=b?f.countChars(a,b):a;if(!!this._super(a)){var d,e,g=[];if(a.indexOf("@")>=0){var h=a.split("@"),i=b?f.countChars(h[0],b):h[0];for(d=0,e=this.EMAIL_DOMAIN.length;d<e;d++)(h[1]===""||this.EMAIL_DOMAIN[d].indexOf(h[1])===0)&&g.push("<li data-org="+h[0]+">"+i+"@"+this.EMAIL_DOMAIN[d]+"</li>")}else for(d=0,e=this.EMAIL_DOMAIN.length;d<e;d++)g.push("<li data-org="+a+">"+c+"@"+this.EMAIL_DOMAIN[d]+"</li>");this.$elem.html(g.join("")).children(":first").addClass("current"),this.bindEvent();return this.$elem}},onClick:function(a){this.onEnter(a)}});return g});define("widget/suggest/SuggestList",function(a,b,c){var d=a("external/jquery"),e=a("basic/oop/Class"),f=e.extend({cacheData:null,binded:null,config:null,$elem:null,hideTimer:null,init:function(a,b){this.$elem=d(a),this.config=b,this.$elem.delegate("li","hover",d.proxy(this.onHover,this)).delegate("li","click",d.proxy(this.onClick,this)),this.config&&!this.config.disableScroll&&this.$elem.bind("scroll",d.proxy(this.onScroll,this))},onHover:function(a){var b=d(a.target);a.target.tagName.toUpperCase()!=="LI"&&(b=b.parents("li").first()),b.hasClass("disable")||b.addClass("current").siblings(".current").removeClass("current")},onCurrentFirst:function(){this.$elem.children("[className!=disable]").first().addClass("current")},onScroll:function(a){clearTimeout(this.hideTimer),this.bindBodyClick||(d(document.body).one("click",d.proxy(function(){this.bindBodyClick=!1,this.hide()},this)),this.bindBodyClick=!0)},show:function(a){clearTimeout(this.hideTimer);if(a===this.cacheData)return!1;this.cacheData=a;return!0},hide:function(){clearTimeout(this.hideTimer),this.hideTimer=setTimeout(d.proxy(function(){this.unbindEvent(),this.$elem.detach()},this),200)},bindEvent:function(){this.binded||(d(document.body).bind("keydown",d.proxy(this.onKey,this)),this.binded=!0)},unbindEvent:function(){this.binded&&(d(document.body).unbind("keydown",d.proxy(this.onKey,this)),this.binded=!1)},onKey:function(a){var b=this.$elem.children();if(a.which===38||a.which===40){var c=b.filter(".current").removeClass("current"),d=null;a.which===38?d=this.getPrevElem(c,b):d=this.getNextElem(c,b),d&&d.addClass("current"),a.preventDefault()}(a.which===13||a.which===9)&&b.size()>0&&(this.onEnter(a),a.preventDefault())},getPrevElem:function(a,b){var c=a.prev();c=c.size()>0?c:b.last();return c.hasClass("disable")?this.getPrevElem(c,b):c},getNextElem:function(a,b){var c=a.next();c=c.size()>0?c:b.first();if(c.hasClass("disable"))return this.getNextElem(c,b);return c},onEnter:function(a){throw new Error("Not Implemented")},onClick:function(a){var b=d(a.target);a.target.tagName.toUpperCase()!=="LI"&&(b=b.parents("li").first());if(!b.hasClass("disable")){var c=b.attr("n");this.$elem.trigger("select",[c])}}});return f});define("_tmpl/loginBox",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<form action="https://reg.163.com/logins.jsp" method="POST" id="minLoginForm" name="loginform" target="_self"><div class="poplayer-item"><label class="poplayer-item-left" for="poplayer_username">通行证：</label><div class="poplayer-item-right"><input id="poplayer_username" class="poplayer-input" type="text" name="username" autocomplete="off" value="',tmplData.email,'" /><p class="poplayer-tips js-tips-username"><span class="text-tips text-tips-error js-text"></span></p></div></div><div class="poplayer-item"><label class="poplayer-item-left" for="poplayer_passport">密码：</label><div class="poplayer-item-right"><input id="poplayer_passport" class="poplayer-input" type="password" name="password" /><p class="poplayer-tips js-tips-passport"><span class="text-tips text-tips-error js-text"></span></p></div></div><div class="poplayer-item"><label class="poplayer-item-left">&nbsp;</label><div class="poplayer-item-right"><label class="label-tag"><input type="checkbox" value="1" name="savelogin" checked="checked" />下次自动登录</label>&nbsp;&nbsp;<a class="poplayer-linka" href="http://reg.163.com/RecoverPasswd1.shtml">忘记密码？</a><input type="hidden" name="url" value="',url,'" /><input type="hidden" value="t" name="product" /><input type="hidden" name="type" value="1" /></div></div><div class="poplayer-item poplayer-loginbox-btnbox"><label class="poplayer-item-left">&nbsp;</label><div class="poplayer-item-right"><div class="poplayer-btnbox"><a class="poplayer-btn-sure login-trigger" href="javascript:;">确定</a><a class="poplayer-btn-cancel close-trigger" href="javascript:;">取消</a></div><p class="poplayer-tips js-tips"><span class="text-tips js-text"></span></p></div></div><div id="loginbox_suggestResult" class="search-result js-list"><ul></ul></div></form>');return p.join("")}});define("guide/RegisterGuide",function(a,b,c){var d=a("external/jquery"),e=a("utils/log/Logger"),f=a("utils/Utils"),g=function(a){this.$elem=d(a),this.$loginBox=null,this.$registerBox=null,this.bindEvent()};g.prototype={bindEvent:function(){this.$elem.delegate(".open-trigger","click",d.proxy(this.onRegister,this))},onRegister:function(b){var c=a("utils/DataSource"),f=a("utils/Utils"),g=a("widget/floatBox/login/LoginBox"),h=a("widget/floatBox/RegisterBox"),i=this,j=this.$elem.find(".open-trigger"),k=this.$elem.find(".js-error"),l=this.$elem.find(".js-input"),m=d.trim(l.val()),n=j.attr("data-enable-account");if(n==="true"){var o=f.validateName(m);if(o!=="")k.html(o);else{c.setKeyFrom(i.$elem).postJSON("checkNickname",{nickName:m},function(a){if(a.result===!1){c.setKeyFrom(i.$elem).postJSON("userRegister",{nickName:m},function(a){window.location="/signup/passport"});var b=e.keyFrom(i.$elem);f.analytics.send("/page.do?method=createUser&keyfrom="+b)}else k.html("这个昵称太受欢迎了，换个试试")});var p=e.keyFrom(i.$elem);f.analytics.send("/page.do?method=nameExist&keyfrom="+p)}}else if(m==="")k.html("邮箱地址不能为空");else if(!f.validateEmail(m))k.html("该邮箱格式有误,请修改");else{c.setKeyFrom(i.$elem).postJSON("userExist",{email:m},function(a){a.result?(i.$loginBox===null&&(i.$loginBox=g.getInstance({email:m})),i.$loginBox.show()):c.setKeyFrom(i.$elem).postJSON("passportExist",{email:m},function(a){a.result?(i.$registerBox===null&&(i.$registerBox=h.getInstance({email:m})),i.$registerBox.show()):window.location="http://reg.163.com/reg/reg.jsp?product=t&url=http://t.163.com/&loginurl=http://t.163.com&username_r="+m})});var p=e.keyFrom(i.$elem);f.analytics.send("/page.do?method=exist&keyfrom="+p)}},onShowLogin:function(a){},blink:function(){var a=this.$elem.find(".js-input");if(a.size()!==0){var b=function(){a.toggleClass("blink")};for(var c=0;c<8;c++)setTimeout(b,c*100)}}};var h=null;return{getInstance:function(a){h===null&&(h=new g(a));return h}}});define("utils/DataSource",function(a,b,c){var d=a("external/jquery"),e=a("model/UserData"),f=a("utils/log/Logger"),g={keyFrom:null,requestMap:{longUrl:{url:"http://163.fm/getOriginal",login:!1},checkAppointNickName:{url:"/user.do?action=checkNickName",login:!1},fav:{url:"/favourites.do?action=create",login:!0},unBindPushService:{url:"/user.do?action=unbindService",login:!1},unfav:{url:"/favourites.do?action=destroy",login:!0},userExist:{url:"/user.do?action=exist",login:!1},passportExist:{url:"/user.do?action=isPassport",login:!1},sendTweet:{url:"/tweet.do?action=addTweet",login:!0},deleteTweet:{url:"/tweet.do?action=deleteTweet",login:!0},bindService:{url:"/user.do?action=bindService",login:!1},atSuggest:{url:"/tweet.do?action=atSuggest",login:!0},messageSuggest:{url:"/tweet.do?action=atSuggest&suggestType=1",login:!0},topicSuggest:{url:"/tweet.do?action=topicRecent",login:!0},atRecent:{url:"/tweet.do?action=atRecent",login:!0},atRecentAll:{url:"/tweet.do?action=atRecent&type=all",login:!0},following:{url:"/user.do?action=getFollowings",login:!1},follow:{url:"/relation.do?action=follow",login:!0},batchfollow:{url:"/relation.do?action=batchfollow",login:!0},unfollow:{url:"/relation.do?action=unFollow",login:!0},block:{url:"/relation.do?action=block",login:!0},unblock:{url:"/relation.do?action=unBlock",login:!0},guessList:{url:"/introduce.do?action=recommendRandom",login:!0},guessYouLikeList:{url:"/introduce.do?action=recommendRandomByMerge",login:!0},followRelationList:{url:"/introduce.do?action=followRecommendReason",login:!0},unlike:{url:"/relation.do?action=suggestBlock",login:!0},recommend:{url:"/yunying.do?action=recommendDaren",login:!1},allReplies:{url:"/tweet.do?action=replyList",login:!0},allReplyBuild:{url:"/tweet.do?action=replyBuildingList",login:!0},updateUserBuilding:{url:"/user.do?action=updateUserBuilding",login:!0},replyFloorList:{url:"/tweet.do?action=replyFloorList",login:!0},msgSession:{url:"/tweet.do?action=sessionTimeline",login:!0},msgItem:{url:"/tweet.do?action=messageTimeline",login:!0},homeTimeline:{url:"/tweet.do?action=homeTimeline",login:!0},groupTimeline:{url:"/tweet.do?action=groupTimeline",login:!0},userTimeline:{url:"/tweet.do?action=userTimeline",login:!0},favTimeline:{url:"/tweet.do?action=favoriteTimeline",login:!0},reply2MeTimeline:{url:"/tweet.do?action=reply2meTimeline",login:!0},replyByMeTimeline:{url:"/tweet.do?action=replybymeTimeline",login:!0},tweetAtTimeline:{url:"/tweet.do?action=tweetAtTimeline",login:!0},replyAtTimeline:{url:"/tweet.do?action=replyAtTimeline",login:!0},revMessageTimeline:{url:"/tweet.do?action=revMessageTimeline",login:!0},sentMessageTimeline:{url:"/tweet.do?action=sentMessageTimeline",login:!0},allRetweets:{url:"/tweet.do?action=retweetList",login:!0},checkNickname:{url:"/user.do?action=nameExist",login:!1},userRegister:{url:"/user.do?action=createUser",login:!1},queryCount:{url:"/user.do?action=queryCount",login:!0,silent:!0},sendMessage:{url:"/message.do?action=sendMessage",login:!0},deleteMessage:{url:"/message.do?action=deleteMessage",login:!0},deleteSession:{url:"/message.do?action=deleteSession",login:!0},followingPois:{url:"/lbs.do?action=getFollowingPois",login:!1},userTopic:{url:"/user.do?action=getFollowingTopics",login:!0},followTopic:{url:"/user.do?action=followTopic",login:!0},unfollowTopic:{url:"/user.do?action=unFollowTopic",login:!0},video:{url:"/video.do?action=parse",login:!1},ku6SuggestKey:{url:"/video.do?action=getKu6SuggestKey",login:!1},searchKu6:{url:"/video.do?action=searchKu6",login:!1},addVideoInfo:{url:"/video.do?action=addVideoInfo",login:!1},toShortUrl:{url:"/yunying.do?action=toShortUrl",login:!1},music:{url:"/music.do?action=search",login:!1},musicToShortURL:{url:"/music.do?action=toShortUrl",login:!1},latestPoi:{url:"/lbs.do?action=getLastActivePois",login:!1},searchLbs:{url:"/lbs.do?action=searchPoi",login:!0},getRightRecEA:{url:"/yunying.do?action=getRightRecEA",login:!0},getMobileRecommend:{url:"/yunying.do?action=getRightRecMob",login:!0},tipsAd:{url:"/yunying.do?action=getTips",login:!0},closeTip:{url:"/yunying.do?action=closeTip",login:!0},skinSetting:{url:"/yunying.do?action=getThemes",login:!0},verify:{url:"/dog.do?action=verify",login:!0},verifyGentie:{url:"/dog.do?action=verifyGentie",login:!0},updateUser:{url:"/user.do?action=updateUserConfig",login:!0},reportSpam:{url:"/dog.do?action=report",login:!0},tweetTag:{url:"/tweet.do?action=getTagData",login:!1},floatIntro:{url:"/user.do?action=getUserIntro",login:!0},checkGroupName:{url:"/user.do?action=existsGroup",login:!0},saveGroup:{url:"/user.do?action=addGroup",login:!0},getFollowingsSimple:{url:"/user.do?action=getFollowingsSimple",login:!0},userFollowing:{url:"/user.do?action=getFollowingTweets",login:!0},userFollowers:{url:"/user.do?action=getFollowerTweets",login:!0},userGroup:{url:"/user.do?action=addGroupUser",login:!0},userUnGroup:{url:"/user.do?action=deleteGroupUser",login:!0},userCreateGroup:{url:"/user.do?action=addGroupSingle",login:!0},removeGroup:{url:"/user.do?action=deleteGroup",login:!0},orderGroup:{url:"/user.do?action=updateGroupsOrder",login:!0},searchTweet:{url:"/search.do?action=searchTweet",login:!1},searchUser:{url:"/search.do?action=searchUser",login:!1},searchApp:{url:"/search.do?action=searchApp",login:!1},searchUserXml:{url:"/search.do?action=findUserJson",login:!1},userRemark:{url:"/user.do?action=setUserRemark",login:!0},guessUser:{url:"/introduce.do?action=recommend",login:!0},authUser:{url:"/introduce.do?action=recDarenFind",login:!0},simillarList:{url:"/introduce.do?action=recommendSimilarity",login:!0},updateUserInfo:{url:"/introduce.do?action=updateUserInfo",login:!0},inviteAndFollow:{url:"/introduce.do?action=inviteAndFollow",login:!0},mailImport:{url:"/introduce.do?action=mailImport",login:!0},msnImport:{url:"/introduce.do?action=msnImport",login:!0},openAccount:{url:"/user.do?action=regUser",login:!0},openAccount2:{url:"/user.do?action=updateUser",login:!0},regRecommend:{url:"/yunying.do?action=firstRecommendDaren",login:!0},recomendForInactive:{url:"/yunying.do?action=recomendForInactive",login:!0},followSelected:{url:"/relation.do?action=followBatch",login:!0},checkShowname:{url:"/user.do?action=nickNameExist",login:!1},checkMobile:{url:"/user.do?action=phoneExist",login:!0},updateProfile:{url:"/user.do?action=updateUser",login:!0},updateAvatar:{url:"/user.do?action=updateUserImg",login:!0},blockList:{url:"/user.do?action=getBlockings",login:!0},updateNotice:{url:"/user.do?action=updateUserNotice",login:!0},updateBrowsing:{url:"/user.do?action=updateBrowsing",login:!0},privacy:{url:"/user.do?action=updateUserPrivacy",login:!0},connections:{url:"/user.do?action=updateConnections",login:!0},addTag:{url:"/user.do?action=addUserTag",login:!0},delTag:{url:"/user.do?action=delUserTag",login:!0},searchSuggest:{url:"/search.do?action=suggestAtHome",login:!1},searchSuggestTweet:{url:"/search.do?action=suggestKeyword",login:!1},getHotTweets:{url:"/yunying.do?action=getRightRecTweet",login:!1},badgeIntro:{url:"/tweet.do?action=queryUserBadgeInfo",login:!1},lightBadge:{url:"/tweet.do?action=lightBadge",login:!0},applyFamilyBadge:{url:"/tweet.do?action=applyFamilyBadge",login:!0},scoreGoodsList:{url:"/tweet.do?action=queryBadgeExchangeInfos",login:!0},exchangeRecord:{url:"/tweet.do?action=queryNewExchangeRecord",login:!0},preview:{url:"/preview.do?action=preview",login:!1},userRecommendBox:{url:"/yunying.do?action=recDarenIfFolloweesLess",login:!1},changeScreenName:{url:"/user.do?action=updateScreenName",login:!1},recommendFollowee:{url:"/introduce.do?action=recommendFollowee",login:!0},voteCreate:{url:"/vote.do?action=create",login:!0},getVote:{url:"/vote.do?action=getVote",login:!1},vote:{url:"/vote.do?action=vote",login:!0},towerCreate:{url:"/gentie.do?action=create",login:!0},getTower:{url:"/tweet.do?action=gentieBuildingList",login:!1},tower:{url:"/gentie.do?action=gentie",login:!0},towerExpand:{url:"/tweet.do?action=gentieFloorList",login:!1},towerdigg:{url:"/gentie.do?action=digg",login:!1},updateUserIDCard:{url:"/user.do?action=updateUserIDCard",login:!0},updateUserIDCard2:{url:"/user.do?action=updateUserIDCard2",login:!0},getLotteryCount:{url:"/user.do?action=getLotteryCount",login:!0},updateUserIDCard3:{url:"/user.do?action=updateUserIDCard3",login:!0},qunTimeline:{url:"/tweet.do?action=qunTimeline",login:!0},qunSearchTimeline:{url:"/search.do?action=searchQunTopic",login:!0},qunSort:{url:"/qun.do?action=getQunTypes",login:!1},checkQunName:{url:"/qun.do?action=checkQunName",login:!1},checkQunTopic:{url:"/qun.do?action=checkQunTopic",login:!1},checkQunDesc:{url:"/qun.do?action=checkQunDesc",login:!1},qunCreate:{url:"/qun.do?action=createQun",login:!1},deleteQun:{url:"/qun.do?action=deleteQun",login:!1},qunUpdate:{url:"/qun.do?action=updateQun",login:!1},qunMemberList:{url:"/qun.do?action=queryQunMembersJsonInfo",login:!1},searchQunMember:{url:"/search.do?action=searchUserFromQun",login:!1},manageMemberList:{url:"/qun.do?action=queryQunMemberAdminJsonInfo",login:!0},searchManageMember:{url:"/search.do?action=searchUserFromQun",login:!0},blockQunMember:{url:"/qun.do?action=pullQunBlackList",login:!0},deleteQunMember:{url:"/qun.do?action=killOffUserFromQun",login:!0},qunBlackList:{url:"/qun.do?action=queryQunBlackListJsonInfo",login:!0},cancelBlackedUser:{url:"/qun.do?action=cancelBlackedUserFromQun",login:!0},searchQun:{url:"/search.do?action=searchQun",login:!1},joinQun:{url:"/qun.do?action=joinQun",login:!0},applyJoinQun:{url:"/qun.do?action=applyJoinQun",login:!0},quitQun:{url:"/qun.do?action=quitQun",login:!0},activeQunUsers:{url:"/qun.do?action=activeUsers",login:!1},qInvite:{url:"/qun.do?action=invite",login:!1},naviApp:{url:"/app/navi",login:!1},qApplyJoinList:{url:"/qun.do?action=queryQunApplyJoinAdminJsonInfo",login:!0},qPass:{url:"/qun.do?action=passApplyJoinQun",login:!0},qReject:{url:"/qun.do?action=refuseApplyJoinQun",login:!0},qBlockApply:{url:"/qun.do?action=blackApplyJoinUser",login:!0},qClaim:{url:"/qun.do?action=cantakeOverQun",login:!0},qSubmitClaim:{url:"/qun.do?action=takeOverQun",login:!0},addTopTweet:{url:"/tweet.do?action=addQunTopTweet",login:!0},unTopTweet:{url:"/tweet.do?action=delQunTopTweet",login:!0},qMine:{url:"/qun.do?action=getMyQun",login:!0},checkAddColumn:{url:"/mcolumn.do?action=checkAddColumn",login:!1},getColumnList:{url:"/mcolumn.do?action=getColumnList",login:!1},addColumn:{url:"/mcolumn.do?action=addColumn",login:!1},checkColumnName:{url:"/mcolumn.do?action=checkColumnNameAvailable",login:!1},checkColumnDesc:{url:"/mcolumn.do?action=checkColumnDescAvailable",login:!1},columnTimeline:{url:"/tweet.do?action=columnTimeline",login:!1},userColumnTimeline:{url:"/tweet.do?action=userColumnTimeline",login:!1},getColumnCategory:{url:"/mcolumn.do?action=getColumnCategory",login:!1},checkUserColumn:{url:"/mcolumn.do?action=checkUserColumn",login:!1},getEmotions:{url:"/yunying.do?action=getEmotions",login:!1},updateAutoPlay:{url:"/user.do?action=updateAutoPlay",login:!1},updateUserlayout:{url:"/user.do?action=updateUserlayout",login:!1},singleHotTopic:{url:"/yunying.do?action=getNewRightTopic",login:!1},rssTimeline:{url:"/tweet.do?action=rssTimeline",login:!1},rssJustLookTimeline:{url:"/tweet.do?action=rssJustLookTimeline",login:!1},rssNewRemind:{url:"/tweet.do?action=rssNewCountRemind",login:!0},customerService:{url:"/rank/daren/inviter.do",login:!0},columnArrange:{url:"/column/columnRankJSON",login:!1},recommendDaren:{url:"/rank/daren/userRankJSON.do",login:!0},recommendDarenTweet:{url:"/rank/daren/tweetRankJSON.do",login:!0},getDarenType:{url:"/article/getUserProfileInfo",login:!0},neteaseRecommend:{url:"/yunying.do?action=neteaseRecommendDaren",login:!0},pushNews:{url:"/yunying/kuaibao",login:!1},searchUserSimilar:{url:"/search.do?action=searchUserSimilar",login:!0},updateUserSchool:{url:"/user.do?action=updateUserSchool",login:!0},bottomRecDaren:{url:"/yunying.do?action=bottomRecDaren",login:!0},bottomRecZT:{url:"/yunying.do?action=bottomRecZT",login:!0},perRec:{url:"/tweet.do?action=getfeedInfos",login:!0},perRecLike:{url:"/tweet.do?action=likeFeedInfoInfos",login:!0},perRecUnLike:{url:"/tweet.do?action=delFeedInfoInfos",login:!0},mailRightRec:{url:"/yunying.do?action=mailRightRec",login:!0},updateUserAtNotice:{url:"/user.do?action=updateUserAtNotice",login:!0},updateUserReplyNotice:{url:"/user.do?action=updateUserReplyNotice",login:!0},recovery:{url:"/tweet.do?action=appeal",login:!0},rssfollow:{url:"/relation.do?action=followTypeUser",login:!0},skipRecommend:{url:"/relation.do?action=skipRecommend",login:!0}},parseArguments:function(a){var b=a[0];d.isPlainObject(this.requestMap[b])&&(this.requestMap[b].login&&e.getLoginUser()===null&&d(document.body).children(":first").trigger("error",["needLogin"]),a[0]=g.requestMap[b].url);return a},parseRequest:function(a,b){var c={},d=b[0],e=this.requestMap[d]&&this.requestMap[d].silent||!1;b=g.parseArguments(b);try{c=a.apply(null,b)}catch(f){return c}c.resend=function(){g.parseRequest(a,b)};var h=c.error;c.error=function(a){h.call(c,function(b){b.status!==421&&a.apply(null,arguments)});return c};return e?c:this.bindError(c)},get:function(){return this.parseRequest(d.get,arguments)},getJSON:function(){return this.parseRequest(d.getJSON,arguments)},ajax:function(){return this.parseRequest(d.ajax,arguments)},getScript:function(){return this.parseRequest(d.getScript,arguments)},post:function(){return this.parseRequest(d.post,arguments)},postJSON:function(){var a=arguments[0],b=arguments[arguments.length-1],c=d("#data_"+a);if(c.size()>0){b(d.parseJSON(c.html())),c.remove();return null}arguments[arguments.length]="json";return this.parseRequest(d.post,arguments)},bindError:function(a){return a.statusCode({500:this.throwSysError,502:this.throwError,421:this.verify,555:this.throwError})},throwError:function(){d(document.body).children(":first").trigger("error",["network",{type:"error",text:"网络太忙啦，请检查网络连接:)"}])},throwSysError:function(){d(document.body).children(":first").trigger("error",["network",{type:"error",text:"服务器出现错误！"}])},setKeyFrom:function(a){this.keyFrom=f.keyFrom(a);return this},verify:function(b){var c=a("widget/floatBox/VerifyBox"),d=c.getInstance();d.show(function(){b.resend()})}};return g});define("widget/floatBox/VerifyBox",function(a,b,c){var d=a("external/jquery"),e=a("widget/floatBox/Box"),f=a("utils/tmpl"),g=a("widget/VerifyCode"),h=e.extend({init:function(a,b){this._super(a,b)},preRender:function(){return{title:"安全提示",content:f.formatTemplate(a("_tmpl/floatBox/verify"))}},postRender:function(){this.$elem.addClass("poplayer-verifybox")},bindEvent:function(){this._super(),this.$elem.find(".confirm-trigger").click(d.proxy(this.confirm,this))},show:function(a){this._super();var b=this,c={callback:function(){a(),b.hide()},confirm:this.confirm,verifyObj:this};this.config.reqCode&&(c.reqCode=this.config.reqCode),this.config.reqUrl&&(c.reqUrl=this.config.reqUrl),this.verifyCode=new g(this.$elem,c),this.verifyCode.render()},confirm:function(){this.verifyCode.confirm()}});return{getInstance:function(a,b){var c=new h(a,b);return c}}});define("widget/VerifyCode",function(a,b,c){var d=a("external/jquery"),e=a("basic/oop/Class"),f=a("utils/DataSource"),g=e.extend({defaultConfig:{imgClassName:".js-verify-image",inputClassName:".js-verify-input",tipsClassName:".js-tips",changeClassName:".change-trigger",reqCode:"getVerifyCode",reqUrl:"verify"},init:function(a,b){this.$elem=a,this.config=d.extend({},this.defaultConfig,b),this.$image=this.$elem.find(this.config.imgClassName),this.$input=this.$elem.find(this.config.inputClassName),this.$error=this.$elem.find(this.config.tipsClassName),this.verifyObj=b.verifyObj,this.host="http://"+location.host+"/dog.do?action="+this.config.reqCode,this.reqUrl=this.config.reqUrl},render:function(){this.changePic(),this.bindEvent()},bindEvent:function(){this.$input.focus().bind("keydown",d.proxy(function(a){a.keyCode==13&&this.verifyObj&&this.config.confirm.call(this.verifyObj)},this)),this.$elem.delegate(this.config.changeClassName,"click",d.proxy(this.changePic,this))},changePic:function(a){a&&a.preventDefault(),this.onError(),this.$input.val(""),this.updatePic()},updatePic:function(){setTimeout(d.proxy(function(){var a=(new Date).getTime();this.$image.attr("src",this.host+"&rnd="+a)},this),50)},confirm:function(){if(!d.isPlainObject(this.request)||this.request.readyState===4){var a=d.trim(this.$input.val());if(a===""){this.onError("请输入验证码");return}var b=this;this.request=f.postJSON(this.reqUrl,{verifyCode:a},function(a){a.status==="ok"?(b.onError(),b.verifyObj&&b.config.callback.call(b.verifyObj)):(b.onError("验证码输入错误"),b.updatePic())})}},onError:function(a){a=a||"",a===""?this.onTextTips(this.$error,"hide"):this.onTextTips(this.$error,"error",a)},onTextTips:function(a,b,c){b==="hide"?a.hide():(c=c||"",b==="correct"?a.show().find(".js-text").removeClass("text-tips-error").html('<em class="icon-correctS"></em>'+c):b==="error"&&a.show().find(".js-text").addClass("text-tips-error").html('<em class="icon-forbidS"></em>'+c))}});return g});define("_tmpl/floatBox/verify",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<span class="poplayer-mess"><em class="icon-inquireB"></em><span>您的账号存在异常操作，为保证您的帐号安全，<br />请输入验证码进行下一步操作。</span></span><div class="poplayer-item"><label class="poplayer-item-left" for="poplayer_code">验证码：</label><div class="poplayer-item-right"><div class="clearfix"><input id="poplayer_code" class="poplayer-input js-verify-input" name="verifyCode" type="text" maxlength="4" /><img class="js-verify-image" height="25" width="66" /><a class="poplayer-verifybox-changeBtn poplayer-linkb change-trigger" href="javascript:;">换一张</a></div><p class="poplayer-tips js-tips"><span class="text-tips text-tips-error js-text"></span></p></div></div><div class="poplayer-btnbox"><a class="poplayer-btn-sure confirm-trigger" href="javascript:;">确定</a><a class="poplayer-btn-cancel close-trigger" href="javascript:;">取消</a></div>');return p.join("")}});define("widget/floatBox/RegisterBox",function(a,b,c){var d=a("external/jquery"),e=a("widget/floatBox/Box"),f=a("utils/Utils"),g=a("widget/floatBox/login/EmailSuggestList"),h=a("utils/DataSource"),i=a("utils/tmpl"),j=e.extend({suggest:null,$emailInput:null,$nickInput:null,$password:null,$checkbox:null,$suggestWrap:null,preRender:function(){return{content:i.formatTemplate(a("_tmpl/registerBox"),this.data),title:"开通网易微博"}},postRender:function(){this.$elem.addClass("poplayer-openbox"),this.$formElem=this.$elem.find("form"),this.$emailInput=this.$elem.find("#mini_username"),this.$nickInput=this.$elem.find("#mini_nickname"),this.$password=this.$elem.find("input:password"),this.$checkbox=this.$elem.find("input:checkbox"),this.$elem.find(".js-url").val(location.href),this.$suggestWrap=this.$elem.find(".js-poplayer-search"),this.suggest=new g(this.$suggestWrap.find("ul")),this.$suggestWrap.show().detach()},bindEvent:function(){this._super(),this.$elem.delegate(".login-trigger","click",d.proxy(this.onRegisterClick,this)),this.$emailInput.bind("keyup",d.proxy(this.onInput,this)),this.$emailInput.bind("blur",d.proxy(this.onBlur,this)),this.$emailInput.bind("focus",d.proxy(this.onFocus,this)),this.$nickInput.bind("blur",d.proxy(this.onCheckNickName,this)),this.$suggestWrap.bind("select.EmailSuggestList",d.proxy(this.onSelect,this))},onError:function(a,b){var c=a.parent().find(".js-tips");this.onTextTips(c,"error",b)},onRight:function(a,b){var c=a.parent().find(".js-tips");this.onTextTips(c,"hide"),b!==undefined&&this.onTextTips(c,"correct",b)},onInput:function(a){var b=d.trim(this.$emailInput.val());if(b.length===0||f.validateEmail(b))this.hideSuggest();else{var c=this.$emailInput.offset();c.top+=this.$emailInput.height()+2,c.left-=1,this.$suggestWrap.appendTo("body").offset(c).width(this.$emailInput.width()).show().css("z-index","2000");var e=this.suggest.show(b);e&&e.appendTo(this.$suggestWrap)}},onFocus:function(a){this.onInput(a)},onBlur:function(a){this.onCheckMail(),this.hideSuggest()},onCheckMail:function(){var a=d.trim(this.$emailInput.val());if(a===""){this.onError(this.$emailInput,"通行证不能为空");return!1}if(!f.validateEmail(a)){this.onError(this.$emailInput,"邮箱格式有误");return!1}this.onRight(this.$emailInput);return!0},onCheckPassport:function(){var a=d.trim(this.$password.val());if(a===""){this.onError(this.$password,"密码不能为空");return!1}this.onRight(this.$password);return!0},onCheckNickNameVal:function(a){var b=f.validateName(a);if(b!==""){this.onError(this.$nickInput,b);return!1}this.onRight(this.$nickInput);return!0},onCheckNickName:function(a){var b=d.trim(this.$nickInput.val());if(!!this.onCheckNickNameVal(b)){var c=this;this.blurTimer=setTimeout(function(){if(!d.isPlainObject(c.request)||c.request.readyState===4)c.request=h.postJSON("checkNickname",{nickName:b},function(a){a.result?c.onError(c.$nickInput,"该昵称已存在"):c.onRight(c.$nickInput,"昵称可用")})},200)}},onRegisterClick:function(a){clearTimeout(this.blurTimer);var b=this.$checkbox.prop("checked"),c=d.trim(this.$nickInput.val());b?this.onRight(this.$checkbox.parent()):this.onError(this.$checkbox.parent(),"您是否同意使用条款？");if(!!this.onCheckMail()){if(!this.onCheckPassport())return;if(!this.onCheckNickNameVal(c))return;if(d.isPlainObject(this.request)&&this.request.readyState!==4)return;var e=this;this.request=h.postJSON("checkNickname",{nickName:c},function(a){if(a.result)e.onError(e.$nickInput,"该昵称已存在");else{var b="http://"+location.host,d=encodeURIComponent(b+"/signup/passport");e.$elem.find(".js-url").val(b+"/user.do?action=createUser&nickName="+c+"&callback="+d),e.$formElem[0].submit()}});return!1}},hideSuggest:function(){clearTimeout(this.hideSuggestTimer);var a=this;this.hideSuggestTimer=setTimeout(function(){a.suggest.hide(),a.$suggestWrap.detach()},100)},onSelect:function(a,b){this.$emailInput.val(b),this.hideSuggest()}}),k=null;return{getInstance:function(a,b){k!==null&&k.hide(),k=new j(a,b);return k}}});define("_tmpl/registerBox",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div><form action="https://reg.163.com/login.jsp" method="POST" id="minLoginForm" name="loginform" target="_self"><div class="poplayer-item"><label for="mini_username" class="poplayer-item-left">邮箱：</label><div class="poplayer-item-right"><input type="text" id="mini_username" name="username" class="poplayer-input" tabindex="1" autocomplete="off" value="',email,'"><p class="poplayer-tips js-tips"><span class="text-tips text-tips-error js-text"></span></p></div></div><div id="suggestResult" class="search-result js-poplayer-search"><ul></ul></div><div class="poplayer-item"><label for="mini_password" class="poplayer-item-left">密码：</label><div class="poplayer-item-right"><input type="password" id="mini_password" name="password" class="poplayer-input" tabindex="2"><a class="poplayer-linka" href="http://reg.163.com/RecoverPasswd1.shtml">忘了密码？</a><p class="poplayer-tips js-tips"><span class="text-tips text-tips-error js-text"></span></p></div></div><div class="poplayer-item"><label for="mini_nickname" class="poplayer-item-left">昵称：</label><div class="poplayer-item-right"><input type="text" id="mini_nickname" name="nickname" class="poplayer-input" tabindex="3"><p class="poplayer-tips js-tips"><span class="text-tips text-tips-error js-text"></span></p></div></div><div class="poplayer-item"><label class="poplayer-item-left">&nbsp;</label><div class="poplayer-item-right"><label id="savelogin" class="label-tag"><input type="checkbox" value="1" name="savelogin" tabindex="5" checked="checked">&nbsp;已阅读并同意使用条款和隐私政策</label><p class="poplayer-tips js-tips"><span class="text-tips text-tips-error js-text"></span></p></div></div><div class="poplayer-item"><label class="poplayer-item-left">&nbsp;</label><div class="poplayer-item-right"><a href="javascript:;" class="poplayer-btn-sure login-trigger">立即开通</a></div></div><div class="clearfix"><label></label><span><input class="js-url" type="hidden" name="url" value=""><input type="hidden" name="product" value="t"><input type="hidden" name="type" value="1"></span></div></form></div>');return p.join("")}});define("qun/widget/JoinBox",function(a,b,c){var d=a("utils/jquery-wb"),e=a("widget/floatBox/Box"),f=a("utils/Utils"),g=a("utils/DataSource"),h=a("utils/tmpl"),i=a("widget/tip/NaviTip"),j=a("model/QunData"),k=a("widget/VerifyCode"),l=e.extend({preRender:function(){return{content:h.formatTemplate(a("_tmpl/floatBox/joinBox"),this.data),title:"申请加入该群"}},postRender:function(){this.$elem.addClass("poplayer-askAddGroupBox"),this.$reasonTips=this.$elem.find(".js-reason-tips")},bindEvent:function(){this._super(),this.$elem.delegate(".cancel-trigger","click",d.proxy(this.cancel,this)),this.$elem.delegate(".submit-trigger","click",d.proxy(this.onSubmit,this)),this.$elem.delegate("textarea","click",d.proxy(this.textareaActive,this)),this.$elem.delegate("textarea","blur",d.proxy(this.textareaBlur,this)),this.verifyCode=new k(this.$elem,{callback:this.onCheckCallBack,confirm:this.onSubmit,tipsClassName:".js-verify-tips",verifyObj:this}),this.verifyCode.render()},textareaActive:function(a){d(a.target).parent().find("label").hide()},textareaBlur:function(a){a.target.value==""&&d(a.target).parent().find("label").show(),this.checkReason()},checkReason:function(){var a=this.$elem.find(".js-apply-reason"),b=a.find("textarea").val();if(typeof b!="string")return!1;if(b==""){this.onTextTips(this.$reasonTips,"error","请输入申请理由");return!1}if(f.strLen(b)>100){this.onTextTips(this.$reasonTips,"error","不能超过50字");return!1}this.onTextTips(this.$reasonTips,"hide");return!0},onSubmit:function(){(this.applyType!="1"||this.checkReason()!==!1)&&this.verifyCode.confirm()},showPass:function(a){this.$elem.hide(),i.show({type:"success",text:a})},showError:function(a){this.$elem.hide(),i.show({type:"error",text:a})},onCheckCallBack:function(){var a=this,b=this.$target,c=j.getQunInfo(),d=null,e=null;b&&(d=b.attr("data-qid"),e=b.attr("data-type"));if(!b||!d)d=c.id;this.joinUrl=this.applyType=="0"?"joinQun":"applyJoinQun",this.joinParam=this.applyType=="0"?{qunId:d}:{qunId:d,applyContent:this.$elem.find(".js-join-reason").val()},g.postJSON(a.joinUrl,this.joinParam,function(c){var d="";if(c.result==="success"){if(a.applyType=="0"){if(e){var f=b.hide().next().show().parent().parent().find(".js-num");f.size()>0&&f.html(parseInt(f.html())+1),a.hide();return}d="加入成功！"}else d="申请已发送！";setTimeout(function(){a.showPass(d)},500),setTimeout(function(){e||location.reload()},2e3)}else if(c.result==="qunBlackListUser"){var d=a.applyType=="0"?"你已被该群列入黑名单，无法加入":"很抱歉，您被禁止申请加入本群";a.showError(d)}else c.result==="tooManyQunMember"?a.showError("群已经达到上限，无法加入"):c.result==="userAddTooManyQun"?a.showError("你最多只能加入3个微群"):c.result==="applyRecordExist"?a.showError("申请正在等待群主处理，请耐心等待"):a.showError("加入失败");setTimeout(function(){a.hide()},1500)})},show:function(a){this._super(),this.$target=a||null;var b=j.getQunInfo();this.applyType="0",this.$target&&typeof this.$target.attr("data-applyType")!="undefined"&&(this.applyType=this.$target.attr("data-applyType")),this.$target||(this.applyType=b.applyType),this.applyType==="0"?this.$elem.find(".js-apply-reason").hide():this.$elem.find(".js-apply-reason").show(),this.$elem.find("textarea").val(""),this.onTextTips(this.$reasonTips,"hide")},cancel:function(){this.hide()}}),m=null;return{getInstance:function(a,b){m==null&&(m=new l(a,b));return m}}});define("utils/jquery-wb",function(a,b,c){var d=a("external/jquery"),e=a("utils/Utils");d.fn.setCaretTo=function(a,b){b===undefined&&(b=a);var c=this.get(0);if(c.createTextRange){var d=c.createTextRange();d.collapse(!0),d.moveStart("character",a),d.moveEnd("character",b-a),d.select()}else c.focus(),c.setSelectionRange(a,b);return this},d.fn.scrollToShow=function(a){var b=this.first().offset().top-(a||0);d(document).scrollTop()>b&&d(document).scrollTop(b);return this},d.fn.focusToEnd=function(){var a=this.focus().val().length;this.setCaretTo(a);return this},d.fn.appendAfterCaret=function(a){var b=this.get(0);if(document.selection){var c=document.selection.createRange();c.text=a}else if(typeof b.selectionStart=="number"&&typeof b.selectionEnd=="number"){var d=b.selectionStart,e=b.selectionEnd,f=d,g=b.value;b.value=g.substring(0,d)+a+g.substring(e,g.length),f+=a.length,b.selectionStart=b.selectionEnd=f}else b.value+=a;return this},d.fn.detachDo=function(a){var b=d("<font />");return this.each(function(c,e){var f=d(this);b.insertBefore(f),f.detach(),a(c,e),f.insertBefore(b),b.detach()})},d.fn.getCaretPosition=function(){var a=this.get(0),b;try{b=a.selectionStart}catch(c){}if(b!==undefined)return a.selectionStart;if(document.selection){var d=0,e=document.selection.createRange();if(e.parentElement()===a){var f=document.body.createTextRange();f.moveToElementText(a);for(b=0;f.compareEndPoints("StartToStart",e)<0;b++)f.moveStart("character",1);for(var g=0;g<=b;g++)a.value.charAt(g)=="\n"&&b++;f=document.body.createTextRange(),f.moveToElementText(a);for(end=0;f.compareEndPoints("StartToEnd",e)<0;end++)f.moveStart("character",1);for(g=0;g<=end;g++)a.value.charAt(g)=="\n"&&end++;d=b}return d}return 0},d.fn.outerHTML=function(){var a=this.first(),b=a.wrap("<div>").parent().html();a.unwrap();return b},function(a){var b;a.scrollTo=function(c,d){var e=a(document).scrollTop(),f=[],g=e-c,h=d?d*30:30;d=d||2;while(Math.abs(g)>0){g=g/2;if(Math.abs(g)<1){f.push(0);break}f.push(g)}b&&clearInterval(b),b=setInterval(function(){f.length?window.scrollTo(0,c+f.shift()):clearInterval(b)},h)}}(d);return d});define("model/QunData",function(a,b,c){var d=a("external/jquery"),e=a("basic/oop/Class"),f=a("utils/Utils"),g=null,h=e.extend({});h.setQunInfo=function(a){g=a},h.getQunInfo=function(a){return g};return h});define("_tmpl/floatBox/joinBox",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<p>加入该群参与讨论</p><div class="clearfix"><div class="poplayer-textareaBox js-apply-reason"><label class="poplayer-textarea-tips" for="join-reason">申请理由，50字以内</label><textarea id="join-reason" class="poplayer-textarea js-join-reason"></textarea></div><div class="poplayer-tips js-reason-tips"><span class="text-tips text-tips-error js-text"></span></div></div><div class="poplayer-item"><label class="poplayer-item-left fS14">验证码：</label><div class="poplayer-item-right clearfix"><input type="text" class="poplayer-input js-verify-input" /><img class="js-verify-image" height="25" width="66" src="" /><a class="poplayer-verifybox-changeBtn poplayer-linkb change-trigger" href="javascript:;">换一张</a><div class="poplayer-tips js-verify-tips"><span class="text-tips text-tips-error js-text"></span></div></div></div><div class="poplayer-btnbox"><a class="poplayer-btn-sure submit-trigger" href="javascript:;">加入</a><a class="poplayer-btn-cancel close-trigger" href="javascript:;">取消</a></div>');return p.join("")}});define("task/dynImage",function(a,b,c){var d=a("external/jquery"),e=a("task/Task"),f=a("utils/Utils");(new e("dynImage",function(){var a=[],b=function(){var b=d(".js-preview-img");b.each(function(a){var b=d(this);this.getAttribute("d-src")&&(b[0].onload=function(){d.browser.msie&&!this.fileSize&&this.load||(this.load=!0,this.onload=null,this.removeAttribute("d-src"))},b.attr("src",this.getAttribute("d-src")))}),setTimeout(function(){b.each(function(b){var c=d(this),e=c.parent().data("realurl");!!e&&!a[e]&&(a[e]=!0,(new Image).src=f.randomOimageUrl(e,440,"",1))})},500)};b(),d(document.body).bind("preLoadImg",b)})).add()});define("task/setHeight",function(a,b,c){var d=a("external/jquery"),e=a("task/Task"),f=a("utils/Utils");(new e("setHeight",function(){var a=d(".conL"),b=d(".conR"),c=d(".content"),e=null;if(b.size()!=0&&c.size()!=0&&a.size()!=0){var f=function(){e&&clearTimeout(e),e=setTimeout(function(){g()},100)},g=function(){var c=a.find("> div"),e=0,f=b.outerHeight();c.each(function(a){e+=d(this).outerHeight()}),e>f?a.css({height:"auto"}):a.css({height:f}),a.height()<parseInt(a.css("min-height"))&&a.css({height:a.css("min-height")})},h=function(){var c=a.height(),d=b.outerHeight();c<d&&a.css({height:d}),a.height()<parseInt(a.css("min-height"))&&a.css({height:a.css("min-height")})},i=d(window),j=d(document);j.bind("setHeightNow",h).bind("setHeight",f),i.bind("scroll",f)}})).add()});define("task/widget/scrollTop",function(a,b,c){var d=a("task/Task"),e=a("utils/Utils"),f=a("external/jquery"),g=new d("scrollTop",function(){var a=null,b=!1;if(e.mail.isMail==!1||e.mail.isMail==!0&&e.mail.getVersion==="js5"){var c=f(".toTop").bind("click",function(){f(window).scrollTop(0)});function d(){var a=f(window).scrollTop();a>0?b&&(c.removeClass("hidden"),b=!1):b||(c.addClass("hidden"),b=!0)}d(),f(window).bind("scroll resize",function(b){clearTimeout(a),a=setTimeout(d,100)})}else{var c=f(".toTop").bind("click",function(){try{var a=e.mail.scrollTop(),b=e.mail.clientHeight();WebmailHelper.evalScript("document.documentElement.scrollTop = 0")}catch(c){}}).removeClass("hidden");setInterval(function(){var a=e.mail.scrollTop(),b=e.mail.clientHeight();a>0&&c.css("top",b+a-90)},500)}});f("#AccountActive").size()==0?g.add():f(document).bind("showScrollTop",function(b){g.add(),a("task/TaskManager").run()})});define("task/hack/ie",function(a,b,c){var d=a("external/jquery"),e=a("task/Task"),f=a("task/TaskManager"),g={fixJSLink:function(){parseFloat(d.browser.version)<8&&d("body").delegate(".js-link","hover",function(a){d(this).toggleClass("ie-hover-hack")})}};d.browser.msie&&f.add(new e("ieHack",function(){d.each(g,function(a,b){b()})}))});define("task/user/iTag",function(a,b,c){var d=a("task/Task"),e=a("task/TaskManager");e.add(new d("userITag",function(){var b=a("external/jquery"),c=a("utils/tmpl"),d=null,e=null;b(document).delegate(".js-tags","hover",function(a){var c=b(a.currentTarget),f=c.data("tags");if(!!f){f=f.split(", "),d||(d=b('<div class=""><em></em></div>').appendTo("body"),d.hover(function(a){clearTimeout(e)},function(a){e=setTimeout(function(){d.hide()},200)}));if(a.type==="mouseenter"){clearTimeout(e);var g=[];for(var h=0,i=f.length;h<i;h++)f[h]=="微专栏"?(g.push('<a href="/column" target="_blank">'+f[h]+"</a>"),d.hasClass("itag-tip")&&d.removeClass("itag-tip"),d.addClass("ctag-tip")):(g.push('<a href="/search/itag/'+f[h]+'" target="_blank">'+f[h]+"</a>"),d.hasClass("ctag-tip")&&d.removeClass("ctag-tip"),d.addClass("itag-tip"));d.find("em").html(g.join(""));var j=c.offset();j.left=j.left-21,j.top=j.top-d.height()-2,d.css({top:j.top,left:j.left}).show()}else clearTimeout(e),e=setTimeout(function(){d.hide()},200)}})}))});define("task/shortURL",function(a,b,c){var d=a("task/TaskManager"),e=a("task/Task");d.add(new e("shortURL",function(){var b=a("external/jquery"),c=a("utils/DataSource");b(document.body).delegate(".short-url:not(.processed)","mouseenter",function(a){var d=b(a.target),e=d.addClass("processed").text();if(e.indexOf("http://163.fm")===0){var f=e.substr(14);c.get("longUrl",{q:f},function(a){d.attr("title",a)},"jsonp")}})}))});define("task/linkTarget",function(a,b,c){var d=a("task/TaskManager"),e=a("task/Task"),f=a("utils/Utils");f.mail.isMail!==!1&&d.add(new e("linkTarget",function(){function f(a){var f=null,g=a.target,h=b(g);g.tagName.toUpperCase()=="A"?f=g.href:(h=h.parent(),f=h.attr("href"));if(h[0].tagName.toUpperCase()=="A"&&h.attr("target")==="_blank"){f.match(e)?(window.location.target="_self",window.location.href=f):(/https?:\/\//.test(f)||(f=c+f),f=f.replace(d,"http://t.163.com/"),window.open(f,"_blank"));return!1}}var b=a("external/jquery"),c="http://"+location.host,d=/^http:\/\/buzz.mail.163.com(.)*?\/|http:\/\/buzz.mail.126.com(.)*?\/|http:\/\/buzz.mail.yeah.net(.)*?\/|http:\/\/buzz.mail.188.com(.)*?\//,e=/.*\/tag\/.+|.*\/settings\/.+/;b(document).delegate("a","click",f)}))});define("task/widget/searchBox",function(a,b,c){var d=a("task/Task");(new d("headSearchBox",function(){var b=a("widget/searchBox/SearchBox"),c=new b("#headSearch")})).add()});define("widget/searchBox/SearchBox",function(a,b,c){var d=a("external/jquery"),e=a("utils/tmpl"),f=a("utils/Utils"),g=a("utils/DataSource"),h=a("utils/log/Logger"),i=a("widget/searchBox/SearchSuggestList"),j=d(document.body),k=function(a){this.$elem=d(a),this.$input=this.$elem.find(".js-input"),this.defaultTip=this.$input.data("blank"),this.$suggestWrap=this.$elem.find(".js-list").show().detach(),this.$suggest=new i(this.$suggestWrap.find("ul")),this.$loading=d(f.LOADING_SMALL.replace("$text$","加载中...")),this.cache={},this.bindEvent()};k.prototype={bindEvent:function(){this.$input.val(this.defaultTip).bind("keyup",d.proxy(this.onInput,this)).bind("focus",d.proxy(this.onFocus,this)).bind("blur",d.proxy(this.onBlur,this)),this.$suggestWrap.bind("select.SearchSuggestList",d.proxy(this.onSelect,this)),this.$elem.delegate(".js-btn","click",d.proxy(this.onButton,this))},onButton:function(){var a=d.trim(this.$input.val());if(a!=this.defaultTip&&a!=""){var b="/tag/"+encodeURIComponent(a);location.href=b}},onFocus:function(a){this.$elem.addClass("navi-search-active"),d.trim(this.$input.val())===this.defaultTip&&this.$input.val(""),this.onInput(a)},onBlur:function(a){d.trim(this.$input.val())===""&&(this.$input.val(this.defaultTip),this.$elem.removeClass("navi-search-active")),j.bind("click",d.proxy(this.autoClose,this))},onLoad:function(){var a=this.$input.offset();a.top+=this.$input.height(),a.left-=1,this.$suggestWrap.appendTo("body").offset(a),this.$suggest.$elem.html(this.$loading)},onInput:function(a){if(a.which!==38&&a.which!==40&&a.which!==13){this.intervalTime&&clearTimeout(this.intervalTime);var b=this.$input.val(),c=f.countChars(f.encodeSpecialHtmlChar(b),16);if(this.cache[b]!==undefined)this.onCallBack(this.cache[b],!0);else{if(!d.trim(b).length||d.trim(b)===this.defaultTip){this.hideSuggest();return}this.onLoad(),this.intervalTime=setTimeout(d.proxy(function(){g.post("searchSuggest",{k:b},d.proxy(function(a){a.input=c,this.cache[b]=a,b==this.$input.val()&&this.onCallBack(a)},this))},this),200)}}},onCallBack:function(b,c){c&&this.$suggestWrap.appendTo("body");var f=d(e.formatTemplate(a("_tmpl/searchSuggestItem"),b));this.$suggest.$elem.html(f),this.$suggest.bindEvent()},hideSuggest:function(){this.hideTimer&&clearTimeout(this.hideTimer);var a=this;this.hideTimer=setTimeout(function(){a.$suggestWrap.detach(),a.$suggest&&a.$suggest.unbindEvent()},100),j.unbind("click",d.proxy(this.autoClose,this))},onSelect:function(a,b,c){var e=null,g=h.keyFrom(this.$input),i=d.trim(this.$input.val());switch(b){case"suggestsvalue":e="/tag/",i=c,g=g+".Rtw&method=searchBT";break;case"usersvalue":e="/",i=c,g=g+".Ruser";break;case"suggests":e="/tag/";break;case"users":e="/search/user/";break;case"tags":e="/search/tag/";break;case undefined:if(i==this.defaultTip||i=="")return;e="/tag/";break;case"apps":e="/search/app/",g=g+".sGuess.sapp";break;case"appsvalue":f.mail.isMail?e="/search/app/":(i=c,e="http://t.163.com/app/detail/"),g=g+".sGuess.app";break;default:return}e+=encodeURIComponent(i);var j={users:"searchUN",suggests:"searchBT",tags:"searchUT"};b=="usersvalue"||b=="suggestsvalue"||b=="appsvalue"||b=="apps"?f.analytics.send("/page.do?keyfrom="+g):b==undefined?h.triggerLog(this.$input,{method:"searchUT"}):h.triggerLog(this.$input,{method:j[b]}),location.href=e},autoClose:function(a){var b=d(a.target).parents().andSelf();d.inArray(this.$elem[0],b)===-1&&this.hideSuggest()}};return k});define("widget/searchBox/SearchSuggestList",function(a,b,c){var d=a("external/jquery"),e=a("widget/suggest/SuggestList"),f=e.extend({onEnter:function(a){this.onClick(a)},onClick:function(a){var b=this.$elem.children(".current").data("type"),c=this.$elem.children(".current").attr("data-value");this.$elem.trigger("select.SearchSuggestList",[b,c])},show:function(a,b){if(!!this._super(a.html())){b||this.$elem.html(a).children(":first").addClass("current"),this.$elem.html(a),this.cacheHtml=a,this.bindEvent();return}},clearUp:function(){this.$elem.empty()},onKey:function(a){this._super(a),a.which===27&&(this.$elem.parent().detach(),a.preventDefault())}});return f});define("_tmpl/searchSuggestItem",function(require){return function(tmplData){var p=[];with(tmplData){p.push('<li data-type="suggests" class="navi-search-result-option">含<i>',input,"</i>的微博</li>");for(var j=0,length=suggests.length;j<length;j++){var item=suggests[j];p.push('<li class="navi-search-result-word" data-type="suggestsvalue" data-value="',item[0],'">',item[1],"</li>")}p.push('<li data-type="users" class="navi-search-result-option">含<i>',input,"</i>的用户</li>");for(var i=0,len=users.length;i<len;i++){var item=users[i];item.screenName=item.screenName==""?item.id:item.screenName,item.location=item.location==","?"":item.location,p.push('<li class="navi-search-result-data '),i==len-1&&p.push("lastNode"),p.push('" data-type="usersvalue" data-value="',item.screenName,'"><img src="',item.avatar,'" /><h3>',item.nickName,""),item.type!="normal"&&(p.push("<em "),item.isColumnUser?p.push('class="cTag"'):p.push('class="iTag"'),p.push("></em>")),p.push("</h3><p>",item.location,"</p></li>")}p.push('<li class="navi-search-result-option" data-type="apps">含<i>',input,"</i>的应用</li>");for(var j=0,length=apps.length;j<length;j++)p.push('<li class="navi-search-result-data lastNode" data-type="appsvalue" data-value="',apps[j].url,'"><img src="',apps[j].image,'"><h3>',apps[j].name,"</h3><p>",apps[j].userNum,"人使用</p></li>");p.push("")}return p.join("")}});define("task/widget/widgetFolder",function(a,b,c){var d=a("task/Task");(new d("widgetFolder",function(){var b=a("external/jquery"),c=a("utils/Cookie");b(".widget-folder").each(function(){var a=b(this),d=a.attr("id");c.get(d)==="fold"&&(a.addClass("retract-icon"),a.parent().parent().find("ul").addClass("hidden"),a.attr("title","展开"))}).bind("click",function(){var a=b(this),d=a.attr("id");c.get(d)==="fold"?(c.set(d,"unfold",30),a.attr("title","收起")):(c.set(d,"fold",30),a.attr("title","展开")),a.parent().parent().find("ul").toggleClass("hidden"),a.toggleClass("retract-icon")})})).add()});define("task/setSkin",function(a,b,c){var d=a("task/Task"),e=(new d("setSkin",function(){var b=a("external/jquery"),c=a("utils/log/Logger"),d=a("widget/SkinSetting").getInstance(),e=b(".set-skin").bind("click",function(a){a.preventDefault(),d.show(a),c.triggerLog(b(a.target),{method:"click"})});a("utils/Cookie").get("setSkin")-0===1&&(a("utils/Cookie").del("setSkin"),e.click())})).add();return e});define("widget/SkinSetting",function(a,b,c){var d=a("external/jquery"),e=a("widget/floatBox/Box"),f=a("model/UserData"),g=a("utils/Utils"),h=a("utils/log/Logger"),i=a("widget/tip/NaviTip"),j="http://img1.cache.netease.com/t/image/index/pic.png",k=e.extend({init:function(){this.originalData={},this.data={},this.$elem=null,this.$skinStyle=d("#skinStyle"),this.$customStyle=d("#customStyle")},show:function(){this._super()},hide:function(){this.$elem&&(this.data=this.originalData,this.updateStyle(this.originalData.url),this.$elem.hide(),this.$elem=null)},render:function(){var b=a("utils/DataSource"),c=!0,e=d(document.body).attr("data-type");if(!e||e!=="self")c=!1;if(this.$elem===null){if(!c||d(".conL").size()===0){location.href="/?setSkin";return}this.$elem=d(a("utils/tmpl").formatTemplate(a("_tmpl/skinSetting"))).appendTo("body"),b.setKeyFrom(this.$elem).post("skinSetting",d.proxy(this.onDataBack,this))}return this.$elem},parseData:function(a){var b=d(a);this.data.profile_background_pos=b.find("input[name=profile_background_pos]:checked").val()-0,this.data.profile_background_fixed=b.find("input[name=profile_background_fixed]").prop("checked")?1:0,this.data.profile_background_filled=b.find("input[name=profile_background_filled]").prop("checked")?1:0,this.data.profile_background_image_url=b.find("input[name=profile_background_image_url]").val(),this.data.profile_css_file_type=b.data("skinType"),this.data.profile_css_file=b.find(".js-item .selected").data("skinId"),this.data.profile_css_file_custom=b.find(".js-color-list .selected").data("skinId"),this.data.css_url_custom=b.find(".js-color-list .selected").data("skin"),this.data.css_url=b.find(".js-item .selected").data("skin"),this.originalData=d.extend({},this.data)},onDataBack:function(b){function h(a,b){a.each(function(){var a=d(this),e=a.find(".selected"),g=1,h=a.find(".js-skin-item");e.size()>0&&(g=Math.ceil((e.index()+1)/b));var i=new f('<div class="pages-small"></div>',{pageSize:b,pageCount:Math.ceil(h.size()/b),pageNo:g});i.render().appendTo(a.find(".js-page")),a.data("pager",i),a.bind("onPage",{items:h},d.proxy(c.onPage,c)),c.showPage(h,i)})}var c=this,e=d(b);this.parseData(e);var f=a("widget/StaticPager");e.find(".js-item").css("display","none");if(this.data.profile_css_file_type===0){var g=e.find(".js-item .selected").first().closest(".js-item").css("display","block");e.find(".js-navi > li").eq(g.index()).addClass("current")}else e.find(".js-custom").css("display","block"),e.find(".js-navi > li").last().addClass("current");h(e.find(".js-normal"),8),h(e.find(".js-custom"),4),this.$elem.find(".js-body").empty().append(e),this.bindEvent()},deleteCustom:function(a){d(a.target).hide(),this.$elem.find(".js-backgroundImg").attr("src",j),this.data.profile_background_image_url="",this.updateStyle()},onUploadSuccess:function(b,c){this.$elem.find(".js-backgroundImg").attr("src",a("utils/Utils").randomOimageUrl(c.originalURL,124,124)),this.data.profile_background_image_url=c.originalURL,this.$elem.find(".js-close-backgroundImg").removeClass("hidden").show(),this.updateStyle()},onUploadFail:function(a,b){d(document).trigger("error",["uploadError",{type:"error",text:"上传图片错误，背景图应该是 2M 以内的 jpg、jpeg、png图片"}])},onUploadLoading:function(a){},onMoveStart:function(a){if(a.currentTarget===a.target){var b={top:a.clientY,left:a.clientX},c=d(a.data.content),e={left:c.offset().left,top:c.offset().top};d(document).bind("mousemove",{startPos:b,startOffset:e,content:a.data.content},d.proxy(this.onMove,this)).bind("mouseup",{startPos:b,startOffset:e,content:a.data.content},d.proxy(this.onMoveEnd,this)).bind("selectstart",d.proxy(this.onMoveSelect,this))}},onMove:function(a){clearTimeout(this.moveTimer),this.moveTimer=setTimeout(function(){var b=a.clientX-a.data.startPos.left+a.data.startOffset.left,c=a.clientY-a.data.startPos.top+a.data.startOffset.top;d(a.data.content).offset({left:b>0?b:0,top:c>0?c:0})},10)},onMoveEnd:function(a){this.onMove(a),d(document).unbind("mousemove",d.proxy(this.onMove,this)).unbind("mouseup",d.proxy(this.onMoveEnd,this)).unbind("selectstart",d.proxy(this.onMoveSelect,this))},onMoveSelect:function(a){a.preventDefault()},onPage:function(a,b,c){this.showPage(a.data.items,b,c)},showPage:function(a,b,c){a.hide(),c=c||b.config.pageNo;var d=b.config.pageSize;if(c>1){var e=(c-1)*d;a=a.filter(":gt("+(e-1)+")")}a.filter(":lt("+d+")").show()},save:function(){var b=a("utils/DataSource");b.setKeyFrom(this.$elem).post("updateUser",this.data,d.proxy(this.callBack,this)),g.analytics.send("/page.do?method=updateUserConfig&keyfrom="+h.keyFrom(this.$elem))},bindEvent:function(){this.$elem.delegate(".close-trigger","click",d.proxy(this.hide,this)),this.$elem.delegate(".save-trigger","click",d.proxy(this.save,this)),this.$elem.find(".js-navi").delegate("li","click",d.proxy(this.switchTab,this)),this.$elem.delegate(".js-skin-item","click",d.proxy(this.changeSkin,this)),this.$elem.find(".drag-trigger").bind("mousedown",{content:this.$elem.children(".js-table")},d.proxy(this.onMoveStart,this));var b=this.$elem.find(".js-backgroundImg, .js-select-backgroundImg"),c=a("widget/FileUploader");this.uploader=new c({onSuccess:d.proxy(this.onUploadSuccess,this),onFail:d.proxy(this.onUploadFail,this),onLoading:d.proxy(this.onUploadLoading,this),trigger:b}),this.$elem.delegate(".js-close-backgroundImg","click",d.proxy(this.deleteCustom,this));var e=this;this.$elem.find("input[name=profile_background_pos]").bind("change",function(a){e.data.profile_background_pos=d(a.target).val()-0,e.updateStyle()}),this.$elem.find("input[name=profile_background_filled]").bind("change",function(a){e.data.profile_background_filled=d(a.target).prop("checked")?1:0,e.updateStyle()}),this.$elem.find("input[name=profile_background_fixed]").bind("change",function(a){e.data.profile_background_fixed=d(a.target).prop("checked")?1:0,e.updateStyle()})},switchTab:function(a){var b=d(a.target).parent(),c=b.index();this.$elem.find(".js-content").children().hide().eq(c).show();var e=b.data("skinType");e!==this.data.profile_css_file_type&&(this.data.profile_css_file_type=e,this.updateStyle()),b.siblings().andSelf().removeClass("current"),b.addClass("current")},changeSkin:function(a){var b=d(a.currentTarget),c=b.data("skin");this.$elem.find(".js-skin-item[data-skin-type="+b.data("skinType")+"]").removeClass("selected").filter("[data-skin-id="+b.data("skinId")+"]").addClass("selected"),this.data.profile_css_file_type=b.data("skinType")?1:0,this.data.profile_css_file_type===1?(this.data.profile_css_file_custom=b.data("skinId"),this.data.css_url_custom=c):(this.data.profile_css_file=b.data("skinId"),this.data.css_url=c),this.updateStyle()},updateStyle:function(){var b="";this.data.profile_css_file_type===1?b=this.data.css_url_custom:b=this.data.css_url,this.$skinStyle.prop("href",b),this.$customStyle.remove(),this.$customStyle=d(a("utils/tmpl").formatTemplate(a("_tmpl/customStyle"),this.data)).appendTo("head")},callBack:function(){i.show({type:"success",text:"设置成功！"}),this.originalData=d.extend({},this.data),this.hide()}}),l=null;return{getInstance:function(){return new k}}});define("_tmpl/skinSetting",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div id="skinSettingLayer" class="poplayer poplayer-skinbox"><iframe class="poplayer-iframe js-iframe" scrolling="no" frameborder="0"></iframe><div class="poplayer-shade js-layer"></div><table class="poplayer-table js-table"><tbody><tr><td class="poplayer-top-left"></td><td class="poplayer-top-center"></td><td class="poplayer-top-right"></td></tr><tr><td class="poplayer-middle-left"></td><td class="poplayer-middle-center js-body"><div class="poplayer-body"><div class="loadingBox"><span><em class="icon-loadingB"></em>数据加载中...</span></div></div></td><td class="poplayer-middle-right"></td></tr><tr><td class="poplayer-bottom-left"></td><td class="poplayer-bottom-center"></td><td class="poplayer-bottom-right"></td></tr></tbody></table></div>');return p.join("")}});define("widget/StaticPager",function(a,b,c){var d=a("external/jquery"),e=a("widget/Pager"),f=e.extend({onPage:function(a){this._super(a),this.update({pageNo:d(a.currentTarget).data("pageNo")}),this.render()}});return f});define("widget/Pager",function(a,b,c){var d=a("external/jquery"),e=a("basic/oop/Class"),f=e.extend({defaults:{pageNo:null,pageCount:null,pageToken:null,pageSize:null,totalCount:null,pageMethod:"page",prevText:"上一页",nextText:"下一页",moreText:"查看更多",moreButtonLimit:2,pageNoRange:7,showNum:!0},init:function(a,b){this.$pageElem=null,this.$elem=d(a),this.update(b),this.bindEvent()},update:function(a){this.config=d.extend({},this.defaults,this.config,a)},render:function(){this.$elem.empty();if(this.config.pageMethod==="more"){this.config.pageToken!=="null"&&(this.$pageElem=d('<a class="btn-viewMore js-btn" hidefocus="true" href="javascript:;">\n                        <span class="view-more">查看更多<em class="icon-expand"></em></span>\n                        <span class="view-loading"><em class="icon-loadingS"></em>加载中...</span>\n                     </a>').appendTo(this.$elem),this.$elem.removeClass("pages-big"));return this.$elem}if(this.config.pageCount<=1)return this.$elem;this.$pageElem=d("<ul></ul>").appendTo(this.$elem);var a=d("<font />").insertBefore(this.$pageElem);this.$pageElem.detach(),this.config.pageCount>this.config.moreButtonLimit&&this.$pageElem.append(this.createButton("PREV").addClass("js-prev"));if(this.config.showNum){var b=Math.floor(this.config.pageNoRange/2),c=Math.max(this.config.pageNo-b,1),e=Math.min(this.config.pageNo+b,this.config.pageCount),f=this.config.pageNoRange-(e-c+1);f>0&&(c>1?c=Math.max(c-f,1):e=Math.min(e+f,this.config.pageCount)),c>1&&(this.$pageElem.append(this.createButton(1)),c>2&&this.$pageElem.append('<li class="pages-line">...</li>'));for(var g=c;g<=e;g++)this.$pageElem.append(this.createButton(g));e<this.config.pageCount&&(e<this.config.pageCount-1&&this.$pageElem.append('<li class="pages-line">...</li>'),this.$pageElem.append(this.createButton(this.config.pageCount)))}this.config.pageCount>this.config.moreButtonLimit&&this.$pageElem.append(this.createButton("NEXT").addClass("js-next")),this.$pageElem.insertBefore(a),a.remove();return this.$elem},bindEvent:function(){this.$elem.delegate(".js-btn","click",d.proxy(this.onPage,this))},onPage:function(a){var b=d(a.currentTarget).data("pageNo");this.$elem.trigger("onPage",[this,b])},createButton:function(a){var b=d('<a href="javascript:;"></a>'),c=a;a==="PREV"?(c=this.config.prevText,a=this.config.pageNo-1):a==="NEXT"&&(c=this.config.nextText,a=this.config.pageNo+1),b.text(c),b=b.wrap('<li class="js-btn"></li>').parent(),b.data("pageNo",a),(a<1||a>this.config.pageCount)&&b.addClass("pages-hide"),a===this.config.pageNo&&b.addClass("current");return b}});return f});define("widget/FileUploader",function(a,b,c){var d=a("external/jquery"),e=a("basic/oop/Class"),f=a("utils/FlashProxy"),g=a("utils/Utils"),h=a("utils/log/Logger"),i=e.extend({count:0,defaultConfig:{waterMark:"",onSuccess:function(){},onLoading:function(){},onFail:function(){}},init:function(b){var c="";this.count++,this.isUploading=!1,window.uploadImageCallback=undefined,this.config=d.extend({},this.defaultConfig,b),this.$picUploadModuleElem=d(b.picUploadModuleElem);var e=window.location.hostname;e.match(/^.+.126.com.*/)?c="126.com":e.match(/^.+.yeah.net.*/)?c="yeah.net":e.match(/^.+.188.com.*/)?c="188.com":c="163.com",document.domain=c;var g=d(a("utils/tmpl").formatTemplate(a("_tmpl/uploadForm"),{count:this.count,waterMark:this.config.waterMark})).appendTo("body");this.$uploadElem=g,this.$elem=g.children().first(),this.$elem.attr("action","http://upload.buzz."+c+"/upload"),this.$file=this.$elem.find("input[type=file]"),this.$file.bind("change",d.proxy(this.submitImage,this)),this.$trigger=d(b.trigger),this.$trigger.bind("mousemove",d.proxy(this.onTriggerMove,this)),this.config.addFlashCallback&&f.add({onFlashUploadSuccess:d.proxy(this.flashUploadCallback,this)})},onTriggerMove:function(a){this.$elem.css({left:a.pageX-4,top:a.pageY-4})},submitImage:function(){var a=this.$elem.find("input[name=Filedata]").val();if(a!==""){h.triggerLog(this.$file,{method:"sImage"}),this.$picUploadModuleElem.find(".insertPic-area-ing").show(),this.$picUploadModuleElem.find(".insertPic-area").hide(),this.$picUploadModuleElem.find(".insertPic-state").hide();if(!this.validateFile(a)){this.config.onFail();return}this.isUploading=!0;if(d.isFunction(window.uploadImageCallback))return;this.config.onLoading(a),window.uploadImageCallback=d.proxy(this.uploadCallback,this),this.$elem.find("input[name=callback]").val("uploadImageCallback"),this.$elem.submit()}},uploadCallback:function(a){window.uploadImageCallback=undefined;var b=this.$elem.find("input[name=Filedata]").val().split("\\").pop();this.filename=b,this.isUploading=!1,a&&a.originalURL?this.config.onSuccess(b,a):this.config.onFail(b,a),this.$picUploadModuleElem.find(".insertPic-area-ing").hide(),this.$picUploadModuleElem.find(".insertPic-area").show()},flashUploadCallback:function(a){d(document.body).unbind("wgtHide"),a={status:0,originalURL:a};var b=g.S4()+g.S4()+g.S4()+g.S4()+".jpg";a&&a.originalURL?this.config.onSuccess(b,a):this.config.onFail(b,a)},validateFile:function(a){return/^.*\.(gif|jpeg|jpg|png|bmp)$/i.test(a)}});return i});define("utils/FlashProxy",function(a,b,c){var d={callback:{},add:function(a){for(n in a)typeof this.callback[n]=="undefined"&&(this.callback[n]=a[n])},call:function(a){var b=a.method,c=a.param;try{var d=this.callback[b](c);return d}catch(e){}}};window.flashProxy=d;return d});define("_tmpl/uploadForm",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div><form class="upload-form" target="sendImage',count,'" action="http://upload.buzz.163.com/upload" method="POST" accept-charset="utf-8" encType="multipart/form-data"><input type="hidden" name="callback" value="uploadImage"/><input type="hidden" name="watermark" value="',waterMark,'"/><input type="file" name="Filedata" class="file-input"/><input type="submit" class="hidden"/></form><iframe class="hidden" name="sendImage',count,'"></iframe></div>');return p.join("")}});define("_tmpl/customStyle",function(require){return function(tmplData){var p=[];with(tmplData){p.push("");var image=profile_background_image_url;p.push("");var pos=["left","center","right"][profile_background_pos-0+1]+" ";p.push("");var filled=["no-repeat","repeat"][profile_background_filled-0];p.push("");var fix=["scroll","fixed"][profile_background_fixed-0];p.push('<style type="text/css" id="customStyle">'),profile_css_file_type!==0&&image!==""&&p.push("body {    background-attachment:",fix,";    background-image: url(",image,");    background-repeat:",filled,";    background-position:",pos,"top; } .wrapper {    background-image: none; }"),p.push("</style>")}return p.join("")}});define("task/user/floatIntro",function(a,b,c){var d=a("task/Task"),e=a("task/TaskManager"),f=a("user/widget/SetGroupRemark");e.add(new d("FloatIntro",function(){function l(){g&&g.css({display:"none"})}function k(){j=setTimeout(function(){f.isShow()||(!h||!h.group?l():h.group.isShow||(l(),h.hide(),h=null))},e)}var b=a("external/jquery"),c=a("model/UserData"),d={},e=500,g=null,h=null,i=null,j=null;b(document).bind("floatIntroOut",k),b(document).bind("floatIntroOutClick",l),b(document).delegate(".js-float-intro","hover",function(f){if(!(c.getLoginUser()===null||g&&g.isEdit)){var l=b(f.currentTarget),m=l.attr("data-user-nickname");g==null&&(g=b(a("utils/tmpl").formatTemplate(a("_tmpl/floatIntro"),{})),g.appendTo("body"),g.hover(function(a){clearTimeout(j)},function(){k()}));var n=d[m];if(!n){var o=a("user/widget/FloatIntro");n=new o(m,{wrapperElem:g}),d[m]=n}f.type==="mouseenter"?(clearTimeout(j),i=setTimeout(function(){h=n,n.show(f),b(document.body).trigger("closeGroupRemark")},e)):(clearTimeout(i),k())}})}))});define("user/widget/SetGroupRemark",function(a,b,c){var d=a("external/jquery"),e=a("utils/Utils"),f=a("user/widget/BasicGroup"),g=a("model/UserData"),h=a("group/GroupAction"),i=d(document.body),j=f.extend({hideTimer:null,maxLen:13,updateCache:{},keyUpTimer:null,init:function(a,b){this._super(a,b),this.$elem=a,this.$listElem=this.$elem.find(".js-selectlist"),this.$createElem=this.$elem.find(".js-operatelist"),this.$inputRemarkElem=this.$elem.find(".js-remark"),this.$remarkTextElem=this.$elem.find(".js-remark-text"),this.$inputElem=this.$elem.find(".js-group"),this.$tipElem=this.$elem.find(".js-tip-group"),this.$tipRemarkElem=this.$elem.find(".js-tip-remark"),this.$btnElem=this.$elem.find(".js-btnbox"),this.isInit=!1},show:function(a,b,c){this.data=g.get(b),this.$target=a,this.callback=c,this._super(),this.showInfo(),this.bindEvent(),this.onRestRemark(),j.isShow=!0},onRestRemark:function(){this.$tipRemarkElem.hide(),this.$inputRemarkElem.val("选填").show(),this.$remarkTextElem.html("").hide()},bindEvent:function(){this.isInit||(this.$listElem.delegate("li","click",d.proxy(this.onSelect,this)),this.$elem.find(".create-group-trigger").bind("click",d.proxy(this.onCreate,this)),this.$elem.delegate(".save-trigger","click",d.proxy(this.onSave,this)),this.$elem.bind("addGroup",d.proxy(this.onGroup,this)),this.$elem.bind("removeGroup",d.proxy(this.onUnGroup,this)),this.$elem.bind("createGroup",d.proxy(this.onCallBack,this)),this.$elem.bind("addRemark",d.proxy(this.onRemarkDataBack,this)),this.bindInput(),this.isInit=!0),this.updateCache[this.data.id]||(g.bindUpdate(this.data.id,d.proxy(this.onUpdate,this)),this.updateCache[this.data.id]=!0),i.bind("click",d.proxy(this.autoClose,this))},setPosition:function(){var a=this.$target.parent().children(":visible"),b=a.offset();a[0]||(a=this.$target.parent().parent().children(":visible"),b=a.offset()),this.$elem.css({left:b.left,top:b.top+a.innerHeight(),display:"block"})},bindInput:function(){this._super();var a=this;e.onBindInputAction(this.$inputElem),e.onBindInputAction(this.$inputRemarkElem,function(){a.$inputRemarkElem.val()==="选填"&&a.$inputRemarkElem.val(""),a.onTextTips(a.$tipRemarkElem,"hide")},function(){a.$inputRemarkElem.val()===""?a.$inputRemarkElem.val("选填"):a.onSaveRemark()}),this.$remarkTextElem.bind("click",function(){a.$remarkTextElem.hide(),a.$inputRemarkElem.show().focus()})},onSaveRemark:function(){if(!this.request||this.request.readyState===4)this.request=h.addRemark.call(this,d.trim(this.$inputRemarkElem.val()))},onRemarkDataBack:function(a,b){var c=b.status;c==0?this.onTextTips(this.$tipRemarkElem,"error","系统出错"):c==2?this.onTextTips(this.$tipRemarkElem,"error","输入已超过16个字符"):(this.onTextTips(this.$tipRemarkElem,"hide"),this.$inputRemarkElem.hide(),this.$remarkTextElem.html(this.$inputRemarkElem.val()).show())},hide:function(){this.$elem.hide(),j.isShow=!1,this.callback&&this.callback.call(),i.unbind("click",d.proxy(this.autoClose,this))},autoClose:function(a){var b=d(a.target).parents().andSelf();d.inArray(this.$elem[0],b)===-1&&(this.hide(),b.filter("#floatIntroBox").size()===0&&i.trigger("floatIntroOutClick"))}});j.isShow=!1;var k=null;return{getInstance:function(a,b){k==null&&(k=new j(a,b));return k},isShow:function(){return j.isShow}}});define("user/widget/BasicGroup",function(a,b,c){var d=a("external/jquery"),e=a("utils/Utils"),f=a("widget/Box"),g=a("model/UserData"),h=a("model/GroupData"),i=a("group/GroupAction"),j=f.extend({init:function(a,b){this.data=g.get(a),this._super(this.data,b)},showInfo:function(){this.onReset(),this.setPosition(),this.renderGroup()},bindEvent:function(){this.$inputElem=this.$elem.find(".js-input"),this.$tipElem=this.$elem.find(".js-tip"),this.$btnElem=this.$elem.find(".js-btnbox"),this.$createElem=this.$elem.find(".js-operatelist"),this.$listElem=this.$elem.find(".js-selectlist"),this.$elem.bind("addGroup",d.proxy(this.onGroup,this)),this.$elem.bind("removeGroup",d.proxy(this.onUnGroup,this)),this.$elem.bind("createGroup",d.proxy(this.onCallBack,this)),g.bindUpdate(this.data.id,d.proxy(this.onUpdate,this))},bindTrigger:function(){this.$listElem.delegate("li","click",d.proxy(this.onSelect,this)),this.$elem.find(".create-group-trigger").bind("click",d.proxy(this.onCreate,this)),this.$elem.delegate(".save-trigger","click",d.proxy(this.onSave,this)),this.bindInput()},bindInput:function(){var a=this;e.onBindInputAction(this.$inputElem),this.$inputElem.bind("keydown",function(b){b.keyCode==13&&a.onSave()})},onGroup:function(a){h.getGroupInfo().currentId=="-1"&&d(document).trigger("removeGroupUser",[this.data.id])},onUnGroup:function(a,b,c){h.getGroupInfo().currentId==c&&d(document).trigger("removeGroupUser",[this.data.id])},onUpdate:function(a){this.data=a,this.renderGroup()},onCreate:function(){this.$createElem.hide(),this.$tipElem.hide(),this.$btnElem.show(),this.$inputElem.val("新组名称")},onSelect:function(a){var b=d(a.currentTarget),c=b.attr("data-group-id"),e=this.data.groupInfos||[],f=e.length,g=!1;d.inArray(c,e)!==-1&&(g=!0);if(!this.request||this.request.readyState===4)g?this.request=i.removeGroup.call(this,c):this.request=i.addGroup.call(this,c)},onSave:function(){var a=d.trim(this.$inputElem.val());if(a===""||a==="新组名称")this.onError("请输入新组名称");else{if(a.length>16){this.onError("输入已超过16个字符");return}if(!this.request||this.request.readyState===4)this.request=i.createGroupAndAddUser.call(this,a)}},onCallBack:function(a,b){var c=b.status;c==1?this.onReset():c==0?this.onError("系统出错"):c==2?this.onError("输入已超过16个字符"):c==3?this.onError("该分组名已被用"):c==4&&this.onError("最多可以创建10个分组")},onError:function(a){a==undefined?this.onTextTips(this.$tipElem,"hide"):this.onTextTips(this.$tipElem,"error",a)},onReset:function(){this.$listElem.show(),this.$createElem.show(),this.$btnElem.hide(),this.$tipElem.hide()},renderGroup:function(){var a=h.getGroupList(),b=a.length,c=[],f="",g=this.data.groupInfos||[],i=[],j="未分组";if(b>0){for(var k=0;k<b;k++){d.inArray(a[k].gId,g)!==-1?f="checked":f="";var l=this.isUserTweet?e.countChars(a[k].name,18):a[k].name;c.push("<li data-group-id="+a[k].gId+'><a hidefocus="true" href="javascript:;"><input type="checkbox" '+f+" />"+l+"</a></li>")}this.$listElem.html(c.join(""))}else this.$listElem.hide()}});return j});define("group/GroupAction",function(a,b,c){var d=a("external/jquery"),e=a("utils/DataSource"),f=a("model/UserData"),g=a("model/GroupData"),h=a("utils/Utils"),i=a("utils/log/Logger"),j=a("widget/tip/NaviTip"),k={checkGroup:function(a){return e.setKeyFrom(this.$elem).postJSON("checkGroupName",a,d.proxy(function(a){this.$elem.trigger("checkGroup",[a]);var b=i.keyFrom(this.$elem);h.analytics.send("/page.do?method=addGroup&keyfrom="+b)},this))},saveGroup:function(a){return e.setKeyFrom(this.$elem).postJSON("saveGroup",a,d.proxy(function(a){this.$elem.trigger("saveGroup",[a]),i.triggerLog("body",{method:"creatgroup"})},this))},createGroupAndAddUser:function(a){return e.setKeyFrom(this.$elem).postJSON("userCreateGroup",{userId:this.data.id,gName:a},d.proxy(function(a){a.status==1&&(g.getGroupList().push(a.newGroup),f.update(a),j.show({type:"success",text:"创建分组并添加成功！"})),this.$elem.trigger("createGroup",[a]);var b=i.keyFrom(this.$elem);h.analytics.send("/page.do?method=addGroupSingle&keyfrom="+b)},this))},addRemark:function(a){return e.setKeyFrom(this.$elem).postJSON("userRemark",{uid:this.data.id,remark:a},d.proxy(function(a){a.status==1&&(f.update(a.callback),j.show({type:"success",text:"设置成功！"})),this.$elem.trigger("addRemark",[a]);var b=i.keyFrom(this.$elem);h.analytics.send("/page.do?method=setUserRemark&keyfrom="+b)},this))},addGroup:function(a){return e.setKeyFrom(this.$elem).postJSON("userGroup",{userId:this.data.id,gId:a},d.proxy(function(a){f.update(a),j.show({type:"success",text:"添加分组成功！"}),this.$elem.trigger("addGroup",[this]);var b=i.keyFrom(this.$elem);h.analytics.send("/page.do?method=addGroupUser&keyfrom="+b)},this))},removeGroup:function(a){return e.setKeyFrom(this.$elem).postJSON("userUnGroup",{userId:this.data.id,gId:a},d.proxy(function(b){f.update(b),j.show({type:"success",text:"移除分组成功！"}),this.$elem.trigger("removeGroup",[this,a]);var c=i.keyFrom(this.$elem);h.analytics.send("/page.do?method=deleteGroupUser&keyfrom="+c)},this))}};return k});define("_tmpl/floatIntro",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div id="floatIntroBox" class="winlayer winlayer-userintro"><table class="winlayer-table"><tbody><tr><td class="winlayer-top-left"></td><td class="winlayer-top-center"></td><td class="winlayer-top-right"></td></tr><tr><td class="winlayer-middle-left"></td><td id="floatIntroTipBox" class="winlayer-middle-center js-content"></td><td class="winlayer-middle-right"></td></tr><tr><td class="winlayer-bottom-left"></td><td class="winlayer-bottom-center"></td><td class="winlayer-bottom-right"></td></tr></tbody></table></div>');return p.join("")}});define("user/widget/FloatIntro",function(a,b,c){var d=a("external/jquery"),e=a("utils/Utils"),f=a("widget/Box"),g=a("model/UserData"),h=a("model/GroupData"),i=a("utils/DataSource"),j=a("user/UserAction"),k=f.extend({hideTimer:null,userUpdataFlag:!1,init:function(a,b){this.data=g.getByNickName(a),this.data==null&&(this.data={},this.data.nickName=a),this._super(this.data,b)},renderTmpl:function(a){return d('<div class="winlayer-userintro-wrapper">\n                      <em class="js-arrow"></em>\n                      <div class="winlayer-body js-body">\n                         <div class="winlayer-userintro-content-tips">\n                            <em class="icon-loadingS"></em>\n                            <p>加载中，请稍等...</p>\n                         </div>\n                      </div>\n                   </div>')},show:function(a){if(e.getBigBoss()!=this.data.screenName){this._super(),this.config.wrapperElem.find(".js-content").empty().append(this.$elem),this.$target=d(a.currentTarget),this.setPosition();if(this.data.status==0){this.onMess("很抱歉，该用户不存在。");return}this.data.status==1?this.showInfo(this.data):i.postJSON("floatIntro",{nickName:this.data.nickName},d.proxy(function(a){parseInt(a.status)==0?(this.onMess("很抱歉，该用户不存在。"),this.data.status=0):(this.data=g.get(g.update(a)),this.data.isColumnUser&&this.data.sysTag.push("微专栏"),this.showInfo(this.data))},this))}},setPosition:function(){var a=this.$target,b=a.offset(),c=7,d=this.$elem.find(".js-arrow").removeClass("winlayer-arrow-up winlayer-arrow-right winlayer-arrow-down");if(a.parents(".conR").size()===0){var f=this.config.wrapperElem.height(),g=a.height();a.parents(".js-message").size()!==0&&(g=20,c=4);var h=b.top-f-4;b.top-200-e.scrollY()>0&&h>0?(d.addClass("winlayer-arrow-down"),b.top=h):(d.addClass("winlayer-arrow-up"),b.top=b.top+g+c),b.left=e.getXY(a[0]).left}else d.addClass("winlayer-arrow-right"),b.left=b.left-this.config.wrapperElem.width()-c,b.top=b.top;this.config.wrapperElem.css({left:b.left,top:b.top,display:"block"})},showInfo:function(b){b.id==g.getLoginUser().id?b.isSelf=!0:b.isSelf=!1,b.description&&b.description.replace(/[\u4e00-\u9fa5\s]/g,"**").length>80&&(b.description=e.countChars(b.description,78));if(b.userTag.length>0){var c=[],f=b.userTag.length;for(var i=0;i<f;i++)c.push(b.userTag[i]),i!=f-1&&c.push(" | ");b.userTagStr=c.join(""),b.userTagStr.replace(/[\u4e00-\u9fa5\s]/g,"**").length>42&&(b.userTagStr=e.countChars(b.userTagStr,40))}else b.userTagStr="";var j=b.groupInfos,k=j.length;if(k>0){var l=[];for(var i=0;i<k;i++)l.push(h.getNameById(j[i]));b.groupTotalTitle=l.join(","),e.strLen(b.groupTotalTitle)>8?b.groupTitle=e.countChars(b.groupTotalTitle,5):b.groupTitle=b.groupTotalTitle}else b.groupTotalTitle="未分组",b.groupTitle="未分组";var m=b.microColumn,n=m.length;if(n>0)for(i=0;i<n;i++)e.strLen(m[i].columnName)>13?m[i].columnTagName="#"+e.countChars(m[i].columnName,14)+"...":m[i].columnTagName="#"+m[i].columnName+"#";this.$elem.find(".js-body").html(d(a("utils/tmpl").formatTemplate(a("_tmpl/floatIntroInfo"),b))),this.renderClass(),this.setPosition(),this.bindTrigger()},onMouseIn:function(a){clearTimeout(this.config.outTimer)},hide:function(){this.config.wrapperElem.hide(),this.group&&this.group.hide()},bindEvent:function(){},bindTrigger:function(){var b=this,c=a("widget/floatBox/AtBox"),e=a("widget/floatBox/FloatMessageBox"),f=a("widget/floatBox/BlockBox"),h=a("widget/floatBox/RemarkBox"),i=new c(this.data),j=new e(this.data),k=new f(this.data),l=new h(this.data);this.$elem.delegate(".follow-trigger","click",d.proxy(this.onFollow,this)),this.$elem.delegate(".unfollow-trigger","click",d.proxy(this.onUnFollow,this)),this.$elem.delegate(".mail-trigger","click",function(){b.hide(),j.show.call(j)}),this.$elem.delegate(".at-trigger","click",function(){b.hide(),i.show.call(i)}),this.$elem.delegate(".block-trigger","click",function(){b.hide(),k.show.call(k)}),this.$elem.delegate(".unblock-trigger","click",d.proxy(this.onUnBlock,this)),this.$elem.delegate(".js-group","hover",d.proxy(this.onShowGroup,this)),this.$elem.delegate(".remark-trigger","click",function(){b.hide(),l.show.call(l)}),this.userUpdataFlag||(g.bindUpdate(this.data.id,d.proxy(this.onUpdate,this)),this.userUpdataFlag=!0)},onShowGroup:function(b){if(b.type==="mouseenter"){var c=a("user/widget/FloatSetGroup");this.group=new c(this.data.id,{wrapperElem:this.config.wrapperElem}),this.group.show(b)}else this.group.hide()},onFollow:function(a){if(!this.request||this.request.readyState===4)this.request=j.doFollow.call(this,a)},onUnFollow:function(){if(!this.request||this.request.readyState===4)this.request=j.doUnFollow.call(this),d(document.body).trigger("closeGroupRemark")},onUnBlock:function(){if(!this.request||this.request.readyState===4)this.request=j.doUnBlock.call(this)},onUpdate:function(a){this.data=a,a.remark!==""?this.$elem.find(".remark-trigger").text("["+a.remark+"]"):this.$elem.find(".remark-trigger").text("[设置备注]"),this.renderClass(),this.renderGroupTitle()},renderClass:function(){var a=["user-unfollowed","user-followed","user-mutualfollowed","user-blocked","user-followedMe"],b=0;this.$elem.removeClass(a.join(" ")),this.data.isBlocking===!0?b=3:this.data.isFollowing&&this.data.isFollowed?b=2:this.data.isFollowing?b=1:this.data.isFollowed?b=4:b=0,this.$elem.addClass(a[b])},renderGroupTitle:function(){var a=h.getGroupList(),b=a.length,c=this.data.groupInfos,d=[],f="未分组";if(c.length>0){for(var g=0,b=c.length;g<b;g++)d.push(h.getNameById(c[g]));d=d.join(","),e.strLen(d)>8?f=e.countChars(d,5):f=d}else d="未分组";this.$elem.find(".js-group-title").html(f+'<em class="icon-expand"></em>').attr("title",d)},onMess:function(a){this.$elem.find(".js-body").html('\n            <div class="winlayer-userintro-content-tips">\n               <div class="tips-text-big">\n                  <span><em class="icon-forbidB"></em>'+a+"</span>\n               </div>\n            </div>"),this.setPosition()}});return k});define("user/UserAction",function(a,b,c){var d=a("external/jquery"),e=a("utils/DataSource"),f=a("model/UserData"),g=a("utils/Utils"),h=a("utils/log/Logger"),i=a("widget/tip/NaviTip"),j={doFollow:function(a,b){return e.setKeyFrom(this.$elem).postJSON("follow",{userId:this.data.id},d.proxy(function(c){c.beBlocking===!0?i.show({type:"error",text:"对不起，由于该用户已将您拉入黑名单，您无法关注Ta！"}):(f.update(c),i.show({type:"success",text:"关注成功！"}),this.$elem.trigger("followed",[this,a,this.data.id,b]),g.analytics.send("/page.do?method=follow&keyfrom="+h.keyFrom(this.$elem)))},this))},doUnFollow:function(){return e.setKeyFrom(this.$elem).postJSON("unfollow",{userId:this.data.id},d.proxy(function(a){a.groupInfos=[],a.remark="",f.update(a),i.show({type:"success",text:"取消关注成功！"}),this.$elem.trigger("unfollowed",[this]),g.analytics.send("/page.do?method=unFollow&keyfrom="+h.keyFrom(this.$elem))},this))},doBlock:function(){return e.setKeyFrom(this.$elem).postJSON("block",{userId:this.data.id},d.proxy(function(a){a.groupInfos=[],a.remark="",f.update(a),i.show({type:"success",text:"拉黑成功！"}),this.$elem.trigger("blocked",[this]),g.analytics.send("/page.do?method=block&keyfrom="+h.keyFrom(this.$elem))},this))},doUnBlock:function(){return e.setKeyFrom(this.$elem).postJSON("unblock",{userId:this.data.id},d.proxy(function(a){f.update(a),i.show({type:"success",text:"取消拉黑成功！"}),this.$elem.trigger("unblocked",[this]),g.analytics.send("/page.do?method=unBlock&keyfrom="+h.keyFrom(this.$elem))},this))}};return j});define("_tmpl/floatIntroInfo",function(require){return function(tmplData){var p=[];with(tmplData){p.push('<div class="winlayer-bd"><div class="winlayer-userintro-userinfo clearfix"><a class="avatar" title="',nickName,'" href="/',screenName,'" data-keyfrom="avatar" target="_blank"><img alt="',nickName,'" src="',avatar,'" /></a><h3><a class="winlayer-userintro-name winlayer-linka link-la" href="/',screenName,'" data-keyfrom="nickname" target="_blank">',nickName,"</a>");var user={sysTag:sysTag,isColumnUser:isColumnUser};p.push("",require("_tmpl/itag")(user),""),isSelf||(p.push('<a class="winlayer-userintro-remark user-remark winlayer-linkb remark-trigger" data-user-id="',id,'" href="javascript:;">'),remark==""?p.push("[设置备注]"):p.push("[",remark,"]"),p.push("</a>")),p.push('</h3><div class="winlayer-userintro-num"><ul class="winlayer-userintro-num"><li><span><b>',followingCount,"</b><br /><span>关注</span></span></li><li><span><b>",followerCount,"</b><br /><span>被关注</span></span></li><li><span><b>",tweetCount,"</b><br /><span>微博</span></span></li></ul></div></div>");if(iDescription||description)p.push('<p class="winlayer-userintro-desc">简介：'),iDescription!=""?p.push("",iDescription,""):p.push("",description,""),p.push("</p>");p.push("");if(microColumn.length!==0){p.push('<p class="winlayer-userintro-desc winlayer-userintro-column">微专栏：');for(var i=0;i<microColumn.length&&i<2;i++)p.push('<a href="/',screenName,"/column/",microColumn[i].columnId,'" title="',microColumn[i].columnName,'" target="_blank">',microColumn[i].columnTagName,"</a>");p.push("</p>")}p.push(""),userTagStr!==""&&p.push('<div class="winlayer-userintro-desc">标签：',userTagStr,"</div>"),p.push("");if(badgeInfos.length>0){var len=badgeInfos.length,nameArr=["完饰大吉","易如反掌","驿寄梅花","流水不腐","笔耕不缀","斗转星移","跟贴局","夏小家族"],ChineseArr=["一","二","三","四","五","六","七","八","九","十"];p.push('<div class="medal-list"><ul>');for(var i=0;i<len;i++){var code=badgeInfos[i].code-0+1,rank=badgeInfos[i].rank?badgeInfos[i].rank-0+1:0,name=nameArr[badgeInfos[i].code],title=badgeInfos[i].rank?name+"("+ChineseArr[rank-1]+"级)":name;p.push('<li><span class="medal0',code,"-on level0",rank,'" title="',title,'"><em class="num"></em></span></li>')}p.push("</ul></div>")}p.push('</div><div class="winlayer-ft">'),isSelf?p.push("<p>这是我自己</p>"):(p.push('<div class="winlayer-userintro-relation winlayer-linkb"><div class="left"><!--          <a class="user-follow-btn follow-trigger" href="javascript:;"><em class="add-signS"></em>加关注</a>--><span class="user-relation-box user-follow-box"><i title="已关注我"><em class="icon-followeder"></em></i><a class="user-follow-btn follow-trigger" href="javascript:;">+加关注</a></span><span class="user-relation-box user-mutualfollow"><i><em class="icon-mutualfollow"></em></i><a class="link-lb unfollow-trigger" href="javascript:;">取消</a></span><span class="user-relation-box user-following-box"><i>已关注</i><a class="link-lb unfollow-trigger" href="javascript:;">取消</a></span><span class="user-relation-box user-block-box"><i>已拉黑</i><a class="link-lb unblock-trigger" href="javascript:;">取消</a></span></div><div class="right"><span class="user-relation-box user-block"><a class="block-trigger" href="javascript:;">拉黑</a></span>'),isSend&&p.push('<span class="user-relation-box user-mail"><a class="mail-trigger" href="javascript:;">私信</a></span>'),p.push('<span class="user-relation-box user-talk"><a class="at-trigger" href="javascript:;">对TA说</a></span><div class="user-group"><a class="user-group-btn js-group" data-user-id="',id,'" href="javascript:;"><span class="js-group-title" title="',groupTotalTitle,'">',groupTitle,'<em class="icon-expand"></em></span></a></div></div></div>')),p.push("</div>")}return p.join("")}});define("_tmpl/itag",function(require){return function(tmplData){var p=[];with(tmplData)p.push(""),sysTag&&sysTag.length>0&&(p.push(""),typeof isColumnUser!="undefined"&&isColumnUser==!0||typeof columnUser!="undefined"&&columnUser==!0?(p.push(""),sysTag.join(",").indexOf("微专栏")==-1&&(p.push(""),sysTag.push("微专栏"),p.push("")),p.push('<a class="cTag js-tags" data-tags="',sysTag.join(", "),'" href="/rank/daren?Method=click" target="_blank"></a>')):p.push('<a class="iTag js-tags" data-tags="',sysTag.join(", "),'" href="/rank/daren?Method=click" target="_blank"></a>'),p.push("")),p.push("");return p.join("")}});define("widget/floatBox/AtBox",function(a,b,c){var d=a("external/jquery"),e=a("widget/floatBox/Box"),f=a("sendBox/FloatPublishBox"),g=a("utils/tmpl"),h=e.extend({init:function(a,b){this._super(a,b),this.pubbox=null},preRender:function(){return{content:g.formatTemplate(a("_tmpl/floatBox/atBox"),this.data),title:'对<b class="poplayer-keyword">'+this.data.nickName+"</b>说"}},postRender:function(){this.$elem.addClass("poplayer-sendbox"),this.$elem.data("needIdCheck",!1)},bindEvent:function(){this._super(),this.pubbox=new f(this.$elem),this.$elem.bind("sent",d.proxy(this.onSent,this))},onSent:function(){this.onTip({type:"success",text:"发送成功！"}),this.hide()},show:function(){this._super(),this.pubbox.render(),this.pubbox.textarea.clear().appendText("@"+this.data.nickName+" ")}});return h});define("sendBox/FloatPublishBox",function(a,b,c){var d=a("external/jquery"),e=a("sendBox/BasicSendBox"),f=a("sendBox/SendBoxAction"),g=e.extend({checkInput:f.checkInput,onSuccess:function(a){this.textarea.clear(),this.tip.show({type:"success",text:"发布成功！"})}});return g});define("sendBox/BasicSendBox",function(a,b,c){var d=a("external/jquery"),e=a("basic/oop/Class"),f=a("sendBox/widget/WordCounter"),g=a("sendBox/widget/atSuggest/AtSuggester"),h=a("sendBox/widget/Emotion"),i=a("sendBox/widget/TextArea"),j=a("sendBox/InputError"),k=a("sendBox/SendBoxAction"),l=a("sendBox/widget/Tip"),m=a("model/UserData"),n=a("utils/Utils"),o=e.extend({init:function(a,b){this.config=b||{},this.data=a,this.$elem=null,this.textarea=null,this.tip=null,this.blurTimer={},this.imageUrl="",this.badgeNavTips=null},render:function(){this.$elem===null&&(this.$elem=d(this.data),this.bindEvent());return this.$elem},bindEvent:function(){this.$textareaElem=this.$elem.find("textarea"),this.textarea=new i(this.$textareaElem),this.$btnElem=this.$elem.find(".submit-trigger, .tower-submit-trigger"),this.$elem.delegate(".submit-trigger","click",d.proxy(this.onSubmit,this)),this.$elem.delegate("textarea","keypress",d.proxy(this.onCtrlEnter,this)),this.$elem.delegate("textarea","keyup paste cut",d.proxy(this.onCheckInput,this)),this.wordCounter=new f(this.$elem.find(".js-wordCounter"),{showTextCoverPic:this.config.showTextCoverPic}),this.wordCounter.bindEvent(this.$textareaElem),this.atSuggester=g.getInstance(),this.atSuggester.bindEvent(this.$textareaElem),this.emotion=h.getInstance(),this.emotion.bind(this),this.tip=new l(this.$elem.find(".sendinfoTip")),this.$elem.bind("error",d.proxy(this.onError,this))},onError:function(a,b){if(b instanceof j){document.activeElement!==this.textarea.$elem[0]&&this.textarea.toInputPos(),this.onSubmitError(b);return!1}},onCtrlEnter:function(a){a.ctrlKey===!0&&(a.which===10||a.keyCode===13)&&this.onSubmit(a)},onSubmit:function(b){if(m.getLoginUser()!=null){try{this.checkInput()}catch(c){if(c instanceof j){this.$elem.trigger("error",[c]);return}throw c}var e=d.proxy(this.doSubmit,this),f=m.getLoginUser(),g=f.isIdCheck,h=f.isOA,i=typeof this.$elem.data("needIdCheck")=="undefined"?!0:this.$elem.data("needIdCheck");if(d(document.body).data("check")&&typeof g!="undefined"&&g!="1"&&i&&!h){var k=a("widget/floatBox/CheckUserBox"),l=k.getInstance();l.show(e),g=="0"&&(f.isIdCheck=!0)}else e()}},onSubmitError:function(a){a.shown===!0&&this.tip.show(a)},onCheckInput:function(){this._checkTimer&&clearTimeout(this._checkTimer);var a=this;this._checkTimer=setTimeout(function(){try{a.checkInput()}catch(b){if(b instanceof j){a.$btnElem.addClass("disabled");return}throw b}a.$btnElem.removeClass("disabled")},100)},checkInput:function(){throw new Error("Abstarct func!")},doSubmit:k.sendTweet,onSuccess:function(a){throw new Error("Abstarct func!")},blink:function(){if(this.$elem!==null){var a=this.$elem.find("textarea:first");if(a.size()===0)return;var b=function(){a.toggleClass("blink")};for(var c=0;c<6;c++)setTimeout(b,c*100)}},bindBlur:function(a,b){clearTimeout(this.blurTimer[a]),this.blurTimer[a]=setTimeout(d.proxy(b,this),100)},cancelBlur:function(a){a===undefined?d.each(this.blurTimer,function(){clearTimeout(this)}):clearTimeout(this.blurTimer(a))},getParams:k.getParams,onBadgeTips:function(a){var b=m.getLoginUser().badgeInfos;if(b.length>0){var c="",e={2:"驿寄梅花",4:"笔耕不辍",5:"斗转星移"},f={4:"发布了一条新",5:"转发了一条"},g=d.inArray(a,b)!==-1,h=d.inArray(2,b)!==-1;g&&(c=e[a]),n.mail.isMail&&(g&&!h&&(c=e[a]),!g&&h&&(c=e[2]),g&&h&&(c=e[2]+"、"+e[a]));if(c!==""){var i=this.$elem.find("input[name=isRetweet]"),j=i.length,k=i.prop("checked")?1:0;if(j==0||j>0&&k){this.badgeNavTips="您"+f[a]+"微博！"+c+"的成长度增加了";return}}}this.badgeNavTips=null}});return o});define("sendBox/widget/WordCounter",function(a,b,c){var d=a("external/jquery"),e=a("utils/Utils"),f=function(a,b){this.$elem=d(a),this.config=b||{},this._timer=null};f.prototype={bindEvent:function(a){d(a).bind("paste",d.proxy(this.onValueChange,this)).bind("cut",d.proxy(this.onValueChange,this)).bind("keyup",d.proxy(this.onValueChange,this))},onValueChange:function(a){var b=this,c=d(a.target);b._timer&&clearTimeout(b._timer),b._timer=setTimeout(function(){var a=Math.floor((f.MAX_LEN-f.count(c.val()))/2),d=[];a>=0?(d.push('还可以输<span class="char-constantia">'),d.push(a),d.push("</span>字")):(d.push('已超出<span class="char-constantia char-constantia-warning">'),d.push(0-a),d.push("</span>字"),b.config.showTextCoverPic&&!(a>-10)&&d.push('<span class="textToPic-btn"> [ <a class="textToPic-trigger" title="把发布框文字转成图片" href="javascript:;">转成图片</a> ]</span>')),b.$elem.html(d.join(""))},100)}},f.MAX_LEN=326,f.MAX_URL_LEN=256,f.count=function(a){if(a.match(/^\s+$/))return 0;var b=a.replace(e.URL_TOSHORT_REG,function(a){return a.length>f.MAX_URL_LEN?a.substr(f.MAX_URL_LEN-22,a.length):a.match(/:\d+/g)?a:"**********************"});b=b.replace(/[\uFE30-\uFFA0\u2E80-\u9FFF\uac00-\ud7ff\u3000‘“”’]/g,"**");return b.length};return f});define("sendBox/widget/atSuggest/AtSuggester",function(a,b,c){var d=a("external/jquery"),e=a("utils/Utils"),f=a("utils/log/Logger"),g=a("sendBox/widget/atSuggest/AtSuggestList"),h=a("utils/DataSource"),e=a("utils/Utils"),i=function(){this.listStatus="hide",this.list=new g(d("<ul></ul>",{id:"autoSuggestat","class":"autoSuggest-list",overflowX:"scroll"}).css({textAlign:"left"}),{showNum:10}),this.$probeElem=d("<div><span></span><em>@</em><span></span></div>").css({textAlign:"left",position:"absolute",visibility:"hidden",top:0,left:0}).appendTo("body"),this.list.$elem.bind("select",d.proxy(this.onSelect,this)),this.keyType="",this.dataAtCache={},this.dataTopicCache={},d(document).bind("sent",d.proxy(function(){this.dataAtCache={},this.dataTopicCache={}},this)),this.timer=null};i.INPUT_REG=/([@＠#＃])([\u4e00-\u9fa5a-zA-Z0-9]{0,24}$)/g,i.TOPIC_REG=/[#＃]/,i.AT_REG=/[@＠]/,i.prototype={bindEvent:function(a){d(a).bind("keyup",d.proxy(this.onInput,this)).bind("click",d.proxy(this.onInput,this)).bind("blur",d.proxy(this.onBlurOut,this))},unbindEvent:function(a){d(a).unbind("keyup",d.proxy(this.onInput,this)).unbind("click",d.proxy(this.onInput,this)).unbind("blur",d.proxy(this.onBlurOut,this))},onSelect:function(a,b){var c=d(this.target);if(c!==null&&this.insertPosition!==undefined){var e=c.val(),f=e.slice(0,this.insertPosition),g=e.slice(this.insertPosition),h=this.keyType,j=f.lastIndexOf(h),k=f.slice(0,j)+g;if(i.AT_REG.test(h))b="@"+b+" ";else{var l="在这里输入你谈论的话题名称#",m=k.indexOf(l);m!==-1&&(k=k.replace(l,""),j=m),b="#"+b+"#"}c.val(k).focus().setCaretTo(j).appendAfterCaret(b).trigger("keyup")}},showList:function(a,b,c){this.list.show(a,{offset:b,maxHeight:207}),d(document).trigger("trigger-atsuggest"),this.listStatus="show"},hideList:function(){this.list.hide(),this.listStatus="hide"},onInput:function(a){if(a.which===16||a.which===27)return!0;if(this.listStatus==="show"&&d.inArray(a.which,[38,40,9])!==-1)return!0;var b=this.getAtInfo(a.target);if(b===null)this.hideList();else{var c=b.offset,g=b.word;if(i.TOPIC_REG.test(this.keyType)&&g!==""){this.hideList();return}if(i.AT_REG.test(this.keyType))if(this.dataAtCache[g]!==undefined)this.onDataBack(this.dataAtCache[g],a,c);else{var j=g===""?"atRecent":"atSuggest";h.setKeyFrom(a.target).post(j,{atKey:g},d.proxy(function(b){this.dataAtCache[g]=b,this.onDataBack(b,a,c)},this))}else if(this.dataTopicCache[g]!==undefined)this.onDataBack(this.dataTopicCache[g],a,c);else{h.setKeyFrom(a.target).post("topicSuggest",{atKey:g},d.proxy(function(b){this.dataTopicCache[g]=b,this.onDataBack(b,a,c)},this));var k=f.keyFrom(a.target);e.analytics.send("/page.do?method=topicRecent&keyfrom="+k)}}},onDataBack:function(a,b,c){a==="null"||d.trim(a).length===0?this.hideList():(this.target=b.target,this.insertPosition=d(b.target).getCaretPosition(),this.showList(a,c))},onCheckText:function(a){var b=a.replace(/&/g,"&amp;").replace(/ /g,"&nbsp;");return e.encodeSpecialHtmlChar(b).replace(/\r\n|\n|\r/g,"<br/>")},getAtInfo:function(a){var b=d(a),c=b.getCaretPosition(),e=b.get(0).value,f=e.slice(0,c).replace(/＠/,"@"),g=f.match(i.INPUT_REG);if(g!==null){var h=null,j=g[0].substr(0,1);if(i.TOPIC_REG.test(j)&&f.match(/[#＃]/g).length%2==0)return null;this.keyType=j,h=g[0].substr(1),this.$probeElem.css({lineHeight:b.css("lineHeight"),width:b.width(),height:b.height(),"padding-top":b.css("padding-top"),"padding-bottom":b.css("padding-bottom"),"padding-left":b.css("padding-left"),"padding-right":b.css("padding-right"),overflowY:b.css("overflowY"),overflowX:b.css("overflowX")}).children().css({fontSize:b.css("fontSize"),fontFamily:b.css("fontFamily"),fontWeight:b.css("fontWeight")});var k=e.slice(c),l=b.scrollTop(),m=f.slice(0,f.length-1-h.length)+"@";this.$probeElem.scrollTop(l),this.$probeElem.find("span:eq(0)")[0].innerHTML=this.onCheckText(m),this.$probeElem.find("span:eq(1)")[0].innerHTML=this.onCheckText(k);var n=this.$probeElem.children("em"),o=this.$probeElem.offset(),p=n.offset(),q=b.offset(),r=p.top-o.top+n[0].offsetHeight,s=p.left-o.left-parseInt(n.css("fontSize").replace("px",""),10);if(this.$probeElem.scrollTop()<l){var t=l-this.$probeElem.scrollTop();t<r&&(r=r-t)}r>b.height()&&(r=b.height());var u=q.top+parseInt(b.css("borderTopWidth").replace("px",""),10)+parseInt(b.css("paddingTop").replace("px",""),10)+r,v=q.left+parseInt(b.css("borderLeftWidth").replace("px",""),10)+parseInt(b.css("paddingLeft").replace("px",""),10)+s;return{offset:{left:v,top:u},word:h}}return null},onBlurOut:function(a){this.hideList()}};var j=null;return{getInstance:function(){j===null&&(j=new i);return j}}});define("sendBox/widget/atSuggest/AtSuggestList",function(a,b,c){var d=a("external/jquery"),e=a("widget/suggest/SuggestList"),f=e.extend({show:function(a,b){this._super(a),this.$elem.css({height:"auto"}),this.$elem.html(a).appendTo("body").css(b.offset).children(":first").addClass("current"),this.$elem.height()>b.maxHeight&&this.$elem.height(b.maxHeight),this.bindEvent()},onEnter:function(a){var b=this.$elem.children(".current").attr("n");this.$elem.trigger("select",[b]),this.hide()},onKey:function(a){this._super(a),(a.which===38||a.which===40)&&this.scrollTo(this.$elem.find(".current")),a.which===27&&(this.hide(),a.preventDefault())},scrollTo:function(a){var b=this.$elem.children().size();if(b<this.config.showNum)return!0;var c=a.index()*a.height(),d=this.$elem.scrollTop(),e=this.$elem.height();(c+3>d+e||c<d)&&this.$elem.scrollTop(c)}});return f});define("sendBox/widget/Emotion",function(a,b,c){var d=a("external/jquery"),e=a("widget/tinyBox/Box"),f=a("utils/tmpl"),g=a("utils/DataSource"),h=a("utils/Utils"),i=a("model/UserData"),j=a("utils/Cookie"),k=a("utils/log/Logger"),l=e.extend({init:function(a){this.$elem=null,this.isKeydown=!1,this.$latelyElem=null,this.latelyTimeout=null,this.hideTimeout=null,this.loginUserId=i.loginUserId,this.EMOTION_EXPIRES=7,this.browser=d.browser,this.needPreLoad=!0,this.cartoonAppended=!1,this.imgArray=[new Image,new Image,new Image,new Image,new Image,new Image,new Image,new Image,new Image,new Image],this.imgUrlArr=[],this.loadInterval=null;var b=this;setTimeout(function(){g.setKeyFrom(null).postJSON("getEmotions",d.proxy(b.getEmotionsSucc,b))},50)},preRender:function(){return{content:f.formatTemplate(a("_tmpl/insertEmotion"),{type:"main"})}},postRender:function(){this.$elem.addClass("winlayer-face"),this.$elem.find(".js-emotionCon").append(this.commonStr)},bind:function(a){this.targetSendBox=a,this.bindLEEvent(),a.$elem.delegate(".face-trigger","click",{targetSendBox:a},d.proxy(this.onTrigger,this))},onTrigger:function(a){this.needPreLoad=!1,this.targetSendBox=a.data.targetSendBox,this.targetSendBox.cancelBlur();var b=d(a.currentTarget),c=b.offset();c.top+=b.height()+4,c.left-=18,this.show(c),this.latelyTimeout&&clearTimeout(this.latelyTimeout),this.$latelyElem&&this.$latelyElem.hide()&&this.unbindLEEvent(),k.triggerLog(b,{method:"emotion"});return!1},show:function(a){d(document.body).bind("click",d.proxy(this.autoClose,this)).trigger("wgtHide"),this.browser.opera||d(document.body).bind("keydown",d.proxy(this.onKeyDown,this)).bind("keyup",d.proxy(this.onKeyUp,this)),this._super(a),this.cartoonAppended||(this.$elem.find(".js-faceNormal").after(this.cartoonStr),this.cartoonAppended=!0,this.$pageCon=this.$elem.find(".js-pageCon"),this.bindPageEvent())},bindLEEvent:function(){this.targetSendBox.$elem.is("#publishBox")&&this.targetSendBox.$elem.delegate(".face-trigger","mouseenter",{targetSendBox:this.targetSendBox},d.proxy(this.showLatelyEmotion,this)).delegate(".face-trigger","mouseleave",d.proxy(this.hideLatelyEmotion,this))},unbindLEEvent:function(){this.targetSendBox.$elem.undelegate(".face-trigger","mouseenter mouseleave")},getEmotionsSucc:function(b){if(!!b&&!!b.common){this.json=b,this.json.config={common:!0,browser:this.browser},this.commonStr=f.formatTemplate(a("_tmpl/emotionCon"),this.json),this.json.config={cartoon:!0,page:!0},this.cartoonStr=f.formatTemplate(a("_tmpl/emotionCon"),this.json);if(this.needPreLoad&&!j.get("em"+this.loginUserId+"_1")){var c=this;setTimeout(function(){c.preLoadEmotion(c.json,"hot",!1),c.preLoadEmotion(c.json,"common",!0)},800)}}},bindPageEvent:function(){var a=this;this.$cartoonCon=this.$elem.find(".js-cartoonCon"),this.$faceNormal=this.$elem.find(".js-faceNormal"),this.$faceCartoon=this.$elem.find(".js-faceCartoon"),this.$elem.find(".js-titleList li.current").trigger("click"),this.$elem.delegate(".js-page","click",function(b){var c=d(b.currentTarget),e=c.prevAll().size();c.addClass("current").siblings().removeClass("current"),a.$cartoonCon.eq(e).removeClass("hidden").siblings().addClass("hidden")})},bindEvent:function(){this.$elem.delegate(".js-titleList li","click",d.proxy(this.onTabSwitch,this)).delegate(".close-trigger","click",d.proxy(this.hide,this)).delegate(".js-faceList li","click",{type:"main"},d.proxy(this.onEmotionSelect,this))},onKeyDown:function(a){a.keyCode===17&&!this.isKeydown&&(this.isKeydown=!0)},onKeyUp:function(a){a.keyCode===17&&(this.isKeydown=!1)},onEmotionSelect:function(a){var b=d(a.currentTarget),c=b.data("faceCode"),e=b.find("img"),f=this.targetSendBox.textarea;if(!!e.size()){f.appendText("["+c+"]"),f.$elem.trigger("keyup");if(a.data.type==="main"){var g=e.attr("src");this.addLEData(decodeURIComponent(c+","+g)),!this.isKeydown&&this.hide()}else a.data.type==="lately"&&this.$latelyElem.hide()}},onTabSwitch:function(a){var b=d(a.currentTarget).addClass("current").siblings(".current").removeClass("current").end().prevAll().size();b===0?(this.$pageCon&&this.$pageCon.hide(),this.$faceNormal.removeClass("hidden"),this.$faceCartoon.addClass("hidden")):(this.$pageCon.show(),this.$faceNormal.addClass("hidden"),this.$faceCartoon.removeClass("hidden"))},showLatelyEmotion:function(a){var b=this.getLEData(),c="em"+this.loginUserId+"_";this.targetSendBox=a.data.targetSendBox;if(!this.$latelyElem&&b[c+1])this.createLEElem(a);else if(this.$latelyElem){var d=this;this.updateLE(a),this.latelyTimeout&&clearTimeout(this.latelyTimeout),this.latelyTimeout=setTimeout(function(){d.$latelyElem.show(),d.latelyTimeout&&clearTimeout(d.latelyTimeout)},300)}},createLEElem:function(b){var c=f.formatTemplate(a("_tmpl/insertEmotion"),{type:"lately"});this.$latelyElem=d(f.formatTemplate(a("_tmpl/winlayer"),{content:c})),this.updateLE(b),this.$latelyElem.addClass("winlayer-latelyfacewin").delay(1e3).appendTo("body").delegate(".js-latelyList li","click",{type:"lately"},d.proxy(this.onEmotionSelect,this)).bind("mouseenter",d.proxy(this.onLEEnter,this)).bind("mouseleave",d.proxy(this.onLEOut,this))},updateLE:function(a){var b=this.$latelyElem.find(".js-latelyList li"),c=this.getLEData(),e="em"+this.loginUserId+"_";for(var f=1;f<=7;f++){var g=c[e+f]||"";if(!g)break;var h=g.split(",")[0];b.eq(f-1).attr({title:h,"data-face-code":h}).html('<img src="'+g.split(",")[1]+'" alt="'+h+'" title="'+h+'">')}var i=d(a.currentTarget).find(".icon-face"),j=i.offset().left-18,k=i.offset().top+i.height();this.$latelyElem.css({left:j,top:k+4})},hideLatelyEmotion:function(a){this.clearAllTimeout();var b=this;this.hideTimeout=setTimeout(function(){b.$latelyElem&&b.$latelyElem.hide()},300)},onLEEnter:function(a){this.hideTimeout&&clearTimeout(this.hideTimeout),this.$latelyElem.show()},onLEOut:function(a){this.clearAllTimeout(),this.$latelyElem.hide()},clearAllTimeout:function(){this.latelyTimeout&&clearTimeout(this.latelyTimeout),this.hideTimeout&&clearTimeout(this.hideTimeout)},getLEData:function(){var a={};for(var b=1;b<=7;b++){var c="em"+this.loginUserId+"_"+b,d=decodeURIComponent(j.get(c));d&&d!=="null"&&(a[c]=d)}return a},addLEData:function(a){var b=this.getLEData(),c="em"+this.loginUserId+"_";for(var d=1;d<=7;d++)j.del(c+d);b[c+1]?this.sortLEData(b,a):j.set(c+1,encodeURIComponent(a),this.EMOTION_EXPIRES)},sortLEData:function(a,b){var a=a,c=!1,d={},e="em"+this.loginUserId+"_";for(var f=1;f<=7;f++)if(b===a[e+f]){a[e+f]="",c=!0;break}if(c){var g=1;for(var f=1;f<=7;f++){var h=a[e+f]||"";h&&(g+=1,d[e+g]=h)}d[e+1]=b,this.saveLEData(a,d,b)}else this.saveLEData(a,{},b)},saveLEData:function(a,b,c){var d="em"+this.loginUserId+"_";b[d+1]&&(a=b);var e=1,f=0;for(var g=1;g<=6;g++){var h=a[d+g]||"";b[d+1]?h&&(f+=1,j.set(d+f,encodeURIComponent(h),this.EMOTION_EXPIRES)):h&&(e+=1,j.set(d+e,encodeURIComponent(h),this.EMOTION_EXPIRES))}j.set(d+1,encodeURIComponent(c),this.EMOTION_EXPIRES)},preLoadEmotion:function(a,b,c){for(var d=0;d<a[b].length;d++)this.imgUrlArr.push(a[b][d][1]);if(c){this.loadInterval&&clearInterval(this.loadInterval);var e=this,f=0;this.loadInterval=setInterval(function(){var a=f*10,b=0;for(var c=a;c<a+10;c++){if(!e.imgUrlArr[c]){e.loadInterval&&clearInterval(e.loadInterval),e.imgArray=null,e.imgUrlArr=null;break}b=c%10;var d=e.imgArray[b];d.src=e.imgUrlArr[c]}f+=1},1500)}},hide:function(a){this._super(),d(document.body).unbind("click",d.proxy(this.autoClose,this)),this.browser.opera||d(document.body).unbind("keydown").unbind("keyup"),this.$latelyElem&&this.bindLEEvent()},autoClose:function(a){var b=d(a.target).parents().andSelf();d.inArray(this.$elem[0],b)===-1&&b.filter(".face-trigger").size()===0&&this.hide()}}),m=null;return{getInstance:function(){m===null&&(m=new l);return m}}});define("widget/tinyBox/Box",function(a,b,c){var d=a("external/jquery"),e=a("widget/Box"),f=a("utils/tmpl"),g=e.extend({renderTmpl:function(b){return d(f.formatTemplate(a("_tmpl/winlayer"),d.extend({content:""},b)))},show:function(a){this._super(),this.offset=a||this.offset,this.$elem.appendTo("body").css({top:this.offset.top,left:this.offset.left})}});return g});define("_tmpl/winlayer",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div class="winlayer"><table class="winlayer-table"><tbody><tr><td class="winlayer-top-left"></td><td class="winlayer-top-center"></td><td class="winlayer-top-right"></td></tr><tr><td class="winlayer-middle-left"></td><td class="winlayer-middle-center"><em class="winlayer-arrow-up js-arrow"></em><div class="winlayer-body">',content,'</div></td><td class="winlayer-middle-right"></td></tr><tr><td class="winlayer-bottom-left"></td><td class="winlayer-bottom-center"></td><td class="winlayer-bottom-right"></td></tr></tbody></table></div>');return p.join("")}});define("_tmpl/insertEmotion",function(require){return function(tmplData){var p=[];with(tmplData)p.push(""),type==="main"?p.push('<div class="winlayer-hd"><a href="javascript:;" class="winlayer-close icon-close close-trigger" title="关闭"></a><ul class="winlayer-titleList js-titleList"><li class="current"><a hidefocus="true" href="javascript:;">常用</a></li><li><a hidefocus="true" href="javascript:;">卡通</a></li></ul></div><div class="winlayer-bd winlayer-face-bd js-emotionCon"></div>'):type==="lately"&&p.push('<div class="winlayer-hd"><h3>最近使用的表情</h3></div><div class="winlayer-bd"><ul class="latelyfacewin-list js-latelyList"><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul></div>'),p.push("");return p.join("")}});define("_tmpl/emotionCon",function(require){return function(tmplData){var p=[];with(tmplData){p.push("");if(config.common){p.push("");if(hot&&hot.length||common&&common.length){p.push(""),config.browser.opera||p.push('<p class="insertFace-tip">提示：按住ctrl键即可一次选中多个表情</p>'),p.push('<div class="face-normal js-faceNormal">');if(hot&&hot.length){p.push('<ul class="face-list-hot js-faceList">');for(var i=0;i<hot.length;i++)p.push('<li title="',hot[i][0],'" data-face-code="',hot[i][0],'"><img src="',hot[i][1],'" title="',hot[i][0],'" alt="',hot[i][0],'" /></li>');p.push("</ul>")}p.push("");if(common&&common.length){p.push('<ul class="face-list js-faceList clearfix">');for(var i=0;i<common.length;i++)p.push('<li title="',common[i][0],'" data-face-code="',common[i][0],'"><img src="',common[i][1],'" title="',common[i][0],'" alt="',common[i][0],'" /></li>');p.push("</ul>")}p.push("</div>")}p.push("")}p.push("");if(config.cartoon){p.push("");if(cartoon&&cartoon.length){p.push('<div class="face-cartoon js-faceCartoon hidden">');for(var i=0;i<cartoon.length;i++){p.push(""),i%3===0&&p.push('<div class="js-cartoonCon ',i===0?"":"hidden",'">'),p.push('<ul class="face-cartoon-list"><li class="face-cartoon-name">',cartoon[i].catName,'</li><li class="face-cartoon-content"><ul class="face-list js-faceList">');for(var k=0;k<cartoon[i].emotions.length;k++)p.push('<li title="',cartoon[i].emotions[k][0],'" data-face-code="',cartoon[i].emotions[k][0],'"><img src="',cartoon[i].emotions[k][1],'" title="',cartoon[i].emotions[k][0],'" alt="',cartoon[i].emotions[k][0],'" /></li>');p.push("</ul></li></ul>"),((i-2)%3===0||i===cartoon.length-1)&&p.push("</div>"),p.push("")}p.push("</div>")}p.push("")}p.push("");if(config.page){p.push('<div class="winlayer-page js-pageCon"><ul class="pages-small">');var pageCount=Math.ceil(cartoon.length/3);p.push("");for(var i=0;i<pageCount;i++)p.push('<li class="js-page ',i===0?"current":"",'"><a href="javascript:;">',i+1,"</a></li>");p.push("</ul></div>")}p.push("")}return p.join("")}});define("sendBox/widget/TextArea",function(a,b,c){var d=a("external/jquery"),e=a("basic/oop/Class"),f=e.extend({minHeight:null,maxHeight:114,autoHeight:!1,autoHeightTimer:!1,_timer:null,init:function(a){this.$elem=d(a),this.bindEvent()},bindEvent:function(){this.$elem.bind("mouseup mousedown keyup keydown",d.proxy(this.onBlur,this))},bindAutoHeight:function(){this.$elem.bind("keyup",d.proxy(this.setHeight,this))},setHeight:function(){this.minHeight===null&&(this.minHeight=this.$elem.height());var a=this;this.autoHeightTimer&&clearTimeout(this.autoHeightTimer),this.autoHeightTimer=setTimeout(function(){a.temptextAreaElem||a.createTempTextArea(),a.temptextAreaElem.value=a.$elem.val();var b=parseFloat(a.temptextAreaElem.scrollHeight);b>a.minHeight?a.maxHeight&&b>a.maxHeight?a.$elem.css({height:a.maxHeight+"px",overflowY:"auto"}):a.$elem.css({height:b+"px",overflowY:"hidden"}):a.$elem.css({height:a.minHeight+"px",overflowY:"hidden"})},80)},createTempTextArea:function(){var a=this.$elem.width(),b=d("#js-textarea")[0];if(b)this.temptextAreaElem=b;else{var b=d(document.createElement("TEXTAREA"))[0];b.id="js-textarea",b.style.height="0px",b.style.position="absolute",b.style.top="-10000px",b.style.height="0px",b.style.overflow="hidden",this.temptextAreaElem=b,d("body").append(b)}b.style.width=a+"px",b.style.lineHeight=this.$elem.css("lineHeight"),b.style.fontSize=this.$elem.css("fontSize")},onBlur:function(a){if(d.inArray(a.which,[17])===-1){var b=this;b._timer&&clearTimeout(b._timer),b._timer=setTimeout(function(){b.$elem.data("lastPosition",b.$elem.getCaretPosition())},100)}},toInputPos:function(){this.$elem.focus().setCaretTo(this.$elem.data().lastPosition);return this},appendText:function(a){this.toInputPos(),this.$elem.appendAfterCaret(a);return this},appendTextToEnd:function(a){this.$elem.focusToEnd().appendAfterCaret(a);return this},clear:function(){this.$elem.val("").trigger("keyup"),this.minHeight!==null&&this.$elem.height(this.minHeight);return this}});return f});define("sendBox/InputError",function(a,b,c){var d=function(a,b){this.constructor=arguments.callee,this.message=a,this.shown=b||!1};d.prototype=Error.prototype;return d});define("sendBox/SendBoxAction",function(a,b,c){var d=a("external/jquery"),e=a("utils/Utils"),f=a("utils/log/Logger"),g=a("utils/DataSource"),h=a("sendBox/widget/WordCounter"),i=a("sendBox/InputError"),j=a("model/TweetData"),k=a("sendBox/widget/Topic"),l={bindDefaultTip:function(){var a=this.$elem.find(".js-default-tip"),b=this.textarea.$elem;a.bind("click",function(a){b.focus()});var c=this;b.bind("focus",function(b){a.hide()}).bind("blur",function(b){c.bindBlur("defaultTip",function(){b.target.value.length===0&&a.show()})})},bindClose:function(){var a=this;this.$elem.delegate(".close-trigger","click",d.proxy(this.close,this))},close:function(a){this.$elem.trigger("close.TalkBox",[this,this]),this.config.showTowerTips&&this.config.showTowerTips===!0&&this.tipsInterval&&this.$elem.find(".js-closeTips").trigger("click",[!1]),this.$elem.detach();return!1},bindOperateCheckbox:function(a){var b=this;this.$elem.delegate(".js-Checkbox","click",function(a){b.cancelBlur(),b.textarea.toInputPos(),a&&a.stopPropagation?a.stopPropagation():window.event.cancelBubble=!0})},checkInput:function(){l.checkRetweetInput.call(this);var a=this.$textareaElem.val(),b=h.count(a.replace(e.CONV_REG,""));if(b<=0)throw new i("再说点什么吧！",!0);return!0},checkRetweetInput:function(){var a=this.textarea.$elem.val(),b=h.count(a),c=a.indexOf(k.content);if(c!==-1){this.textarea.$elem.setCaretTo(c+1,c+k.contentLength+1);throw new i("换个话题再发布吧！",!0)}if(b>326)throw new i("Invalid input length",!1);var d=a.match(e.CONV_REG);if(d&&d.length>2)throw new i("最多包含2个#话题！",!0);return!0},showSuccess:function(b){this.$elem.find("textarea").val("");var c=this;if(!this.config.showTowerTips||this.config.showTowerTips!==!0)setTimeout(function(){l.close.call(c)},30);else{var e=this.data.relatedTweet.replyParentTweet||this.data.relatedTweet.root||null;if(!e){setTimeout(function(){l.close.call(c)},30);return}this.$successTips=d(a("utils/tmpl").formatTemplate(a("_tmpl/towerSuccessTips"),e));var f=5,g=this.$successTips.find(".js-timeCount");this.$hideElem=this.$elem.find("> *").not(".js-arrow").hide(),this.$elem.append(this.$successTips),this.tipsInterval=setInterval(function(){f!==0?g.text(f--):c.$elem.find(".js-closeTips").trigger("click",[!0])},1e3)}},onRequestError:function(a){var b=d.parseJSON(a.responseText);b.errorType==="block"&&this.tip.show({type:"error",text:"你已被对方加入黑名单，不能对其进行评论或转发"})},sendTweet:function(){if(!d.isPlainObject(this.request)||this.request.readyState===4){var b=this.getParams(),c=this.$elem.find(".submit-trigger").addClass("sbtn-icon-ing"),h=c.html();c.data("originHtml",h),c.html("<em>发送中...</em>");var i=this;this.request=g.setKeyFrom(this.$elem).postJSON("sendTweet",b,function(d){var e=l.parseResultInfo(d);if(e.isSuccess)if(i.config.successCallBack)i.config.successCallBack(d);else{var f=j.get(j.update(d));i.$elem.trigger("sent",[f,i,b.replyIt]),i.onSuccess(d)}else{i.tip.show({type:"error",text:e.tip});if(!e.tip){var g=a("widget/floatBox/VerifyBox"),k=g.getInstance();k.show(function(){i.request.resend()})}else c.html(c.data("originHtml"))}c.removeClass("sbtn-icon-ing").html(h)}).error(d.proxy(l.onSendError,i)),e.analytics.send("/page.do?method=addTweet&keyfrom="+f.keyFrom(this.$elem))}},parseResultInfo:function(a){var b=a.resultInfo,c={};c.tip="",b.addTweet=="3"||b.replyTarget=="3"||b.replyRoot=="3"||b.retweet=="3"?c.isSuccess=!1:b.addTweet=="4"||b.replyTarget=="4"||b.replyRoot=="4"||b.retweet=="4"?(c.isSuccess=!1,c.tip="该条微博已经被删除"):b.addTweet=="2"||b.replyTarget=="2"||b.replyRoot=="2"||b.retweet=="2"||b.topPost=="2"||b.downPost=="2"?(c.isSuccess=!1,c.tip="操作失败"):b.replyTarget!="1"&&b.replyRoot!="1"||b.retweet!="1"?b.replyTarget=="1"||b.replyRoot=="1"?(c.isSuccess=!1,c.tip="对不起，由于该微博中有用户把您拉入黑名单，您无法回复这条评论"):b.retweet=="1"?(c.isSuccess=!1,c.tip="对不起，由于该微博中有用户把您拉入黑名单，您无法转发这条评论"):b.topPost=="1"?(c.isSuccess=!1,c.tip="顶操作失败"):b.downPost=="1"?(c.isSuccess=!1,c.tip="踩操作失败"):c.isSuccess=!0:(c.isSuccess=!1,c.tip="对不起，由于该微博中有用户把您拉入黑名单，您无法回复并且转发这条评论");return c},onSendError:function(a){var b=this.$elem.find(".submit-trigger").removeClass("sbtn-icon-ing");b.html(b.data("originHtml"));var c=d.parseJSON(a.responseText);c.errorType&&c.errorType==="block"&&this.$elem.trigger("error",["blockedByUser",{title:"无法发送信息",content:"对不起，该用户已经将你加入黑名单，因此无法对他发送信息"}])},getParams:function(){var b=(this.config.replyType===1||d("#singleTweetList").attr("data-reply-type")==1)&&this.config.type==="reply";if(b)var c=this.$elem.find("textarea").val();else var c=d.trim(this.$elem.find("textarea").val());var e=this.$elem.find(".js-publishBoxFt input,.js-inputs input"),f=e.filter("[name=isRetweet]").prop("checked")?1:0,g=e.filter("[name=replyOriginal]").prop("checked")?1:0,h=e.filter("[name=replyToIt]").prop("checked")?1:0,i=0;if(this.config.quote){var j=this.config.quote;this.config.quote=""}else if(this.data.type==="reply"){var j="||@"+this.data.user.nickName+"："+this.data.content;this.config.quote=""}if(this.config.type==="reply")h=1,i=2;else if(this.config.type==="retweet"||this.config.type==="qunRetweet")f=1,i=1;var k={content:c,targetId:this.data.id,isRetweet:f,replyOriginal:g,replyIt:h,flag:i,replyOriginContent:j},l=a("model/QunData").getQunInfo();if(this.config.type==="qunRetweet"||this.config.type==="reply"&&l)k.qId=l.id;if(d("#discoverPage").size()){var m=d("#discoverBox .mainBox-hd .js-name").text(),n=d("#discoverBox .mainBox-hd .js-name").attr("data-href");k.rssSource=n+"|发现-"+m}b&&(k.replyType=1),(this.config.type==="reply"||this.config.type==="retweet")&&this.data.user&&this.data.user.id&&(k.targetUserId=this.data.user.id);return k},appendRetweetContent:function(){var a=" ||@"+this.data.user.nickName+"："+this.data.content;a.length>163&&(a=a.substr(0,163));var b=this.$elem.find("textarea");b.val(a).setCaretTo(0)}};return l});define("model/TweetData",function(a,b,c){var d=a("external/jquery"),e=a("basic/oop/Class"),f=a("model/UserData"),g=a("utils/Utils"),h=a("lbs/CityData"),i={},j={},k=e.extend({init:function(a){this.id=k.update(a)},get:function(){return i[this.id]}}),l=["replyCount","retweetCount","isFavorited"];k.update=function(a){a.videoInfos=a.videoInfos||[];if(a.position){var b=h.cityData[a.position.province],c=b&&b.city[a.position.city];a.position.provinceCode=b&&b.code||0,a.position.cityCode=c&&c.code||0}else a.position=null;a.relatedTweet&&d.each(a.relatedTweet,function(b,c){c&&(typeof c!="string"&&(c=k.update(c)),a.relatedTweet[b]=k.get(c))});var e=a.user;e&&(typeof e!="string"&&(e=f.update(e)),a.user=f.get(e));var g=!1;if(i[a.id]!==undefined){var j=i[a.id];for(var m=0,n=l.length;m<n;m++){var o=l[m];if(a[o]!==undefined&&a[o]!==j[o]){g=!0;break}}}i[a.id]=d.extend(!0,i[a.id],a),g&&k.publishUpdate(a.id);return a.id},k.get=function(a){return i[a]},k.bindUpdate=function(a,b){var c=j[a]||[];c.push(b),j[a]=c},k.publishUpdate=function(a){var b=j[a];if(b!==undefined)for(var c=0,d=b.length;c<d;c++)b[c](k.get(a))},k.clearData=function(a,b){d.each(i,function(c,d){c!==a&&c!==b&&(i[c]=undefined)})};return k});define("lbs/CityData",[],function(a,b,c){return{cityData:{"北京":{code:1,city:{}},"天津":{code:2,city:{}},"河北":{code:3,city:{"不限":{code:0},"石家庄":{code:1},"唐山":{code:2},"秦皇岛":{code:3},"邯郸":{code:4},"邢台":{code:5},"保定":{code:6},"张家口":{code:7},"承德":{code:8},"沧州":{code:9},"廊坊":{code:10},"衡水":{code:11}}},"山西":{code:4,city:{"不限":{code:0},"太原":{code:1},"大同":{code:2},"阳泉":{code:3},"长治":{code:4},"晋城":{code:5},"朔州":{code:6},"晋中":{code:7},"运城":{code:8},"忻州":{code:9},"临汾":{code:10},"吕梁":{code:11}}},"内蒙":{code:5,city:{"不限":{code:0},"呼和浩特":{code:1},"包头":{code:2},"乌海":{code:3},"赤峰":{code:4},"通辽":{code:5},"鄂尔多斯":{code:6},"呼伦贝尔":{code:7},"巴彦淖尔":{code:8},"乌兰察布":{code:9},"兴安":{code:10},"锡林郭勒":{code:11},"阿拉善":{code:12}}},"辽宁":{code:6,city:{"不限":{code:0},"沈阳":{code:1},"大连":{code:2},"鞍山":{code:3},"抚顺":{code:4},"本溪":{code:5},"丹东":{code:6},"锦州":{code:7},"营口":{code:8},"阜新":{code:9},"辽阳":{code:10},"盘锦":{code:11},"铁岭":{code:12},"朝阳":{code:13},"葫芦岛":{code:14}}},"吉林":{code:7,city:{"不限":{code:0},"长春":{code:1},"吉林":{code:2},"四平":{code:3},"辽源":{code:4},"通化":{code:5},"白山":{code:6},"松原":{code:7},"白城":{code:8},"延边朝鲜族自治州":{code:9}}},"黑龙江":{code:8,city:{"不限":{code:0},"哈尔滨":{code:1},"齐齐哈尔":{code:2},"鸡西":{code:3},"鹤岗":{code:4},"双鸭山":{code:5},"大庆":{code:6},"伊春":{code:7},"佳木斯":{code:8},"七台河":{code:9},"牡丹江":{code:10},"黑河":{code:11},"绥化":{code:12},"大兴安岭":{code:13}}},"上海":{code:9,city:{}},"江苏":{code:10,city:{"不限":{code:0},"南京":{code:1},"无锡":{code:2},"徐州":{code:3},"常州":{code:4},"苏州":{code:5},"南通":{code:6},"连云港":{code:7},"淮安":{code:8},"盐城":{code:9},"扬州":{code:10},"镇江":{code:11},"泰州":{code:12},"宿迁":{code:13}}},"浙江":{code:11,city:{"不限":{code:0},"杭州":{code:1},"宁波":{code:2},"温州":{code:3},"嘉兴":{code:4},"湖州":{code:5},"绍兴":{code:6},"金华":{code:7},"衢州":{code:8},"舟山":{code:9},"台州":{code:10},"丽水":{code:11}}},"安徽":{code:12,city:{"不限":{code:0},"合肥":{code:1},"芜湖":{code:2},"蚌埠":{code:3},"淮南":{code:4},"马鞍山":{code:5},"淮北":{code:6},"铜陵":{code:7},"安庆":{code:8},"黄山":{code:9},"滁州":{code:10},"阜阳":{code:11},"宿州":{code:12},"巢湖":{code:13},"六安":{code:14},"亳州":{code:15},"池州":{code:16},"宣城":{code:17}}},"福建":{code:13,city:{"不限":{code:0},"福州":{code:1},"厦门":{code:2},"莆田":{code:3},"三明":{code:4},"泉州":{code:5},"漳州":{code:6},"南平":{code:7},"龙岩":{code:8},"宁德":{code:9}}},"江西":{code:14,city:{"不限":{code:0},"南昌":{code:1},"景德镇":{code:2},"萍乡":{code:3},"九江":{code:4},"新余":{code:5},"鹰潭":{code:6},"赣州":{code:7},"吉安":{code:8},"宜春":{code:9},"抚州":{code:10},"上饶":{code:11}}},"山东":{code:15,city:{"不限":{code:0},"济南":{code:1},"青岛":{code:2},"淄博":{code:3},"枣庄":{code:4},"东营":{code:5},"烟台":{code:6},"潍坊":{code:7},"济宁":{code:8},"泰安":{code:9},"威海":{code:10},"日照":{code:11},"莱芜":{code:12},"临沂":{code:13},"德州":{code:14},"聊城":{code:15},"滨州":{code:16}}},"河南":{code:16,city:{"不限":{code:0},"郑州":{code:1},"开封":{code:2},"洛阳":{code:3},"平顶山":{code:4},"安阳":{code:5},"鹤壁":{code:6},"新乡":{code:7},"焦作":{code:8},"濮阳":{code:9},"许昌":{code:10},"漯河":{code:11},"三门峡":{code:12},"南阳":{code:13},"商丘":{code:14},"信阳":{code:15},"周口":{code:16},"驻马市":{code:17},"济源":{code:18}}},"湖北":{code:17,city:{"不限":{code:0},"武汉":{code:1},"黄石":{code:2},"十堰":{code:3},"宜昌":{code:4},"襄樊":{code:5},"鄂州":{code:6},"荆门":{code:7},"孝感":{code:8},"荆州":{code:9},"黄冈":{code:10},"咸宁":{code:11},"随州":{code:12},"恩施":{code:13},"仙桃":{code:14},"潜江":{code:15},"天门":{code:16},"神农架":{code:17}}},"湖南":{code:18,city:{"不限":{code:0},"长沙":{code:1},"株洲":{code:2},"湘潭":{code:3},"衡阳":{code:4},"邵阳":{code:5},"岳阳":{code:6},"常德":{code:7},"张家界":{code:8},"益阳":{code:9},"郴州":{code:10},"永州":{code:11},"怀化":{code:12},"娄底":{code:13},"湘西":{code:14}}},"广东":{code:19,city:{"不限":{code:0},"广州":{code:1},"韶关":{code:2},"深圳":{code:3},"珠海":{code:4},"汕头":{code:5},"佛山":{code:6},"江门":{code:7},"湛江":{code:8},"茂名":{code:9},"肇庆":{code:10},"惠州":{code:11},"梅州":{code:12},"汕尾":{code:13},"河源":{code:14},"阳江":{code:15},"清远":{code:16},"东莞":{code:17},"中山":{code:18},"潮州":{code:19},"揭阳":{code:20},"云浮":{code:21}}},"广西":{code:20,city:{"不限":{code:0},"南宁":{code:1},"柳州":{code:2},"桂林":{code:3},"梧州":{code:4},"北海":{code:5},"防城港":{code:6},"钦州":{code:7},"贵港":{code:8},"玉林":{code:9},"百色":{code:10},"贺州":{code:11},"河池":{code:12},"来宾":{code:13},"崇左":{code:14}}},"海南":{code:21,city:{"不限":{code:0},"海口":{code:1},"三亚":{code:2},"五指山":{code:3},"琼海":{code:4},"儋州":{code:5},"文昌":{code:6},"万宁":{code:7},"东方":{code:8},"定安":{code:9},"屯昌":{code:10},"澄迈":{code:11},"临高":{code:12},"白沙":{code:13},"昌江":{code:14},"乐东":{code:15},"陵水":{code:16},"保亭":{code:17},"琼中":{code:18},"西沙群岛":{code:19},"南沙群岛":{code:20},"其他岛屿":{code:21}}},"重庆":{code:22,city:{}},"四川":{code:23,city:{"不限":{code:0},"成都":{code:1},"自贡":{code:2},"攀枝花":{code:3},"泸州":{code:4},"德阳":{code:5},"绵阳":{code:6},"广元":{code:7},"遂宁":{code:8},"内江":{code:9},"乐山":{code:10},"南充":{code:11},"眉山":{code:12},"宜宾":{code:13},"广安":{code:14},"达州":{code:15},"雅安":{code:16},"巴中":{code:17},"资阳":{code:18},"阿坝":{code:19},"甘孜":{code:20},"凉山":{code:21}}},"贵州":{code:24,city:{"不限":{code:0},"贵阳":{code:1},"六盘水":{code:2},"遵义":{code:3},"安顺":{code:4},"铜仁地区":{code:5},"黔西南":{code:6},"毕节":{code:7},"黔东南":{code:8},"黔南":{code:9}}},"云南":{code:25,city:{"不限":{code:0},"昆明":{code:1},"曲靖":{code:2},"玉溪":{code:3},"保山":{code:4},"昭通":{code:5},"丽江":{code:6},"普洱":{code:7},"临沧":{code:8},"楚雄":{code:9},"红河":{code:10},"文山":{code:11},"西双版纳":{code:12},"大理":{code:13},"德宏":{code:14},"怒江":{code:15},"迪庆":{code:16}}},"西藏":{code:26,city:{"不限":{code:0},"拉萨":{code:1},"昌都":{code:2},"山南":{code:3},"日喀则":{code:4},"那曲":{code:5},"阿里":{code:6},"林芝":{code:7}}},"陕西":{code:27,city:{"不限":{code:0},"西安":{code:8},"铜川":{code:9},"宝鸡":{code:10},"咸阳":{code:11},"渭南":{code:12},"延安":{code:13},"汉中":{code:14},"榆林":{code:15},"安康":{code:16},"商洛":{code:17}}},"甘肃":{code:28,city:{"不限":{code:0},"兰州":{code:1},"嘉峪关":{code:2},"金昌":{code:3},"白银":{code:4},"天水":{code:5},"武威":{code:6},"张掖":{code:7},"平凉":{code:8},"酒泉":{code:9},"庆阳":{code:10},"定西":{code:11},"陇南":{code:12},"临夏":{code:13},"甘南":{code:14}}},"青海":{code:29,city:{"不限":{code:0},"西宁":{code:1},"海东":{code:2},"海北":{code:3},"黄南":{code:4},"海南":{code:5},"果洛":{code:6},"玉树":{code:7},"海西":{code:8}}},"宁夏":{code:30,city:{"不限":{code:0},"银川":{code:1},"石嘴山":{code:2},"吴忠":{code:3},"固原":{code:4},"中卫":{code:5}}},"新疆":{code:31,city:{"不限":{code:0},"乌鲁木齐":{code:1},"克拉玛依":{code:2},"吐鲁番":{code:3},"哈密":{code:4},"昌吉":{code:5},"博尔塔拉":{code:6},"巴音郭楞":{code:7},"阿克苏":{code:8},"克孜勒苏":{code:9},"喀什":{code:10},"和田":{code:11},"伊犁":{code:12},"塔城":{code:13},"阿勒泰":{code:14},"其他":{code:15}}},"台湾":{code:32,city:{"不限":{code:0},"台北":{code:1},"台中":{code:2},"台南":{code:3},"高雄":{code:4},"基隆":{code:5},"新竹":{code:6},"嘉义":{code:7},"宜兰":{code:8},"桃园":{code:9},"彰化":{code:10},"苗栗":{code:11},"云林":{code:12},"屏东":{code:13},"澎湖":{code:14},"花莲":{code:15}}},"香港":{code:33,city:{}},"澳门":{code:34,city:{}}}}});define("sendBox/widget/Topic",function(a,b,c){var d=a("utils/jquery-wb"),e=a("basic/oop/Class"),f=a("utils/Utils"),g=e.extend({init:function(a){this.$trigger=d(a.trigger),this.textarea=a.textarea,this.initTrigger()},initTrigger:function(){this.$trigger.removeClass("hidden"),this.$trigger.bind("click",d.proxy(this.inputTopic,this))},inputTopic:function(){this.$trigger.hasClass("insert-topic-btn")?f.analytics.send("/page.do?method=addTopic&keyfrom=pHometl.topic"):f.analytics.send("/page.do?method=topic&keyfrom=pHometl");var a=this.textarea.$elem.val();a.indexOf(g.content)===-1&&this.textarea.appendText(g.content+" ");var b=this.textarea.$elem.val().indexOf(g.content);this.textarea.$elem.setCaretTo(b+1,b+g.contentLength+1),this.textarea.$elem.keyup()}});g.content="#在这里输入你谈论的话题名称#",g.contentLength=13;return g});define("_tmpl/towerSuccessTips",function(require){return function(tmplData){var p=[];with(tmplData){p.push("");var url="/"+user.screenName+"/status/"+id;p.push('<div class="tweet-tips js-successTips"><div><a class="btn-small-green" href="',url,'" target="_blank">查看盖楼</a></div><div><p class="text-la"><span class="js-timeCount">5</span>秒后自动关闭&nbsp;&nbsp;[<a class="link-lb js-closeTips" href="javascript:;" title="立即关闭">立即关闭</a>]</p></div></div>')}return p.join("")}});define("sendBox/widget/Tip",function(a,b,c){var d=a("external/jquery"),e=a("widget/tip/NaviTip"),f=function(a,b){this.$elem=d(a)};f.prototype={show:function(a){a instanceof Error?this.onText(a.message,"error"):this.onText(a.text,a.type)},onText:function(a,b){e.show(a,b)}};return f});define("widget/floatBox/CheckUserBox",function(a,b,c){var d=a("external/jquery"),e=a("widget/floatBox/Box"),f=a("utils/Utils"),g=a("utils/DataSource"),h=a("model/UserData"),i=a("utils/tmpl"),j="http://"+location.host+"/dog.do?action=getToughVerifyCode",k=e.extend({preRender:function(){return{content:i.formatTemplate(a("_tmpl/checkUserBox"),this.data),title:"身份认证"}},postRender:function(){this.$elem.addClass("poplayer-checkuserbox"),this.$name=this.$elem.find(".js-name"),this.$number=this.$elem.find(".js-number"),this.$tips=this.$elem.find(".js-tips"),this.$verify=this.$elem.find(".js-verifyCode"),this.$img=this.$elem.find(".js-image")},bindEvent:function(){this._super(),this.$elem.delegate(".submit-trigger","click",d.proxy(this.onSubmit,this)).delegate(".change-trigger","click",d.proxy(this.onChangeVerifyCode,this)),this.$elem.find("input[type=text]").bind("keyup",d.proxy(this.onKeyUp,this)),this.$elem.find("input[type=text]").bind("click",d.proxy(this.onError,this)),this.$elem.find(".js-overseas").bind("click",d.proxy(this.hide,this))},show:function(a,b,c){this._super(),this.callback=a||null,this.closeCallback=b||null,this.isRegOpen=c||!1,this.$name.val("").focus(),this.$number.val(""),this.onError(),this.$elem.find(".change-trigger").trigger("click")},onCheck:function(){var a=d.trim(this.$name.val()),b=d.trim(this.$number.val()),c=d.trim(this.$verify.val());if(a===""){this.onError("请填写真实姓名和身份证"),this.$name.focus();return!1}if(b===""){this.onError("请填写真实姓名和身份证"),this.$number.focus();return!1}if(c===""){this.onError("请输入验证码"),this.$verify.focus();return!1}return!0},onError:function(a){typeof a=="string"&&a!==""?this.onTextTips(this.$tips,"error",a):this.onTextTips(this.$tips,"hide")},onKeyUp:function(a){this.timer&&clearTimeout(this.timer);var b=this;this.timer=setTimeout(function(){b.onError()},100)},onSubmit:function(){this.onError(),this.isRegOpen===!0?f.analytics.send("/page.do?keyfrom=reg.nickname&method=finish"):f.analytics.send("/page.do?method=finish&keyfrom=pHometl");if(!(d.isPlainObject(this.request)&&this.request.readyState!==4||!this.onCheck())){var a=d.trim(this.$name.val()),b=d.trim(this.$number.val()),c=d.trim(this.$verify.val()),e=this;this.request=g.postJSON("updateUserIDCard",{realName:a,idNo:b,verifyCode:c},function(a){if(a.state){e.hide(!0);var b=h.getLoginUser();b!=null&&(b.isIdCheck=!0),e.isRegOpen===!0?f.analytics.send("/page.do?keyfrom=reg.nickname&method=finish.suc"):f.analytics.send("/page.do?keyfrom=pHometl&method=finish.suc"),setTimeout(function(){e.callback&&e.callback.call()},500)}else e.onError(a.desc),e.$elem.find(".change-trigger").trigger("click")});return!1}},onChangeVerifyCode:function(a){var b=(new Date).getTime();this.$img.attr("src",j+"&rnd="+b);return!1},hide:function(a){this._super();a!==!0&&this.closeCallback&&this.closeCallback.call()}}),l=null;return{getInstance:function(a,b){l==null&&(l=new k(a,b));return l}}});define("_tmpl/checkUserBox",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<p class="poplayer-checkuserbox-desc">请遵守<a class="poplayer-linkb" href="http://news.163.com/11/1216/11/7LD3VQ1600014JB6.html" target="_blank">《北京市微博客发展管理若干规定》</a>使用微博客服务。本网将建立健全用户信息安全管理制度，保障用户信息安全，严防用户信息泄露。</p><div class="poplayer-item"><label class="poplayer-item-left" for="poplayer_name">真实姓名：</label><div class="poplayer-item-right"><input id="poplayer_name" class="poplayer-input js-name" type="text" /></div></div><div class="poplayer-item"><label class="poplayer-item-left" for="poplayer_num">身份证号：</label><div class="poplayer-item-right"><input id="poplayer_num" class="poplayer-input js-number" type="text" /></div></div><div class="poplayer-item poplayer-checkuserbox-verify"><label class="poplayer-item-left" for="poplayer_num">验证码：</label><div class="poplayer-item-right"><input id="poplayer_verifyCode" class="poplayer-input js-verifyCode" type="text" />&nbsp;&nbsp;<img class="js-image" height="25" width="84" src="">&nbsp;&nbsp;<a class="poplayer-linkb change-trigger" href="javascript:;">换一张</a></div></div><div class="poplayer-item poplayer-checkuserbox-tips-item"><label class="poplayer-item-left">&nbsp;</label><div class="poplayer-item-right"><p class="poplayer-tips js-tips"><span class="text-tips text-tips-error js-text"></span></p></div></div><div class="poplayer-item"><label class="poplayer-item-left">&nbsp;</label><div class="poplayer-item-right"><div class="poplayer-btnbox"><a class="poplayer-btn-sure submit-trigger" href="javascript:;">填写完毕</a><a class="poplayer-btn-cancel close-trigger" href="javascript:;">下次再说</a></div></div></div><div class="poplayer-item"><label class="poplayer-item-left">&nbsp;</label><div class="poplayer-item-right"><a class="cDBlue js-overseas fFS link-more" href="/settings/idCard#Overseas" target="_blank">港澳台/海外用户认证/组织机构用户认证&gt;&gt;</a></div></div>');return p.join("")}});define("_tmpl/floatBox/atBox",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div class="tweet-publishBox"><div class="tweet-publishBox-hd"><div class="tweet-publishBox-textareaBox"><textarea class="tweet-publishBox-textarea"></textarea></div></div><div class="tweet-publishBox-ft"><div class="clearfix"><div class="tweet-publishBox-operate"><div class="tweet-publishBox-btn"><a class="submit-trigger" href="javascript:;">发送</a></div><span class="tweet-publishBox-tip js-wordCounter">还可以输入<span class="char-constantia">163</span>字</span><div class="tweet-publishBox-insert"><div class="insert-list"><a class="insert-face face-trigger" title="表情" href="javascript:;"><em class="icon-face"></em></a></div></div></div></div></div></div>');return p.join("")}});define("widget/floatBox/FloatMessageBox",function(a,b,c){var d=a("external/jquery"),e=a("widget/floatBox/Box"),f=a("sendBox/MessageBox"),g=a("utils/tmpl"),h=e.extend({init:function(a,b){this._super(a,b),this.msgbox=null},preRender:function(){return{content:g.formatTemplate(a("_tmpl/floatBox/messageBox"),this.data),title:"发私信"}},postRender:function(){this.$elem.addClass("poplayer-mailbox")},bindEvent:function(){this._super(),this.msgbox=new f(this.$elem),this.$elem.bind("messageSent",d.proxy(this.onSent,this))},onSent:function(){this.hide()},show:function(){this._super(),this.msgbox.render(),this.data.nickName.length>0?this.$elem.find("textarea").focus():this.$elem.find("input").focus(),this.msgbox.textarea.clear()}});return h});define("sendBox/MessageBox",function(a,b,c){var d=a("external/jquery"),e=a("sendBox/BasicSendBox"),f=a("sendBox/SendBoxAction"),g=a("utils/DataSource"),h=a("utils/log/Logger"),i=a("utils/Utils"),j=e.extend({init:function(a,b){this._super(a,b),this.$nickName=null,this.$content=null},checkInput:f.checkInput,render:function(){this._super(),this.$nickName===null&&(this.$nickName=this.$elem.find("input"),this.$nickName.val().length>0&&this.$nickName.attr("readonly","true"),this.$content=this.$elem.find("textarea"),this.$tips=this.$elem.find(".js-tips"),this.$nickName.bind("focus",d.proxy(function(){this.onShowTips()},this))),this.$elem.data("needIdCheck",!1)},bindEvent:function(){this._super();var b=a("sendBox/widget/MessageSuggester").getInstance();b.bindEvent(this.$elem.find("input[type=text]"))},doSubmit:function(){if(!d.isPlainObject(this.request)||this.request.readyState===4){var a=this.getParams(),b=this.$elem.find(".submit-trigger"),c=b.html();b.html("发送中..."),b.data("originHtml",c),this.request=g.setKeyFrom(this.$elem).postJSON("sendMessage",a,d.proxy(function(a){b.html(c),this.$elem.trigger("messageSent",[a,this]),this.onSuccess()},this)).error(d.proxy(this.onSendError,this)),i.analytics.send("/page.do?method=sendMessage&keyfrom="+h.keyFrom(this.$elem))}},getParams:function(){var a=this.$nickName.val(),b=this.$content.val();return{nickName:a,content:b}},onSuccess:function(){this.textarea.clear(),this.onShowTips(),this.tip.show({type:"success",text:"发送成功！"})},onSendError:function(a){var b=this.$elem.find(".submit-trigger").removeClass("sbtn-icon-ing");b.html(b.data("originHtml"));var c=null;try{c=d.parseJSON(a.responseText)}catch(e){}if(!(!c||!c.errorType||!this.errorMessage[c.errorType])){if(c.errorType==="user_not_exist"){this.onShowTips(this.errorMessage[c.errorType]);return}d(document.body).children(":first").trigger("error",["sendMessageError",{type:"error",text:this.errorMessage[c.errorType]}])}},errorMessage:{user_not_exist:"该用户不存在",forbidden:"私信发送失败，默认情况下只有 ta 关注的人才能给 ta 发私信",block:"私信发送失败，您已被 ta 加入黑名单",out_of_space_sendbox:"私信发送失败，发件箱已满，请删掉一些邮件",out_of_space_inbox:"私信发送失败，对方收件箱已满"},onError:function(a,b){this.onShowTips(b.message)},onShowTips:function(a){a=a||"",a===""?this.$tips.hide():this.$tips.show().find(".js-text").addClass("text-tips-error").html('<em class="icon-forbidS"></em>'+a)}});return j});define("sendBox/widget/MessageSuggester",function(a,b,c){var d=a("external/jquery"),e=a("utils/log/Logger"),f=a("utils/Utils"),g=a("basic/oop/Class").extend({_timer:null,dataCache:{},listStatus:"hide",init:function(){var b=a("sendBox/widget/atSuggest/AtSuggestList");this.list=new b(d("<ul></ul>",{id:"MessageSuggester","class":"autoSuggest-list",overflowX:"scroll"}).css({textAlign:"left"}),{showNum:10}),this.list.$elem.bind("select",d.proxy(this.onSelect,this))},bindEvent:function(a){d(a).bind("keyup",d.proxy(this.onInput,this)).bind("click",d.proxy(this.onInput,this)).bind("blur",d.proxy(this.onBlurOut,this))},unbindEvent:function(a){d(a).unbind("keyup",d.proxy(this.onInput,this)).unbind("click",d.proxy(this.onInput,this)).unbind("blur",d.proxy(this.onBlurOut,this))},onSelect:function(a,b){d(this.target).val(b)},showList:function(a,b,c){this.list.show(a,{offset:b,maxHeight:210}),this.listStatus="show"},hideList:function(){this.list.hide(),this.listStatus="hide"},onInput:function(a){var b=this;b._timer&&clearTimeout(b._timer),b._timer=setTimeout(function(){b.onInputTrigger.call(b,a)},100)},onInputTrigger:function(b){if(b.which===16)return!0;if(this.listStatus==="show"&&d.inArray(b.which,[38,40,13,9])!==-1)return!0;var c=d(b.target),g=c.val();if(this.dataCache[g]!==undefined)this.onDataBack(this.dataCache[g],b);else{a("utils/DataSource").setKeyFrom(b.target).post("messageSuggest",{atKey:g},d.proxy(function(a){this.dataCache[g]=a,this.onDataBack(a,b)},this));var h=e.keyFrom(b.target);f.analytics.send("/page.do?method=atSuggest&suggestType=1&keyfrom="+h)}},onDataBack:function(a,b){if(a==="null"||d.trim(a).length===0)this.hideList();else{var c=d(b.target).offset();c.top+=d(b.target).height(),this.target=b.target,this.showList(a,c)}},onBlurOut:function(a){this.hideList()}}),h=null;return{getInstance:function(){h===null&&(h=new g);return h}}});define("_tmpl/floatBox/messageBox",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div class="poplayer-item" style="padding-bottom: 10px;"><label class="poplayer-item-left" for="poplayer_mailName">收件人：</label><div class="poplayer-item-right"><input id="poplayer_mailName" class="poplayer-input" type="text" value="',nickName,'" /><p class="poplayer-tips js-tips"><span class="text-tips text-tips-error js-text"></span></p></div></div><div class="poplayer-item"><label class="poplayer-item-left" for="poplayer_mainContent">内容：</label><div class="poplayer-item-right"><textarea id="poplayer_mainContent" class="poplayer-textarea"></textarea></div></div><div class="tweet-publishBox-ft"><div class="clearfix"><div class="tweet-publishBox-operate"><div class="tweet-publishBox-btn"><a class="submit-trigger disabled" href="javascript:;">发送</a></div><span class="tweet-publishBox-tip js-wordCounter">还可以输入<span class="char-constantia">163</span>字</span><div class="tweet-publishBox-insert"><div class="insert-list"><a class="insert-face face-trigger" title="表情" href="javascript:;"><em class="icon-face"></em></a></div></div></div></div></div>');return p.join("")}});define("widget/floatBox/BlockBox",function(a,b,c){var d=a("external/jquery"),e=a("model/UserData"),f=a("user/UserAction"),g=a("widget/floatBox/Box"),h=a("utils/tmpl"),i=g.extend({init:function(a,b){this._super(a,b),typeof a=="string"?this.data=e.get(a):this.data=(new e(a)).get()},postRender:function(){this.$elem.addClass("poplayer-blockbox")},preRender:function(){return{content:h.formatTemplate(a("_tmpl/blockBox"),this.data),title:'将<b class="poplayer-keyword">'+this.data.nickName+"</b>拉入黑名单"}},hide:function(a){this._super(a)},bindEvent:function(){this._super(),this.$elem.delegate(".block-trigger","click",d.proxy(f.doBlock,this)),this.$elem.bind("blocked",d.proxy(this.onFollow,this))},onFollow:function(){this.hide()}});return i});define("_tmpl/blockBox",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<span class="poplayer-mess"><em class="icon-inquireB"></em><span>确定将<b class="poplayer-keyword">',nickName,'</b>拉入黑名单？</span></span><p class="poplayer-desc">你们的关系将被清空，TA以后不能关注你、评论你，不能给你发私信</p><div class="poplayer-btnbox"><a class="poplayer-btn-sure block-trigger" href="javascript:;">确定</a><a class="poplayer-btn-cancel close-trigger" href="javascript:;">取消</a></div>');return p.join("")}});define("widget/floatBox/RemarkBox",function(a,b,c){var d=a("external/jquery"),e=a("widget/floatBox/Box"),f=a("utils/tmpl"),g=a("utils/Utils"),h=a("model/UserData"),i=a("group/GroupAction"),j=a("widget/tip/NaviTip"),k=e.extend({preRender:function(){return{content:f.formatTemplate(a("_tmpl/remarkBox"),this.data),title:"设置备注名"}},postRender:function(){this.$elem.addClass("poplayer-remarkbox")},bindEvent:function(){this._super(),this.bindInput(),this.$tipElem=this.$elem.find(".js-tips"),this.$elem.find(".submit-trigger").bind("click",d.proxy(this.onSent,this)),this.$elem.bind("addRemark",d.proxy(this.onDataBack,this))},bindInput:function(){this.$inputElem=this.$elem.find("input:first"),this.$inputElem.bind("keydown",d.proxy(function(a){a.keyCode==13&&this.onSent()},this))},onCheckInput:function(){var a=d.trim(this.$inputElem.val());if(g.strLen(a)>16){this.onErrorInput("请不要超过8个汉字或16个英文字母");return!1}return!0},onErrorInput:function(a){this.onTextTips(this.$tipElem,"error",a)},onSent:function(){!this.onCheckInput()||d.isPlainObject(this.request)&&this.request.readyState!==4||(this.request=i.addRemark.call(this,d.trim(this.$inputElem.val())))},onCheckDataBack:function(a){var b=a.status;if(b==1)return!0;b==0?this.onErrorInput("系统出错"):b==2&&this.onErrorInput("输入已超过16个字符");return!1},onDataBack:function(a,b){!this.onCheckDataBack(b)||this.hide()},show:function(){this._super(),this.$tipElem.hide(),this.data.remark!==""?this.$inputElem.val(this.data.remark).setCaretTo(0,this.data.remark.length):this.$inputElem.val("").focus()},onLayerClick:function(){this.hide()}});return k});define("_tmpl/remarkBox",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div class="poplayer-item"><input class="poplayer-input" type="text" /><a class="poplayer-btn-sure submit-trigger" href="javascript:;">保存</a></div><p class="poplayer-tips js-tips"><span class="text-tips text-tips-error js-text"><em class="icon-forbidS"></em>错误信息</span></p>');return p.join("")}});define("user/widget/FloatSetGroup",function(a,b,c){var d=a("external/jquery"),e=a("user/widget/BasicGroup"),f=e.extend({isShow:!1,mouseInTimer:null,mouseOutTimer:null,delay:500,init:function(a,b){this._super(a,b),this.config.wrapperElem=b.wrapperElem},renderTmpl:function(a){return d('<div class="group-popbox">\n                      <ul class="group-selectlist js-selectlist">\n                      </ul>\n                      <ul class="group-operatelist js-operatelist">\n                         <li><a class="create-group-trigger" hidefocus="true" href="javascript:;"><em class="icon-add"></em><span>创建分组</span></a></li>\n                      </ul>\n                      <div class="group-popbox-btnbox js-btnbox">\n                         <div class="clearfix">\n                            <input class="group-popbox-input js-input" data-blank="新组名称" type="text" /><a class="btn-small btn-small-gray save-trigger" hidefocus="true" href="javascript:;">保存</a>\n                         </div>\n                         <p class="group-popbox-tips js-tip">\n                            <span class="text-tips js-text"></span>\n                         </p>\n                      </div>\n                  </div>')},show:function(a){this._super(),d(document.body).append(this.$elem),this.$target=d(a.currentTarget),this.showInfo(),this.isShow=!0,d(document.body).bind("click",d.proxy(this.autoClose,this)).trigger("closeGroupRemark")},setPosition:function(){var a=this.$target,b=a.offset();this.$elem.css({left:b.left,top:b.top-2,display:"block"})},bindEvent:function(){this._super(),this.bindTrigger()},bindTrigger:function(){this._super();var a=this;this.$elem.hover(function(){clearTimeout(a.mouseOutTimer)},function(){a.hide(),d(document).trigger("floatIntroOut")})},onCreate:function(){this._super(),this.config.wrapperElem.isEdit=!0},onReset:function(){this._super(),this.config.wrapperElem.isEdit=!1},hide:function(){var a=this;this.config.wrapperElem.isEdit||(this.mouseOutTimer=setTimeout(function(){a.hide2()},a.delay))},hide2:function(){this.isShow=!1,this.config.wrapperElem.isEdit=!1,this.$elem.remove(),d(document.body).unbind("click",d.proxy(this.autoClose,this))},autoClose:function(a){var b=d(a.target).parents().andSelf();d.inArray(this.$elem[0],b)===-1&&(this.hide2(),d(document).trigger("floatIntroOutClick"))}});return f});define("task/widget/menu",function(a,b,c){var d=a("task/Task"),e=(new d("menu",function(){var b=a("widget/Menu");(new b).render()})).add()});define("widget/Menu",function(a,b,c){var d=a("external/jquery"),e=a("basic/oop/Class"),f=a("utils/tmpl"),g=a("model/UserData"),h=a("utils/DataSource"),i=a("utils/Utils"),j=a("utils/Polling").getInstance();window.getNewMail=function(a,b,c){var e=parseInt(a);if(e>0){var f=a;e>99&&(f="99+"),d("#navPassport").addClass("navi-passport-count"),d("#navMailCount").text(f)}};var k=e.extend({init:function(){this.$elem=d(".js-head-nav"),this.loginUser=g.getLoginUser(),this.$loading=d(i.LOADING_SMALL.replace("$text$",""))},render:function(){this.bindEvent()},bindEvent:function(){this.updateNews(),this.loginUser&&this.updateMail(),this.$elem.delegate(".js-hover","hover",d.proxy(this.onHover,this))},onHover:function(a){var b=d(a.currentTarget);a.type==="mouseenter"?(b.addClass("hover"),b.attr("data-type")=="naviApp"&&this.onApp(b),b.attr("data-type")=="qun"&&this.onQun(b)):b.removeClass("hover")},onApp:function(b){if(!d.isPlainObject(this.navAppRequest)||this.navAppRequest.readyState===4){var c=b.find(".js-left"),e=b.find(".js-right"),g=this;this.$loading.appendTo(c),this.navAppRequest=h.getJSON("naviApp",function(h){if(c.find("li").length==0){var j=g.loginUser?"mine":"rec",k=h.count;if(k>0){var l=k<7?k:6;for(var m=0;m<l;m++){var n=h.apps[m].name,o=i.countChars(n,14),p={isApp:!0,keyfrom:j,key:h.apps[m].key,hasTitle:i.strLen(n)>14?n:!1,image:h.apps[m].icon,name:o};d(f.formatTemplate(a("_tmpl/naviSublist"),p)).appendTo(c)}}if(k>6){e.parent().parent().addClass("navi-alllist");for(var m=6;m<k;m++){var n=h.apps[m].name,o=i.countChars(n,14),p={isApp:!0,keyfrom:j,key:h.apps[m].key,hasTitle:i.strLen(n)>14?n:!1,image:h.apps[m].icon,name:o};d(f.formatTemplate(a("_tmpl/naviSublist"),p)).appendTo(e)}}b.removeAttr("data-type")}g.$loading.remove()})}},onQun:function(b){if(!d.isPlainObject(this.navQunRequest)||this.navQunRequest.readyState===4){var c=b.find(".js-list"),e=this;this.$loading.appendTo(c),this.navQunRequest=h.postJSON("qMine",function(g){var h=g.myquns.length,j=g.myCreateQuns.length;if((h>0||j>0)&&c.find("li").length==0){for(var k=0;k<j;k++){var l=g.myCreateQuns[k].qun.qunName,m=i.countChars(l,11),n={isNav:!0,isCreate:!0,hasTitle:i.strLen(l)>11?l:!1,qunName:m,qunNO:g.myCreateQuns[k].qun.qunNO,newTLCount:g.myCreateQuns[k].newTLCount};d(f.formatTemplate(a("_tmpl/myQun"),n)).appendTo(c)}for(var o=0;o<h;o++){var l=g.myquns[o].qun.qunName,m=i.countChars(l,13),n={isNav:!0,isCreate:!1,hasTitle:i.strLen(l)>13?l:!1,qunName:m,jsonName:g.myquns[o].qun.qunName,qunNO:g.myquns[o].qun.qunNO,newTLCount:g.myquns[o].newTLCount};d(f.formatTemplate(a("_tmpl/myQun"),n)).appendTo(c)}b.removeAttr("data-type")}e.$loading.remove()})}},updateCount:function(a,b){b>0&&b<100?a.html(b):b>99?a.html("99+"):a.html("")},updateNews:function(){var a=this.$elem.find("li[data-type=news]"),b=a.find(".js-at-count"),c=a.find(".js-reply-count"),d=a.find(".js-session-count"),e=a.find(".js-follow-count"),f=a.find(".js-total");if(this.loginUser){j.register("userInfo");var g=this;j.register("newCount",function(a){var h=a.replyAtCount?a.atCount+a.replyAtCount:a.atCount,i=h+a.replyCount+a.messageCount+a.newFollowerCount;g.updateCount(b,h),g.updateCount(c,a.replyCount),g.updateCount(d,a.messageCount),g.updateCount(e,a.newFollowerCount),i>0&&i<100&&f.html(i).parent().addClass("notice-info-show"),i==0&&f.html(i).parent().removeClass("notice-info-show"),i>99&&f.html("99+").parent().addClass("notice-info-show")})}},updateMail:function(){if(!!d("#navPassport").size()){var a=d("#navPassport").find("ul[data-mail]").attr("data-mail"),b=a.split("@")[1],c="funcid=getusrnewmsgcnt&template=newmsgres_setcookie.htm&callback=getNewMail&fid=1&username="+a,e={"163.com":"http://msg.mail.163.com/cgi/mc?"+c,"126.com":"http://msg.mail.126.com/cgi/mc?"+c,"vip.126.com":"http://msg.vip.126.com/cgi/mc?"+c,"yeah.net":"http://msg.mail.yeah.net/cgi/mc?"+c,"188.com":"http://msg.mail.188.com/cgi/mc?"+c,"vip.163.com":"http://msg.vip.163.com/cgi/mc?"+c,others:"others"};e[b]&&(h.requestMap.getNewMail={url:e[b],login:!0},h.getScript("getNewMail"))}}});return k});define("utils/Polling",function(a,b,c){var d=a("external/jquery"),e=a("utils/DataSource"),f=a("basic/oop/Class"),g=a("model/UserData"),h=f.extend({params:{},callbacks:{},registers:[],INTERVAL:3e4,init:function(a){this.interval=a&&a.interval||this.INTERVAL,this.timer=null},register:function(a,b,c){d.isFunction(b)&&(c=b,b={}),d.inArray(a,this.registers)===-1&&(this.callbacks[a]=[],this.registers.push(a)),d.extend(this.params,b),this.callbacks[a].push(c),this.timer===null&&this.startInterval()},remove:function(a){if(d.inArray(a,this.registers)!==-1){var b=d.inArray(a,this.registers);b!==-1&&this.registers.splice(b,1)}},startInterval:function(){g.getLoginUser()!=null&&(this.stopInterval(),this.registers.length!==0&&(this.timer=setInterval(d.proxy(this.doPolling,this),this.interval)))},stopInterval:function(){this.timer&&clearInterval(this.timer)},resetInterval:function(){this.stopInterval(),this.startInterval()},doPolling:function(){e.postJSON("queryCount",d.extend({keys:this.registers},this.params),d.proxy(this.onDataBack,this))},onDataBack:function(a){var b=this.callbacks;d.each(a,function(a,c){var d=b[a]||[];for(var e=0,f=d.length;e<f;e++)d[e]&&d[e].call(null,c)})},reset:function(){},updateParams:function(a){d.extend(this.params,a)}}),i=null;return{getInstance:function(a){i===null&&(i=new h(a));return i}}});define("_tmpl/naviSublist",function(require){return function(tmplData){var p=[];with(tmplData)p.push(""),isApp&&(p.push('<li><a data-keyfrom="',keyfrom,'" href="/app/detail/',key,'"'),hasTitle&&p.push('title="',hasTitle,'"'),p.push('><span><img src="',image,'"/>',name,"</span></a></li>")),p.push("");return p.join("")}});define("_tmpl/myQun",function(require){return function(tmplData){var p=[];with(tmplData)p.push(""),isNav&&isCreate&&(p.push('<li><a data-keyfrom="mine" class="link-qOwer" href="/qun/',qunNO,'"'),hasTitle&&p.push('title="',hasTitle,'"'),p.push(">"),newTLCount>0&&(p.push('<em class="nav-num">'),newTLCount>99?p.push("99+"):p.push("",newTLCount,""),p.push("</em>")),p.push('<b class="icon-qOwer"></b>',qunName,"</a></li>")),p.push(""),isNav&&!isCreate&&(p.push('<li><a data-keyfrom="mine" class="pos-rel" href="/qun/',qunNO,'"'),hasTitle&&newTLCount>0&&p.push('title="',hasTitle,'"'),p.push(">"),newTLCount>0?(p.push('<em class="nav-num">'),newTLCount>99?p.push("99+"):p.push("",newTLCount,""),p.push("</em>",qunName,"")):p.push("",jsonName,""),p.push("</a></li>")),p.push(""),!isNav&&isCreate&&(p.push('<li class="clearfix"><span class="name"><b class="icon-qOwer" title="我是群主"></b><a hidefocus="true" class="link-ra" href="/qun/',qunNO,'"'),hasTitle&&p.push('title="',hasTitle,'"'),p.push(">",qunName,"</a></span>"),newTLCount>0&&(p.push('<span class="q-ower-status-num text-ra">'),newTLCount>99?p.push("99+"):p.push("",newTLCount,""),p.push("</span>")),p.push("</li>")),p.push(""),!isNav&&!isCreate&&(p.push('<li class="clearfix"><a hidefocus="true" class="link-ra name" href="/qun/',qunNO,'">',qunName,"</a>"),newTLCount>0&&(p.push('<span class="q-ower-status-num text-ra">'),newTLCount>99?p.push("99+"):p.push("",newTLCount,""),p.push("</span>")),p.push("</li>")),p.push("");return p.join("")}});define("task/user/setGroupRemark",function(a,b,c){var d=a("external/jquery"),e=a("task/Task"),f=a("task/TaskManager");f.add(new e("SetGroupRemark",function(){var b=null,c='<div class="group-popbox group-remark-popbox" id="setGroupRemark">\n                   <div>\n                      <div class="group-popbox-item clearfix">\n                         <label>备注：</label>\n                         <div class="group-popbox-item-right">\n                            <input class="group-popbox-input js-remark" type="text" data-blank="选填" value="选填" />\n                            <span class="group-popbox-remark js-remark-text" style="display:none;" title="点击修改"></span>\n                            <p class="group-popbox-tips js-tip-remark">\n                               <span class="text-tips js-text"></span>\n                            </p>\n                         </div>\n                      </div>\n                      <div class="group-popbox-item clearfix">\n                         <label>分组：</label>\n                         <div class="group-popbox-item-right" style="margin-top:-3px;">\n                            <ul class="group-selectlist noBg js-selectlist">\n                            </ul>\n                            <ul class="group-operatelist js-operatelist">\n                               <li><a class="create-group-trigger" hidefocus="true" href="javascript:;"><em class="icon-add"></em><span>创建分组</span></a></li>\n                            </ul>\n                            <div class="group-popbox-btnbox js-btnbox">\n                               <div class="clearfix">\n                                  <input class="group-popbox-input js-group" data-blank="新组名称" type="text" /><a class="btn-small btn-small-gray save-trigger" hidefocus="true" href="javascript:;">保存</a>\n                               </div>\n                            </div>\n                            <p class="group-popbox-tips js-tip-group">\n                               <span class="text-tips js-text"></span>\n                            </p>\n                         </div>\n                      </div>\n                   </div>\n                </div>',e=null;d(document.body).bind("followed",function(f,g,h,i,j){var k=d(h.currentTarget);if(b===null){b=d(c).appendTo("body");var l=a("user/widget/SetGroupRemark");e=l.getInstance(b)}e.show(k,i,j)}).bind("closeGroupRemark",function(){e&&e.hide()})}))});define("widget/mail/recommend/RecommendTask.js",function(a,b,c){var d=a("external/jquery"),e=a("task/Task"),f=a("basic/MCR"),g=a("widget/mail/recommend/RecommendRenderer"),h=a("widget/mail/recommend/RecommendModel"),i=a("widget/mail/recommend/RecommendController"),j=a("model/UserData"),k=a("utils/Utils"),l=a("utils/log/Logger"),m=d(document.body);(new e("RecommendTask",function(){!k.mail.isMail||d(window).width()>1024&&d(".js-mail-recommend-box").size()>0&&(d(".js-mail-recommend-box").removeClass("hidden"),new f(i,h,g),l.triggerLog(m,{method:"mailDailyRec"}))})).add()});define("basic/MCR",function(a,b,c){function d(a,b,c){this.controller=new a,this.model=new b,this.renderer=new c,this.controller.model=this.model,this.controller.renderer=this.renderer,this.model.controller=this.controller,this.renderer.controller=this.controller,typeof this.model.init=="function"&&this.model.init(),typeof this.renderer.init=="function"&&this.renderer.init(),typeof this.controller.init=="function"&&this.controller.init();return{render:this.renderer,controller:this.controller,model:this.model}}return d});define("widget/mail/recommend/RecommendRenderer",function(a,b,c){function k(){this.$mailRecTrigger=d(".js-mail-recommend-hint")}var d=a("external/jquery"),e=a("utils/tmpl"),f=a("utils/Utils"),g=a("widget/tip/NaviTip"),h=a("widget/mail/recommend/RecommendTmpl"),i=a("model/UserData"),j=a("utils/log/Logger");k.prototype.init=function(){this.controller.getRecommendInfo()},k.prototype.renderRecommendInfo=function(a){var b=this,c=a;this.$content=d(e.parseTemplate(h.main,c)).css("marginLeft",-245).appendTo(".mail-recommend-box"),this.bind()},k.prototype.bind=function(){var a=this,b={};a.$content.hover(function(a){},function(c){b={css:{opacity:0,marginLeft:-245},time:500},a.doAnimate(a.$content,b,function(b){a.$mailRecTrigger.fadeIn()})}),a.$mailRecTrigger.hover(function(c){a.$content.is(":animated")||(b={css:{opacity:1,marginLeft:0},time:500},a.$mailRecTrigger.fadeOut(function(c){a.doAnimate(a.$content,b)}))},function(a){}),d.each([".js-mrz-link-la",".js-mrz-link-img",".js-mrc-link-la",".js-mrc-link-lb"],function(a,b){d(b).click(function(a){j.triggerLog(this,{method:"mailDailyRec"})})})},k.prototype.doAnimate=function(a,b,c){a.animate(b.css,b.time,c)};return k});define("widget/mail/recommend/RecommendTmpl",function(a,b,c){var d={main:'<dl class="mail-recommend-content">\n\n               <% /* 精彩专题 S */ %>\n               <dt>\n                  <a class="mail-recommend-caption" href="http://t.163.com/zt" target="_blank">精彩专题</a><a class="link-la js-mrz-link-la" href="<%=zts.specialSite%>" target="_blank" data-keyfrom="ZT"><%=zts.title%></a>\n               </dt>\n               <dd class="mail-recommend-zt">\n                  <a href="<%=zts.specialSite%>" target="_blank" data-keyfrom="ZT" class="js-mrz-link-img"><img src="<%=zts.picUrl%>"/></a>\n               </dd>\n            <% /* 精彩专题 E */ %>\n\n            <% /* 微专栏 S */ %> \n               <dt>\n                  <a class="mail-recommend-caption" href="http://t.163.com/column" target="_blank">微专栏</a><a class="link-la js-mrc-link-la" href="<%=column.columnSrc%>" data-keyfrom="column">#<%=column.columnName%>#</a>\n               </dt>\n               <dd class="mail-recommend-column">\n                  <a class="link-la js-float-intro" href="<%=column.userSrc%>" data-user-nickname="<%=column.userNickName%>" data-keyfrom="nickName">\n                     <%=column.userNickName%>：</a><%=column.columnContent%>\n                     <a class="link-lb js-mrc-link-lb" href="<%=column.contentSrc%>" data-keyfrom="detail">[原文]</a>\n               </dd>\n               <% /* 微专栏 E */%>\n               </dl>\n               '};return d});define("widget/mail/recommend/RecommendModel",function(a,b,c){function g(){}var d=a("utils/DataSource"),e=a("utils/Cookie"),f=a("utils/Utils");g.prototype.getRecommendInfo=function(a){var b=this;d.postJSON("mailRightRec",function(c){b.data=c,c.column.columnContent=f.countChars(c.column.columnContent,88,!1),a(c)})};return g});define("widget/mail/recommend/RecommendController",function(a,b,c){function d(){}d.prototype.getRecommendInfo=function(){var a=this;this.model.getRecommendInfo(function(b){a.renderer.renderRecommendInfo(b)})};return d});define("task/singleUser",function(a,b,c){var d=a("task/Task"),e=a("external/jquery"),f=a("model/UserData"),g=a("user/SingleUser"),h=a("utils/DataSource"),i=a("utils/log/Logger");(new d("singleUser",function(){var b=new g("#mainUserContainer"),c=e("#mainUserContainer"),d=e("#userTweetRecommend"),h=c.find(".userBox-avatar").first().data("static-uploadflag");h&&i.triggerLog(c,{method:"avatarUpload"}),c.delegate(".js-user-operate","hover",function(a){if(f.getLoginUser()!==null){var b=e(a.currentTarget),c=b.find("ul");c.hover(function(a){clearTimeout(mouseOutTimer)},function(){mouseOutTimer=setTimeout(function(){c.hide()},delay)}),a.type==="mouseenter"?(clearTimeout(mouseOutTimer),mouseInTimer=setTimeout(function(){b.siblings(".js-user-operate").find("ul").hide(),c.show()},100)):(clearTimeout(mouseInTimer),mouseOutTimer=setTimeout(function(){c.hide()},delay))}}),c.delegate(".recommend-trigger","click",function(c){if(!!d.size()&&!!d.hasClass("hidden")){var f=e("#mainUserContainer .userColumn-tips");f[0]&&f.hide();var g=b.data,h=!1;g.sysTag&&g.sysTag.length>0&&(h=!0);var i=a("user/list/FollowRecList");(new i(null,{paramId:g.id,isDaren:h})).render()}})})).add()});define("user/SingleUser",function(a,b,c){var d=a("external/jquery"),e=a("user/User"),f=a("utils/DataSource"),g=a("model/UserData"),h=a("utils/Utils"),i=e.extend({init:function(a){var b=this;f.postJSON("singleUser",function(c){b._super(c),b.$elem=d(a),b.bindEvent()})},bindEvent:function(){this.$elem.delegate(".remark-trigger","click",d.proxy(this.onRemark,this)),this.$elem.delegate(".report-trigger","click",d.proxy(this.onReport,this));var b=a("task/widget/FloatMenu"),c=this.$elem.find(".more-trigger"),e=new b({box:c,button:c.find(".js-more"),menu:c.find(".js-list")}),f=a("user/widget/UserRelation"),h=new f(this.data,{elem:this.$elem});g.bindUpdate(this.data.id,d.proxy(this.onUpdate,this))},onUpdate:function(a){this.data=a,a.remark!==""?this.$elem.find(".user-remark").text("["+a.remark+"]"):this.$elem.find(".user-remark").text("[设置备注]")},onReport:function(){var b=a("utils/ReportSpamManager"),c=this.data.id,d=new b(this.user.get(),{type:"user",userId:c,imageUrl:this.$elem.find("img").attr("src"),contentHeight:136});d.doReport()},onRemark:function(){var b=a("widget/floatBox/RemarkBox"),c=new b(this.data);c.show()}});return i});define("user/User",function(a,b,c){var d=a("external/jquery"),e=a("basic/oop/Class"),f=a("model/UserData"),g=e.extend({init:function(a,b){typeof a=="string"?this.data=f.get(a):(this.user=new f(a),this.data=this.user.get()),this.config=b||{},this.$elem=null}});return g});define("task/widget/FloatMenu",function(a,b,c){var d=a("external/jquery"),e=a("basic/oop/Class"),f=e.extend({init:function(a,b){this.$button=d(a.button),this.$menu=d(a.menu),this.$box=d(a.box),this.config=b||{},this.isOpen=!1,this.bindEvent()},bindEvent:function(){this.$button.bind("click",d.proxy(this.clickButton,this))},clickButton:function(){this.isOpen?this.closeMenu():this.openMenu()},openMenu:function(){this.isOpen=!0,this.$box.addClass("on"),this.$menu.show();var a=this;setTimeout(function(){d(document).one("click",function(){a.closeMenu()})},25)},closeMenu:function(){this.isOpen=!1,this.$box.removeClass("on"),this.$menu.hide()}});return f});define("user/widget/UserRelation",function(a,b,c){var d=a("external/jquery"),e=a("utils/Utils"),f=a("basic/oop/Class"),g=a("user/UserAction"),h=a("model/GroupData"),i=f.extend({init:function(a,b){this.data=a,this.config=b||{},this.$elem=b.elem,this.bindEvent()},render:function(){this.renderClass(),this.bindEvent()},bindEvent:function(){var b=a("widget/floatBox/AtBox"),c=a("widget/floatBox/FloatMessageBox"),e=a("widget/floatBox/BlockBox"),f=a("model/UserData"),g=new b(this.data),h=new c(this.data),i=new e(this.data);this.$elem.delegate(".at-trigger","click",d.proxy(g.show,g)),this.$elem.delegate(".mail-trigger","click",d.proxy(h.show,h)),this.$elem.delegate(".follow-trigger","click",d.proxy(this.onFollow,this)),this.$elem.delegate(".unfollow-trigger","click",d.proxy(this.onUnFollow,this)),this.$elem.delegate(".block-trigger","click",d.proxy(i.show,i)),this.$elem.delegate(".unblock-trigger","click",d.proxy(this.onUnBlock,this)),f.bindUpdate(this.data.id,d.proxy(this.onUpdate,this)),this.renderClass()},onUpdate:function(a){this.data=a,this.renderClass(),this.renderGroup()},renderClass:function(){var a=["user-unfollowed","user-followed","user-mutualfollowed","user-blocked","user-followedMe"],b=0;this.$elem.removeClass(a.join(" ")),this.data.isBlocking===!0?b=3:this.data.isFollowing&&this.data.isFollowed?b=2:this.data.isFollowing?b=1:this.data.isFollowed?b=4:b=0,this.$elem.addClass(a[b])},onFollow:function(a){if(!this.request||this.request.readyState===4)this.request=g.doFollow.call(this,a)},onUnFollow:function(){if(!this.request||this.request.readyState===4)this.request=g.doUnFollow.call(this)},onUnBlock:function(){if(!this.request||this.request.readyState===4)this.request=g.doUnBlock.call(this)},renderGroup:function(){var a=h.getGroupList(),b=a.length,c=[],d="",f=this.data.groupInfos,g=[],i="未分组";if(f.length>0){for(var j=0,b=f.length;j<b;j++)g.push(h.getNameById(f[j]));g=g.join(","),i=e.countChars(g,8)}else g="未分组";this.$elem.find(".js-group-title").html(i+'<em class="icon-expand"></em>').attr("title",g)}});return i});define("utils/ReportSpamManager",function(a,b,c){var d=a("external/jquery"),e=a("basic/oop/Class"),f=a("widget/tip/NaviTip"),g=e.extend({init:function(a,b){this.data=a,this.config=b},doReport:function(){var b={};this.config.type==="user"?(b.reportType="user",d.extend(b,this.data,this.config)):(b.reportType="butter",b.reportData=this.data,b.nickName=this.config.nickName),b.contentHeight=this.config.contentHeight;var c=a("widget/floatBox/ReportSpamBox"),e=new c(b),g=this;e.show(function(b){g.config.type=b.type;var c=a("utils/DataSource");c.postJSON("reportSpam",g.config,function(a){a.status==="ok"?f.show({type:"success",text:"你的举报已提交，我们将尽快处理，感谢你对我们工作的支持！"}):f.show({type:"error",text:"后台繁忙，请稍后再次提交，感谢您的举报！"})});if(b.block==="1"){var d={userId:g.config.userId},e=a("model/UserData");c.postJSON("block",d,function(a){e.update(a)})}})}});return g});define("widget/floatBox/ReportSpamBox",function(a,b,c){var d=a("external/jquery"),e=a("widget/floatBox/Box"),f=a("utils/tmpl"),g=a("utils/DataSource"),h=e.extend({init:function(a,b){this._super(a,b)},preRender:function(){return{title:"举报不良信息",content:f.formatTemplate(a("_tmpl/reportSpam"),this.data)}},postRender:function(){this.$elem.addClass("poplayer-reportbox"),this.$elem.find(".js-data").css("height",this.data.contentHeight+"px")},bindEvent:function(){this._super(),this.$elem.delegate(".submit-trigger","click",d.proxy(this.confirm,this)),this.$elem.delegate(".cancel-trigger","click",d.proxy(this.cancel,this))},show:function(a){this._super(),this.succCallBack=a},confirm:function(){var a={};a.type=this.$elem.find("input:checked[name=stype]").val();a.type===undefined?this.$elem.find("#warn-message").removeClass("hidden"):(a.block=this.$elem.find("input:checked[name=block_spam]").val(),this.succCallBack(a),this.hide())},cancel:function(){this.hide()}});return h});define("_tmpl/reportSpam",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<h3>举报的是<em class="poplayer-keyword">@<a class="poplayer-linka ununderline" style="cursor:text;" href="javascript:;">',nickName,"</a></em>"),reportType!="user"&&p.push("的微博"),p.push('：</h3><div class="poplayer-reportbox-reportData js-data clearfix">'),reportType==="user"?p.push('<div class="poplayer-reportbox-reportData-user-pic"><img class="avatar-big" alt="/',nickName,'" src="',imageUrl,'" /></div><p class="poplayer-reportbox-reportData-user-name">',nickName,"</p>"):p.push("",reportData,""),p.push('</div><h3>请选择举报内容的类型（必选）：</h3><ul class="poplayer-reportbox-typelist"><li><label class="label-tag"><input type="radio" value="1" name="stype" />诈骗、骚扰、广告信息</label></li><li><label class="label-tag"><input type="radio" value="2" name="stype" />色情、低俗、暴力信息</label></li><li><label class="label-tag"><input type="radio" value="3" name="stype" />违法有害信息</label></li><li><label class="label-tag"><input type="radio" value="4" name="stype" />其他理由</label></li></ul><div class="poplayer-ft"><div class="poplayer-btnbox"><a class="poplayer-btn-sure submit-trigger" href="javascript:;">确定</a><a class="poplayer-btn-cancel cancel-trigger" href="javascript:;">取消</a></div><label class="poplayer-reportbox-block label-tag"><input type="checkbox" value="1" name="block_spam" />将该用户拉入黑名单</label></div>');return p.join("")}});define("user/list/FollowRecList",function(a,b,c){var d=a("external/jquery"),e=a("widget/list/RenderableList"),f=a("utils/DataSource"),g=a("utils/Utils"),h=a("utils/log/Logger"),i=a("user/UserTemplate"),j=e.extend({init:function(a,b){this._super(a,b),this.$wrappElem=d("#userTweetRecommend"),this.paramId=this.config.paramId,this.isDaren=this.config.isDaren,a==null&&(this.$elem=this.$wrappElem.find(".js-list"))},render:function(){var a=this;f.postJSON("recommendFollowee",{similarityUserId:this.paramId,recommendType:"SIMILARITY_RECOMMEND",isDaren:a.isDaren},function(b){var c=b.list.length;c>0&&(a.$wrappElem.removeClass("hidden"),a.$wrappElem.hasClass("hidden")&&a.$wrappElem.removeClass("hidden"),d(".userColumn").hasClass("hidden")||d(".userColumn").addClass("hidden")),c<4&&(a.$wrappElem.find(".js-prev").remove(),a.$wrappElem.find(".js-next").remove());for(var e=0,c=b.list.length;e<c;e++){var f=new i(b.list[e]);a.add(f)}a.slider()})},slider:function(){var b=a("widget/SwitchUserSlider"),c=this.$wrappElem.find(".js-list"),e=c.find("li:first").outerWidth(!0),f=new b(c,{prevElem:this.$wrappElem.find(".js-prev"),nextElem:this.$wrappElem.find(".js-next"),leftDisableClass:"icon-prev-big-disabled",rightDisableClass:"icon-next-big-disabled",distance:e}),g=this;this.$wrappElem.delegate(".close-trigger","click",function(){g.$wrappElem.fadeOut("fast",function(){d(this).remove()}),h.triggerLog(g.$wrappElem,{method:"close"})})},wrap:function(a){return a.wrap('<li class="js-item">').parent()}});return j});define("widget/list/RenderableList",function(a,b,c){var d=a("external/jquery"),e=a("basic/oop/Class"),f=e.extend({init:function(a,b){this.$elem=d(a),this.config=b||{}},add:function(a){var b=a.render(),c=this.wrap(b);this.$elem.append(c);return c},remove:function(a){this.unwrap(a.render()),a.erase()},wrap:function(a){},unwrap:function(a){}});return f});define("user/UserTemplate",function(a,b,c){var d=a("external/jquery"),e=a("utils/tmpl"),f=a("user/User"),g=a("user/UserAction"),h=a("model/UserData"),i=a("utils/Utils"),j=f.extend({init:function(a,b){typeof a!="string"&&(this.tmpData=a,a=a.user),this._super(a,b),this.initVariable()},initVariable:function(){if(!this.config.html){var a=this.config.maxNickLength||10,b=this.config.maxReasonLength||10;this.tmpData&&(this.tmpData.countNickName=i.countChars(this.tmpData.user.nickName,a),typeof this.tmpData.reason=="string"&&(this.tmpData.countReason=i.countChars(this.tmpData.reason,b)),this.tmpData.nickLinkClass=this.config.nickLinkClass||"link-ra js-float-intro",this.tmpData.reasonClass=this.config.reasonClass||"text-ra",this.tmpData.followPosition=this.config.followPosition||"right")}},render:function(){this.$elem===null&&(this.config.html?(this.$elem=d(this.config.html),delete this.config.html):this.$elem=d(e.formatTemplate(a("_tmpl/userTemplate"),d.extend({config:this.config},this.tmpData))),this.bindEvent());return this.$elem},bindEvent:function(){this.renderFollow(),this.$elem.delegate(".follow-trigger","click",d.proxy(this.follow,this)),h.bindUpdate(this.data.id,d.proxy(this.renderFollow,this))},renderFollow:function(){this.data.isFollowing===!1?this.$elem.find(".js-add-focus").show().end().find(".js-remove-focus").hide():this.$elem.find(".js-remove-focus").show().end().find(".js-add-focus").hide()},follow:function(a){if(!this.request||this.request.readyState===4)this.request=g.doFollow.call(this,a,d.proxy(function(){this.$elem.trigger("onFollowed",[this])},this))}});return j});define("_tmpl/userTemplate",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div class="item"><div class="left"><a class="avatar js-float-intro" href="/',user.screenName,'" data-user-nickname="',user.nickName,'" data-keyfrom="avatar" target="_blank"><img src="',user.avatar,'" /></a>'),followPosition=="left"&&p.push('<span class="followBoxS"><a class="add-focusS follow-trigger js-add-focus" style="display: inline-block" href="javascript:;"><em class="add-signS">+</em>关注</a><em class="remove-focusS js-remove-focus">已关注</em></span>'),p.push('</div><h3><a class="icon-close close-trigger" title="不感兴趣" href="javascript:;"></a><a class="',nickLinkClass,'" href="/',user.screenName,'" title="',user.nickName,'" data-user-nickname="',user.nickName,'" target="_blank">',countNickName,"</a>",require("_tmpl/itag")(user),"</h3>"),followPosition=="right"&&p.push('<span class="followBoxS"><a class="add-focusS follow-trigger js-add-focus" style="display: inline-block" href="javascript:;"><em class="add-signS">+</em>关注</a><em class="remove-focusS js-remove-focus">已关注</em></span>'),p.push(""),reason&&reason!=""&&p.push('<p title="',reason,'" class="',reasonClass,'">',countReason,"</p>"),p.push("</div>");return p.join("")}});define("widget/SwitchUserSlider",function(a,b,c){var d=a("external/jquery"),e=a("basic/oop/Class"),f=e.extend({init:function(a,b){this.$elem=d(a),this.$slides=this.$elem.children(".js-item"),this.maxIndex=this.$slides.size(),this.index=1,this.config=d.extend({},b),this.$prevElem=this.config.prevElem,this.$nextElem=this.config.nextElem,this.leftDisableClass=this.config.leftDisableClass,this.rightDisableClass=this.config.rightDisableClass,this.showNum=this.config.showNum||3,this.distance=this.config.distance,this.slideNum=this.config.slideNum||3,this.frequency=this.config.frequency||280,this.bindEvent()},bindEvent:function(){this.$prevElem.bind("click",d.proxy(function(){this.to(-this.slideNum)},this)),this.$nextElem.bind("click",d.proxy(function(){this.to(this.slideNum)},this))},to:function(a){this.$prevElem.removeClass(this.leftDisableClass),this.$nextElem.removeClass(this.rightDisableClass),a=this.index+a,a<2&&this.$prevElem.addClass(this.leftDisableClass),a<1?a=1:a>this.maxIndex-this.showNum&&(this.$nextElem.addClass(this.rightDisableClass),a=this.maxIndex-this.showNum+1),this.index=a,this.$elem.animate({marginLeft:"-"+(this.index-1)*this.distance},this.frequency,"linear")},reset:function(){this.$elem.css("margin-left",0),this.to(-this.index)}});return f});define("task/user/setGroup",function(a,b,c){var d=a("task/Task"),e=a("task/TaskManager");e.add(new d("SetGroup",function(){var b=a("external/jquery"),c=a("model/UserData"),d=a("model/GroupData"),e={},f={},g=500,h=null,i=null,j=null,k=b("#mainUserContainer").size()?!0:!1,l=k?100:g;b(document).delegate(".js-user-group","hover",function(d){if(c.getLoginUser()!==null){var f=b(d.currentTarget),m=f.attr("data-user-id");h==null&&(h=b('<div class="group-popbox"></div>'),h.appendTo("body"),h.hover(function(a){clearTimeout(j)},function(){j=setTimeout(function(){h.hide()},g)}));var n=e[m];if(!n){var o=a("user/widget/SetGroup");n=new o(m,{wrapperElem:h,isUserTweet:k}),e[m]=n}d.type==="mouseenter"?(clearTimeout(j),i=setTimeout(function(){n.show(d)},l)):(clearTimeout(i),j=setTimeout(function(){h.hide()},g))}})}))});define("user/widget/SetGroup",function(a,b,c){var d=a("external/jquery"),e=a("utils/Utils"),f=a("user/widget/BasicGroup"),g=f.extend({hideTimer:null,maxLen:13,init:function(a,b){this._super(a,b),this.isUserTweet=this.config.isUserTweet},renderTmpl:function(){return d('<div>\n                      <ul class="group-selectlist js-selectlist">\n                      </ul>\n                      <ul class="group-operatelist js-operatelist">\n                         <li><a class="create-group-trigger" hidefocus="true" href="javascript:;"><em class="icon-add"></em><span>创建分组</span></a></li>\n                      </ul>\n                      <div class="group-popbox-btnbox js-btnbox">\n                         <div class="clearfix">\n                            <input class="group-popbox-input js-input" data-blank="新组名称" type="text" /><a class="btn-small btn-small-gray save-trigger" hidefocus="true" href="javascript:;">保存</a>\n                         </div>\n                      </div>\n                      <p class="group-popbox-tips js-tip">\n                         <span class="text-tips js-text"></span>\n                      </p>\n                   </div>')},show:function(a){this._super(),this.config.wrapperElem.empty().append(this.$elem),this.$target=d(a.currentTarget),this.showInfo(),this.isUserTweet||d(document.body).bind("click",d.proxy(this.autoClose,this)),d(document.body).trigger("closeGroupRemark")},showInfo:function(){this._super(),this.bindTrigger()},setPosition:function(){var a=this.$target,b=a.offset(),c=this.isUserTweet?b.top+23:b.top-2;this.config.wrapperElem.css({left:b.left,top:c,display:"block"})},hide:function(){this.config.wrapperElem.hide(),d(document.body).unbind("click",d.proxy(this.autoClose,this))},autoClose:function(a){var b=d(a.target).parents().andSelf();d.inArray(this.config.wrapperElem[0],b)===-1&&this.hide()}});return g});define("task/filter",function(a,b,c){var d=a("task/Task");(new d("filter",function(){var b=a("external/jquery"),c=b(".js-filterBox"),d=b("#tweetList");if(c.size()!==0)var e=a("widget/filter/TweetFilter"),f=new e(c,{list:d,filterUsage:"tweetFilter"})})).add()});define("widget/filter/TweetFilter",function(a,b,c){var d=a("external/jquery"),e=a("widget/filter/BaseFilter"),f=a("model/GroupData"),g=e.extend({filterMap:{"/filter/":"all","/filter/org":"org","/filter/image":"image","/filter/video":"video","/filter/music":"music","/filter/comment":"comment","/filter/topic":"topic","/filter/column":"column","/filter/rss/recommend/1":"1","/filter/rss/recommend/2":"2","/filter/rss/recommend/12":"12","/filter/rss/recommend/16":"16"},init:function(a,b){this._super(a,b),this.mainPageReg=new RegExp("/"+this.screenName+"(/main)?"),this.GroupId=f.getGroupInfo()?f.getGroupInfo().currentId:"",this.groupReg=new RegExp("/group/"+this.GroupId)},onStateChange:function(a,b){this.matchArray=b.match(this.filterReg);!this.mainPageReg.test(b)&&!this.groupReg.test(b)&&!this.matchArray||this._super(a,b)}});return g});define("widget/filter/BaseFilter",function(a,b,c){var d=a("external/jquery"),e=a("basic/oop/Class"),f=a("model/UserData"),g=a("utils/History"),h=e.extend({filterMap:{},init:function(a,b){this.filterReg=/[0-9A-Za-z\/]+(\/filter\/[^\/?&#]+)/,this.screenName=f.getLoginUser()?f.getLoginUser().screenName:"",this.$elem=a,this.config=b,this.$list=b.list,this.bindEvent()},bindEvent:function(){this.$elem.delegate("a[class!=no-filter]","click",d.proxy(this.onClick,this)),d(document.body).bind("pushStateChange",d.proxy(this.onStateChange,this))},onClick:function(a){if(!(d.browser.msie&&d.browser.version<8)&&f.getLoginUser()){a.preventDefault();var b=d(a.currentTarget),c=b.data("type"),e=null;this.$elem.find("a.current").removeClass("current"),b.addClass("current"),this.changeUrlState(b,c)}},changeUrlState:function(a,b){var c=a.attr("href");g.getInstance().hasPushState&&this.$list.trigger("changeFilter",[b,this.config.filterUsage]),g.getInstance().pushState(c)},onStateChange:function(a,b){var c="/filter/";this.matchArray=b.match(this.filterReg),c=this.matchArray&&this.matchArray[1]?this.matchArray[1]:c;var d=this.$elem.find("a[data-type="+this.filterMap[c]+"]");this.$elem.find("a").removeClass("current"),d.addClass("current"),this.$list.trigger("changeFilter",[this.filterMap[c],this.config.filterUsage])}});return h});define("utils/History",function(a,b,c){var d=a("external/jquery"),e=a("basic/oop/Class"),f=a("utils/Utils"),g=e.extend({hasPushState:history.pushState?!0:!1,isHashChange:"onhashchange"in window&&typeof document.documentMode!="undefined"&&document.documentMode>=8,currentHash:"",init:function(){var a=this;this.hasPushState?window.onpopstate=function(){setTimeout(function(){var b=a.parseURL(),c=b.path+b.query;a.onPopstate(c)},0)}:this.isHashChange?d(window).bind("hashchange",function(){var b,c=a.parseURL();/^#!/.test(c.hash)?b=c.hash.substr(2).replace(/#.*$/,""):b=c.path+c.query,a.onPopstate(b)}):(this.createIframe(),setInterval(function(){var b,c=a.parseURL();/^#!/.test(c.hash)?b=c.hash.substr(2).replace(/#.*$/,""):b=c.path+c.query;a.isSameHash(b)||(a.currentHash=b,a.onPopstate(b))},200))},createIframe:function(){this.iframe=document.createElement("iframe"),this.iframe.style.display="none",document.body.appendChild(this.iframe),this.iframe=this.iframe.contentWindow,window.setFrameHashCallback=d.proxy(this.setFrameHash,this)},setHash:function(a){a=encodeURIComponent(a),this.iframe.document.open("text/html"),this.iframe.document.write("<html><head></head><body onload=\"parent.setFrameHashCallback('"+a+"');\"></body></html>"),this.iframe.document.close()},setFrameHash:function(a){a=decodeURIComponent(a),window.location.hash=a},parseURL:function(){var a=f.parseURL(document.location.href);return{host:a.host,path:"/"+a.path,query:a.query&&"?"+a.query,hash:a.hash&&"#"+a.hash}},pushState:function(a){this.isSameHash(a)||(this.hasPushState?(history.pushState(null,null,a),this.currentHash=a):this.isHashChange?(window.location.hash="#!"+a,this.currentHash=a):this.setHash("#!"+a))},onPopstate:function(a){d(document.body).trigger("pushStateChange",[a])},isSameHash:function(a){return this.currentHash===a?!0:!1}}),h=null;return{getInstance:function(a){h===null&&(h=new g(a));return h}}});define("task/userTimeline",function(a,b,c){var d=a("task/Task"),e=a("utils/Utils"),f=a("utils/DataSource");(new d("userTimeline",function(){var b=a("utils/jquery-wb"),c=null,d=b("#tweetList"),f=d.data("timeline-type"),g=d.data("filter-type")||"all";switch(f){case"userTimeline":c=a("tweet/list/UserTimelineList");break;case"userColumnTimeline":case"columnTimeline":c=a("tweet/list/ColumnTimelineList")}var h={pagerContainer:".mainBox-ft"};b.extend(h,{filterType:g});var i=new c(d,h),j=i.render(),k=!1;b(".mainBox-ft").bind("pager",function(a,c){c.config.pageMethod==="page"&&!k&&(e.mail.isMail&&e.mail.getVersion!=="js5"?e.scrollTo(e.getXY(b(".mainBox")[0]).top-5):window.scrollTo(0,e.getXY(b(".mainBox")[0]).top-35)),k=!1}),f==="userTimeline"&&d.bind("changeFilter",function(b,c){k=!0,i.onFilter(c),a("utils/Polling").getInstance().resetInterval()})})).add()});define("tweet/list/UserTimelineList",function(a,b,c){var d=a("external/jquery"),e=a("tweet/NormTweet"),f=a("tweet/list/basic/NormTimeline"),g=a("model/UserData"),h=f.extend({filterMap:{org:"原创",image:"图片",video:"视频",music:"音乐",comment:"跟贴",topic:"话题",column:"微专栏"},init:function(a,b){this._super(a,b),this.userId=this.$elem.attr("data-user-id")},buildUrl:function(a){return"userTimeline"},buildParam:function(a){var b=d.extend(this._super(a),{userId:this.userId});return this.config.filterType!=="all"?d.extend(b,{filter:this.config.filterType}):b},showEmpty:function(){var b="您暂时没发过",c=g.getLoginUser(),d=c?c.nickName:"",e=g.get(this.userId).nickName;d!=e&&(b=e+"暂时没发过"),this.config.filterType!=="all"&&(b=b+this.filterMap[this.config.filterType]),b=b+'信息&nbsp;&nbsp;<a href="/rss" class="link-lb fFS" data-keyfrom="discover">去发现看看&gt;&gt;</a>';if(this.$empty===null){var f=a("widget/TipBox");this.$empty=(new f({content:b})).render()}else this.$empty.find(".js-text").html(b);this.$empty.appendTo(this.$elem)},newItem:function(a,b){var c={html:b,hideAvatar:!0};return new e(a,c)},onSent:function(a,b,c){b.type!=="reply"&&b.user.id===this.userId&&this.updateNew(b)}});return h});define("tweet/NormTweet",function(a,b,c){a("external/google-map");var d=a("utils/jquery-wb"),e=a("tweet/Tweet"),f=a("tweet/TweetAction"),g=a("tweet/action/DeleteAction"),h=a("tweet/action/DiggAction"),i=a("tweet/status/ReplyRetweet"),j=a("model/TweetData"),k=a("tweet/widget/MediaBox"),l=a("sendBox/SendBoxAction"),m=a("tweet/action/RenderInnerTweetAction"),n=a("tweet/action/ReportSpamAction"),o=a("tweet/action/DisplayTagAction"),p=a("utils/tmpl"),q=a("utils/Utils"),r=e.extend(d.extend({init:function(a,b){this._super(a,b),this.replyTalkBox=null,this.retweetTalkBox=null,this.$map=null,this.mediaBox=null,this.innerTweet=null,this.author=null,this.sendBoxStatus=this.SendBoxStatusList.allClose;if(this.data.ztInfos!==undefined){var c=this.data.ztInfos[0].desc;this.data.countZtInfosDesc=c==""?"大家正在热烈讨论，点击发表我的看法。":q.countChars(c,76)}this.data.hasOwnProperty("digged")||(this.data.digged=!1)},render:function(){this.$elem===null&&(this.config.html?(this.$elem=d(this.config.html),delete this.config.html):this.config.isFromProject?(this.data.isFromProject=!0,this.$elem=d(p.formatTemplate(a("_tmpl/tweet/projectTweet"),d.extend({config:this.config},this.data)))):this.$elem=d(p.formatTemplate(a("_tmpl/tweet/normTweet"),d.extend({config:this.config},this.data))),this.bindEvent());return this.$elem},bindEvent:function(){this._super(),m.doAction.call(this),this.$elem.bind("open.TalkBox",d.proxy(this.onTalkBoxOpen,this)).bind("sent",d.proxy(this.onSent,this)).delegate(".report-trigger","click",d.proxy(this.onReport,this)).delegate(".digg-trigger","click",d.proxy(this.onDigg,this)).delegate(".reply-trigger","click",d.proxy(this.onReply,this)).delegate(".retweet-trigger","click",d.proxy(this.onRetweet,this)).delegate(".fav-trigger","click",d.proxy(this.onFav,this)).delegate(".map-trigger","click",d.proxy(this.onShowMap,this)).delegate(".delete-trigger","click",d.proxy(this.onDelete,this)).delegate("*","close.TalkBox",d.proxy(this.onTalkBoxClose,this)).delegate(".js-message:first .js-tweet-tag","hover",d.proxy(this.onDisplayTag,this));var a=this.$elem.find("> .tweet-main > .js-media");a.length>0&&(this.mediaBox=new k(a,{type:"normal"}),this.$elem.find(".js-message:first .video-trigger").bind("click",d.proxy(this.mediaBox.onVideo,this.mediaBox)),this.$elem.find(".js-message:first .music-trigger").bind("click",d.proxy(this.mediaBox.onMusic,this.mediaBox)),this.$elem.find(".js-message:first .preview-trigger").bind("click",d.proxy(this.mediaBox.onNewsPrv,this.mediaBox))),j.bindUpdate(this.data.id,d.proxy(f.update,this))},onReport:n.doAction,onDelete:g.doAction,onSent:function(a,b,c){},onTalkBoxOpen:function(a,b,c){this.data.type==="retweet"&&c.config.type==="retweet"&&!c.config.isRoot&&c.$elem.find("textarea").val()===""&&l.appendRetweetContent.call(c),c.$elem.find("textarea").trigger("keyup"),this.$elem.siblings("#userGuideRetweet").remove()},onTalkBoxClose:function(a){this.statusOnTalkBoxClose(a)},onReply:function(a){this.statusOnReply(a)},onRetweet:function(a){this.statusOnRetweet(a)},onDigg:h.doAction,onDisplayTag:o.doAction,onFav:function(a){var b=d(a.target);b.data("favorited")?f.delFavorite.call(this,b):f.addFavorite.call(this,b);return!1},onShowMap:function(a){var b=this;if(google.maps.Map===undefined)d.ajax({url:"http://maps.gstatic.com/intl/en_us/mapfiles/api-3/4/4a/main.js",dataType:"script",success:function(){b.onShowMap(a)},cache:!0});else{this.renderMap(),this.$map.slideDown("slow");var c=d(a.target).offset(),e=d(a.target).width();this.$map.find(".js-arrow").offset({left:c.left+e/2-5})}},renderMap:function(){if(this.$map===null){var b=d(p.formatTemplate(a("_tmpl/map")));this.$map=b.insertAfter(this.$elem.find(".js-poi")),b.delegate(".close-trigger","click",d.proxy(this.onCloseMap,this));var c=this.data.position.poi.coordinate,e=new google.maps.LatLng(c.latitude,c.longitude),f=new google.maps.Map(b.find(".js-main")[0],{zoom:13,center:e,mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:!0,mapTypeControl:!1}),g=new google.maps.Marker({position:e,map:f})}return this.$map},onCloseMap:function(a){this.$map!==null&&this.$map.slideUp("normal")},openTalkBox:f.openTalkBox,closeTalkBox:f.closeTalkBox,initTalkBox:function(a){var b=this.data.timestamp>=13407264e5?{replyType:1}:{};f.initTalkBox.apply(this,[a,b,""])}},i));return r});define("external/google-map",function(a,b){window.google=window.google||{},google.maps=google.maps||{},function(){var a=google.maps.modules={};google.maps.__gjsload__=function(b,c){a[b]=c},google.maps.Load=function(a){delete google.maps.Load,a([null,[[["http://mt0.googleapis.com/vt?lyrs=m@146&src=api&hl=en-US&","http://mt1.googleapis.com/vt?lyrs=m@146&src=api&hl=en-US&"]],[["http://khm0.googleapis.com/kh?v=80&hl=en-US&","http://khm1.googleapis.com/kh?v=80&hl=en-US&"],null,null,null,1],[["http://mt0.googleapis.com/vt?lyrs=h@146&src=api&hl=en-US&","http://mt1.googleapis.com/vt?lyrs=h@146&src=api&hl=en-US&"],null,null,"imgtp=png32&"],[["http://mt0.googleapis.com/vt?lyrs=t@126,r@146&src=api&hl=en-US&","http://mt1.googleapis.com/vt?lyrs=t@126,r@146&src=api&hl=en-US&"]],null,[[null,0,7,7,[[[33e7,124605e4],[3862e5,12936e5]],[[3665e5,1297e6],[3862e5,1320034790]]],["http://mt0.gmaptiles.co.kr/mt?v=kr1.13&hl=en-US&","http://mt1.gmaptiles.co.kr/mt?v=kr1.13&hl=en-US&"]],[null,0,8,9,[[[33e7,124605e4],[3862e5,12796e5]],[[345e6,12796e5],[3862e5,12867e5]],[[3489e5,12867e5],[3862e5,12936e5]],[[35469e4,12936e5],[3862e5,1320034790]]],["http://mt0.gmaptiles.co.kr/mt?v=kr1.13&hl=en-US&","http://mt1.gmaptiles.co.kr/mt?v=kr1.13&hl=en-US&"]],[null,0,10,19,[[[329890840,1246055600],[386930130,1284960940]],[[344646740,1284960940],[386930130,1288476560]],[[350277470,1288476560],[386930130,1310531620]],[[370277730,1310531620],[386930130,1320034790]]],["http://mt0.gmaptiles.co.kr/mt?v=kr1.13&hl=en-US&","http://mt1.gmaptiles.co.kr/mt?v=kr1.13&hl=en-US&"]],[null,3,7,7,[[[33e7,124605e4],[3862e5,12936e5]],[[3665e5,1297e6],[3862e5,1320034790]]],["http://mt0.gmaptiles.co.kr/mt?v=kr1p.12&hl=en-US&","http://mt1.gmaptiles.co.kr/mt?v=kr1p.12&hl=en-US&"]],[null,3,8,9,[[[33e7,124605e4],[3862e5,12796e5]],[[345e6,12796e5],[3862e5,12867e5]],[[3489e5,12867e5],[3862e5,12936e5]],[[35469e4,12936e5],[3862e5,1320034790]]],["http://mt0.gmaptiles.co.kr/mt?v=kr1p.12&hl=en-US&","http://mt1.gmaptiles.co.kr/mt?v=kr1p.12&hl=en-US&"]],[null,3,10,null,[[[329890840,1246055600],[386930130,1284960940]],[[344646740,1284960940],[386930130,1288476560]],[[350277470,1288476560],[386930130,1310531620]],[[370277730,1310531620],[386930130,1320034790]]],["http://mt0.gmaptiles.co.kr/mt?v=kr1p.12&hl=en-US&","http://mt1.gmaptiles.co.kr/mt?v=kr1p.12&hl=en-US&"]]],[["http://cbk0.google.com/cbk?","http://cbk1.google.com/cbk?"]],[["http://khmdb0.googleapis.com/kh?v=36&hl=en-US&","http://khmdb1.googleapis.com/kh?v=36&hl=en-US&"]],[["http://mt0.googleapis.com/mapslt?hl=en-US&","http://mt1.googleapis.com/mapslt?hl=en-US&"]],[["http://mt0.googleapis.com/mapslt/ft?hl=en-US&","http://mt1.googleapis.com/mapslt/ft?hl=en-US&"]]],["en-US","US",null,0,null,"http://maps.google.com","http://maps.gstatic.com/intl/en_us/mapfiles/","http://gg.google.com","https://maps.googleapis.com","http://maps.googleapis.com"],["http://maps.gstatic.com/intl/en_us/mapfiles/api-3/4/4a","3.4.4a"],[841483249],1,null,null,null,null,0,"",null,null,0],b)};var b=(new Date).getTime()}();return window.google});define("tweet/Tweet",function(a,b,c){var d=a("external/jquery"),e=a("basic/oop/Class"),f=a("model/TweetData"),g=a("model/UserData"),h=e.extend({init:function(a,b){this.$elem=null,typeof a=="string"?this.data=f.get(a):this.data=(new f(a)).get(),this.config=b||{}},render:function(){throw new Error("Not implemented yet")},bindEvent:function(){this.data&&this.data.user&&g.bindUpdate(this.data.user.id,d.proxy(this.onUpdate,this))},erase:function(){this.$elem.remove(),this.$elem=null},onUpdate:function(a){!this.data.user.isShowRemark||(a.remark!==""?this.$elem.find(".js-remark:first").text(a.remark):this.$elem.find(".js-remark:first").text(a.nickName))}});return h});define("tweet/TweetAction",function(a,b,c){var d=a("utils/jquery-wb"),e=a("utils/Utils"),f=a("sendBox/SendBoxFactory"),g=a("utils/DataSource"),h=a("model/UserData"),i=a("model/QunData"),j=a("widget/tip/NaviTip"),k=a("utils/log/Logger"),l={openTalkBox:function(a,b){var c=i.getQunInfo();if(!(h.getLoginUser()===null||a==="reply"&&c&&!c.isJoin)){this.initTalkBox(a);var d=this[a+"TalkBox"],e=this.$elem.find("."+a+"-trigger").addClass("currentActive"),f={replyTalkBox:["reply","unfoldReply"],retweetTalkBox:["RT","unfoldRT"],rootReplyTalkBox:["originReply","unfoldReply"],rootRetweetTalkBox:["originRT","unfoldRT"]},g=(e.width()-e.find("span").width())/2,j=e.offset().left+g-7;this.$elem.find(".js-foot:last").after(d.render());var l=d.$elem.attr("data-keyfrom",f[a+"TalkBox"][0]).find("textarea");a==="retweet"?l.focus():l.focusToEnd(),d.setUpArrowPosition(j),this.$elem.trigger("open.TalkBox",[this,d]),k.triggerLog(d.$elem,{method:f[a+"TalkBox"][1]})}},closeTalkBox:function(a,b){if(h.getLoginUser()!==null){this.initTalkBox(a);var c=this[a+"TalkBox"];this.$elem.find("."+a+"-trigger").removeClass("currentActive"),c.render().detach(),this.$elem.trigger("close.TalkBox",[this,c])}},initTalkBox:function(a,b,c){var d=c===undefined?a:c+a;if(!this[a+"TalkBox"]){var e=this.data;this[a+"TalkBox"]=f.newInstance(d,e,b)}},addFavorite:function(a){h.getLoginUser()!==null&&(g.setKeyFrom(this.$elem).postJSON("fav",{butterId:this.data.id,targetUserId:this.data.user.id},function(b){b.status=="4"?j.show({type:"error",text:"该条微博已经被删除！"}):(a.attr("title","取消收藏这条微博"),a.html("取消收藏"),a.data("favorited",!0),j.show({type:"success",text:"收藏成功！"}))}),e.analytics.send("/page.do?method=create&keyfrom="+k.keyFrom(this.$elem)))},delFavorite:function(a){h.getLoginUser()!==null&&(g.setKeyFrom(this.$elem).postJSON("unfav",{butterId:this.data.id,targetUserId:this.data.user.id},function(b){b.status=="4"?j.show({type:"error",text:"该条微博已经被删除！"}):(a.attr("title","收藏这条微博"),a.html("收藏"),a.data("favorited",!1),j.show({type:"success",text:"取消收藏成功！"}))}),e.analytics.send("/page.do?method=destroy&keyfrom="+k.keyFrom(this.$elem)))},update:function(a){e.updateCount(this.$elem.find(".reply-counter:last"),this.data.replyCount),e.updateCount(this.$elem.find(".retweet-counter:last"),this.data.retweetCount),e.updateCount(this.$elem.find(".top-counter:last"),this.data.topPostCount),e.updateCount(this.$elem.find(".down-counter:last"),this.data.downPostCount)}};return l});define("sendBox/SendBoxFactory",function(a,b,c){var d=a("external/jquery"),e=a("sendBox/talkBox/ReplyBox"),f=a("sendBox/talkBox/ReplyListTalkBox"),g=a("sendBox/talkBox/RetweetBox"),h=a("sendBox/talkBox/RetweetListTalkBox"),i={newInstance:function(a,b,c){switch(a){case"singleTweet_reply":return new e(b,c);case"reply_reply":return new e(b,c);case"retweet_reply":return new f(b,c);case"reply":return new f(b,c);case"rootReply":return new f(b,c);case"singleTweet_retweet":return new g(b,c);case"retweet_retweet":return new h(b,c);case"retweet":return new h(b,c);case"rootRetweet":return new h(b,c);default:throw new Error("SendBoxFactory 错误，未指定需要创建的 SendBox 类型:"+a)}}};return i});define("sendBox/talkBox/ReplyBox",function(a,b,c){var d=a("external/jquery"),e=a("sendBox/talkBox/TalkBox"),f=a("sendBox/InputError"),g=a("sendBox/SendBoxAction"),h=e.extend({init:function(a,b){this._super(a,b),this.config.type="reply"},bindEvent:function(){this._super();if(this.config.showTowerTips&&this.config.showTowerTips===!0){var a=this;this.$elem.delegate(".js-closeTips","click",function(b){a.onCloseTips(b,!0)})}},onCloseTips:function(a,b){this.tipsInterval&&clearInterval(this.tipsInterval),this.$successTips.remove(),this.$hideElem.show(),b&&g.close.call(this)},checkInput:function(){if(this.data.type=="reply"){var a=d.trim(this.$elem.find("textarea").val());if(a=="回复@"+this.data.user.nickName+"：")throw new f("再说点什么吧",!0)}g.checkInput.call(this)}});return h});define("sendBox/talkBox/TalkBox",function(a,b,c){var d=a("external/jquery"),e=a("sendBox/BasicSendBox"),f=a("sendBox/SendBoxAction"),g=a("sendBox/widget/AtInput"),h=a("utils/tmpl"),i=a("model/UserData"),j=e.extend({init:function(a,b){this._super(a,b),this.config.isAutoHeight=typeof this.config.isAutoHeight!="undefined"?this.config.isAutoHeight:!0,this.$elem=this.config.elem||null},render:function(){this.getCurrentUser(),this.$elem===null&&(this.$elem=this.renderTmpl(),this.bindEvent());return this.$elem},bindEvent:function(){this._super(),f.bindDefaultTip.apply(this),f.bindClose.apply(this),f.bindOperateCheckbox.apply(this),this.config.isAutoHeight&&this.textarea.bindAutoHeight(),this.atInput=g.getInstance(),this.atInput.bind(this.$elem.find(".at-trigger"),this.textarea)},getCurrentUser:function(){var a=i.getLoginUser();this.config.loginUserId=a.id},close:f.close,renderTmpl:function(){return d(h.formatTemplate(a("_tmpl/talkBox"),{config:this.config,data:this.data}))},setUpArrowPosition:function(a){this.$arrow=this.$arrow||this.$elem.find(".js-arrow"),this.$arrow.offset({left:a})},onClose:function(a){this.$elem.detach()},onSubmit:function(a){this.cancelBlur(),this._super(a)},onSuccess:function(a){f.showSuccess.call(this,a),this.onBadgeTips(5);var b=(this.config.type==="reply"?"评论":"转发")+"成功！";this.tip.show({type:"success",text:this.badgeNavTips!==null?this.badgeNavTips:b})},onSubmitError:function(a){this._super(a),this.blink()}});return j});define("sendBox/widget/AtInput",function(a,b,c){var d=a("external/jquery"),e=a("widget/tinyBox/Box"),f=a("utils/DataSource"),g=a("utils/tmpl"),h=a("utils/Utils"),i=a("sendBox/widget/atSuggest/AtInputList"),j=a("utils/log/Logger"),k=d(document.body),l=e.extend({maxHeight:184,init:function(a){this.$elem=null,this.dataAtCache={},this.isShow=!1},preRender:function(){return{content:g.formatTemplate(a("_tmpl/atInput"))}},postRender:function(){this.$elem.addClass("winlayer-at"),this.list=new i(d("<ul></ul>",{"class":"winlayer-at-list"}),{showNum:8,disableScroll:!0}),this.$elem.find(".js-body").append(this.list.$elem)},bindEvent:function(){this._super(),this.$searchElem=this.$elem.find(".js-search"),this.$input=this.$searchElem.find("input[type=text]"),this.$searchClose=this.$searchElem.find(".js-close"),this.$searchBtn=this.$searchElem.find(".js-btn"),this.$input.bind("keyup",d.proxy(this.onInput,this)),this.list.$elem.bind("select",d.proxy(this.onSelect,this)),this.$searchBtn.bind("click",d.proxy(function(){this.$input.trigger("keyup")},this)),this.$searchClose.bind("click",d.proxy(function(){this.$input.val("").trigger("keyup")},this)),k.bind("trigger-atsuggest",d.proxy(function(){this.isShow&&this.hide()},this)),k.bind("sent",d.proxy(function(){this.dataAtCache={}},this)),h.onBindInputAction(this.$input)},bind:function(a,b){d(a).bind("click",{textarea:b,target:a},d.proxy(this.show,this))},show:function(a,b){k.trigger("wgtHide").bind("click",d.proxy(this.autoClose,this)),this.$trigger=d(a.data.target),this.textarea=a.data.textarea;var c=this.$trigger,e=c.offset();e.top=e.top+c.height()+4,e.left=e.left-18,this._super(e),this.$input.focus().val(""),this.onDataList(),j.triggerLog(this.$trigger,{method:"atRecent"})},onInput:function(a){if(d.inArray(a.which,[38,40])!==-1)return!0;var b=d.trim(this.$input.val());b!==""?(this.$searchBtn.hide(),this.$searchClose.show()):(this.$searchBtn.show(),this.$searchClose.hide()),this.dataAtCache[b]!==undefined?this.onDataBack(this.dataAtCache[b]):(f.setKeyFrom(this.$elem).post("atSuggest",{atKey:b},d.proxy(function(a){this.dataAtCache[b]=a,this.onDataBack(a)},this)),h.analytics.send("/page.do?method=atSuggest&keyfrom="+j.keyFrom(this.$elem)))},onSelect:function(a,b){this.textarea.appendText("@"+b+" "),this.textarea.$elem.trigger("keyup")},onDataList:function(){var a=d.trim(this.$input.val());this.dataAtCache[a]!==undefined?this.onDataBack(this.dataAtCache[a]):(f.setKeyFrom(this.$elem).postJSON("atRecentAll",{},d.proxy(function(b){this.$elem.find(".js-loading").remove(),this.dataAtCache[a]=b,this.onDataBack(b)},this)),h.analytics.send("/page.do?method=atRecent&type=all&keyfrom="+j.keyFrom(this.$elem)))},onDataBack:function(a){if(a==="null"||d.trim(a).length===0){var b=h.encodeSpecialHtmlChar(d.trim(this.$input.val())),c=b===""?'<li class="disable"></li>':"<li n="+b+">直接@<b>"+h.countChars(b,20)+"</b></li>";this.list.show(c,{maxHeight:this.maxHeight})}else this.list.show(a,{maxHeight:this.maxHeight});this.isShow=!0},hide:function(a){this._super(),k.unbind("click",d.proxy(this.autoClose,this)),this.list.unbindEvent(),this.isShow=!1},autoClose:function(a){var b=d(a.target).parents().andSelf();d.inArray(this.$elem[0],b)===-1&&d.inArray(this.$trigger[0],b)===-1&&this.hide()}}),m=null;return{getInstance:function(){m==null&&(m=new l);return m}}});define("sendBox/widget/atSuggest/AtInputList",function(a,b,c){var d=a("external/jquery"),e=a("widget/suggest/SuggestList"),f=e.extend({show:function(a,b){this.$elem.css({height:"auto"}),this.$elem.html(a),this.onCurrentFirst(),this.$elem.scrollTop(0),this.$elem.height()>b.maxHeight&&this.$elem.height(b.maxHeight),this.bindEvent()},onEnter:function(a){var b=this.$elem.children(".current").attr("n");this.$elem.trigger("select",[b])},onKey:function(a){this._super(a),(a.which===38||a.which===40)&&this.scrollTo(this.$elem.find(".current"))},scrollTo:function(a){var b=this.$elem.children().size();if(b<this.config.showNum)return!0;var c=a.index()*a.height(),d=this.$elem.scrollTop(),e=this.$elem.height();c<e?this.$elem.scrollTop(0):(c+3>d+e||c<d)&&this.$elem.scrollTop(c)}});return f});define("_tmpl/atInput",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div class="winlayer-hd"><a class="winlayer-close icon-close close-trigger" title="关闭" href="javascript:;"></a><div class="winlayer-at-search"><div class="winlayer-search js-search"><input class="winlayer-search-input" type="text" /><div class="winlayer-search-right"><a class="winlayer-search-btn js-btn" title="搜索" href="javascript:;"><em class="icon-search-gray"></em></a><a class="winlayer-search-close js-close" href="javascript:;" style="display:none;"></a></div></div></div></div><div class="winlayer-bd winlayer-at-bd js-body"><div class="loadingBoxS js-loading"><span><em class="icon-loadingS"></em>数据加载中...</span></div></div><div class="winlayer-at-ft">@朋友，他们就会收到通知</div>');return p.join("")}});define("_tmpl/talkBox",function(require){return function(tmplData){var p=[];with(tmplData){p.push('<div class="tweet-talk js-talkBox',config.isRoot?" tweet-root-talk":"",'"><div class="tweet-talk-arrow js-arrow',config.isRoot?" tweet-root-talk-arrow":"",'"><em class="icon-arrow-up js-arrow"></em></div><div class="tweet-talk-hd',config.isRoot?" tweet-root-talk-hd":"",'"><h3>'),config.type==="reply"?(p.push(""),config.isRoot?p.push("原文评论"):data.type==="reply"?p.push("回复评论"):p.push("评论微博"),p.push("")):config.type==="qunRetweet"?p.push("转发到我的微博"):config.type==="retweet"&&(p.push(""),config.isRoot?p.push("原文转发"):p.push("转发微博"),p.push("")),p.push("</h3>"),config.noClose!==!0&&p.push('<a class="icon-close close-trigger" href="javascript:;" title="关闭"></a>'),p.push('</div><div class="tweet-publishBox',config.isRoot?" tweet-root-talk-publishBox":"",'"><div class="tweet-publishBox-hd"><div class="tweet-publishBox-textareaBox"><label class="tweet-publishBox-defaultTips js-default-tip">'),config.type==="reply"?(p.push(""),data.type==="reply"?p.push("点击添加回复"):p.push("点击添加评论"),p.push("")):p.push("转发微博"),p.push('</label><textarea class="tweet-publishBox-textarea"></textarea></div></div><div class="tweet-publishBox-ft js-publishBoxFt"><div class="clearfix"><div class="tweet-publishBox-operate"><div class="tweet-publishBox-btn"><a class="',typeof config.isTowerReply!="undefined"&&config.isTowerReply===!0?"tower-submit-trigger ":"submit-trigger ",""),config.type==="reply"&&p.push("disabled"),p.push('" href="javascript:;">'),config.type==="reply"?(p.push(""),data.type==="reply"?p.push("回复"):p.push("评论"),p.push("")):p.push("转发"),p.push('</a></div><span class="tweet-publishBox-tip js-wordCounter">还可以输<span class="char-constantia">163</span>字</span><div class="tweet-publishBox-insert"><div class="insert-list"><a class="insert-at at-trigger" title="@Ta的昵称或备注可以提到Ta" href="javascript:;"><em class="icon-at"></em></a><a class="insert-face face-trigger" title="表情" href="javascript:;"><em class="icon-face"></em></a></div></div></div><span class="fl">'),config.type==="reply"&&p.push('<label class="label-tag"><input name="isRetweet" type="checkbox" class="js-Checkbox" />同时转发到我的微博</label>'),p.push(""),config.type==="retweet"&&p.push('<label class="label-tag"><input name="replyToIt" type="checkbox" class="js-Checkbox" />同时评论给',data.user.nickName,"</label>"),p.push("</span></div>"),isShowReplyOriginal=config.type!=="qunRetweet"&&data.relatedTweet.root&&config.loginUserId!==data.relatedTweet.root.user.id&&data.relatedTweet.root.user.id!==data.user.id,p.push("");if(typeof config.singleHasRoot!="undefined")p.push(""),config.singleHasRoot=="true"&&data.user.nickName!==config.singleRootUser&&config.singleTweetUser!==config.singleRootUser&&(p.push('<label class="tweet-publishBox-reply label-tag"><input name="replyOriginal" type="checkbox" '),config.type==="reply"&&p.push("checked"),p.push("/>同时评论给原文作者",config.singleRootUser,"</label>")),p.push("");else if(config.type==="reply"&&data.type==="reply"){p.push("");var root=data.relatedTweet.root||null;p.push(""),root&&data.rootTweetId!==root.id&&isShowReplyOriginal&&!config.isTowerReply?p.push('<label class="tweet-publishBox-reply label-tag"><input name="replyOriginal" type="checkbox" checked/>同时评论给原文作者',data.relatedTweet.root.user.nickName,"</label>"):(root&&config.isTowerReply&&root.relatedTweet.root&&data.user.id!==root.relatedTweet.root.user.id&&root.user.id!==root.relatedTweet.root.user.id||data.relatedTweet.parent&&data.user.id!==data.relatedTweet.parent.user.id&&data.relatedTweet.parent.user.id!==root.user.id)&&p.push('<label class="tweet-publishBox-reply label-tag"><input name="replyOriginal" type="checkbox" checked/>同时评论给原文作者',root.relatedTweet.root?root.relatedTweet.root.user.nickName:root.user.nickName,"</label>"),p.push("")}else p.push(""),isShowReplyOriginal&&(p.push('<label class="tweet-publishBox-reply label-tag"><input name="replyOriginal" type="checkbox" '),config.type==="reply"&&p.push("checked"),p.push("/>同时评论给原文作者",data.relatedTweet.root.user.nickName,"</label>")),p.push("");p.push("</div></div></div>")}return p.join("")}});define("sendBox/talkBox/ReplyListTalkBox",function(a,b,c){var d=a("external/jquery"),e=a("sendBox/talkBox/ReplyBox"),f=a("utils/tmpl"),g=e.extend({bindEvent:function(){this._super(),this.rootData=this.data;if(this.config.replyType&&this.config.replyType===1){var b=a("tweet/list/TowerReplyBoxList"),c=d(f.formatTemplate(a("_tmpl/tweet/list/talkBoxTweetList"),this.data)),e=a("sendBox/talkBox/TalkBoxListManager");this.talkBoxManager=new e,this.talkBoxManager.bindEvent(c.find("ul").addClass("towerTweet-talk-list towerList")),this.replyTowerList=new b(c.find("ul"),{pagerContainer:this.$elem.find(".js-pages"),data:this.data,container:c,asyncRequest:!0}),this.replyTowerList.render().appendTo(this.$elem);var g=this;this.$elem.find(".js-pages").bind("pager",function(){g.$elem.scrollToShow(10)})}else{var h=a("tweet/list/ReplyBoxTweetList");this.replyList=new h(this.data),this.$replyList=this.replyList.render().appendTo(this.$elem),this.$replyList.bind("replyTrigger",d.proxy(this.onListReply,this))}},onSuccess:function(){this.data=this.rootData,this.textarea.clear(),this.onBadgeTips(5),this.tip.show({type:"success",text:this.badgeNavTips!==null?this.badgeNavTips:"评论成功！"})},onListReply:function(a,b){this.data=b,this.config.quote="||@"+b.user.nickName+"："+b.content;var c=this.textarea.$elem.val(),d="回复@"+b.user.nickName+"：";c=c.replace(/回复@.+：|\s{0,}/,d),this.textarea.$elem.val(c),this.textarea.$elem.keyup(),this.textarea.$elem.focusToEnd()}});return g});define("tweet/list/TowerReplyBoxList",function(a,b,c){var d=a("external/jquery"),e=a("tweet/list/basic/TowerTimeline"),f=a("model/UserData"),g=e.extend({init:function(a,b){this._super(a,b),this.listType="replybuild",this.replyListType="replybuild",this.data=b.data||{},this.pager.$elem.attr("class","pages-small"),this.$container=b.container},buildParam:function(a){return d.extend(this._super(a),{screenName:this.data.user.id,butterId:this.data.id})},render:function(){this.bindEvent(),this.$pager||(this.$pager=this.pager.render(),this.$pagerContainer=this.$container.find(".js-pages"),this.$pagerContainer.bind("onPage",d.proxy(this.onPageStart,this)),this.$pager.appendTo(this.$pagerContainer),this.pager.initData());return this.$container},showEmpty:function(){this.$container.hide()},hideEmpty:function(){this.$container.show()},onSent:function(a,b,c){this.hideEmpty(),this._super(a,b,c)},onPage:function(a){this._super(a),a.page.pageCount>1&&this.$pagerContainer.siblings(".js-link-all").show().attr("href","/"+a.refTweets[0].user.screenName+"/status/"+a.refTweets[0].id+"/reply")}});return g});define("tweet/list/basic/TowerTimeline",function(a,b,c){var d=a("external/jquery"),e=a("sendBox/talkBox/TalkBoxListManager"),f=a("tweet/TowerTweet"),g=a("model/TweetData"),h=a("tweet/list/basic/Timeline"),i=a("model/UserData"),j=a("utils/Utils"),k=h.extend({init:function(a,b){this._super(a,b),this.config.tweetId=this.$elem.attr("data-tweet-id"),this.config.userId=this.$elem.attr("data-user-id"),this.replyFloorIdx=null,this.newOneTowerData=null},buildUrl:function(a){return"allReplyBuild"},bindEvent:function(){this._super(),this.talkBoxManager=new e,this.talkBoxManager.bindEvent(this.$elem),this.$elem.bind("tower.ExpandTower",d.proxy(this.onExpandTower,this)).bind("tower.SetFloorIdx",d.proxy(this.setFloorIdx,this))},updateData:function(a){a.refTweets&&(d.each(a.refTweets,function(a,b){g.update(b)}),this.refTweetsId=a.refTweets[0].user.id),d.each(a.towerList,function(b,c){var e=a.towerList[b].relatedTweet;d.each(c.buildingContent,function(a,b){g.update(b),b.relatedTweet=e})})},renderData:function(a){this.onFragment(a,a.towerList)},onDeleted:function(a,b){this.remove(b),a.stopPropagation()},onExpandTower:function(a,b){var c=b.callBack,d=this.newItem(b.json.towerList[0]),e=d.render();d.pageNo=b.self.pageNo,d.allExpandTower=b.self.allExpandTower,c(e,b)},newItem:function(a,b){var c=this.refTweetsId&&i.getLoginUser()&&this.refTweetsId==i.getLoginUser().id?!0:!1;return new f(a,{html:b,singleHasRoot:this.config.singleHasRoot,singleTweetUser:this.config.singleTweetUser,singleRootUser:this.config.singleRootUser,canBeReported:!0,isTowerReply:!0,canBeDeleted:c})},setFloorIdx:function(a,b,c){this.newOneTowerData=c,this.replyFloorIdx=b},onSent:function(a,b,c){var d=this.data?this.data.id:this.config.tweetId;if(b.type==="reply"&&!!b.relatedTweet.parent&&b.relatedTweet.parent.id===d){if(this.replyFloorIdx&&this.newOneTowerData&&c.config.isTowerReply){var e=this.replyFloorIdx+1,f=this.newOneTowerData.buildingContent,g=j.getSortedKey(f,"b2s")[0];if(e<g){var h=j.getSortedKey(f,"b2s")[0];for(var i=e;i<=h;i++)delete f[i]}this.newOneTowerData.buildingContent[e]=b,this.newOneTowerData.floorSize=e;var k=this.newOneTowerData}else var k={buildingContent:{1:b},floorSize:1};this.updateNew(k),this.newOneTowerData=null,this.replyFloorIdx=null}},wrap:function(a){return a.wrap('<li class="liItem"></li>').parent()}});return k});define("sendBox/talkBox/TalkBoxListManager",function(a,b,c){var d=a("external/jquery"),e=a("basic/oop/Class"),f=e.extend({init:function(){this.openedTalkBox=null},bindEvent:function(a){this.elem=a,d(a).delegate(".js-tweet","open.TalkBox",d.proxy(this.onTalkBoxOpen,this)).delegate(".js-tweet","close.TalkBox",d.proxy(this.onTalkBoxClose,this))},onTalkBoxOpen:function(a,b,c){if(this.openedTalkBox!==null){this.openedTalkBox.close();var e=d(a.currentTarget).offset().top-36;window.scrollTo(0,e)}this.openedTalkBox=c;return!1},onTalkBoxClose:function(a,b,c){var d=this.openedTalkBox?this.openedTalkBox.replyTowerList:null,e=d?d.talkBoxManager.openedTalkBox:null;d&&e&&(e.close(),e=null),this.openedTalkBox===c&&(this.openedTalkBox=null);return!1}});return f});define("tweet/TowerTweet",function(a,b,c){var d=a("external/jquery"),e=a("utils/DataSource"),f=a("tweet/action/DeleteAction"),g=a("tweet/action/ReportSpamAction"),h=a("tweet/status/Reply"),i=a("utils/tmpl"),j=a("tweet/Tweet"),k=a("tweet/TweetAction_Tower"),l=a("model/TweetData"),m=a("utils/Utils"),n=j.extend(d.extend({init:function(a,b){this._super(a,b),this.config=d.extend(this.config,{replyType:1}),this.replyTalkBox=null,this.sendBoxStatus=this.SendBoxStatusList.allClose,this.listType="replybuild",this.towerId=m.S4()+m.S4(),this.pageNo=1,this.allExpandTower={towerList:[{}]},this.oneTowerdata=a,this.maxFloorData=null,this.htmlStr="",this.replyItemType="replybuild"},bindEvent:function(){this._super();var a=this;this.$elem.delegate(".tower-reply-trigger","click",{towerId:this.towerId},d.proxy(this.onReply,this)).delegate(".tower-delete-trigger","click",d.proxy(this.onDelete,this)).delegate(".tower-report-trigger","click",d.proxy(this.onReport,this)).bind("open.TalkBox",d.proxy(this.onTalkBoxOpen,this)).unbind("close.TalkBox").bind("close.TalkBox",d.proxy(this.onTalkBoxClose,this)).delegate(".js-towerCon","hover",d.proxy(this.onHover,this)).delegate(".js-expandTrigger","click",d.proxy(this.onExpandTower,this)).bind("sent",function(b,c,d){d.config.isTowerReply&&(a.sendBoxStatus=a.SendBoxStatusList.allClose)})},onTalkBoxOpen:function(a,b,c,d){var e=c.$elem.find("textarea"),f=d.target;e.val("回复@"+this.oneTowerdata.buildingContent[this.floorIdx].user.nickName+"："),e.trigger("keyup"),this.openedTowerId=d.data.towerId,this.lastReplyTrigger=f},onTalkBoxClose:function(a,b,c,e){this.sendBoxStatus=this.SendBoxStatusList.allClose,this.$elem.trigger("tower.SetFloorIdx",[null,null]),d(this.lastReplyTrigger).removeClass("currentActive");if(!!e){var f=e.target;if(this.openedTowerId===e.data.towerId&&this.lastReplyTrigger!==f){var g=d(this.lastReplyTrigger).parents(".js-foot:last");g.siblings(".js-lastFloor").size()||g.css("visibility","hidden"),setTimeout(function(){d(f).trigger("click")},20)}}},onReply:function(a){this.floorIdx=d(a.target).data("floorIdx"),a.data.floorIdx=this.floorIdx,this.statusOnReply(a),this.$elem.trigger("tower.SetFloorIdx",[this.floorIdx,this.oneTowerdata])},onHover:function(a){var b=d(a.currentTarget),c=b.find(".js-foot");!c.size()||(a.type==="mouseenter"?c.css("visibility","visible"):c.find(".currentActive").size()||c.css("visibility","hidden"))},onExpandTower:function(b){var c=this,f=d(b.currentTarget),g=f.attr("data-page-no")||1,h={butterId:d("#singleTweetList").attr("data-tweet-id")||this.data.relatedTweet.root.id,pageMethod:"page",pageNo:g,leafId:this.oneTowerdata.leafButterId};this.$expandTrigger=f,e.setKeyFrom(f).postJSON("replyFloorList",h,function(b){b.towerList[0].floorSize=m.getSortedKey(b.towerList[0].buildingContent,"b2s")[0],b.towerList[0].leafButterId=c.oneTowerdata.leafButterId;var e=a("model/TweetData");b.refTweets&&d.each(b.refTweets,function(a,b){e.update(b)});var g=b.towerList[0].relatedTweet;d.each(b.towerList,function(a,b){d.each(b.buildingContent,function(a,b){e.update(b),b.relatedTweet=e.get(g.root)})}),c.allExpandTower.page?d.extend(!0,c.allExpandTower.towerList[0],b.towerList[0]):(c.allExpandTower.page=b.page,c.allExpandTower.refTweets=b.refTweets,c.allExpandTower.towerList[0]=b.towerList[0]),c.allExpandTower.towerList[0].buildingContent[c.maxFloorData[0]]=c.maxFloorData[1];var h=m.getSortedKey(c.allExpandTower.towerList[0].buildingContent,"b2s"),i=h[0]==h[1]+1?{floorSize:h[0]}:{floorSize:h[1]+1};c.allExpandTower.towerList[0].floorSize=i.floorSize,c.$elem.trigger("tower.ExpandTower",[{json:c.allExpandTower,callBack:d.proxy(c.callBack,c),self:c,target:f}])})},callBack:function(a,b){this.$elem.replaceWith(a),this.$elem=d(a);var c=b.target.data("pageNo")||1,e=this.$elem.find(".towerBox:first"),f=e;c!==b.json.page.pageCount&&f.wrap('<div class="towerBox"></div>').parent(".towerBox").append(this.$expandTrigger),c=c<b.json.page.pageCount?c+1:b.json.page.pageCount,this.$expandTrigger.attr("data-page-no",c)},render:function(){if(this.$elem===null){if(this.config.html)this.$elem=d(this.config.html),delete this.config.html;else{var a=d.extend({},this.oneTowerdata);this.maxKey=m.getSortedKey(a.buildingContent,"b2s")[0],this.maxFloorData=[this.maxKey,a.buildingContent[m.getSortedKey(a.buildingContent,"b2s")[0]]],a=null;var b=this.newTowerItem(this.oneTowerdata);this.$elem=d(b)}this.bindEvent()}return this.$elem},newTowerItem:function(a){var b=this.towerStr(a,"","",1);return b},towerStr:function(b,c,d,e){var d=c,e=e,f=b.buildingContent[e].user?b.buildingContent[e].user.avatar:"";!f.match(m.OIMAGE_REG)&&b.buildingContent[e].user&&(b.buildingContent[e].user.avatar=m.randomOimageUrl(f,54,54));if(b.fold){d='<div class="towerBox"><div class="towerBox">'+i.formatTemplate(a("_tmpl/tweet/tower/towerItem"),{oneFloor:b.buildingContent[1],maxKey:this.maxKey,floorIdx:1,author:null,config:this.config})+i.formatTemplate(a("_tmpl/tweet/tower/towerItem"),{expandTrigger:!0}),this.htmlStr=d;var g=m.getSortedKey(b.buildingContent,"s2b")[1],h=m.getSortedKey(b.buildingContent,"b2s")[0];for(var j=g;j<=h;j++)d=this.htmlStr,j!=h?this.htmlStr='<div class="towerBox">'+d+i.formatTemplate(a("_tmpl/tweet/tower/towerItem"),{oneFloor:b.buildingContent[j],maxKey:this.maxKey,floorIdx:j,author:null,config:this.config}):this.htmlStr=i.formatTemplate(a("_tmpl/tweet/tower/towerWrap"),{oneFloor:b.buildingContent[j],maxKey:this.maxKey,htmlStr:d,floorIdx:j,author:!0,config:this.config})}else if(e<=8&&e!==b.floorSize)d=this.htmlStr,this.htmlStr='<div class="towerBox">'+d+i.formatTemplate(a("_tmpl/tweet/tower/towerItem"),{oneFloor:b.buildingContent[e],maxKey:this.maxKey,floorIdx:e,author:null,config:this.config}),e+=1,b.buildingContent[e]&&this.towerStr(b,this.htmlStr,d,e);else if(e>8&&e<=b.floorSize-8&&e!==b.floorSize)this.htmlStr=this.htmlStr+'<div class="towerBox mid-towerBox">'+i.formatTemplate(a("_tmpl/tweet/tower/towerItem"),{oneFloor:b.buildingContent[e],maxKey:this.maxKey,floorIdx:e,author:null,config:this.config}),e+=1,b.buildingContent[e]&&this.towerStr(b,this.htmlStr,d,e);else if(e>b.floorSize-8&&e<b.floorSize&&e!==b.floorSize)d=this.htmlStr,this.htmlStr='<div class="towerBox">'+d+i.formatTemplate(a("_tmpl/tweet/tower/towerItem"),{oneFloor:b.buildingContent[e],maxKey:this.maxKey,floorIdx:e,author:null,config:this.config}),e+=1,b.buildingContent[e]?this.towerStr(b,this.htmlStr,d,e):b.buildingContent[this.maxKey]&&this.towerStr(b,this.htmlStr,d,this.maxKey);else if(e===b.floorSize||e===this.maxKey)this.htmlStr=i.formatTemplate(a("_tmpl/tweet/tower/towerWrap"),{oneFloor:b.buildingContent[this.maxKey],maxKey:this.maxKey,htmlStr:this.htmlStr,floorIdx:this.maxKey,author:!0,config:this.config});return this.htmlStr},onReport:g.doAction,onDelete:f.doAction,openTalkBox:k.openTalkBox,closeTalkBox:k.closeTalkBox,initTalkBox:function(a,b){k.initTalkBox.apply(this,[a,this.config,"tower_"])}},h));return n});define("tweet/action/DeleteAction",function(a,b,c){var d=a("external/jquery"),e=a("utils/DataSource"),f=a("model/TweetData"),g=a("model/QunData"),h=a("utils/Utils"),i=a("widget/tip/NaviTip"),j=a("utils/log/Logger"),k={doAction:function(b){var c=g.getQunInfo();if(!c||!!g.getQunInfo().isJoin){var e=this.config.type==="reply"?"评论":"微博",f=a("widget/tinyBox/ConfirmBox"),h=f.getInstance({msg:"确定删除该"+e+"？"});h.show(b.currentTarget,{onConfirm:d.proxy(k.doDelete,this)}),this.delTrigger=d(b.target),this.delFloorIdx=this.delTrigger.data("floorIdx")||null}},doDelete:function(){if(this.replyItemType&&this.replyItemType=="replybuild"&&this.delFloorIdx)var a={butterId:this.oneTowerdata.buildingContent[this.delFloorIdx].id};else var a={butterId:this.data.id};var b=g.getQunInfo();b&&this.data.type!=="reply"&&(a.qId=b.id),e.setKeyFrom(this.$elem).postJSON("deleteTweet",a,d.proxy(k.callback,this))},callback:function(a){if(a.status==="ok"){if(a.refTweets&&a.refTweets.length>0)for(var b=0,c=a.refTweets.length;b<c;b++)f.update(a.refTweets[b]);i.show({type:"success",text:"删除成功！"});if(this.replyItemType&&this.replyItemType=="replybuild"&&this.delFloorIdx)if(this.oneTowerdata.floorSize===1)this.$elem.fadeOut(1e3,d.proxy(function(){this.$elem.trigger("tweetDeleted",[this])},this));else{var e=this.delTrigger.parents(".js-foot").siblings(".js-message");e.fadeOut(1e3,function(){e.text("当前楼层已被拆除").addClass("floor-delete").show().siblings(".js-foot, .js-talkBox").remove().end().siblings(".js-hd").find(".js-nickName").remove()})}else this.$elem.fadeOut(1e3,d.proxy(function(){this.$elem.trigger("tweetDeleted",[this])},this))}else i.show({type:"error",text:"删除失败！"});var g=j.keyFrom(this.$elem);h.analytics.send("/page.do?method=deleteTweet&keyfrom="+g)}};return k});define("widget/tinyBox/ConfirmBox",function(a,b,c){var d=a("external/jquery"),e=a("widget/tinyBox/Box"),f=a("utils/tmpl"),g=e.extend({defaultConfig:{textConfirm:"确认",textCancel:"取消",msg:"确认继续操作么?",onConfirm:function(){},onCancel:function(){}},init:function(a){this.data=d.extend({},this.defaultConfig,a),this.$elem=null},preRender:function(){return{content:f.formatTemplate(a("_tmpl/confirmTip"),this.data)}},postRender:function(){this.$elem.addClass("winlayer-deletebox"),this.$elem.find(".js-arrow")[0].className="winlayer-arrow-down"},bindEvent:function(){this.$elem.delegate(".confirm-trigger","click",d.proxy(this.onConfirm,this)),this.$elem.delegate(".cancel-trigger","click",d.proxy(this.onCancel,this))},show:function(a,b){var c=d(a),e=c.offset();this._super(e),this.$elem.css({top:e.top-this.$elem.height(),left:e.left+c.width()/2-g.ARROW_LEFT-6.5}),this.$elem.hide().fadeIn("fast"),this.data.onConfirm=b.onConfirm||null,this.data.onCancel=b.onCancel||null},hide:function(){var a=this;this.$elem.fadeOut("fast",function(){a.$elem.detach()}),d(document).unbind("keydown",a.hideHandler)},onConfirm:function(){this.data.onConfirm&&this.data.onConfirm(),this.hide()},onCancel:function(){this.data.onCancel&&this.data.onCancel(),this.hide()}});g.ARROW_LEFT=70;var h=null;return{getInstance:function(a,b){h==null&&(h=new g(a,b));return h}}});define("_tmpl/confirmTip",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div class="winlayer-bd"><p>',msg,'</p><div class="winlayer-btnbox"><a class="winlayer-btn-sure confirm-trigger" href="javascript:;">确定</a><a class="winlayer-btn-cancel cancel-trigger" href="javascript:;">取消</a></div></div>');return p.join("")}});define("tweet/action/ReportSpamAction",function(a,b,c){var d=a("external/jquery"),e=a("utils/tmpl"),f=a("model/UserData"),g={doAction:function(b){if(f.getLoginUser()!==null){if(this.data.relatedTweet.root){var c=this.data.relatedTweet.root;c.hasOwnProperty("digged")||(c.digged=!1),c.config=!1,this.data.relatedTweet.root=c}this.reportFloorIdx=d(b.target).data("floorIdx")||null;if(this.replyItemType&&this.replyItemType=="replybuild"&&this.reportFloorIdx){var g=this.oneTowerdata.buildingContent[this.reportFloorIdx]||{};g.relatedTweet.root.config=!1;var h=e.formatTemplate(a("_tmpl/tweet/reportSpamTweet"),d.extend({config:this.config},g)),i=g.id,j=g.user.id,k=g.user.nickName}else var h=e.formatTemplate(a("_tmpl/tweet/reportSpamTweet"),d.extend({config:this.config},this.data)),i=this.data.id,j=this.data.user.id,k=this.data.user.nickName;var l=d(h);l.find("a").attr("href","javascript:;").attr("target",""),h="",l.map(function(){h=h+d(this).outerHTML()});var m=a("utils/ReportSpamManager"),n=new m(h,{type:"butter",butterId:i,userId:j,nickName:k,contentHeight:89});n.doReport()}}};return g});define("_tmpl/tweet/reportSpamTweet",function(require){return function(tmplData){var p=[];with(tmplData){p.push("");var tweetUser=user;p.push(""),tweetUser.config=config,p.push('<p class="tweet-message">',require("_tmpl/tweet/widget/tweetUserName")(tmplData),"：",richContent,"</p>"),type!=="retweet"&&type!=="reply"?p.push("",require("_tmpl/tweet/widget/mediaBox")(tmplData,{openMedia:!1}),"",require("_tmpl/tweet/widget/position")(tmplData),""):p.push("",require("_tmpl/tweet/innerTweet")(tmplData.relatedTweet.root),""),p.push("")}return p.join("")}});define("_tmpl/tweet/widget/tweetUserName",function(require){return function(tmplData){var p=[];with(tmplData){p.push('<span><a class="link-la js-remark js-float-intro" data-keyfrom="nickName" href="/',user.screenName,'" data-user-nickname="',user.nickName,'">'),user.isShowRemark&&user.remark!=""?p.push("",user.remark,""):p.push("",user.nickName,""),p.push("</a>");var tweetUser=user;p.push("",require("_tmpl/itag")(tweetUser),"");if(user.activityIcon&&user.activityIcon.length>0){p.push("");for(var i=0,l=user.activityIcon.length;i<l;i++){p.push("");var icon=user.activityIcon[i];p.push('<a class="active_icon" title="',icon.title,'" href="',icon.link,'" target="_blank" style="background-image:url(\'',icon.image,"')\"></a>")}p.push("")}p.push("</span>")}return p.join("")}});define("_tmpl/tweet/widget/mediaBox",function(require){return function(tmplData){var p=[];with(tmplData){p.push("");if(imageList&&imageList.length||videoInfos.length||typeof musicInfos!="undefined"&&musicInfos.length||typeof voteInfos!="undefined"&&voteInfos.length||typeof towerInfos!="undefined"&&towerInfos.length||typeof linkInfos!="undefined"&&linkInfos.length||typeof gameInfos!="undefined"&&gameInfos.length||typeof ztInfos!="undefined"&&ztInfos.length||typeof columnIdInfos!="undefined"&&columnIdInfos.length){p.push('<div class="tweet-media js-media"><div class="tweet-media-preview">'),imageList&&imageList.length&&p.push('<div class="tweet-preview-item tweet-preview-pic pic-trigger',config.openMedia?" hidden":"",'" data-realurl="',imageList[0],'"><img class="js-preview-img" src="http://timge1.126.net/image?w=140&amp;h=140&amp;url=',encodeURIComponent(imageList[0]),'&amp;gif=1&amp;quality=85" /></div>'),p.push(""),videoInfos.length&&p.push('<div class="tweet-preview-item tweet-preview-video video-trigger',config.openMedia?" hidden":"",'" data-index="0"><img src="http://timge2.126.net/image?w=140&amp;h=140&amp;url=',encodeURIComponent(videoInfos[0].coverUrl),'&amp;gif=1&amp;quality=85" /><em class="icon-video-cover"></em></div>'),p.push(""),typeof towerInfos!="undefined"&&towerInfos.length&&(p.push('<div class="tweet-preview-item tweet-preview-tower tower-trigger"><pre class="tweet-preview-tower-desc">',towerInfos[0].firstGentieInfo,'</pre><span class="tweet-preview-tower-tips">'),towerInfos[0].floorSize==1?p.push("刚打好地基[<em>点击参与</em>]"):p.push('还有<em class="js-tower-floorSize">',towerInfos[0].floorSize-1,"</em>条精彩盖楼内容[<em>点击展开</em>]"),p.push("</span></div>")),p.push("");if(typeof voteInfos!="undefined"&&voteInfos.length){p.push('<div class="vote-trigger tweet-preview-item '),voteInfos[0].isOld||p.push("tweet-preview-cover"),p.push('" data-url="',voteInfos[0].originalUrl,'">');if(voteInfos[0].isOld)p.push('<a href="javascript:;"><img src="http://img1.cache.netease.com/t/image/common/vote.jpg" /></a>');else{p.push('<div class="tweet-preview-cover-img">'),voteInfos[0].smallCover!=""?p.push('<img src="',voteInfos[0].smallCover,'"/>'):p.push('<img src="http://img1.cache.netease.com/t/image/common/vote.gif"/>'),p.push('<span></span><em>微投票</em></div><h3 class="tweet-preview-cover-title">',voteInfos[0].title,"</h3>");for(var i=0,l=voteInfos[0].options.length;i<l;i++)p.push(""),i<2&&p.push('<p class="tweet-preview-cover-desc"><span class="dot"></span>',voteInfos[0].options[i],"</p>"),p.push(""),l>2&&i==2&&p.push('<p class="tweet-preview-cover-desc">...</p>'),p.push("");p.push('<span class="btn-small btn-small-red">参与投票</span>')}p.push("</div>")}p.push(""),typeof ztInfos!="undefined"&&ztInfos.length&&ztInfos[0].topicType==1&&(p.push('<div class="tweet-preview-item tweet-preview-cover zt-trigger"><div class="tweet-preview-cover-img tweet-preview-zt-img">'),ztInfos[0].hasCover?p.push('<img src="',ztInfos[0].coverUrl,'"/><span></span><em>微专题</em>'):p.push('<img src="http://img2.cache.netease.com/t/image/active/zt-cover.jpg"/>'),p.push('</div><h3 class="tweet-preview-cover-title">',ztInfos[0].title,'</h3><p class="tweet-preview-cover-desc">',countZtInfosDesc,'</p><span class="btn-small btn-small-red">查看详情</span></div>')),p.push(""),typeof musicInfos!="undefined"&&musicInfos.length&&p.push('<div class="tweet-preview-item tweet-preview-music"><a class="music-trigger" href="javascript:;" data-index="0"><em class="icon-music-play"></em>',musicInfos[0].songName&&musicInfos[0].singer?musicInfos[0].songName+"-"+musicInfos[0].singer:"点击播放音乐","</a></div>"),p.push('</div><div class="tweet-media-detail js-detail"></div></div>')}p.push("")}return p.join("")}});define("_tmpl/tweet/widget/position",function(require){return function(tmplData){var p=[];with(tmplData){p.push("");if(position){p.push('<div class="tweet-poi link-lb js-poi"><span>');if(position.province||position.city)p.push('<a href="/city?s=',position.provinceCode,"&c=",position.cityCode,'" target="_blank"><em class="icon-lbs"></em><span>'),position.province&&p.push("",position.province,""),p.push(""),position.city&&p.push("",position.city,""),p.push("</span></a>&nbsp;");p.push(""),position.poi&&position.poi.name!=""&&p.push('<a href="/venue/',position.poi.id,'" target="_blank"><span>',position.poi.name,'</span></a>&nbsp;-&nbsp;<a class="map-trigger" href="javascript:;"><span>查看地图</span></a>'),p.push("</span></div>")}p.push("")}return p.join("")}});define("_tmpl/tweet/innerTweet",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div class="tweet-root js-tweet-root" data-tweet-id="',id,'" data-tweet-type="inner"><div class="tweet-hd">'),type!="delete"&&type!="hidden"&&p.push('<a class="tweet-time link-lb" data-method="checkDetail" href="/',user.screenName,"/status/",id,'" target="_blank"><em class="tweet-root-time cDGray">',prettyTime,'</em><em class="tweet-root-detail">进入详情页</em></a>'),p.push("",require("_tmpl/tweet/widget/tweetUserName")(tmplData),"</div>"),type!="hidden"||type=="hidden"&&user.isLoginUser?(p.push('<p class="tweet-message js-message">',richContent,""),isColumnRank&&p.push('<a href="/column" title="热门专栏" target="_blank" data-method="reColumn"><em class="icon-column-recommend"></em></a>'),p.push("</p>",require("_tmpl/tweet/widget/mediaBox")(tmplData),"")):p.push("",require("_tmpl/tweet/widget/hidden")(tmplData),""),p.push(""),type!="delete"&&(p.push("<div "),(type!="hidden"||type=="hidden"&&user.isLoginUser)&&p.push('class="tweet-ft js-foot"'),p.push(">",require("_tmpl/tweet/widget/source")(tmplData),""),type!="hidden"&&(p.push('<div class="tweet-option link-lb">'),isShowDigg&&p.push("",require("_tmpl/tweet/widget/digg")(tmplData),""),p.push('<a href="javascript:;" class="rootRetweet-trigger need-login">原文转发',require("_tmpl/tweet/widget/counter")({type:"retweet",count:retweetCount}),'</a><a href="javascript:;" class="rootReply-trigger need-login">原文评论',require("_tmpl/tweet/widget/counter")({type:"reply",count:replyCount}),"</a></div>")),p.push("</div>")),p.push("</div>");return p.join("")}});define("_tmpl/tweet/widget/hidden",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<p class="tweet-message">抱歉，此微博已设置为私密</p>');return p.join("")}});define("_tmpl/tweet/widget/source",function(require){return function(tmplData){var p=[];with(tmplData)p.push(""),type!=="hidden"?p.push('<div class="tweet-info text-la">来自',source,"</div>"):type=="hidden"&&user.isLoginUser&&p.push('<div class="tweet-info text-la">私密微博仅本人可见</div>'),p.push("");return p.join("")}});define("_tmpl/tweet/widget/digg",function(require){return function(tmplData){var p=[];with(tmplData)p.push(""),type!=="hidden"&&p.push('<span class="tweet-viewpoint',digged?" disabled":"",'"><a class="tweet-praise',digged?digged=="top"?" top-succeed":"":" digg-trigger",'" href="javascript:;" title="',digged?digged=="top"?"已顶":"":"顶并转发",'" data-type="top"><em class="icon-praise"></em><span class="tweet-viewpoint-count top-counter">',require("_tmpl/tweet/widget/counter")({type:"top",count:topPostCount}),'</span></a><a class="tweet-disdain',digged?digged=="down"?" down-succeed":"":" digg-trigger",'" href="javascript:;" title="',digged?digged=="down"?"已踩":"":"踩并转发",'" data-type="down"><em class="icon-disdain"></em><span class="tweet-viewpoint-count down-counter">',require("_tmpl/tweet/widget/counter")({type:"down",count:downPostCount}),"</span></a></span>"),p.push("");return p.join("")}});define("_tmpl/tweet/widget/counter",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<span class="',type,'-counter">'),count>0&&p.push("(",count,")"),p.push("</span>");return p.join("")}});define("tweet/status/Reply",function(a,b,c){var d={statusOnReply:function(a){this.sendBoxStatus.onReply.call(this,a)},statusOnTalkBoxClose:function(a){this.sendBoxStatus.onTalkBoxClose.call(this,a)},SendBoxStatusList:{replyOpen:{onReply:function(a){this.closeTalkBox("reply",a),this.sendBoxStatus=this.SendBoxStatusList.allClose},onTalkBoxClose:function(a){this.closeTalkBox("reply"),this.sendBoxStatus=this.SendBoxStatusList.allClose}},allClose:{onReply:function(a){this.openTalkBox("reply",a),this.sendBoxStatus=this.SendBoxStatusList.replyOpen},onTalkBoxClose:function(a){}}}};return d});define("tweet/TweetAction_Tower",function(a,b,c){var d=a("utils/jquery-wb"),e=a("utils/Utils"),f=a("sendBox/SendBoxFactory_Tower"),g=a("model/UserData"),h=a("model/QunData"),i={openTalkBox:function(a,b){var c=h.getQunInfo();if(!(g.getLoginUser()===null||a==="reply"&&c&&!c.isJoin)){this.floorIdx=b.data.floorIdx,this.initTalkBox(a),d(b.target).parents(".js-foot").after(this[a+"TalkBox"].render()),this[a+"TalkBox"].data=this.oneTowerdata.buildingContent[this.floorIdx];var e=d(b.target).addClass("currentActive"),f={replyTalkBox:"reply",retweetTalkBox:"RT"};this[a+"TalkBox"].$elem.attr("data-keyfrom",f[a+"TalkBox"]);var i=e.offset().left+4;this[a+"TalkBox"].setUpArrowPosition(i),this[a+"TalkBox"].$elem.find("textarea").focusToEnd(),this.$elem.trigger("open.TalkBox",[this,this[a+"TalkBox"],b||null])}},closeTalkBox:function(a,b){g.getLoginUser()!==null&&(this.initTalkBox(a),this[a+"TalkBox"].render().detach(),this.$elem.trigger("close.TalkBox",[this,this[a+"TalkBox"],b||null]))},initTalkBox:function(a,b,c){var d=c===undefined?a:c+a;if(this[a+"TalkBox"]===null){var e=this.oneTowerdata.buildingContent[this.floorIdx];this[a+"TalkBox"]=f.newInstance(d,e,b)}}};return i});define("sendBox/SendBoxFactory_Tower",function(a,b,c){var d=a("sendBox/talkBox/TowerReplyBox"),e={newInstance:function(a,b,c){switch(a){case"tower_reply":return new d(b,c);default:throw new Error("SendBoxFactory 错误，未指定需要创建的 SendBox 类型:"+a)}}};return e});define("sendBox/talkBox/TowerReplyBox",function(a,b,c){var d=a("external/jquery"),e=a("sendBox/talkBox/TalkBox"),f=a("sendBox/InputError"),g=a("sendBox/SendBoxAction"),h=e.extend({init:function(a,b){this._super(a,b),this.config.type="reply"},bindEvent:function(){this._super(),this.$elem.delegate(".tower-submit-trigger","click",d.proxy(this.onSubmit,this))},checkInput:function(){if(this.data.type=="reply"){var a=d.trim(this.$elem.find("textarea").val());if(a=="回复@"+this.data.user.nickName+"：")throw new f("再说点什么吧",!0)}g.checkInput.call(this)}});return h});define("_tmpl/tweet/tower/towerItem",function(require){return function(tmplData){var p=[];with(tmplData){p.push("");var expandTrigger=expandTrigger||null;p.push(""),expandTrigger==null?p.push('<div class="tower-con js-towerCon"><div class="tower-hd js-hd">',require("_tmpl/tweet/tower/towerUserName")({oneFloor:oneFloor,floorIdx:floorIdx,maxKey:maxKey,author:author}),"</div>",require("_tmpl/tweet/tower/towerContent")({oneFloor:oneFloor,config:config,floorIdx:floorIdx}),"</div>"):p.push('<p class="expand-content js-expandTrigger" title="点击展开">展开可查看更多盖楼内容<a class="link-la expand-tower">[点击展开]</a></p>'),p.push("</div>")}return p.join("")}});define("_tmpl/tweet/tower/towerUserName",function(require){return function(tmplData){var p=[];with(tmplData){p.push("");var needAuthor=author&&author==!0,user=oneFloor.user||{avatar:"http://timge1.126.net/image?w=48&h=48&url=http%3A%2F%2F126.fm%2F12RySS&gif=1&quality=85",nickName:"该用户不存在",screenName:"notfound"};p.push(""),(needAuthor||needAuthor&&maxKey==1)&&p.push('<span class="tweet-author"><a class="avatar js-float-intro" data-keyfrom="avatar" href="/',user.screenName,'" title="',user.nickName,'" data-user-nickname="',user.nickName,'"><img src="',user.avatar,'" /></a></span><div class="tweet-main">'),p.push(""),(oneFloor.type!=="delete"||oneFloor.type!=="delete"&&maxKey==1)&&p.push("",require("_tmpl/tweet/tower/nickName")({user:user}),""),p.push(""),floorIdx&&maxKey!=floorIdx&&p.push('<span class="tower-index">',floorIdx,"</span>"),p.push("")}return p.join("")}});define("_tmpl/tweet/tower/nickName",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<span class="nick-name-con js-nickName"><a class="link-la js-remark js-float-intro" data-keyfrom="nickName" href="/',user.screenName,'" data-user-nickname="',user.nickName,'">',user.isShowRemark&&user.remark?user.remark:user.nickName,"</a></span>");return p.join("")}});define("_tmpl/tweet/tower/towerContent",function(require){return function(tmplData){var p=[];with(tmplData){p.push("");var isLastFloor=isLastFloor||!1;p.push('<pre class="message js-message',oneFloor.type==="delete"||!oneFloor.user?" floor-delete":"","",isLastFloor?" last-floor js-lastFloor":"",'">');if(oneFloor.user!=null){p.push("");var richContent=oneFloor.buildingRichContent||oneFloor.richContent;p.push("")}else{p.push("");var richContent="该用户已被删除";p.push("")}p.push("",richContent,"</pre>");if(oneFloor.type!=="delete"&&oneFloor.user){p.push('<div class="tweet-ft js-foot clearfix"><div class="tweet-info text-la"><a target="_blank" href="/',oneFloor.user.screenName,"/status/",oneFloor.id,'" class="link-lb">',oneFloor.prettyTime,"</a>&nbsp;来自",oneFloor.source,'</div><div class="tweet-option link-lb">'),!oneFloor.user.isLoginUser&&config.canBeReported&&p.push('<a class="tweet-option-report tower-report-trigger need-login" title="举报这条微博" href="javascript:;" data-floor-idx="',floorIdx,'">举报</a>'),p.push("");var canBeDeleted=oneFloor.user.isLoginUser||config.canBeDeleted;p.push(""),canBeDeleted&&p.push('<a class="tweet-option-delete tower-delete-trigger need-login" title="删除这条微博" href="javascript:;" data-floor-idx="',floorIdx,'">删除</a>'),p.push('<a class="tower-reply-trigger need-login" title="回复这条微博" href="javascript:;" data-floor-idx="',floorIdx,'">回复</a></div></div>')}p.push("")}return p.join("")}});define("_tmpl/tweet/tower/towerWrap",function(require){return function(tmplData){var p=[];with(tmplData)p.push(""),floorIdx==maxKey&&p.push('<div class="tweet js-tweet clearfix" data-tweet-id="',oneFloor.butterId,'" data-tweet-type="',oneFloor.type,'">'),p.push("",require("_tmpl/tweet/tower/towerUserName")({oneFloor:oneFloor,author:author,floorIdx:floorIdx,maxKey:maxKey}),""),htmlStr&&p.push("",htmlStr,""),p.push("",require("_tmpl/tweet/tower/towerContent")({oneFloor:oneFloor,config:config,floorIdx:floorIdx,isLastFloor:!0}),""),floorIdx==maxKey&&p.push("</div></div>"),p.push("");return p.join("")}});define("tweet/list/basic/Timeline",function(a,b,c){var d=a("external/jquery"),e=a("widget/AutoPager"),f=a("widget/list/RenderableList"),g=a("model/TweetData"),h=a("utils/Utils"),i=d(document.body),j=f.extend({init:function(a,b){this._super(a,b),this.inited=!1,this.initPreviewPic=!1,this.config.asyncRequest=this.config.asyncRequest||!1,this.$empty=null,this.$pager=null,this.tweetList=[],this.$loading=d(h.LOADING_BIG.replace("$text$","加载中...")),this.$pagerContainer=d(this.config.pagerContainer),this.pagerBox='<div class="mainBox-page pages-big"></div>',this.pager=this.initPager()},initPager:function(){return new e(this.pagerBox,{buildUrl:d.proxy(this.buildUrl,this),buildParam:d.proxy(this.buildParam,this),onPage:d.proxy(this.onPage,this),autoMoreCount:this.config.autoMoreCount||undefined})},bindEvent:function(){this.$pagerContainer.bind("onPage",d.proxy(this.onPageStart,this)),this.$elem.bind("tweetDeleted",d.proxy(this.onDeleted,this)),d(document).bind("sent",d.proxy(this.onSent,this))},render:function(){throw new Error("Abstract method!")},newItem:function(a,b){throw new Error("Abstract method!")},onSent:function(a,b,c){},wrap:function(a){throw new Error("Abstract method!")},onPageStart:function(a,b,c){b===this.pager&&(this.pager.config.pageMethod==="page"?this.onClear():this.$elem.children().filter(".pageLine").removeClass("pageLine").end().last().addClass("pageLine"),d(document).trigger("setHeightNow"))},onHover:function(a,b){var c=d(b.currentTarget);b.type==="mouseenter"?c.addClass(a):c.removeClass(a)},onDeleted:function(a,b){d.inArray(b.data.id,this.tweetList)!==-1&&this.remove(b),a.stopPropagation()},updateNew:function(a){var b=this.pager.config;if(b.pageMethod==="more"||b.pageNo===1){var c=this.add(this.newItem(a));c.hide().prependTo(c.parent()).fadeIn("slow",function(){d.browser.msie&&this.style.removeAttribute("filter")}),this.hideEmpty(),i.trigger("preLoadImg")}},hide:function(){this.$elem.hide(),this.$pager&&this.$pager.hide()},show:function(){this.render(),this.$elem.show(),this.$pager.show()},buildUrl:function(a){throw new Error("Abstract method!")},buildParam:function(a){return{}},onPage:function(a){this.$loading.remove(),this.updateData(a),this.renderData(a),this.checkEmpty(),this.pager.$elem.show(),this.initPreviewPic?i.trigger("preLoadImg"):this.initPreviewPic=!0,d(document).trigger("setHeight")},updateData:function(a){a.refTweets&&d.each(a.refTweets,function(a,b){g.update(b)}),d.each(a.list,function(a,b){g.update(b)})},renderData:function(a){!this.inited&&!this.config.asyncRequest?(this.$elem.find(".js-tweet").each(d.proxy(function(a,b){var c=b.getAttribute("data-tweet-id"),d=this.newItem(c,b);this.tweetList.push(c),d.render()},this)),this.inited=!0):this.onFragment(a)},onFragment:function(a,b){var c=document.createDocumentFragment(),b=b?b:a.list;for(var d=0,e=b.length;d<e;d++){var f=this.add(this.newItem(b[d]),!0);c.appendChild(f[0])}this.$elem.get(0).appendChild(c),this.inited||(this.inited=!0)},add:function(a,b){this.tweetList.push(a.data.id);var c=a.render(),d=this.wrap(c);b||this.$elem.append(d);return d},remove:function(a){var b=d.inArray(a.data.id,this.tweetList);b!==-1&&this.tweetList.splice(b,1);return this._super(a)},checkEmpty:function(){var a=this.pager.config;a.pageMethod!=="more"&&a.pageNo!==1||this.$elem.children().size()!==0?this.hideEmpty():this.showEmpty()},showEmpty:function(){if(this.$empty===null){var b=a("widget/TipBox");this.$empty=(new b({content:"列表暂时没有内容，请多在微博玩玩吧"})).render()}this.$empty.appendTo(this.$elem)},hideEmpty:function(){this.$empty!==null&&(this.$empty.hide(),this.$empty=null)},unwrap:function(a){a.parent().remove()},onClear:function(){this.$loading.insertBefore(this.$elem),this.$elem.empty(),this.tweetList=[],this.pager.$elem.hide()},onRest:function(){this.pager.config.pageMethod!=="page"&&(this.onClear(),this.pager.config.pageToken=null,this.pager.config.autoMoreCount=2)}});return j});define("widget/AutoPager",function(a,b,c){var d=a("external/jquery"),e=a("widget/AjaxPager"),f=a("utils/Utils"),g=e.extend({init:function(a,b){this._super(a,b),this.timer=null,this.config.autoMoreCount=this.config.autoMoreCount||-1},bindEvent:function(){this._super(),d(window).bind("scroll.AutoPager resize.AutoPager",d.proxy(this.setTimeCheck,this))},setTimeCheck:function(){var a=this;clearTimeout(a.timer),a.timer=setTimeout(d.proxy(a.checkScroll,a),50)},checkScroll:function(){this.config.pageMethod==="more"&&d(window).scrollTop()+screen.availHeight>this.$elem.offset().top&&(this.config.autoMoreCount>=0?this.$elem.find(".js-btn").click():(d(window).unbind("scroll.AutoPager resize.AutoPager"),d(window).trigger("AutoPager.autoLoadFinish"))),f.mail.isMail&&this.config.pageMethod==="more"&&(d(window).unbind("scroll.AutoPager resize.AutoPager"),d(window).trigger("AutoPager.autoLoadFinish"))},onDataBack:function(a){this._super(a),this.config.autoMoreCount-=1}});return g});define("widget/AjaxPager",function(a,b,c){var d=a("external/jquery"),e=a("utils/DataSource"),f=a("widget/Pager"),g=a("model/UserData"),h=f.extend({init:function(a,b){this._super.apply(this,arguments),this.callback=this.config.onPage,this.request=null,this.pageCountLimit=this.config.pageCountLimit||undefined,this.$tip=d('<p class="cDGray tAr">网页篇幅所限，部分结果不能显示，抱歉！</p>')},requestPage:function(a){var b=this.config.buildUrl(a),c=this.config.buildParam(a);if(this.config.pageMethod==="more"){if(d.isPlainObject(this.request)&&this.request.readyState!==4)return;c.pageToken=this.config.pageToken}else c.pageNo=a;c.pageMethod=this.config.pageMethod,this.request=e.setKeyFrom(this.$elem).postJSON(b,c,d.proxy(this.onDataBack,this)),this.$elem.trigger("pager",[this])},onPage:function(a){if(g.getLoginUser()===null)d(document).trigger("error",["needLogin"]);else{this._super(a);var b=d(a.currentTarget).data("pageNo");this.requestPage(b),this.config.pageMethod==="page"?this.$elem.children().addClass("hidden"):this.$elem.children().addClass("btn-viewMore-loading")}},onDataBack:function(a){this.pageCountLimit!==undefined&&(a.page.pageCount=Math.min(this.pageCountLimit,a.page.pageCount)),a.page||(a.page={},a.page.pageCount=0,a.page.totalSize=0),this.update(a.page),this.render();if(this.pageCountLimit!==undefined){var b=Math.floor(this.config.totalSize/this.config.pageSize);b>this.config.pageCount&&a.page.pageNo==this.config.pageCount&&(this.$tip.insertBefore(this.$pageElem),this.$tip.removeClass("hidden"))}this.callback(a)},initData:function(){this.$elem.trigger("onPage",[this,1]),this.requestPage(1)}});return h});define("widget/TipBox",function(a,b,c){var d=a("external/jquery"),e=a("basic/oop/Class"),f=a("utils/tmpl"),g=e.extend({init:function(a,b){this.$elem=null,this.data=a,this.config=b},render:function(){if(this.$elem===null){var b=this.preRender();this.$elem=d(f.formatTemplate(a("_tmpl/tipBox"),d.extend(b,this.data))),this.bindEvent()}return this.$elem},preRender:function(){return{}},bindEvent:function(){}});return g});define("_tmpl/tipBox",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div class="tips-mess-box"><div class="js-text">',content,"</div></div>");return p.join("")}});define("_tmpl/tweet/list/talkBoxTweetList",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div class="tweet-talk-bd"><div class="tweet-talk-content"><ul class="tweet-talk-list js-tweetTalkList clearfix" data-tweet-id="',id,'" data-user-id="',user.id,'"></ul><div class="tweet-talk-ft"><div class="tweet-talk-page link-lb js-pages"></div><a href="" class="link-lb tweet-talk-link-all js-link-all fFS" data-method="readMore" target="_blank">查看全部&gt;&gt;</a></div></div></div><a class="tweet-talk-shrink close-trigger" href="javascript:;"><em class="icon-shrink"></em></a>');return p.join("")}});define("tweet/list/ReplyBoxTweetList",function(a,b,c){var d=a("external/jquery"),e=a("tweet/ReplyBoxTweet"),f=a("tweet/list/basic/TalkBoxTimeline"),g=f.extend({buildUrl:function(a){return"allReplies"},newItem:function(a){return new e(a)},onSent:function(a,b,c,f){if(b.type==="reply"&&b.relatedTweet.parent&&b.relatedTweet.parent.id===this.data.id){b.type="reply";var g=new e(b),h=this.add(g);h.hide().prependTo(h.parent()),this.hideEmpty(),h.fadeIn("slow",function(){d.browser.msie&&this.style.removeAttribute("filter")})}},onPage:function(a){this._super(a),a.page.pageCount>1&&this.$pagerContainer.siblings(".js-link-all").show().attr("href","/"+a.refTweets[0].user.screenName+"/status/"+a.refTweets[0].id+"/reply")}});return g});define("tweet/ReplyBoxTweet",function(a,b,c){var d=a("external/jquery"),e=a("tweet/TalkBoxTweet"),f=e.extend({bindEvent:function(){this._super(),this.$elem.delegate(".talkbox-reply-trigger","click",d.proxy(this.onReply,this))},onReply:function(a){this.$elem.trigger("replyTrigger",[this.data])}});return f});define("tweet/TalkBoxTweet",function(a,b,c){var d=a("external/jquery"),e=a("utils/tmpl"),f=a("tweet/Tweet"),g=a("tweet/action/DeleteAction"),h=f.extend({render:function(){this.$elem===null&&(this.$elem=d(e.formatTemplate(a("_tmpl/tweet/talkBoxTweet"),this.data)),this.bindEvent());return this.$elem},bindEvent:function(){this._super(),this.$elem.delegate(".talkbox-delete-trigger","click",d.proxy(this.onDelete,this))},onDelete:g.doAction});return h});define("_tmpl/tweet/talkBoxTweet",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div class="item" data-tweet-id="',id,'" data-tweet-type="talkBoxTweet"><span data-user-nickname="',user.nickName,'" class="link-la js-float-intro"><a class="js-remark" href="/',user.screenName,'">'),user.isShowRemark&&user.remark!=""?p.push("",user.remark,""):p.push("",user.nickName,""),p.push("</a>：</span>",richContent,'<span class="time">(',prettyTime,')</span><p class="tweet-talk-list-operate link-lb">'),(user.isLoginUser||type=="reply"&&relatedTweet.root.user.isLoginUser)&&p.push('<a class="tweet-option-delete talkbox-delete-trigger" href="javascript:;">删除</a>'),p.push(""),type!=="reply"?p.push('<a class="talkbox-retweet-trigger" href="javascript:;">转发</a>'):p.push('<a class="talkbox-reply-trigger" href="javascript:;">回复</a>'),p.push("</p></div>");return p.join("")}});define("tweet/list/basic/TalkBoxTimeline",function(a,b,c){var d=a("external/jquery"),e=a("utils/tmpl"),f=a("tweet/list/basic/Timeline"),g=f.extend({init:function(a,b){this._super.apply(this,arguments),this.$elem=null,this.data=a||{},this.$container=null,this.config.asyncRequest=!0,this.pager.$elem.attr("class","pages-small")},bindEvent:function(){this._super(),this.$elem.delegate("li","hover",function(a){var b=d(this).find(".talkbox-delete-trigger");a.type==="mouseenter"?b.show():b.hide()})},buildParam:function(a){return{screenName:this.data.user.screenName,butterId:this.data.id}},showEmpty:function(){this.$container.hide()},hideEmpty:function(){this.$container.show()},render:function(){this.$container===null&&(this.$container=d(e.formatTemplate(a("_tmpl/tweet/list/talkBoxTweetList"),this.data)),this.$elem=this.$container.find("ul"),this.bindEvent(),this.$pager=this.pager.render(),this.$pagerContainer=this.$container.find(".js-pages"),this.$pagerContainer.bind("onPage",d.proxy(this.onPageStart,this)),this.$pager.appendTo(this.$pagerContainer),this.pager.initData());return this.$container},wrap:function(a){return a.wrap("<li>").parent()}});return g});define("sendBox/talkBox/RetweetBox",function(a,b,c){var d=a("external/jquery"),e=a("sendBox/talkBox/TalkBox"),f=a("sendBox/SendBoxAction"),g=a("model/QunData"),h=e.extend({init:function(a,b){this._super(a,b),this.config.type=g.getQunInfo()?"qunRetweet":"retweet"},checkInput:f.checkRetweetInput});return h});define("sendBox/talkBox/RetweetListTalkBox",function(a,b,c){var d=a("external/jquery"),e=a("sendBox/talkBox/RetweetBox"),f=a("tweet/list/RetweetBoxTweetList"),g=e.extend({bindEvent:function(){this._super(),this.tweetList=new f(this.data),this.$tweetList=this.tweetList.render().appendTo(this.$elem),this.$tweetList.bind("retweetTrigger",d.proxy(this.onListRetweet,this))},onListRetweet:function(a,b){var c=" ||@"+b.user.nickName+"："+b.content;c.length>163&&(c=c.substr(0,163)),this.$elem.find("textarea").val(c).setCaretTo(0).keyup()}});return g});define("tweet/list/RetweetBoxTweetList",function(a,b,c){var d=a("external/jquery"),e=a("tweet/RetweetBoxTweet"),f=a("tweet/list/basic/TalkBoxTimeline"),g=f.extend({buildUrl:function(){return"allRetweets"},newItem:function(a){return new e(a)},onSent:function(a,b){if(b.type==="retweet"&&b.relatedTweet.parent&&b.relatedTweet.parent.id===this.data.id&&this.pager.config.pageNo===1){b.type="retweet";var c=new e(b),f=this.add(c),g=f.find(".js-tweet-tag");g.size()&&g.outerHTML(g.html()),f.hide().prependTo(f.parent()),this.hideEmpty(),f.fadeIn("slow",function(){d.browser.msie&&this.style.removeAttribute("filter")})}},onPage:function(a){this._super(a),a.page.pageCount>1&&this.$pagerContainer.siblings(".js-link-all").show().attr("href","/"+a.refTweets[0].user.screenName+"/status/"+a.refTweets[0].id+"/retweet")}});return g});define("tweet/RetweetBoxTweet",function(a,b,c){var d=a("external/jquery"),e=a("tweet/TalkBoxTweet"),f=e.extend({bindEvent:function(){this._super(),this.$elem.delegate(".talkbox-retweet-trigger","click",d.proxy(this.onRetweet,this))},onRetweet:function(a){this.$elem.trigger("retweetTrigger",[this.data])}});return f});define("tweet/action/DiggAction",function(a,b,c){var d=a("utils/jquery-wb"),e=a("utils/DataSource"),f=a("widget/tip/NaviTip"),g=a("utils/log/Logger"),h=a("sendBox/SendBoxAction"),i=a("model/TweetData"),j=a("model/UserData"),k={doAction:function(a){var b=d(a.currentTarget),c=b.data("type");b.parent().data("digged")||k.onDigg.call(this,b,c)},onDigg:function(a,b){if(!d.isPlainObject(this.diggRequest)||this.diggRequest.readyState===4){var c=j.getLoginUser(),f=this,h=b=="top",i=this.data,l=h?"[顶]":"[踩]",m=h?"digg":"dislike",n=h?"顶":"踩";if(c){var o={targetId:i.id,isRetweet:1,replyOriginal:0,replyIt:0,flag:1,targetUserId:i.user.id};h?o.isTopPost=1:o.isDownPost=1,i.type==="retweet"&&(l=l+" ||@"+i.user.nickName+"："+i.content,l.length>163&&(l=l.substr(0,163))),o.content=l,this.diggRequest=e.setKeyFrom(this.$elem).postJSON("sendTweet",o,function(c){k.updateStatus(i,b),k.onCallback.apply(f,[c,a,b,n])})}else{var p=h?0:1,q=i.relatedTweet.root,r=a.find("."+b+"-counter"),s=this.$elem.find("."+b+"-counter:first"),t=h?i.topPostCount:i.downPostCount,u=h?q&&q.topPostCount:q&&q.downPostCount,v=new Image;this.diggRequest=v.src="http://t.163.com/topdown?butterId="+i.id+"&type="+p,k.successBack.apply(f,[a,b,n]),r.html("("+(t+1)+")"),q&&s.html("("+(u+1)+")")}g.triggerLog(this.$elem,{method:m})}},onCallback:function(b,c,d,e){var g=this,i=h.parseResultInfo(b);if(i.isSuccess)k.successBack.apply(g,[c,d,e,b]);else{f.show({type:"error",text:i.tip});if(!i.tip){var j=a("widget/floatBox/VerifyBox"),l=j.getInstance();l.show(function(){g.diggRequest.resend()})}}},successBack:function(a,b,c,e){a.addClass("tweet-viewpoint-position");var g=this,h=d('<div class="tweet-viewpoint-animation">+1</div>'),i=j.getLoginUser(),l=i?c+"并转发成功":c+"成功";h.appendTo(a).animate({bottom:"20px",opacity:0},700,"linear",function(){d(this).remove(),a.removeClass("tweet-viewpoint-position"),i&&k.onNewTweet.apply(g,[e])}),a.addClass(b+"-succeed").parent().data("digged",!0).addClass("disabled").find(".digg-trigger").removeAttr("title"),a.attr("title","已"+c),f.show({type:"success",text:l})},updateStatus:function(a,b){a.digged=b,i.update(a)},onNewTweet:function(a){var b=i.get(i.update(a));this.$elem.trigger("sent",[b,this,0])}};return k});define("tweet/status/ReplyRetweet",function(a,b,c){var d={statusOnReply:function(a){this.sendBoxStatus.onReply.call(this,a)},statusOnRetweet:function(a){this.sendBoxStatus.onRetweet.call(this,a);var b=this.$elem.find(".js-talkBox textarea");b.size()>0&&b.setCaretTo(0)},statusOnTalkBoxClose:function(a){this.sendBoxStatus.onTalkBoxClose.call(this,a)},SendBoxStatusList:{replyOpen:{onReply:function(a){this.closeTalkBox("reply"),this.sendBoxStatus=this.SendBoxStatusList.allClose},onRetweet:function(a){this.closeTalkBox("reply"),this.openTalkBox("retweet",a),this.sendBoxStatus=this.SendBoxStatusList.retweetOpen},onTalkBoxClose:function(a){this.closeTalkBox("reply"),this.sendBoxStatus=this.SendBoxStatusList.allClose}},retweetOpen:{onReply:function(a){this.closeTalkBox("retweet"),this.openTalkBox("reply",a),this.sendBoxStatus=this.SendBoxStatusList.replyOpen},onRetweet:function(a){this.closeTalkBox("retweet"),this.sendBoxStatus=this.SendBoxStatusList.allClose},onTalkBoxClose:function(a){this.closeTalkBox("retweet"),this.sendBoxStatus=this.SendBoxStatusList.allClose}},allClose:{onReply:function(a){this.openTalkBox("reply",a),this.sendBoxStatus=this.SendBoxStatusList.replyOpen},onRetweet:function(a){this.openTalkBox("retweet",a),this.sendBoxStatus=this.SendBoxStatusList.retweetOpen},onTalkBoxClose:function(a){}}}};return d});define("tweet/widget/MediaBox",function(a,b,c){var d=a("utils/jquery-wb"),e=a("utils/tmpl"),f=a("utils/Utils"),g=a("utils/DataSource"),h=a("utils/log/Logger"),i=a("model/TweetData"),j=a("tweet/widget/VoteList"),k=a("tweet/widget/TowerList"),l=a("model/UserData"),m=a("tweet/widget/column/ReadColumn"),n=a("tweet/widget/pic/Pic"),o=d(document.body),p=a("basic/Observer"),q={NORMAL:0,RIGHT:1,TOP:2,LEFT:3},r=function(b,c){var e=a("utils/Utils").S4;this.$elem=d(b),this.config=c,this.$detailAreaElem=this.$elem.find(".js-detail"),this.MAX_ELEMENTS=3,this.expandType=this.$elem.data("expand")||!1,this.$loginUser=l.getLoginUser(),this.tweetId=this.getTweetId(),this.bindEvent()};o.hasClass("singleWrapper")?(r.videoWidth=580,r.videoHeight=495):(r.videoWidth=440,r.videoHeight=375),p.subscribe({eventName:"totalPageStart",func:function(){r.videoWidth=440,r.videoHeight=375}}),p.subscribe({eventName:"singlePageStart",func:function(){r.videoWidth=580,r.videoHeight=495}}),r.prototype={getTweetId:function(){var a=this.config.type==="normal"?".js-tweet":".js-tweet-root",b=this.$elem.parents(a).attr("data-tweet-id");return b},bindEvent:function(){var a=this.$elem.parent();this.$elem.delegate(".close-trigger","click",d.proxy(this.onClose,this)).delegate(".video-trigger","click",d.proxy(this.onVideo,this)).delegate(".music-trigger","click",d.proxy(this.onMusic,this)).delegate(".expand-trigger","click",d.proxy(this.onPrvExpand,this)).delegate(".vote-trigger","click",d.proxy(this.onVote,this)).delegate(".tower-trigger","click",d.proxy(this.onTower,this)),a.find(".pic-trigger").size()&&(this.Pic=new n(this)),a.delegate(".zt-trigger","click",d.proxy(this.onZt,this)).delegate(".js-message:first .js-columnTriger","click",d.proxy(this.onColumn,this)),o.bind("musicPlaying",d.proxy(this.onMediaClose,this)),this.expandType&&this.$elem.find("."+this.expandType+"-trigger").trigger("click")},setClass:function(a){a=a?" "+a:"",this.$elem.get(0).className="tweet-media js-media"+a,a&&d(document).trigger("setHeight")},getIndex:function(a,b){var c=a.siblings("."+b+"-trigger").andSelf();return c.index(a)||0},getMediaInfo:function(a){var b=this.$elem.parents(".js-tweet").attr("data-tweet-id"),c=i.get(b),a=a==="pic"?"imageList":a+"Infos";return this.config.type==="normal"?c[a]:c.relatedTweet.root[a]},onClose:function(){this.setClass(""),(this.isVideoOpen||this.isMusicOpen)&&this.$elem.trigger("close.MediaBox",[null,this]),this.isVideoOpen=!1,this.isMusicOpen=!1,this.isVoteOpen=!1,this.isTowerOpen=!1,this.isNewsPrvOpen=!1,this.isZtOpen=!1,this.currentVideoUrl=null,this.currentMusicUrl=null,this.Pic&&this.Pic.close(),this.$videoDetailElem&&this.$videoDetailElem.detach(),this.$musicDetailElem&&this.$musicDetailElem.detach(),this.$voteDetailElem&&this.$voteDetailElem.detach(),this.$towerDetailElem&&this.$elem.scrollToShow(250)&&this.$towerDetailElem.detach(),this.$newsDetailElem&&this.$elem.scrollToShow(50)&&this.$newsDetailElem.detach(),this.$ztDetailElem&&this.$ztDetailElem.detach(),o.unbind("vote.sucessCallBack"),o.unbind("tower.sucessCallBack"),o.unbind("tower.expand"),this.isColumnOpen=!1,this.currentColumnId=null,this.$columnDetailElem&&this.$columnDetailElem.detach()},onMediaClose:function(){(this.isVideoOpen||this.isMusicOpen)&&this.onClose()},onVideo:function(b){var c=d(b.target).parent(".video-trigger").andSelf(),e=this.getVideoInfo(c),f={wmode:"opaque",allowfullscreen:"true",flashvars:"playMovie=true&isAutoPlay=true&auto=1&autoPlay=true&adss=0"};if(this.isVideoOpen&&e.shortUrl===this.currentVideoUrl)this.onClose();else{this.$elem.trigger("open.MediaBox",[null,this]),o.trigger("musicPlaying"),this.onClose(),this.renderVideo(e),a("external/swfobject").embedSWF(this.flashUrl,this.videoId,r.videoWidth,r.videoHeight,"9.0.0","","",f);try{d.scrollTo(this.$elem.parents(".liItem").first().offset().top)}catch(g){}this.isVideoOpen=!0}},renderVideo:function(b){if(!this.$videoDetailElem){var c=f.S4;this.videoId=c()+c(),this.$videoDetailElem=d(e.formatTemplate(a("_tmpl/tweet/media/videoPlay"),{id:this.videoId}))}this.flashUrl=b.flashUrl,this.$videoDetailElem.find(".js-title").attr("href",b.shortUrl).html(f.countChars(b.title,30)),this.$videoDetailElem.appendTo(this.$detailAreaElem),this.setClass("tweet-view"),this.currentVideoUrl=b.shortUrl},getVideoInfo:function(a){var b=a.data("index");b==undefined&&(b=this.getIndex(a,"video"));return this.getMediaInfo("video")[b]},onMusic:function(a){var b=d(a.target).parent(".music-trigger").andSelf(),c=this.getMusicInfo(b);this.isMusicOpen&&c.shortUrl===this.currentMusicUrl?this.onClose():(this.$elem.trigger("open.MediaBox",[null,this]),o.trigger("musicPlaying"),this.onClose(),this.$elem.scrollToShow(33),this.renderMusic(c),this.isMusicOpen=!0)},renderMusic:function(b){if(!this.$musicDetailElem){var c=f.S4;this.musicId=c()+c(),this.$musicDetailElem=d(e.formatTemplate(a("_tmpl/tweet/media/musicPlay"),{id:this.musicId}))}if(b.source!=="xiami")this.fixedIdj(b.songUrl);else{this.musicSrc="http://img.xiami.com/widget/0_"+b.playKey+"_/singlePlayer.swf",this.$musicDetailElem.find(".js-title").attr("href",b.songUrl).html(f.countChars(b.songName,30));var g=b.photoUrl||"http://img3.cache.netease.com/t/image/common/music_cover.jpg";this.$musicDetailElem.find(".js-image").html('<img width="130" height="130" src="'+g+'" />').show(),this.$musicDetailElem.appendTo(this.$detailAreaElem),this.setClass("tweet-view"),this.currentMusicUrl=b.shortUrl;var h={wmode:"opaque",bgColor:"#F3F3F3",name:"tweetXmmp"};a("external/swfobject").embedSWF(this.musicSrc,this.musicId,"257","33","9.0.0","","",h)}},getMusicInfo:function(a){var b=a.data("index");b==undefined&&(b=this.getIndex(a,"music"));return this.getMediaInfo("music")[b]},fixedIdj:function(b){f.getScript("http://music.ph.126.net/ph.js",!0);var c={wmode:"opaque",allowfullscreen:"false",allowScriptAccess:"always"},d={musicUrl:b,autoPlay:!0};this.$musicDetailElem.find(".js-title").attr("href","http://idj.163.com/").attr("title","网易IDJ").html("网易idj"),this.$musicDetailElem.appendTo(this.$detailAreaElem).find(".js-image").hide(),this.setClass("tweet-view"),a("external/swfobject").embedSWF("http://static.t.126.net/frontend/flash/music/musicPlayer1.swf",this.musicId,239,21,"9.0.0","",d,c)},onVote:function(b){if(this.isVoteOpen)this.onClose();else{var c=d(b.currentTarget),f=this;this.voteUrl=c.attr("data-url"),this.setClass("tweet-view"),this.isVoteOpen=!0,this.$voteDetailElem=d(e.formatTemplate(a("_tmpl/tweet/media/voteDetail"))),this.$voteDetailElem.appendTo(this.$detailAreaElem),this.$voteContent=this.$voteDetailElem.find(".js-content"),this.$loginUser&&o.bind("vote.sucessCallBack",function(b,c){f.getVoteSuccess(c);var d=a("widget/tip/NaviTip");d.show({type:"success",text:"投票成功！"})}),g.setKeyFrom(c).postJSON("getVote",{voteUrl:this.voteUrl},d.proxy(this.getVoteSuccess,this)).error(d.proxy(this.getVoteFail,this))}},getVoteSuccess:function(a){this.$voteContent.removeClass("loading tweet-vote-show").find(".js-body").remove();var b=new j(a,{container:this.$voteContent,voteUrl:this.voteUrl,tweetId:this.tweetId});b.render()},getVoteFail:function(){this.$voteContent.addClass("loading").find(".js-loading").html('<em class="icon-forbidS"></em>打开失败，请稍后再试...')},onTower:function(b){if(this.isTowerOpen)this.onClose();else{var c=d(b.currentTarget),f=this;this.setClass("tweet-view"),this.isTowerOpen=!0,this.initTowerPublish=!1,this.$towerDetailElem=d(e.formatTemplate(a("_tmpl/tweet/media/tower/towerDetail"),{user:l.getLoginUser()})),this.$towerDetailElem.appendTo(this.$detailAreaElem),this.$towerContent=this.$towerDetailElem.find(".js-content"),this.$loginUser&&o.bind("tower.sucessCallBack",function(b,c){f.getTowerSuccess(c);var d=a("widget/tip/NaviTip");d.show({type:"success",text:"盖楼成功！"})}).bind("tower.expand",function(a,b){f.onTowerExpand(b)});var i={butterId:this.tweetId,pageMethod:"page",pageNo:1};g.postJSON("getTower",i,d.proxy(this.getTowerSuccess,this)).error(d.proxy(this.getTowerFail,this)),h.triggerLog(c,{method:"affixGet"})}},onTowerExpand:function(a){var b=a.callBack,c=this.getTowerList(a.json),d=c.render();c.pageNo=a.self.pageNo,c.allExpandTower=a.self.allExpandTower,b(d,a),this.$elem.find(".js-tower-floorSize").text(c.maxKey-1)},getTowerList:function(a){var b=new k(a,{tweetId:this.tweetId,container:this.$towerContent.find(".js-tower-container")});return b},getTowerSuccess:function(b){var c=this.getTowerList(b);this.$towerContent.removeClass("loading").find(".towerBox:first").remove(),c.render().prependTo(this.$towerContent.find(".js-tower-container")),this.$elem.find(".js-tower-floorSize").text(c.maxKey-1);if(!this.initTowerPublish){var e=a("sendBox/widget/tower/FloorCreateBox"),f=this.$towerContent.find(".js-publishBox");(new e(f,{gentieRootId:this.tweetId,target:this.$elem.find(".submit-trigger")})).render().bind("floor.sent",d.proxy(c.onFloorSent,c)),this.initTowerPublish=!0}},getTowerFail:function(){this.$towerContent.addClass("loading").find(".js-loading").html('<em class="icon-forbidS"></em>打开失败，请稍后再试...')},onNewsPrv:function(b){var c=d(b.target),f=this.getMediaInfo("link")[this.getIndex(c,"preview")];this.lastNewsUrl="",this.isNewsPrvOpen&&this.currentNewsUrl===f.shortUrl?this.onClose():!this.isNewsPrvOpen&&this.currentNewsUrl===f.shortUrl&&this.newsStatus?(this.isNewsPrvOpen=!0,this.$detailAreaElem.html(this.$newsDetailElem),this.setClass("tweet-view"),h.triggerLog(c,{method:"view_news"})):(this.currentNewsUrl=f.shortUrl,this.isNewsPrvOpen=!0,this.$newsDetailElem=d(e.formatTemplate(a("_tmpl/tweet/media/newsPrvDetail"),f)),this.$detailAreaElem.html(this.$newsDetailElem),this.setClass("tweet-view"),this.$ellipsisElem=this.$detailAreaElem.find(".js-ellipsis"),this.$expandTrigger=this.$detailAreaElem.find(".js-controlBar .expand-trigger"),this.$closeTrigger=this.$detailAreaElem.find(".js-controlBar .close-trigger"),g.setKeyFrom(c).postJSON("preview",{url:f.shortUrl},d.proxy(this.onPrvSuccess,this)).error(d.proxy(this.onPrvErr,this)),h.triggerLog(c,{method:"view_news"}))},onPrvSuccess:function(b){this.newsStatus=!0;var c=null;b.source==="neteasenews"?c="_网易新闻":b.source==="easyblog"?c="_网易博客":b.source==="easyread"&&(c="_网易阅读解析"),c&&this.$elem.find(".js-title").attr({title:b.title+c});var f=d("<div>"+b.content+"</div>"),g=this.cleanNewsTag(b,f);this.$newsBody=d(e.formatTemplate(a("_tmpl/tweet/media/newsBody"),{newsStatus:this.newsStatus,json:b})),this.$ellipsisElem.before(this.$newsBody),this.$newsMessage=this.$elem.find(".js-message").append(g),this.$detailAreaElem.find(".js-controlBar").removeClass("hidden");var h=g.find("*");h.size()>this.MAX_ELEMENTS+1?(g.find("*:lt("+this.MAX_ELEMENTS+")").show(),this.$ellipsisElem.removeClass("hidden"),this.$closeTrigger.hide()):(h.show(),this.$expandTrigger.hide()),this.$elem.find(".js-loadingBox").addClass("hidden")},onPrvErr:function(a){this.newsStatus=!1,this.$elem.find(".js-loadingBox").addClass("hidden").end().find(".js-newsFail").removeClass("hidden")},onPrvExpand:function(a){this.$newsMessage.find("*:gt("+this.MAX_ELEMENTS+")").show(),this.$ellipsisElem.addClass("hidden"),this.$closeTrigger.show(),this.$expandTrigger.hide(),this.showViewOriginal&&this.$detailAreaElem.find(".js-viewAll").removeClass("hidden")},cleanNewsTag:function(a,b){b.find("> *:empty").not("img, embed, br, object").remove(),b.find("embed").filter(function(){return d(this).attr("src").indexOf("bookview.swf")!=-1}).remove();if(a.source==="neteasenews"){var c=b.find("div").has("table");b.find("div").not(c).remove()}var e=b.find("> *").hide(),f=e.find("img").length>20?40:55;this.showViewOriginal=!1,e.size()>f&&(b.find("> *:gt("+f+")").remove(),this.showViewOriginal=!0),b.find("a").attr({target:"_blank","data-unlog":"true"});return b},onZt:function(b){if(this.isZtOpen)this.onClose();else{var c=a("sendBox/ZtPreviewBox"),g=this.getMediaInfo("zt")[0];g.desc==""?g.desc="大家正在热烈讨论，发表你的看法吧":g.desc=f.countChars(g.desc,164),g.hasCover||(g.coverUrl="http://img2.cache.netease.com/t/image/active/zt-cover.jpg"),this.isZtOpen=!0,this.setClass("tweet-view"),this.$ztDetailElem=d(e.formatTemplate(a("_tmpl/tweet/media/ztDetail"),g)).appendTo(this.$detailAreaElem);var i=this.$ztDetailElem.find(".js-publishBox"),j=new c(i,{ztId:this.tweetId,$close:this.$elem.find(".close-trigger")});j.render(),h.triggerLog(o,{method:"unfoldZT"}),o.trigger("tweet.foldSendBox")}},onColumn:function(b){if(!this.$loginUser)d(document).trigger("error",["needLogin"]);else{var c=d(b.currentTarget),f=c.attr("data-id");if(this.isColumnOpen&&f==this.currentColumnId)this.onClose();else{this.Pic&&this.Pic.close(),this.onMediaClose(),this.setClass("tweet-view"),this.currentColumnId=f,this.isColumnOpen=!0,this.$columnDetailElem&&this.$columnDetailElem.detach();var g=c.prev().text(),j=i.get(this.tweetId).user.screenName,k=this.config.type==="normal"?".js-tweet":".js-tweet-root";this.$columnDetailElem=d(e.formatTemplate(a("_tmpl/tweet/media/columnDetail"),{columnId:f,screenName:j,columnName:g})).appendTo(this.$detailAreaElem);var l=new m({columnId:f,tweetId:this.tweetId,columnDetailElem:this.$columnDetailElem,isFormFeed:this.$elem.parents(k).hasClass("feed-tweet")});h.triggerLog(c,{method:"columnRead"})}}}};return r});define("tweet/widget/VoteList",function(a,b,c){var d=a("external/jquery"),e=a("basic/oop/Class"),f=a("model/UserData"),g=a("utils/tmpl"),h=d(document.body),i=e.extend({init:function(a,b){this.config=b||{},this.$elem=null,this.data=a,this.selectArr=[],this.totalOption=[]},render:function(){this.$elem===null&&(this.$elem=d(g.formatTemplate(a("_tmpl/tweet/media/voteContent"),d.extend({config:this.config},this.data))).appendTo(this.config.container),this.bindEvent());return this.$elem},bindEvent:function(){if(this.data.status=="canVote"||this.data.status=="logout")this.$elem.delegate(".js-item","click",d.proxy(this.onOption,this)).delegate(".js-item","hover",function(){d(this).toggleClass("hover")}),this.getTotalOption();else{h.unbind("vote.sucessCallBack");var a=this;d.each(this.$elem.find(".js-bg"),function(){d(this).animate({width:d(this).attr("data-percent")},1e3)}),setTimeout(function(){a.$elem.find(".js-vote-guess").show(500)},1e3)}},getTotalOption:function(){var a=this;d.each(this.data.options,function(b,c){var d="“"+c.content+"”";a.totalOption.push(d)})},onOption:function(a){if(f.getLoginUser()==null)d(document).trigger("error",["needLogin"]);else{var b=d(a.currentTarget);$list=b.parent(),$btn=this.$elem.find(".submit-trigger"),$list.find(".js-item").removeClass("hover"),b.addClass("hover"),$btn.addClass("disabled"),this.$elem.parent().addClass("tweet-vote-show"),this.showSendBox(),this.onRadio(a),this.onCheckBox(a)}},showSendBox:function(){if(!this.initVotePublish){var b=a("sendBox/VoteSendBox"),c=this.$elem.find(".js-publishBox");(new b(c,{voteUrl:this.config.voteUrl,tweetId:this.config.tweetId,$container:this.$elem,target:this.$elem.find(".submit-trigger")})).render(),this.initVotePublish=!0,h.trigger("tweet.foldSendBox")}},onRadio:function(a){var b=d(a.currentTarget),c=b.parent(),e=c.find("input[type=radio]"),f=this.$elem.find(".submit-trigger");if(!!e.size()){var g=b.data("index"),h=c.find(".js-left:eq("+g+")").text();e.eq(g).attr("checked","checked"),this.$elem.find("textarea").trigger("inputOptions",["radio","投票给“"+h+"”"]),f.removeClass("disabled")}},onCheckBox:function(a){var b=d(a.currentTarget),c=b.parent(),e=c.find("input[type=checkbox]"),f=this.$elem.find(".submit-trigger");if(!!e.size()){var g="",h=b.data("index"),i=e.eq(h),j="“"+i.parent().text()+"”";d(a.target).is("input")||(i.prop("checked")?i.removeAttr("checked"):i.attr("checked","checked")),i.prop("checked")?this.selectArr.push(j):this.selectArr.splice(d.inArray(j,this.selectArr),1);var k=this.selectArr,l=this.selectArr.length;l>7&&(g="等"+l+"个选项",k=k.slice(0,7));var m=l?"投票给"+k.join("、")+g:"";this.$elem.find("textarea").trigger("inputOptions",["checkbox",m,k,this.selectArr,this.totalOption]),e.each(function(){if(d(this).prop("checked")){f.removeClass("disabled");return!1}})}}});return i});define("_tmpl/tweet/media/voteContent",function(require){return function(tmplData){var p=[];with(tmplData){p.push("");var voteTip="投票已结束",btnText="已结束",iconClass="icon-inquireS";status=="voted"?(voteTip="已参加",btnText="已投票",iconClass="icon-correctS"):status=="logout"&&(voteTip='登录后才能投票，<a href="javascript:;" class="link-la need-login">点此登录</a>',btnText="投票"),isCreator=="true"?status=="canVote"&&(voteTip="我发起的投票",btnText="投票",iconClass="icon-correctS"):status=="canVote"&&(voteTip="投票后看结果",btnText="投票"),p.push('<div class="tweet-vote-body js-body"><h2 class="tweet-vote-title">',title,"</h2>"),cover!==""&&p.push('<p class="tweet-vote-img"><img src="',cover,'"/></p>'),p.push(""),desc!==""&&p.push('<p class="tweet-vote-summary">',desc,"</p>"),p.push('<div class="tweet-vote-result clearfix"><span class="tweet-vote-result-left"><em class="',iconClass,'"></em>',voteTip,"</span>"),status!="logout"&&(p.push('<span class="tweet-vote-result-right">'),endTime!=="-1"&&p.push("",endTime,"结束&nbsp;&nbsp;"),p.push("已有<em>",voteNumber,"</em>人参与</span>")),p.push('</div><div class="tweet-vote-list"><ul class="tweet-vote-list">');for(var i=0,l=options.length;i<l;i++){var index=i%5+1,select=options[i].select=="true"?" hover":"",pointer=status=="canVote"?" li-pointer":"";p.push('<li data-index="',i,'" class="js-item',select,"",pointer,'" ><div class="tweet-vote-item"><div class="left js-left"><input class="',status=="end"?"hidden":"",'" data-id="',options[i].id,'" type="',parseInt(voteType)==0?"radio":"checkbox",'"',options[i].select=="true"?'checked="checked"':"","",status=="canVote"||status=="logout"?"":'disabled=""','name="vote-option"/>',options[i].content,"</div>"),(status=="voted"||status=="end")&&p.push('<div class="right"><span><em class="js-bg vote-bg-',index!=10?"0"+index:index,'" data-percent="',options[i].percent,'"></em></span>',options[i].voteNumber,"(",options[i].percent,")</div></div>"),p.push("</li>")}p.push("</ul></div>"),status=="canVote"&&p.push('<div class="tweet-talk js-publishBox"><div class="tweet-publishBox-textareaBox"><textarea class="tweet-publishBox-textarea"></textarea></div><div class="tweet-publishBox-ft js-publishBoxFt"><div class="clearfix"><div class="tweet-publishBox-operate"><div class="tweet-publishBox-btn"><a href="javascript:;" class="submit-trigger">投票</a></div><span class="tweet-publishBox-tip js-wordCounter">还可以输<span class="char-constantia">163</span>字</span><div class="tweet-publishBox-insert"><div class="insert-list"><a href="javascript:;" title="@Ta的昵称或备注可以提到Ta" class="insert-at at-trigger"><em class="icon-at"></em></a><a href="javascript:;" title="表情" class="insert-face face-trigger"><em class="icon-face"></em></a></div></div></div><span class="fl"><label class="label-tag"><input type="checkbox" checked="checked" name="isRetweet">同时转发到我的微博</label></span></div></div></div>'),p.push('<div class="tweet-vote-foot"><a class="btn-small need-login btn-small-disabled" href="javascript:;">',btnText,"</a>");if((status=="voted"||status=="end")&&voteTop.length){p.push('<div class="tweet-vote-guess js-vote-guess"><h3>你可能感兴趣的投票：</h3>');for(var j=0,l=voteTop.length;j<l;j++)p.push('<p><em class="icon-vote"></em><a class="link-la" href="/',voteTop[j].screenName,"/status/",voteTop[j].id,'" target="_blank">',voteTop[j].title,'</a><span class="tweet-vote-guess-num">（',voteTop[j].number,"人参与）</span></p>");p.push("</div>")}p.push("</div></div>")}return p.join("")}});define("sendBox/VoteSendBox",function(a,b,c){var d=a("external/jquery"),e=a("sendBox/widget/AtInput"),f=a("sendBox/BasicSendBox"),g=a("sendBox/SendBoxAction"),h=a("model/UserData"),i=a("utils/DataSource"),j=a("utils/log/Logger"),k=f.extend({bindEvent:function(){if(h.getLoginUser()!=null){this._super(),this.isHandInput=!1;var a=this;this.$textareaElem.bind("inputOptions",function(b,c,e,f,g,h){var i=d(this),j=d.trim(i.val());a.textarea.onBlur(b),a.wordCounter.onValueChange(b),j==""&&(a.isHandInput=!1),c=="radio"?i.val(e).focusToEnd():a.isHandInput?a.onInputOptions(f,g,h):i.val(e).focusToEnd()}),this.atInput=e.getInstance(),this.atInput.bind(this.$elem.find(".at-trigger"),this.textarea)}},onInputOptions:function(a,b,c){var e=this,f=/“[\s\S]+?”/g,g=/等\d+个选项/g,h=/投票给/g,i=d.trim(this.$textareaElem.val()),j=b.length,k="等"+j+"个选项",l=i.match(f)==null?[]:i.match(f);d.each(l,function(a,b){d.inArray(b,c)===-1&&b&&l.splice(d.inArray(b,l),1)}),j<8&&d.each(a,function(a,b){if(d.inArray(b,l)===-1){var c=d.trim(e.$textareaElem.val()),f=c.charAt(c.length-1),g=b;f=="”"&&(g="、"+b),c.indexOf("投票给")==-1&&(g="投票给"+b),e.textarea.appendTextToEnd(g)}}),d.each(l,function(b,c){if(d.inArray(c,a)===-1){var f=d.trim(e.$textareaElem.val()),b=f.indexOf(c),g=b+c.length,i=f.substring(0,b),k=f.substr(g),l=c;j==0&&(f=f.replace(h,"")),k.charAt(0)=="、"&&(l=c+"、"),i.charAt(i.length-1)=="、"&&k.length==0&&(l="、"+c),f=f.replace(l,""),e.$textareaElem.val(f).focusToEnd()}});var i=d.trim(this.$textareaElem.val()),m=i.match(g);j<8?(m!==null&&(i=i.replace(g,"")),this.$textareaElem.val(i).focusToEnd()):m==null?this.textarea.appendTextToEnd(k):(i=i.replace(g,k),this.$textareaElem.val(i).focusToEnd())},checkInput:g.checkRetweetInput,onCheckInput:function(){this._super(),this.isHandInput=!0},doSubmit:function(){var a=this.config.target,b=[],c=this.config.$container.find(".js-item").has("input:checked");for(var e=0;e<c.size();e++)b.push(c.eq(e).find("input").attr("data-id"));if(b.length!=0){var f=this.$elem.find("[name=isRetweet]").prop("checked")?1:0;f&&d(document).trigger("clearBadgeCache");var g={voteTarget:this.config.voteUrl,optId:b,content:d.trim(this.$textareaElem.val()),targetId:this.config.tweetId,isRetweet:f,flag:1,replyIt:0,replyOriginal:0};i.setKeyFrom(a).postJSON("vote",g,d.proxy(this.getVoteSuccess,this)),j.triggerLog(a,{method:"vote"})}},getVoteSuccess:function(a){d(document.body).trigger("vote.sucessCallBack",[a])},getParams:function(){},onSubmitError:function(a){this._super(a),this.blink()},onSuccess:function(){this.textarea.clear(),this.onBadgeTips(4),this.tip.show({type:"success",text:this.badgeNavTips!==null?this.badgeNavTips:"发布成功！"})}});return k});define("tweet/widget/TowerList",function(a,b,c){var d=a("external/jquery"),e=a("basic/oop/Class"),f=a("model/UserData"),g=a("utils/tmpl"),h=a("utils/DataSource"),i=a("utils/Utils"),j=a("tweet/action/TowerDiggAction"),k=d(document.body),l=e.extend({init:function(a,b){this.data=a,this.config=b||{},this.$elem=null,this.pageNo=1,this.allExpandTower={towerList:[{}]},this.oneTowerdata=a.towerList[0],this.maxFloorData=null,this.htmlStr="",this.$container=this.config.container},render:function(){if(this.$elem===null){var a=d.extend({},this.oneTowerdata);this.maxKey=i.getSortedKey(a.buildingContent,"b2s")[0],this.maxFloorData=[this.maxKey,a.buildingContent[i.getSortedKey(a.buildingContent,"b2s")[0]]],a=null;var b=this.newTowerItem(this.oneTowerdata);this.$elem=d(b),this.bindEvent()}return this.$elem},bindEvent:function(){this.$container.undelegate().delegate(".js-expandTrigger","click",d.proxy(this.onExpandTower,this)).delegate(".tower-digg-trigger","click",d.proxy(this.onTowerDigg,this)).delegate(".tower-reply-trigger","click",d.proxy(this.onReply,this))},newTowerItem:function(a){var b=this.towerStr(a,"","",1);return b},isLogin:function(){if(!f.getLoginUser()){d(document).trigger("error",["needLogin"]);return!1}return!0},towerStr:function(b,c,d,e){var d=c,e=e;if(b.fold){var f=i.getSortedKey(b.buildingContent,"s2b")[0],h=i.getSortedKey(b.buildingContent,"b2s")[0];for(var j=f;j<=6;j++)d=this.htmlStr,j!=6?this.htmlStr='<div class="towerBox">'+d+g.formatTemplate(a("_tmpl/tweet/media/tower/towerItem"),{oneFloor:b.buildingContent[j],maxKey:this.maxKey,floorIdx:j}):this.htmlStr='<div class="towerBox"><div class="towerBox">'+d+g.formatTemplate(a("_tmpl/tweet/media/tower/towerItem"),{oneFloor:b.buildingContent[6],maxKey:this.maxKey,floorIdx:6})+g.formatTemplate(a("_tmpl/tweet/media/tower/towerItem"),{expandTrigger:!0});for(var j=h-4;j<=h;j++)d=this.htmlStr,this.htmlStr='<div class="towerBox">'+d+g.formatTemplate(a("_tmpl/tweet/media/tower/towerItem"),{oneFloor:b.buildingContent[j],maxKey:this.maxKey,floorIdx:j})}else e<=8&&e!==b.floorSize?(d=this.htmlStr,this.htmlStr='<div class="towerBox">'+d+g.formatTemplate(a("_tmpl/tweet/media/tower/towerItem"),{oneFloor:b.buildingContent[e],maxKey:this.maxKey,floorIdx:e}),e+=1,b.buildingContent[e]&&this.towerStr(b,this.htmlStr,d,e)):e>8&&e<=b.floorSize-8&&e!==b.floorSize?(this.htmlStr=this.htmlStr+'<div class="towerBox mid-towerBox">'+g.formatTemplate(a("_tmpl/tweet/media/tower/towerItem"),{oneFloor:b.buildingContent[e],maxKey:this.maxKey,floorIdx:e}),e+=1,b.buildingContent[e]&&this.towerStr(b,this.htmlStr,d,e)):e>b.floorSize-8&&(d=this.htmlStr,this.htmlStr='<div class="towerBox">'+d+g.formatTemplate(a("_tmpl/tweet/media/tower/towerItem"),{oneFloor:b.buildingContent[e],maxKey:this.maxKey,floorIdx:e}),e+=1,b.buildingContent[e]&&this.towerStr(b,this.htmlStr,d,e));return this.htmlStr},onExpandTower:function(a){if(!!this.isLogin()){var b=this,c=d(a.currentTarget),e=c.attr("data-page-no")||1,f={butterId:this.config.tweetId,pageMethod:"page",pageNo:e,leafId:this.oneTowerdata.leafButterId};this.$expandTrigger=c,h.setKeyFrom(c).postJSON("towerExpand",f,function(a){a.towerList[0].floorSize=i.getSortedKey(a.towerList[0].buildingContent,"b2s")[0],a.towerList[0].leafButterId=b.oneTowerdata.leafButterId,b.allExpandTower.page?d.extend(!0,b.allExpandTower.towerList[0],a.towerList[0]):(b.allExpandTower.page=a.page,b.allExpandTower.towerList[0]=a.towerList[0]),b.allExpandTower.towerList[0].buildingContent[b.maxFloorData[0]]=b.maxFloorData[1];var e=i.getSortedKey(b.allExpandTower.towerList[0].buildingContent,"b2s"),f=e[0]==e[1]+1?{floorSize:e[0]}:{floorSize:e[1]+1};b.allExpandTower.towerList[0].floorSize=f.floorSize,b.$elem.trigger("tower.expand",[{json:b.allExpandTower,callBack:d.proxy(b.callBack,b),self:b,target:c}])})}},callBack:function(a,b){this.$container.find(".towerBox:first").replaceWith(a),this.$elem=d(a);var c=b.target.data("pageNo")||1;c!==b.json.page.pageCount&&this.$elem.wrap('<div class="towerBox"></div>').parent(".towerBox").append(this.$expandTrigger),c=c<b.json.page.pageCount?c+1:b.json.page.pageCount,this.$expandTrigger.attr("data-page-no",c)},onFloorSent:function(a,b){this.maxKey=this.maxKey+1,b.user=f.get(b.user),this.oneTowerdata.buildingContent[this.maxKey]=b,this.oneTowerdata.floorSize=this.maxKey,d.extend(!0,this.data.towerList[0],this.oneTowerdata),k.trigger("tower.sucessCallBack",[this.data])},onTowerDigg:j.doAction,onReply:function(a){if(!!this.isLogin()){var b=d(a.currentTarget),c=b.data("floorIdx"),e=this.oneTowerdata.buildingContent[c],f=e.user.nickName,g=this.$container.find("textarea"),h=g.val();g.val(h+"回复"+c+"楼"+"@"+f+" ").setCaretTo(g.val().length).keyup(),i.scrollTo(i.getXY(g[0]).top-250)}}});return l});define("tweet/action/TowerDiggAction",function(a,b,c){var d=a("utils/jquery-wb"),e=a("utils/DataSource"),f=a("widget/tip/NaviTip"),g=a("utils/log/Logger"),h=a("model/UserData"),i={doAction:function(a){var b=d(a.currentTarget),c=b.data("type");b.parent().data("digged")||i.onDigg.call(this,b,c)},onDigg:function(a,b){if(!d.isPlainObject(this.diggRequest)||this.diggRequest.readyState===4){var c=h.getLoginUser(),f=this,j=b=="top",k=j?"digg":"dislike",l=j?"顶":"踩",m=a.data("floorIdx");oneFloor=this.oneTowerdata.buildingContent[m],count=j?oneFloor.topPostCount:oneFloor.downPostCount;if(c){var n={gentieId:oneFloor.id,targetId:this.config.tweetId,nickName:oneFloor.user.nickName,floorIdx:m,type:b,flag:1};this.diggRequest=e.postJSON("towerdigg",n,function(c){i.onCallback.apply(f,[c,a,b,l,count])})}else{var o=j?2:3,p=new Image;this.diggRequest=p.src="http://t.163.com/topdown?butterId="+oneFloor.id+"&type="+o,i.successBack.apply(f,[a,b,l,count])}g.triggerLog(this.$elem,{method:k})}},onCallback:function(b,c,d,e,f){if(b.status==0)i.successBack.apply(g,[c,d,e,f]);else if(b.status==1)i.onErrorTip("顶踩失败");else if(b.status==2){var g=this,h=a("widget/floatBox/VerifyBox"),j=h.getInstance(null,{reqUrl:"verifyGentie",reqCode:"getGentieVerifyCode"});j.show(function(){g.diggRequest.resend()})}},successBack:function(a,b,c,e){a.addClass("tweet-viewpoint-position");var g=d('<div class="tweet-viewpoint-animation">+1</div>'),i=h.getLoginUser(),j=i?c+"并转发成功":c+"成功";g.appendTo(a).animate({bottom:"20px",opacity:0},700,"linear",function(){d(this).remove(),a.removeClass("tweet-viewpoint-position")}),a.addClass(b+"-succeed").parent().data("digged",!0).addClass("disabled").find(".tower-digg-trigger").removeAttr("title"),a.attr("title","已"+c),f.show({type:"success",text:j});var k=a.find("."+b+"-counter");k.html("("+(e+1)+")")},onErrorTip:function(a){f.show({type:"error",text:a})}};return i});define("_tmpl/tweet/media/tower/towerItem",function(require){return function(tmplData){var p=[];with(tmplData){p.push("");var expandTrigger=expandTrigger||null;p.push(""),expandTrigger==null?p.push('<div class="tower-con js-towerCon"><div class="tower-hd js-hd">',require("_tmpl/tweet/media/tower/towerUserName")({oneFloor:oneFloor,floorIdx:floorIdx,maxKey:maxKey}),"</div>",require("_tmpl/tweet/media/tower/towerContent")({oneFloor:oneFloor,floorIdx:floorIdx}),"</div>"):p.push('<p class="expand-content js-expandTrigger" title="点击展开">展开可查看更多盖楼内容<a class="link-la expand-tower">[点击展开]</a></p>'),p.push("</div>")}return p.join("")}});define("_tmpl/tweet/media/tower/towerUserName",function(require){return function(tmplData){var p=[];with(tmplData){p.push("");var user=oneFloor.user||{avatar:"http://timge1.126.net/image?w=48&h=48&url=http%3A%2F%2F126.fm%2F12RySS&gif=1&quality=85",nickName:"该用户不存在",screenName:"notfound"};p.push(""),(oneFloor.type!=="delete"||oneFloor.type!=="delete"&&maxKey==1)&&p.push("",require("_tmpl/tweet/tower/nickName")({user:user}),""),p.push(""),floorIdx&&p.push('<span class="tower-index">',floorIdx,"</span>"),p.push("")}return p.join("")}});define("_tmpl/tweet/media/tower/towerContent",function(require){return function(tmplData){var p=[];with(tmplData){p.push('<pre class="message js-message',oneFloor.type==="delete"||!oneFloor.user?" floor-delete":"",'">');if(oneFloor.user!=null){p.push("");var richContent=oneFloor.buildingRichContent||oneFloor.richContent;p.push("")}else{p.push("");var richContent="该用户已被删除";p.push("")}p.push("",richContent,"</pre>"),oneFloor.type!=="delete"&&p.push('<div class="tweet-ft tweet-ft-show"><div class="tweet-option link-lb"><span class="tweet-viewpoint"><a class="tweet-praise tower-digg-trigger" href="javascript:;" title="顶并转发" data-type="top" data-floor-idx="',floorIdx,'"><em class="icon-praise"></em><span class="tweet-viewpoint-count top-counter">',require("_tmpl/tweet/widget/counter")({type:"top",count:oneFloor.topPostCount}),'</span></a><a class="tweet-disdain tower-digg-trigger" href="javascript:;" title="踩并转发" data-type="down" data-floor-idx="',floorIdx,'"><em class="icon-disdain"></em><span class="tweet-viewpoint-count down-counter">',require("_tmpl/tweet/widget/counter")({type:"down",count:oneFloor.downPostCount}),'</span></a></span><a class="tower-reply-trigger" href="javascript:;" title="回复这条盖楼" data-floor-idx="',floorIdx,'">回复</a></div></div>'),p.push("")}return p.join("")}});define("tweet/widget/column/ReadColumn",function(a,b,c){var d=a("external/jquery"),e=a("basic/oop/Class"),f=a("tweet/widget/column/ColumnTweet"),g=a("utils/DataSource"),h=a("utils/tmpl"),i=a("model/TweetData");g.requestMap.quickColumnTimeline={url:"/tweet.do?action=quickColumnTimeline",login:!1};var j={},k=e.extend({init:function(a){this.config=a||{},this.$elem=this.config.columnDetailElem,this.getInfo(this.config.columnId,this.config.tweetId)},bindEvent:function(){this.$elem.delegate(".js-mask","hover",d.proxy(this.onMaskHover,this))},onMaskHover:function(a){var b=d(a.target);a.type==="mouseenter"?(b.css({opacity:0}),d.browser.msie&&d.browser.version>7&&b.find("em").css({opacity:0})):(b.css({opacity:.3}),d.browser.msie&&d.browser.version>7&&b.find("em").css({opacity:1}))},getInfo:function(a,b){var c=this;j[a]?this.render(j[a]):g.postJSON("quickColumnTimeline",{columnId:a},function(b){for(var d=0;d<b.tweets.length;d++)i.update(b.tweets[d]),b.tweets[d].digged=!1,b.imageWidth=c.config.isFormFeed?356:420;j[a]=b,c.render(j[a])})},render:function(b){var c=d(h.formatTemplate(a("_tmpl/tweet/media/columnContent"),b)),e=this;c.find(".js-tweet").each(function(a,b){var c=d(b),f=c.attr("data-tweet-id"),g=e.newItem(f,b);g.render()}),setTimeout(function(){e.$elem.find(".js-body").html(c),e.bindEvent()},100)},newItem:function(a,b){var c={html:b};return new f(a,c)}});return k});define("tweet/widget/column/ColumnTweet",function(a,b,c){var d=a("external/jquery"),e=a("tweet/action/DiggAction"),f=a("utils/log/Logger"),g=a("tweet/widget/pic/Pic"),h=a("utils/tmpl"),i=a("tweet/Tweet"),j=a("tweet/TweetAction"),k=a("model/TweetData"),l=420,m=130,n=i.extend({bindEvent:function(){this._super(),this.onPicMask(),this.onPic(),this.$elem.delegate(".digg-trigger","click",d.proxy(this.onDigg,this)),k.bindUpdate(this.data.id,d.proxy(this.update,this))},render:function(){this.$elem===null&&(this.config.html&&(this.$elem=d(this.config.html),delete this.config.html),this.bindEvent());return this.$elem},onDigg:function(a){a.stopPropagation(),e.doAction.call(this,a)},update:function(){j.update.apply(this),this.$elem.find(".js-diggBox").html(h.formatTemplate(a("_tmpl/tweet/widget/digg"),this.data))},onPicMask:function(){var a=this.$elem.find(".pic-trigger"),b=this.$elem.find(".js-preview-img");b.size()&&b.bind("load",function(){var b=new Image,c=d('<div class="tweet-column-img-mask js-mask"><em class="icon-zoom-large"></em></div>');b.src=d(this).attr("src");var e=b.width>l?l:b.width,f=b.height>m?m:b.height;a.css({height:f}),c.css({width:e,height:f}).appendTo(a)}).bind("error",function(){d(this).parent().detach()})},onPic:function(){var a=this.$elem.find(".js-media");a.size()&&(this.Pic=new g({$elem:this.$elem,config:{type:"normal"},tweetId:this.data.id},!0),this.$elem.delegate(".pic-trigger","click",d.proxy(this.onPicLog,this)).delegate(".columnMedia-rotate-trigger","click",d.proxy(this.Pic.onRotate,this.Pic)).delegate(".columnMedia-close-trigger","click",d.proxy(this.onPicClose,this)))},onPicClose:function(){this.$elem.removeClass("tweet-view"),this.Pic&&this.Pic.close()},onPicLog:function(a){var b=d(a.currentTarget);f.triggerLog(b,{method:"columnPic"})}});return n});define("tweet/widget/pic/Pic",function(a,b,c){function l(a,b){this.whirl=0,this.type=a.config.type||"normal",this.columnTweetId=b?a.tweetId:null,this.isColumn=b||!1,k.hasClass("singleWrapper")?this.picMaxWidth=b?540:580:this.picMaxWidth=b?400:440,this.$elem=a.$elem,this.$detailAreaElem=this.$elem.find(".js-detail"),this.$picPreviewElem=this.$elem.find(".pic-trigger"),this.$elem.delegate(".rotate-trigger","click",d.proxy(this.onRotate,this));var c=this;this.$picPreviewElem.click(function(){c.onPic()}),j.subscribe({eventName:"totalPageStart",func:function(){c.picMaxWidth=b?420:440,c.closePic()}}),j.subscribe({eventName:"singlePageStart",func:function(){c.picMaxWidth=b?560:580,c.closePic()}})}var d=a("external/jquery"),e=a("utils/Utils"),f=a("model/TweetData"),g=a("tweet/widget/pic/PicTmpl"),h=a("utils/tmpl"),i=a("tweet/widget/pic/RotatePicAction.js"),j=a("basic/Observer"),k=d(document.body);l.prototype={onPic:function(){this.isOpen=!0,this.picLoaded?this.onPicShow():this.renderBigPic()},closePic:function(){this.picLoaded=!1,this.canvasElem=null,this.isOpen&&this.$elem.removeClass("tweet-view"),this.close()},onPicShow:function(){this.$picDetailElem.appendTo(this.$detailAreaElem),this.$elem.addClass("tweet-view"),d(document).trigger("setHeight")},getPicInfo:function(){var a=this.columnTweetId?this.columnTweetId:this.$elem.parents(".js-tweet").attr("data-tweet-id"),b=f.get(a);return this.type==="normal"?b.imageList[0]:b.relatedTweet.root.imageList[0]},renderBigPic:function(){var a=this,b=this.getPicInfo();if(!this.picLoading){this.picLoadingElem=d('<span class="icon-loadingS"></span>'),this.$picPreviewElem.append(this.picLoadingElem),this.$picDetailElem=d(h.parseTemplate(g.bigPhoto,{url:b,isColumn:a.isColumn}));var c=new Image;c.onload=function(){d.browser.msie&&!this.fileSize&&this.load||(this.load=!0,a.picLoading=!1,a.onPicLoaded(c),this.onload=null)},c.src=e.randomOimageUrl(b,this.picMaxWidth,"",1),this.picLoading=!0}},onPicLoaded:function(a){!this.isOpen||(this.$picContentElem=this.$picDetailElem.find(".js-content"),this.$picContentElem.append(a),this.picSize={width:a.width,height:a.height},a.width>this.picMaxWidth&&(this.picSize={width:this.picMaxWidth,height:a.height*(this.picMaxWidth/a.width)},a.setAttribute("width",this.picSize.width),a.setAttribute("height",this.picSize.height)),this.picLoadingElem.remove(),this.onPicShow(),this.picLoaded=!0,this.picImageElem=a)},onRotate:function(a){i.doAction.call(this,a)},close:function(){this.$picDetailElem&&this.$elem.scrollToShow(50)&&this.$picDetailElem.detach(),this.isOpen=!1}};return l});define("tweet/widget/pic/PicTmpl",function(a,b,c){var d={bigPhoto:'<div class="tweet-detail-item tweet-detail-pic">\n                   <div class="tweet-control link-lb">\n                      <a class="icon-control-close <%if(isColumn){%> columnMedia-close-trigger <%}else{%> close-trigger <%}%>" title="收起" href="javascript:;">收起</a>\n                      <a class="icon-control-left <%if(isColumn){%>columnMedia-rotate-trigger <%}else{%> rotate-trigger <%}%>" title="向左转" data-direction="-1" href="javascript:;">向左转</a>\n                      <a class="icon-control-right <%if(isColumn){%>columnMedia-rotate-trigger <%}else{%> rotate-trigger <%}%>" title="向右转" data-direction="+1" href="javascript:;">向右转</a>\n                      <a class="icon-control-open" title="查看原图" href="<%=url%>" target="_blank">查看原图</a>\n                   </div>\n                   <div class="tweet-content tweet-content-pic js-content <%if(isColumn){%> columnMedia-close-trigger <%}else{%> close-trigger <%}%>"> </div>\n                </div>'};return d});define("tweet/widget/pic/RotatePicAction.js",function(a,b,c){var d=a("external/jquery"),e=a("tweet/widget/pic/PicTools"),f={doAction:function(a){var b=parseInt(d(a.currentTarget).data("direction"));b===1?this.whirl++:this.whirl--,this.whirl<0&&(this.whirl=4+this.whirl),this.whirl>3&&(this.whirl=0),this.whirl%2!==0?this.picSize.height>this.picMaxWidth&&(this.picImageElem.width=this.picSize.width*(this.picMaxWidth/this.picSize.height),this.picImageElem.height=this.picMaxWidth):(this.picImageElem.width=this.picSize.width,this.picImageElem.height=this.picSize.height),d.browser.msie?e.picDrawIE.call(this,this.whirl):(this.canvasElem||(this.canvasElem=document.createElement("canvas"),this.canvasContext=this.canvasElem.getContext("2d"),this.$picContentElem.append(this.canvasElem)),e.picDraw.call(this,this.whirl))}};return f});define("tweet/widget/pic/PicTools",function(a,b,c){var d=a("utils/jquery-wb"),e={picDraw:function(a){var b=this.picImageElem,c=this.canvasElem,d=this.canvasContext;switch(a){case 0:c.width=b.width,c.height=b.height,d.drawImage(b,0,0,b.width,b.height);break;case 1:c.width=b.height,c.height=b.width,d.rotate(90*Math.PI/180),d.drawImage(b,0,-b.height,b.width,b.height);break;case 2:c.width=b.width,c.height=b.height,d.rotate(180*Math.PI/180),d.drawImage(b,-b.width,-b.height,b.width,b.height);break;case 3:c.width=b.height,c.height=b.width,d.rotate(270*Math.PI/180),d.drawImage(b,-b.width,0,b.width,b.height)}b.style.display="none"},picDrawIE:function(a){var b=a*90,c=b*(Math.PI/180),e=d(this.picImageElem),f=Math.cos(c),g=-1*Math.sin(c),h=Math.sin(c),i=f;e.css({position:"absolute",left:"50%",filter:"progid:DXImageTransform.Microsoft.Matrix(M11="+f+",M12="+g+",M21="+h+",M22="+i+",SizingMethod='auto expand')"}),this.$picContentElem.css({position:"relative",height:e.height()}),e.css({marginLeft:"-"+e.width()/2})}};return e});define("basic/Observer",function(a,b,c){var d=[],e={Publisher:function(a){this.eventName=a},subscribe:function(a){var b=!1;for(var c=0;c<d.length;c++)if(d[c]===a){b=!0;break}b||d.push(a)},unsubscribe:function(a){var b=[];for(var c=0;c<d.length;c++)d[c]!=a&&b.push(d[c]);d=b}};e.Publisher.prototype.deliver=function(){var a=this,b=arguments||null;for(var c=0;c<d.length;c++)a.eventName==d[c].eventName&&d[c].func(b)};return e});define("_tmpl/tweet/media/columnContent",function(require){return function(tmplData){var p=[];with(tmplData){p.push('<div class="tweet-column-body"><em class="icon-column-tag"></em><div class="tweet-column-lead"><div class="tweet-column-title"><a href="/',screenName,"/column/",columnInfo.columnId,'" data-method="columnMore" class="link-la">',nickName,"的微专栏：",columnInfo.columnName,"</a><span>【精选】</span></div><p>",columnInfo.columnDesc,'</p></div><ul class="tweetList tweetList-noAvatar">');for(var i=0;i<tweets.length;i++){p.push('<li class="item"><div class="tweet js-tweet" data-tweet-id="',tweets[i].id,'"><div class="tweet-main"><p class="tweet-message">',tweets[i].columnContent,"</p>"),tweets[i].imageList&&tweets[i].imageList.length&&p.push('<div class="tweet-media js-media"><div class="tweet-media-preview"><div class="tweet-preview-pic pic-trigger" data-realurl="',tweets[i].imageList[0],'"><img class="js-preview-img" src="http://timge1.126.net/image?w=',imageWidth,"&url=",encodeURIComponent(tweets[i].imageList[0]),'&gif=1&quality=85" /></div></div><div class="tweet-media-detail js-detail"></div></div>'),p.push('<div class="tweet-ft js-foot"><div class="tweet-info text-la">',tweets[i].prettyTime,"</div>");var tmplData=tweets[i];p.push('<div class="tweet-option link-lb js-diggBox">',require("_tmpl/tweet/widget/digg")(tmplData),"</div></div></div></div></li>")}p.push('</ul><div class="tweet-column-ft"><a href="/',screenName,"/column/",columnInfo.columnId,'"  class="link-lb fFS"  data-method="columnMore">查看#',columnInfo.columnName,'#&nbsp;微专栏&gt;&gt;</a><a href="javascript:" class="tweet-talk-shrink close-trigger"><em class="icon-shrink"></em></a></div></div>')}return p.join("")}});define("external/swfobject",function(a,b,c){function Y(a){var b=/[\\\"<>\.;]/,c=b.exec(a)!=null;return c&&typeof encodeURIComponent!=d?encodeURIComponent(a):a}function X(a,b){if(!!A){var c=b?"visible":"hidden";w&&S(a)?S(a).style.visibility=c:W("#"+a,"visibility:"+c)}}function W(a,b,c,f){if(!B.ie||!B.mac){var g=l.getElementsByTagName("head")[0];if(!g)return;var h=c&&typeof c=="string"?c:"screen";f&&(y=null,z=null);if(!y||z!=h){var i=T("style");i.setAttribute("type","text/css"),i.setAttribute("media",h),y=g.appendChild(i),B.ie&&B.win&&typeof l.styleSheets!=d&&l.styleSheets.length>0&&(y=l.styleSheets[l.styleSheets.length-1]),z=h}B.ie&&B.win?y&&typeof y.addRule==e&&y.addRule(a,b):y&&typeof l.createTextNode!=d&&y.appendChild(l.createTextNode(a+" {"+b+"}"))}}function V(a){var b=B.pv,c=a.split(".");c[0]=parseInt(c[0],10),c[1]=parseInt(c[1],10)||0,c[2]=parseInt(c[2],10)||0;return b[0]>c[0]||b[0]==c[0]&&b[1]>c[1]||b[0]==c[0]&&b[1]==c[1]&&b[2]>=c[2]?!0:!1}function U(a,b,c){a.attachEvent(b,c),r[r.length]=[a,b,c]}function T(a){return l.createElement(a)}function S(a){var b=null;try{b=l.getElementById(a)}catch(c){}return b}function R(a){var b=S(a);if(b){for(var c in b)typeof b[c]=="function"&&(b[c]=null);b.parentNode.removeChild(b)}}function Q(a){var b=S(a);b&&b.nodeName=="OBJECT"&&(B.ie&&B.win?(b.style.display="none",function(){b.readyState==4?R(a):setTimeout(arguments.callee,10)}()):b.parentNode.removeChild(b))}function P(a,b,c){var d=T("param");d.setAttribute("name",b),d.setAttribute("value",c),a.appendChild(d)}function O(a,b,c){var f,g=S(c);if(B.wk&&B.wk<312)return f;if(g){typeof a.id==d&&(a.id=c);if(B.ie&&B.win){var i="";for(var j in a)a[j]!=Object.prototype[j]&&(j.toLowerCase()=="data"?b.movie=a[j]:j.toLowerCase()=="styleclass"?i+=' class="'+a[j]+'"':j.toLowerCase()!="classid"&&(i+=" "+j+'="'+a[j]+'"'));var k="";for(var l in b)b[l]!=Object.prototype[l]&&(k+='<param name="'+l+'" value="'+b[l]+'" />');g.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+i+">"+k+"</object>",q[q.length]=a.id,f=S(a.id)}else{var m=T(e);m.setAttribute("type",h);for(var n in a)a[n]!=Object.prototype[n]&&(n.toLowerCase()=="styleclass"?m.setAttribute("class",a[n]):n.toLowerCase()!="classid"&&m.setAttribute(n,a[n]));for(var o in b)b[o]!=Object.prototype[o]&&o.toLowerCase()!="movie"&&P(m,o,b[o]);g.parentNode.replaceChild(m,g),f=m}}return f}function N(a){var b=T("div");if(B.win&&B.ie)b.innerHTML=a.innerHTML;else{var c=a.getElementsByTagName(e)[0];if(c){var d=c.childNodes;if(d){var f=d.length;for(var g=0;g<f;g++)(d[g].nodeType!=1||d[g].nodeName!="PARAM")&&d[g].nodeType!=8&&b.appendChild(d[g].cloneNode(!0))}}}return b}function M(a){if(B.ie&&B.win&&a.readyState!=4){var b=T("div");a.parentNode.insertBefore(b,a),b.parentNode.replaceChild(N(a),b),a.style.display="none",function(){a.readyState==4?a.parentNode.removeChild(a):setTimeout(arguments.callee,10)}()}else a.parentNode.replaceChild(N(a),a)}function L(a,b,c,e){x=!0,u=e||null,v={success:!1,id:c};var f=S(c);if(f){f.nodeName=="OBJECT"?(s=N(f),t=null):(s=f,t=c),a.id=i;if(typeof a.width==d||!/%$/.test(a.width)&&parseInt(a.width,10)<310)a.width="310";if(typeof a.height==d||!/%$/.test(a.height)&&parseInt(a.height,10)<137)a.height="137";l.title=l.title.slice(0,47)+" - Flash Player Installation";var g=B.ie&&B.win?"ActiveX":"PlugIn",h="MMredirectURL="+k.location.toString().replace(/&/g,"%26")+"&MMplayerType="+g+"&MMdoctitle="+l.title;typeof b.flashvars!=d?b.flashvars+="&"+h:b.flashvars=h;if(B.ie&&B.win&&f.readyState!=4){var j=T("div");c+="SWFObjectNew",j.setAttribute("id",c),f.parentNode.insertBefore(j,f),f.style.display="none",function(){f.readyState==4?f.parentNode.removeChild(f):setTimeout(arguments.callee,10)}()}O(a,b,c)}}function K(){return!x&&V("6.0.65")&&(B.win||B.mac)&&!(B.wk&&B.wk<312)}function J(a){var b=null,c=S(a);if(c&&c.nodeName=="OBJECT")if(typeof c.SetVariable!=d)b=c;else{var f=c.getElementsByTagName(e)[0];f&&(b=f)}return b}function I(){var a=p.length;if(a>0)for(var b=0;b<a;b++){var c=p[b].id,e=p[b].callbackFn,f={success:!1,id:c};if(B.pv[0]>0){var g=S(c);if(g)if(V(p[b].swfVersion)&&!(B.wk&&B.wk<312))X(c,!0),e&&(f.success=!0,f.ref=J(c),e(f));else if(p[b].expressInstall&&K()){var h={};h.data=p[b].expressInstall,h.width=g.getAttribute("width")||"0",h.height=g.getAttribute("height")||"0",g.getAttribute("class")&&(h.styleclass=g.getAttribute("class")),g.getAttribute("align")&&(h.align=g.getAttribute("align"));var i={},j=g.getElementsByTagName("param"),k=j.length;for(var l=0;l<k;l++)j[l].getAttribute("name").toLowerCase()!="movie"&&(i[j[l].getAttribute("name")]=j[l].getAttribute("value"));L(h,i,c,e)}else M(g),e&&e(f)}else{X(c,!0);if(e){var m=J(c);m&&typeof m.SetVariable!=d&&(f.success=!0,f.ref=m),e(f)}}}}function H(){var a=l.getElementsByTagName("body")[0],b=T(e);b.setAttribute("type",h);var c=a.appendChild(b);if(c){var f=0;(function(){if(typeof c.GetVariable!=d){var e=c.GetVariable("$version");e&&(e=e.split(" ")[1].split(","),B.pv=[parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10)])}else if(f<10){f++,setTimeout(arguments.callee,10);return}a.removeChild(b),c=null,I()})()}else I()}function G(){n?H():I()}function F(a){if(typeof k.addEventListener!=d)k.addEventListener("load",a,!1);else if(typeof l.addEventListener!=d)l.addEventListener("load",a,!1);else if(typeof k.attachEvent!=d)U(k,"onload",a);else if(typeof k.onload=="function"){var b=k.onload;k.onload=function(){b(),a()}}else k.onload=a}function E(a){w?a():o[o.length]=a}function D(){if(!w){try{var a=l.getElementsByTagName("body")[0].appendChild(T("span"));a.parentNode.removeChild(a)}catch(b){return}w=!0;var c=o.length;for(var d=0;d<c;d++)o[d]()}}var d="undefined",e="object",f="Shockwave Flash",g="ShockwaveFlash.ShockwaveFlash",h="application/x-shockwave-flash",i="SWFObjectExprInst",j="onreadystatechange",k=window,l=document,m=navigator,n=!1,o=[G],p=[],q=[],r=[],s,t,u,v,w=!1,x=!1,y,z,A=!0,B=function(){var a=typeof l.getElementById!=d&&typeof l.getElementsByTagName!=d&&typeof l.createElement!=d,b=m.userAgent.toLowerCase(),c=m.platform.toLowerCase(),i=c?/win/.test(c):/win/.test(b),j=c?/mac/.test(c):/mac/.test(b),o=/webkit/.test(b)?parseFloat(b.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,p=!1,q=[0,0,0],r=null;if(typeof m.plugins!=d&&typeof m.plugins[f]==e)r=m.plugins[f].description,r&&(typeof m.mimeTypes==d||!m.mimeTypes[h]||!!m.mimeTypes[h].enabledPlugin)&&(n=!0,p=!1,r=r.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),q[0]=parseInt(r.replace(/^(.*)\..*$/,"$1"),10),q[1]=parseInt(r.replace(/^.*\.(.*)\s.*$/,"$1"),10),q[2]=/[a-zA-Z]/.test(r)?parseInt(r.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof k.ActiveXObject!=d)try{var s=new ActiveXObject(g);s&&(r=s.GetVariable("$version"),r&&(p=!0,r=r.split(" ")[1].split(","),q=[parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10)]))}catch(t){}return{w3:a,pv:q,wk:o,ie:p,win:i,mac:j}}(),C=function(){!B.w3||((typeof l.readyState!=d&&l.readyState=="complete"||typeof l.readyState==d&&(l.getElementsByTagName("body")[0]||l.body))&&D(),w||(typeof l.addEventListener!=d&&l.addEventListener("DOMContentLoaded",D,!1),B.ie&&B.win&&(l.attachEvent(j,function(){l.readyState=="complete"&&(l.detachEvent(j,arguments.callee),D())}),k==top&&function(){if(!w){try{l.documentElement.doScroll("left")}catch(a){setTimeout(arguments.callee,0);return}D()}}()),B.wk&&function(){if(!w){if(!/loaded|complete/.test(l.readyState)){setTimeout(arguments.callee,0);return}D()}}(),F(D)))}(),Z=function(){B.ie&&B.win&&window.attachEvent("onunload",function(){var a=r.length;for(var b=0;b<a;b++)r[b][0].detachEvent(r[b][1],r[b][2]);var c=q.length;for(var d=0;d<c;d++)Q(q[d]);for(var e in B)B[e]=null;B=null;for(var f in $)$[f]=null;$=null})}(),$={registerObject:function(a,b,c,d){if(B.w3&&a&&b){var e={};e.id=a,e.swfVersion=b,e.expressInstall=c,e.callbackFn=d,p[p.length]=e,X(a,!1)}else d&&d({success:!1,id:a})},getObjectById:function(a){if(B.w3)return J(a)},embedSWF:function(a,b,c,f,g,h,i,j,k,l){var m={success:!1,id:b};B.w3&&!(B.wk&&B.wk<312)&&a&&b&&c&&f&&g?(X(b,!1),E(function(){c+="",f+="";var n={};if(k&&typeof k===e)for(var o in k)n[o]=k[o];n.data=a,n.width=c,n.height=f;var p={};if(j&&typeof j===e)for(var q in j)p[q]=j[q];if(i&&typeof i===e)for(var r in i)typeof p.flashvars!=d?p.flashvars+="&"+r+"="+i[r]:p.flashvars=r+"="+i[r];if(V(g)){var s=O(n,p,b);n.id==b&&X(b,!0),m.success=!0,m.ref=s}else{if(h&&K()){n.data=h,L(n,p,b,l);return}X(b,!0)}l&&l(m)})):l&&l(m)},switchOffAutoHideShow:function(){A=!1},ua:B,getFlashPlayerVersion:function(){return{major:B.pv[0],minor:B.pv[1],release:B.pv[2]}},hasFlashPlayerVersion:V,createSWF:function(a,b,c){return B.w3?O(a,b,c):undefined},showExpressInstall:function(a,b,c,d){B.w3&&K()&&L(a,b,c,d)},removeSWF:function(a){B.w3&&Q(a)},createCSS:function(a,b,c,d){B.w3&&W(a,b,c,d)},addDomLoadEvent:E,addLoadEvent:F,getQueryParamValue:function(a){var b=l.location.search||l.location.hash;if(b){/\?/.test(b)&&(b=b.split("?")[1]);if(a==null)return Y(b);var c=b.split("&");for(var d=0;d<c.length;d++)if(c[d].substring(0,c[d].indexOf("="))==a)return Y(c[d].substring(c[d].indexOf("=")+1))}return""},expressInstallCallback:function(){if(x){var a=S(i);a&&s&&(a.parentNode.replaceChild(s,a),t&&(X(t,!0),B.ie&&B.win&&(s.style.display="block")),u&&u(v)),x=!1}}};return $});define("_tmpl/tweet/media/videoPlay",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div class="tweet-detail-item tweet-detail-video"><div class="tweet-control link-lb"><a class="icon-control-close close-trigger" href="javascript:;">收起</a><a class="icon-control-open js-title" href="" target="_blank"></a></div><div id="',id,'" class="tweet-content tweet-content-video js-content"></div></div>');return p.join("")}});define("_tmpl/tweet/media/musicPlay",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div class="tweet-detail-item tweet-detail-music"><div class="tweet-control link-lb"><a class="icon-control-close close-trigger" href="javascript:;">收起</a><a class="icon-control-open js-title" href="" target="_blank"></a></div><div class="tweet-content tweet-content-music"><div class="tweet-content-music-cover js-image"></div><div class="tweet-content-music-player"><div id="',id,'"><a href="http://www.adobe.com/go/getflashplayer" target="_blank"><img src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" alt="获取 flash 播放器"></a></div></div></div></div>');return p.join("")}});define("_tmpl/tweet/media/voteDetail",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div class="tweet-detail-item tweet-detail-vote"><div class="tweet-control link-lb"><a class="icon-control-close close-trigger" href="javascript:;">收起</a></div><div class="tweet-content loading js-content"><div class="loadingBox"><span class="js-loading"><em class="icon-loadingB"></em>正在打开...</span></div></div></div>');return p.join("")}});define("_tmpl/tweet/media/tower/towerDetail",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div class="tweet-detail-item tweet-detail-tower"><div class="tweet-control link-lb"><a class="icon-control-close close-trigger" href="javascript:;">收起</a></div><div class="tweet-content loading js-content"><div class="loadingBox"><span class="js-loading"><em class="icon-loadingB"></em>正在打开...</span></div><div class="tweet-tower-body towerList tweet-tower-hidden js-tower-container" data-keyfrom="affix"><!--盖楼内容区--><div class="tweet-tower-publishBox js-publishBox">'),user?p.push('<a class="link-la js-float-intro" data-keyfrom="nickName" href="/',user.screenName,'" data-user-nickname="',user.nickName,'">',user.isShowRemark&&user.remark?user.remark:user.nickName,"</a>"):p.push('<span class="cGray">请<a href="javascript:;" class="link-la need-login">登录</a>后发言</span>'),p.push('<div class="tweet-publishBox-hd"><div class="tweet-publishBox-textareaBox"><label class="tweet-publishBox-defaultTips js-default-tip">@用户，他就会收到通知</label><fieldset><div><textarea class="tweet-publishBox-textarea"></textarea></div></fieldset></div></div><div class="tweet-publishBox-ft"><div class="clearfix"><span class="fl"><label class="label-tag"><input type="checkbox" checked="checked" name="isRetweet">同时转发到我的微博</label></span><div class="tweet-publishBox-operate"><div class="tweet-publishBox-btn"><a class="submit-trigger disabled" href="javascript:;">盖楼</a></div><span class="tweet-publishBox-tip js-wordCounter">还可以输<span class="char-constantia">163</span>字</span></div></div></div></div></div></div><a href="javascript:;" class="tweet-talk-shrink close-trigger"><em class="icon-shrink"></em></a></div>');return p.join("")}});define("sendBox/widget/tower/FloorCreateBox",function(a,b,c){var d=a("external/jquery"),e=a("sendBox/widget/tower/TowerSendBox"),f=a("sendBox/SendBoxAction"),g=a("utils/DataSource"),h=a("model/UserData"),i=a("utils/log/Logger"),j=e.extend({bindEvent:function(){this._super(),f.bindDefaultTip.apply(this);var a=this;this.$textareaElem.bind("focus",function(){h.getLoginUser()?a.$elem.parents(".js-tower-container").removeClass("tweet-tower-hidden"):d(document).trigger("error",["needLogin"])})},doSubmit:function(){var a=this.$elem.find("[name=isRetweet]").prop("checked")?1:0,b={targetId:this.config.gentieRootId,isRetweet:a,content:this.textarea.$elem.val()};this.request=g.postJSON("tower",b,d.proxy(this.onSuccess,this)).error(d.proxy(this.onFail,this)),i.triggerLog(this.config.target,{method:"affixReply"})},onSuccess:function(a){this._super(a)&&(this.$elem.trigger("floor.sent",[a.newFloor]),this.textarea.clear().$elem.focus())}});return j});define("sendBox/widget/tower/TowerSendBox",function(a,b,c){var d=a("sendBox/BasicSendBox"),e=a("sendBox/SendBoxAction"),f=a("widget/tip/NaviTip"),g=d.extend({checkInput:e.checkInput,onSubmit:function(a){this.cancelBlur(),this._super(a)},onSubmitError:function(a){this._super(a),this.blink()},onErrorTip:function(a){f.show({type:"error",text:a})},onSuccess:function(b){if(b.result==0)return!0;if(b.result==1){this.onErrorTip("很抱歉，内容含有敏感信息");return!1}if(b.result==2){this.onErrorTip("盖楼发起失败");return!1}if(b.result==3){var c=this,d=a("widget/floatBox/VerifyBox"),e=d.getInstance(null,{reqUrl:"verifyGentie",reqCode:"getGentieVerifyCode"});e.show(function(){c.request.resend()});return!1}},onFail:function(){this.onErrorTip("盖楼发起失败，请稍后再试")}});return g});define("_tmpl/tweet/media/newsPrvDetail",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div class="tweet-detail-item tweet-detail-preview"><div class="tweet-control link-lb"><a class="icon-control-close close-trigger" href="javascript:;">收起</a><a class="icon-control-open js-title" target="_blank" href="',shortUrl,'" title="',title,'">查看原文</a></div><div class="tweet-content"><div class="loadingBox js-loadingBox"><span class="js-loading"><em class="icon-loadingB"></em>正在打开...</span></div><div class="tweet-news-body js-body"><p class="tweet-news-ellipsis js-ellipsis hidden">......</p><p class="tweet-news-original js-viewAll hidden"><a title="余下全文" class="link-la" target="_blank" href="',shortUrl,'">余下全文</a>...</p><div class="tweet-news-expand js-controlBar hidden"><a class="icon-control-expand expand-trigger link-la" href="javascript:;">展开全部</a><a class="icon-control-close close-trigger link-la" href="javascript:;">收起</a></div><div class="tweet-news-fail js-newsFail hidden"><em class="caution-icon"></em>链接失效了，<a href="',shortUrl,'" title="',title,'" target="_blank" data-unlog="true">查看原文&gt;&gt;</a></div></div></div></div>');return p.join("")}});define("_tmpl/tweet/media/newsBody",function(require){return function(tmplData){var p=[];with(tmplData)p.push(""),newsStatus&&(p.push('<h4 class="tweet-news-title js-title">',json.title,"</h4>"),json.summary&&p.push('<p class="tweet-news-summary js-sum">',json.summary,"</p>"),p.push('<div class="tweet-news-message js-message"></div>')),p.push("");return p.join("")}});define("sendBox/ZtPreviewBox",function(a,b,c){var d=a("external/jquery"),e=a("sendBox/widget/AtInput"),f=a("sendBox/BasicSendBox"),g=a("widget/FileUploader"),h=a("sendBox/SendBoxAction"),i=a("sendBox/widget/picUpload/PicSimple"),j=a("model/UserData"),k=f.extend({bindEvent:function(){if(j.getLoginUser()!=null){this._super();var a=this;this.$textareaElem.bind("blur",function(){d.trim(this.value)===""&&a.$btnElem.addClass("disabled")}),this.atInput=e.getInstance(),this.atInput.bind(this.$elem.find(".at-trigger"),this.textarea),this.$topicGuide=this.$elem.find(".js-guide"),this.$insert=this.$elem.find(".face-trigger"),this.$topicGuide.size()?(this.$textareaElem.blur(),this.$textareaElem.bind("click",d.proxy(this.showTopic,this)),this.$topicGuide.bind("click",d.proxy(this.showTopic,this)),this.$insert.bind("click",d.proxy(this.showTopic,this)),this.$elem.bind("showTopic",d.proxy(this.showTopic,this))):this.$textareaElem.focusToEnd(),this.PicSimple=new i({trigger:this.$elem.find(".uploadPic-trigger"),textarea:this.textarea,callBack:this.$topicGuide.size()?function(){a.$elem.trigger("showTopic")}:!1})}},showTopic:function(){var a=this.$topicGuide.attr("data-topic");this.textarea.appendText(a),this.$textareaElem.focusToEnd(),this.removeEvent()},removeEvent:function(){this.$textareaElem.keyup().unbind("click"),this.$topicGuide.unbind("click").remove(),this.$insert.unbind("click"),this.$elem.unbind("showTopic")},checkInput:h.checkInput,getParams:function(){var a=this._super();a.imageUrl=this.PicSimple.imageUrl?this.PicSimple.imageUrl:"",a.ztId=this.config.ztId;return a},onSubmitError:function(a){this._super(a),this.blink()},onSuccess:function(){this.textarea.clear();try{this.PicSimple.hide()}catch(a){}this.PicSimple.imageUrl="",this.onBadgeTips(4),this.tip.show({type:"success",text:this.badgeNavTips!==null?this.badgeNavTips:"发布成功！"}),this.config.$close.trigger("click")}});return k});define("sendBox/widget/picUpload/PicSimple",function(a,b,c){var d=a("external/jquery"),e=a("widget/tinyBox/Box"),f=a("widget/FileUploader"),g=a("utils/Utils"),h=a("model/UserData"),i=a("utils/tmpl"),j=d(document.body),k=a("utils/log/Logger"),l=e.extend({imageUrl:null,tmpUrl:null,picMaxWidth:140,init:function(a){this._super.apply(this,arguments),this.config=this.data,delete this.data,this.$trigger=d(this.config.trigger),this.textarea=a.textarea,this.callBack=a.callBack,this.uploader=new f({waterMark:"t.163.com/"+h.getLoginUser().screenName,onSuccess:d.proxy(this.onSuccess,this),onFail:d.proxy(this.onFail,this),onLoading:d.proxy(this.onLoading,this),trigger:this.$trigger}),this.uploader.$uploadElem.appendTo(this.$trigger),this.$trigger.unbind("mousemove")},postRender:function(){this.$elem.addClass("winlayer-uploadpic")},show:function(){var a={top:this.$trigger.offset().top+23,left:this.$trigger.offset().left-18};this._super(a),j.trigger("wgtHide"),this.callBack&&this.callBack()},onFail:function(){d(document).trigger("error",["uploadError",{type:"error",text:"上传图片错误，图片应该是 2M 以内的 jpg、gif、png、bmp图片"}])},onSuccess:function(b,c){this.uploader.$elem.get(0).reset(),this.imageUrl=c.originalURL,this.textarea.$elem.focusToEnd(),this.tmpUrl=c.originalURL;var d=c.picText||"";this.$elem.find(".winlayer-body").html(i.formatTemplate(a("_tmpl/uploadSuccess"),{fileName:b,fileNameShort:g.countChars(b,18)})),this.rotatePicLoading(!0),this.initRotate(),this.bigImgArray[this.whirl]=this.tmpUrl,this.onPreviewImgLoaded(c)},initRotate:function(){this.whirl=0,this.smallImgArray=[],this.bigImgArray=[]},onPreviewImgLoaded:function(a){var b=this,c=new Image;c.onload=function(){d.browser.msie&&!this.fileSize&&this.load||(this.load=!0,b.$elem.find(".js-img").html(c),this.onload=null,b.rotatePicLoading(!1))},c.src=g.randomOimageUrl(a.originalURL,b.picMaxWidth,b.picMaxWidth),this.smallImgArray[this.whirl]=c.src},onLoading:function(){this.show(),this.$elem.find(".winlayer-body").html(g.LOADING_SMALL.replace("$text$","正在上传，请稍等..."))},bindEvent:function(){this.$elem.delegate(".delete-trigger","click",d.proxy(this.hide,this)),this.$elem.delegate(".rotate-trigger","click",d.proxy(this.onRotate,this)),j.bind("totalPageStart",d.proxy(this.onClose,this)).bind("singlePageStart",d.proxy(this.onClose,this))},onClose:function(a){this.tmpUrl!==null&&(this.tmpUrl=null,this.imageUrl="",this.autoClose(a))},rotatePicLoading:function(a){a?(this.$elem.find(".winlayer-body").addClass("winlayer-uploadpic-loading"),this.$elem.find(".js-rotate").removeClass("rotate-trigger"),this.uploader.isUploading=!0):(this.$elem.find(".winlayer-body").removeClass("winlayer-uploadpic-loading"),this.$elem.find(".js-rotate").addClass("rotate-trigger"),this.uploader.isUploading=!1)},countWhirl:function(a){var b=parseInt(d(a.currentTarget).data("direction"));b===1?this.whirl++:this.whirl--,this.whirl<0&&(this.whirl=4+this.whirl),this.whirl>3&&(this.whirl=0);return b},onRotate:function(a){a.preventDefault();var b=this.countWhirl(a),c=b>0?"rImage":"lImage";k.triggerLog(a.currentTarget,{method:c});if(this.smallImgArray[this.whirl])this.imageUrl=this.bigImgArray[this.whirl],this.$elem.find(".js-img img").attr("src",this.smallImgArray[this.whirl]);else{var e=b>0?90:270,f="http://upload.buzz.163.com/rotate",g={imageUrl:this.tmpUrl,rotatedegree:e};this.rotatePicLoading(!0),this.Request=d.getJSON(f+"?callback=?",g,d.proxy(function(a){a&&a.originalURL&&(this.tmpUrl=a.originalURL,this.bigImgArray[this.whirl]=this.tmpUrl,this.imageUrl=this.bigImgArray[this.whirl],this.onPreviewImgLoaded(a))},this))}},hide:function(){this.uploader.isUploading||(this.$elem.find("iframe").attr("src","about:blank"),this.imageUrl="",this._super(),k.triggerLog(this.$elem.find(".delete-trigger"),{method:"deleteImage"}))},autoClose:function(a){if(!this.uploader.isUploading){var b=d(a.target).parents().andSelf();d.inArray(this.$elem[0],b)===-1&&d.inArray(this.$trigger[0],b)===-1&&this.hide()}}});return l});define("_tmpl/uploadSuccess",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div class="winlayer-bd"><span title="',fileName,'" class="winlayer-uploadpic-imgname">',fileNameShort,'</span><div class="loadingBoxS"><span><em class="icon-loadingS"></em></span></div><div class="winlayer-uploadpic-imgbox"><span class="js-img"></span></div><div class="winlayer-uploadpic-action js-uploadpic-action"><a class="fr icon-delete delete-trigger" href="javascript:;" title="删除图片"></a><a class="icon-left-rotate js-rotate rotate-trigger" href="javascript:;" data-direction="-1" title="向左旋转"></a><a class="icon-right-rotate js-rotate rotate-trigger" href="javascript:;" data-direction="+1" title="向右旋转"></a></div></div>');return p.join("")}});define("_tmpl/tweet/media/ztDetail",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div class="tweet-detail-item"><div class="tweet-control link-lb"><a class="icon-control-close close-trigger" href="javascript:;">收起</a><a class="icon-control-open" href="',originalUrl,'" target="_blank" data-method="clickZT">进入专题</a></div><div class="tweet-content"><div class="tweet-zt-body"><div class="tweet-zt-intro clearfix"><a href="',originalUrl,'" target="_blank" data-method="clickZT" class="tweet-zt-cover-link"><img src="',coverUrl,'"/></a><a href="',originalUrl,'" target="_blank" class="tweet-zt-title link-la" data-method="clickZT"><em>',title,'</em>[进入专题]</a><p class="tweet-zt-desc">',desc,'</p></div><div class="tweet-zt-publish js-publishBox" data-keyfrom="wZT"><div class="tweet-publishBox-textareaBox">'),topicGuide!=""?p.push('<label data-topic="',topic,'" class="tweet-publishBox-defaultTips js-guide">',topicGuide,'</label><textarea class="tweet-publishBox-textarea"></textarea>'):p.push('<textarea class="tweet-publishBox-textarea">',topic,"</textarea>"),p.push('</div><div class="tweet-publishBox-ft"><div class="clearfix"><div class="insert-list fl js-insert"><div class="uploadPic-trigger insert-pic" title="图片"><em class="icon-pic need-login"></em></div><a class="insert-face face-trigger need-login" title="表情" href="javascript:;"><em class="icon-face"></em></a></div><div class="fr"><div class="tweet-publishBox-btn"><a class="submit-trigger need-login disabled" href="javascript:;">发布</a></div><span class="tweet-publishBox-tip js-wordCounter">还可以输<span class="char-constantia">163</span>字</span></div></div></div></div></div></div></div>');return p.join("")}});define("_tmpl/tweet/media/columnDetail",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div class="tweet-detail-item"><div class="tweet-control link-lb"><a href="javascript:;" class="icon-control-close close-trigger">收起</a><a target="_blank" href="/',screenName,"/column/",columnId,'" class="icon-control-open fFS" data-method="columnMore">查看',columnName,'&nbsp;微专栏&gt;&gt;</a></div><div class="tweet-content js-body"><div class="loadingBox"><span class="js-loading"><em class="icon-loadingB"></em>正在打开...</span></div></div></div>');return p.join("")}});define("tweet/action/RenderInnerTweetAction",function(a,b,c){var d=a("external/jquery"),e=a("tweet/InnerTweet"),f={doAction:function(){var a=this.data.relatedTweet.root;if(a&&this.innerTweet===null){a.isFromProject=this.data.isFromProject;var b=this.$elem.find(".js-tweet-root");b.size()>0?(this.innerTweet=new e(a,{html:b}),this.innerTweet.render()):(this.innerTweet=new e(a),this.$elem.find(".js-foot").before(this.innerTweet.render()))}}};return f});define("tweet/InnerTweet",function(a,b,c){var d=a("external/jquery"),e=a("tweet/Tweet"),f=a("tweet/widget/MediaBox"),g=a("model/TweetData"),h=a("tweet/TweetAction"),i=a("tweet/action/DiggAction"),j=a("tweet/action/DisplayTagAction"),k=a("tweet/status/ReplyRetweet"),l=a("utils/tmpl"),m=a("utils/Utils"),n=e.extend(d.extend({init:function(a,b){this._super(a,b),this.mediaBox=null,this.replyTalkBox=null,this.retweetTalkBox=null,this.sendBoxStatus=this.SendBoxStatusList.allClose;if(this.data.ztInfos!==undefined){var c=this.data.ztInfos[0].desc;this.data.countZtInfosDesc=c==""?"大家正在热烈讨论，点击发表我的看法。":m.countChars(c,76)}this.data.hasOwnProperty("digged")||(this.data.digged=!1)},render:function(){this.$elem===null&&(this.config.html?(this.$elem=d(this.config.html),delete this.config.$elem):this.data.isFromProject?this.$elem=d(l.formatTemplate(a("_tmpl/tweet/projectInnerTweet"),d.extend({config:this.config},this.data))):this.$elem=d(l.formatTemplate(a("_tmpl/tweet/innerTweet"),d.extend({config:this.config},this.data))),this.bindEvent());return this.$elem},bindEvent:function(){this._super();var a=this.$elem.find("> .js-media");a.length>0&&(this.mediaBox=new f(a,{type:"inner"}),this.$elem.find(".js-message:first .video-trigger").bind("click",d.proxy(this.mediaBox.onVideo,this.mediaBox)),this.$elem.find(".js-message:first .music-trigger").bind("click",d.proxy(this.mediaBox.onMusic,this.mediaBox)),this.$elem.find(".js-message:first .preview-trigger").bind("click",d.proxy(this.mediaBox.onNewsPrv,this.mediaBox))),this.$elem.bind("open.TalkBox",d.proxy(this.onTalkBoxOpen,this)).delegate(".rootReply-trigger","click",d.proxy(this.onReply,this)).delegate(".rootRetweet-trigger","click",d.proxy(this.onRetweet,this)).delegate("*","close.TalkBox",d.proxy(this.onTalkBoxClose,this)).delegate(".digg-trigger","click",d.proxy(this.onDigg,this)).delegate(".js-message:first .js-tweet-tag","hover",d.proxy(this.onDisplayTag,this)),g.bindUpdate(this.data.id,d.proxy(h.update,this))},upFirstCase:function(a){var b=a.charAt(0);return a.replace(b,b.toUpperCase())},onReply:function(a){this.statusOnReply(a)},onRetweet:function(a){this.statusOnRetweet(a)},openTalkBox:function(a,b){var a="root"+this.upFirstCase(a);h.openTalkBox.call(this,a,b)},closeTalkBox:function(a,b){var a="root"+this.upFirstCase(a);h.closeTalkBox.call(this,a,b)},initTalkBox:function(a){var b=this.data.timestamp>=13407264e5?{replyType:1}:{};b.isRoot=!0,h.initTalkBox.apply(this,[a,b])},onTalkBoxClose:function(a){this.statusOnTalkBoxClose(a)},onTalkBoxOpen:function(a,b,c){c.config.isRoot=!0},onDigg:function(a){a.stopPropagation(),i.doAction.call(this,a)},onDisplayTag:j.doAction},k));return n});define("tweet/action/DisplayTagAction",function(a,b,c){var d=a("widget/tinyBox/TweetTagBox"),e=null,f={doAction:function(a){var b=e;b||(b=new d,e=b),b.display(a)}};return f});define("widget/tinyBox/TweetTagBox",function(a,b,c){var d=a("external/jquery"),e=a("widget/Box"),f=a("utils/Utils"),g=a("utils/DataSource"),h=a("utils/tmpl"),i=a("utils/log/Logger"),j={},k=500,l=null,m=null,n=null,o=f.LOADING_SMALL.replace("$text$","加载中，请稍候..."),p=e.extend({init:function(a,b){this._super(a,b)},preRender:function(){return{content:'<div class="winlayer-bd js-content"></div>'}},renderTmpl:function(b){return d(h.formatTemplate(a("_tmpl/winlayer"),d.extend({content:""},b)))},postRender:function(){n=this.$elem,n.addClass("winlayer-tweetfloatbox").appendTo("body").attr("data-keyfrom","ecard").hover(function(){m&&clearTimeout(m)},function(){l&&clearTimeout(l),m=setTimeout(function(){n.hide()},k)})},display:function(a){a.type==="mouseenter"?(m&&clearTimeout(m),l=setTimeout(d.proxy(function(){this.show(a)},this),k)):(l&&clearTimeout(l),m=setTimeout(function(){n&&n.hide()},k))},show:function(a){this.$target=d(a.currentTarget);var b=this.$target.attr("data-tagid"),c=this.$target.attr("data-keywords");n||this._super(),j[b]?this.showInfo(j[b]):(n.find(".js-content").html(o),this.setPosition(),g.postJSON("tweetTag",{tagId:b},d.proxy(function(a){a.keyWords=c,this.showInfo(a),j[b]=a},this))),i.triggerLog(this.$target,{method:"ecardHover"})},showInfo:function(b){var c=this,e=d(h.formatTemplate(a("_tmpl/tweet/widget/tweetTagBox"),b)),f=e.find(".js-img"),g=function(){n.find(".js-content").html(e),c.setPosition()};f.size()?f.bind("load",function(){g()}).bind("error",function(){f.parent().detach(),g()}):g()},setPosition:function(){var a=this.$target,b=a.offset(),c=7,d=n.find(".js-arrow").removeClass("winlayer-arrow-up winlayer-arrow-down"),e=n.height(),g=a.height();a.parents(".js-message").size()!==0&&(g=20,c=4);var h=b.top-e-4;b.top-200-f.scrollY()>0&&h>0?(d.addClass("winlayer-arrow-down"),b.top=h):(d.addClass("winlayer-arrow-up"),b.top=b.top+g+c),b.left=f.getXY(a[0]).left,n.css({left:b.left,top:b.top,display:"block"})}});return p});define("_tmpl/tweet/widget/tweetTagBox",function(require){return function(tmplData){var p=[];with(tmplData)p.push("<h4>"),type==1&&p.push('<a href="http://news.tag.163.com" data-method="clickecard" data-keyfrom="logo" target="_blank" class="winlayer-tweetfloatbox-read"></a>'),p.push('关于<a href="',docUrl,'" target="_blank" class="link-la" data-method="clickecard" data-keyfrom="'),type==1?p.push("keyword"):type==2&&p.push("topicWord"),p.push('">',keyWords,"</a>的"),type==1?p.push("新闻"):type==2&&p.push("专题"),p.push("</h4>"),docPicUrl&&(p.push('<a href="',docUrl,'" target="_blank" data-method="clickecard" data-keyfrom="'),type==1?p.push("mainpic"):type==2&&p.push("topicPic"),p.push('" class="winlayer-tweetfloatbox-img"><img src="',docPicUrl,'" class="js-img"/></a>')),p.push('<div class="winlayer-tweetfloatbox-info clearfix"><h3><a href="',docUrl,'" target="_blank" data-method="clickecard" data-keyfrom="'),type==1?p.push("title"):type==2&&p.push("topicTitle"),p.push('">',docTitle,"</a></h3><p>",docSubject+"...",'<a href="',docUrl,'" target="_blank" data-method="clickecard" data-keyfrom="'),type==1?p.push("details"):type==2&&p.push("Detais"),p.push('" class="link-la">[详细]</a></p></div>');return p.join("")}});define("_tmpl/tweet/projectInnerTweet",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div class="tweet-root js-tweet-root" data-tweet-id="',id,'" data-tweet-type="inner"><div class="tweet-hd">'),type!="delete"&&type!="hidden"&&p.push('<a class="tweet-time link-lb" data-method="checkDetail" href="/',user.screenName,"/status/",id,'" target="_blank"><em class="tweet-root-time cDGray">',prettyTime,'</em><em class="tweet-root-detail">进入详情页</em></a>'),p.push("",require("_tmpl/tweet/widget/tweetUserName")(tmplData),"</div>"),type!="hidden"||type=="hidden"&&user.isLoginUser?p.push('<p class="tweet-message js-message">',richContent,"</p>",require("_tmpl/tweet/widget/mediaBox")(tmplData),""):p.push("",require("_tmpl/tweet/widget/hidden")(tmplData),""),p.push(""),type!="delete"&&(p.push("<div "),(type!="hidden"||type=="hidden"&&user.isLoginUser)&&p.push('class="tweet-ft js-foot"'),p.push(">",require("_tmpl/tweet/widget/source")(tmplData),""),type!="hidden"&&p.push('<div class="tweet-option link-lb"><a href="/',user.screenName,"/status/",id,'/retweet" class="need-login" target="_blank">原文转发',require("_tmpl/tweet/widget/counter")({type:"retweet",count:retweetCount}),'</a><a href="/',user.screenName,"/status/",id,'/reply" class="need-login" target="_blank">原文评论',require("_tmpl/tweet/widget/counter")({type:"reply",count:replyCount}),"</a></div>"),p.push("</div>")),p.push("</div>");return p.join("")}});define("_tmpl/tweet/projectTweet",function(require){return function(tmplData){var p=[];with(tmplData){p.push('<div class="tweet js-tweet" data-tweet-id="',id,'" data-tweet-type="',type,'">');if(!config.hideAvatar){p.push("");var tweetUser=user;p.push(""),tweetUser.config=config,p.push("",require("_tmpl/tweetUser")(tweetUser),"")}p.push('<div class="tweet-main"><div class="tweet-hd">'),config.noClickTime?p.push('<em class="tweet-time cDGray">',prettyTime,"</em>"):(p.push('<a class="tweet-time link-lb" data-method="checkDetail" href="/',user.screenName,"/status/",id,'" target="_blank">'),config.noChangeTime?p.push("",prettyTime,""):p.push('<em class="tweet-info-time cDGray">',prettyTime,'</em><em class="tweet-link-detail">进入详情页</em>'),p.push("</a>")),p.push("",require("_tmpl/tweet/widget/tweetUserName")(tmplData),"</div>"),type!="hidden"||type=="hidden"&&user.isLoginUser?(p.push('<p class="tweet-message js-message">',richContent,"</p>"),tmplData.relatedTweet.root&&type!=="reply"&&p.push("",require("_tmpl/tweet/widget/mediaBox")(tmplData),""),p.push(""),type!=="retweet"&&type!=="reply"&&p.push("",require("_tmpl/tweet/widget/mediaBox")(tmplData),"",require("_tmpl/tweet/widget/position")(tmplData),""),p.push("")):p.push("",require("_tmpl/tweet/widget/hidden")(tmplData),""),p.push("<div "),(type!="hidden"||type=="hidden"&&user.isLoginUser)&&p.push('class="tweet-ft js-foot"'),p.push(">",require("_tmpl/tweet/widget/source")(tmplData),'<div class="tweet-option link-lb">',require("_tmpl/tweet/widget/report")(tmplData),"",require("_tmpl/tweet/widget/delete")(tmplData),""),type!=="reply"&&p.push("",require("_tmpl/tweet/widget/retweet")(tmplData),"",require("_tmpl/tweet/widget/fav")(tmplData),""),p.push("",require("_tmpl/tweet/widget/reply")(tmplData),"</div></div></div></div>")}return p.join("")}});define("_tmpl/tweetUser",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<span class="tweet-author"><a class="avatar js-float-intro" data-keyfrom="avatar" href="/',screenName,'" title="',nickName,'" data-user-nickname="',nickName,'"><img alt="',nickName,'" src="',avatar,'" /></a>'),config&&config.showRelation&&p.push('<div class="tweet-relation js-relation user-',isFollowing?isFollowed?"mutualfollowed":"followed":"unfollowed",'"><a class="user-follow-btn follow-trigger" href="javascript:;"><em class="add-signS"></em>关注</a><span class="user-relation-box user-following-box"><i>已关注</i></span><span class="user-relation-box user-mutualfollow" title="你们在相互关注"><i><em class="icon-mutualfollow"></em></i></span></div>'),p.push("</span>");return p.join("")}});define("_tmpl/tweet/widget/report",function(require){return function(tmplData){var p=[];with(tmplData)p.push(""),!user.isLoginUser&&config.canBeReported&&type!=="hidden"&&p.push('<a class="tweet-option-report report-trigger need-login" title="举报这条微博" href="javascript:;">举报</a>'),p.push("");return p.join("")}});define("_tmpl/tweet/widget/delete",function(require){return function(tmplData){var p=[];with(tmplData)p.push(""),(user.isLoginUser||config.canBeDeleted)&&p.push('<a class="tweet-option-delete delete-trigger need-login" title="删除这条微博" href="javascript:;">删除</a>'),p.push("");return p.join("")}});define("_tmpl/tweet/widget/retweet",function(require){return function(tmplData){var p=[];with(tmplData)p.push(""),type!=="hidden"&&p.push('<a class="retweet-trigger need-login" title="转发这条微博" href="javascript:;">转发',require("_tmpl/tweet/widget/counter")({type:"retweet",count:retweetCount}),"</a>"),p.push("");return p.join("")}});define("_tmpl/tweet/widget/fav",function(require){return function(tmplData){var p=[];with(tmplData)p.push(""),type!=="hidden"&&p.push('<a class="fav-trigger need-login" data-favorited="',isFavorited,'" title="',isFavorited?"取消":"",'收藏这条微博" href="javascript:;">',isFavorited?"取消":"","收藏</a>"),p.push("");return p.join("")}});define("_tmpl/tweet/widget/reply",function(require){return function(tmplData){var p=[];with(tmplData)p.push(""),type!=="hidden"&&p.push('<a class="reply-trigger need-login" title="',type==="reply"?"回复":"评论",'这条微博" href="javascript:;">',type==="reply"?"回复":"评论","",require("_tmpl/tweet/widget/counter")({type:"reply",count:replyCount}),"</a>"),p.push("");return p.join("")}});define("_tmpl/tweet/normTweet",function(require){return function(tmplData){var p=[];with(tmplData){p.push('<div class="tweet js-tweet" data-tweet-id="',id,'" data-tweet-type="',type,'">');if(!config.hideAvatar){p.push("");var tweetUser=user;p.push(""),tweetUser.config=config,p.push("",require("_tmpl/tweetUser")(tweetUser),"")}p.push('<div class="tweet-main"><div class="tweet-hd">'),config.noClickTime?p.push('<em class="tweet-time cDGray">',prettyTime,"</em>"):(p.push('<a class="tweet-time link-lb" data-method="checkDetail" href="/',user.screenName,"/status/",id,'" target="_blank">'),config.noChangeTime?p.push("",prettyTime,""):p.push('<em class="tweet-info-time cDGray">',prettyTime,'</em><em class="tweet-link-detail">进入详情页</em>'),p.push("</a>")),p.push("",require("_tmpl/tweet/widget/tweetUserName")(tmplData),"</div>"),type!="hidden"||type=="hidden"&&user.isLoginUser?(p.push('<p class="tweet-message js-message '),tmplData.isHotTweet&&p.push("tweet-hot-message"),p.push('">',richContent,""),tmplData.isHotTweet&&p.push('<em class="icon-hotTop"></em>'),isColumnRank&&p.push('<a href="/column" target="_blank" title="热门专栏" data-method="reColumn"><em class="icon-column-recommend"></em></a>'),p.push("</p>"),tmplData.relatedTweet.root&&type!=="reply"&&p.push("",require("_tmpl/tweet/widget/mediaBox")(tmplData),""),p.push(""),type!=="retweet"&&type!=="reply"&&p.push("",require("_tmpl/tweet/widget/mediaBox")(tmplData),"",require("_tmpl/tweet/widget/position")(tmplData),""),p.push("")):p.push("",require("_tmpl/tweet/widget/hidden")(tmplData),""),p.push("",require("_tmpl/tweet/widget/tweetOptionBar")(tmplData),"</div></div>")}return p.join("")}});define("_tmpl/tweet/widget/tweetOptionBar",function(require){return function(tmplData){var p=[];with(tmplData)p.push("<div "),(type!="hidden"||type=="hidden"&&user.isLoginUser)&&p.push('class="tweet-ft js-foot"'),p.push(">",require("_tmpl/tweet/widget/source")(tmplData),'<div class="tweet-option link-lb">',require("_tmpl/tweet/widget/report")(tmplData),"",require("_tmpl/tweet/widget/manger")(tmplData),"",require("_tmpl/tweet/widget/delete")(tmplData),""),type!=="reply"&&(p.push(""),isShowDigg&&p.push("",require("_tmpl/tweet/widget/digg")(tmplData),""),p.push("",require("_tmpl/tweet/widget/retweet")(tmplData),"",require("_tmpl/tweet/widget/fav")(tmplData),"")),p.push("",require("_tmpl/tweet/widget/reply")(tmplData),"</div></div>");return p.join("")}});define("_tmpl/tweet/widget/manger",function(require){return function(tmplData){var p=[];with(tmplData)p.push(""),typeof showManger!="undefined"&&showManger&&type!=="hidden"&&p.push('<a class="tweet-option-manger manger-trigger" href="javascript:;"><span>管理<em></em></span></a>'),p.push("");return p.join("")}});define("_tmpl/map",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div class="tweet-map"><em class="icon-arrow-up js-arrow"></em><a class="icon-close close-trigger" title="关闭" href="javascript:;"></a><div class="tweet-map-main js-main"></div></div>');return p.join("")}});define("tweet/list/basic/NormTimeline",function(a,b,c){var d=a("external/jquery"),e=a("tweet/widget/MediaListManager"),f=a("tweet/NormTweet"),g=a("sendBox/talkBox/TalkBoxListManager"),h=a("tweet/list/basic/Timeline"),i=d(document.body),j=h.extend({init:function(a,b){this._super(a,b),this.bindEvent()},render:function(){this.$pager||(this.pager.initData(),this.$pager=this.pager.$elem,this.$pagerContainer.size()>0?this.$pager.appendTo(this.$pagerContainer):this.$elem.after(this.$pager));return this.$elem},bindEvent:function(){this._super(),this.talkBoxManager=new g,this.talkBoxManager.bindEvent(this.$elem),this.MediaManager=new e,this.MediaManager.bindEvent(this.$elem),this.$elem.delegate(".liItem","hover",d.proxy(this.onHover,this,"li-hover")).delegate(".js-tweet-root","hover",d.proxy(this.onHover,this,"tweet-root-hover"))},newItem:function(a,b){var c={html:b};return new f(a,c)},onNewTweets:function(a,b){var c=this.pager.config;if(b.length>30||c.pageMethod==="page"&&c.pageNo>1)d(".js-filterBox").find("a[data-type=all]").trigger("click");else{var e=null,f=this.$elem.children().filter(".pageLine").removeClass("pageLine").end().first();for(var g=0,h=b.length;g<h;g++)d.inArray(b[g].id,this.tweetList)===-1&&(e=this.add(this.newItem(b[g])),e.hide().insertBefore(f).fadeIn("fast",function(){d.browser.msie&&d(this).get(0).style.removeAttribute("filter")}));this.hideEmpty(),e&&e.addClass("pageLine"),i.trigger("preLoadImg")}},wrap:function(a){return a.wrap('<li class="liItem"></li>').parent()},onFilter:function(a,b){d.isPlainObject(this.pager.request)&&this.pager.request.readyState!==4&&(this.pager.request.abort(),this.pager.request.readyState=4),b&&b==="noticeFilter"?this.config.noticeFilterType=a:this.config.filterType=a,this.onRest(),this.tweetUpdater&&(this.config.filterType!=="all"?(this.tweetUpdater.config.isShow=!1,this.tweetUpdater.removePolling()):(this.tweetUpdater.config.isShow=!0,this.tweetUpdater.registerPolling()),this.tweetUpdater.tweets=[],this.tweetUpdater.sentTweets=[],this.$tweetUpdater.hide()),this.pager.initData()}});return j});define("tweet/widget/MediaListManager",function(a,b,c){var d=a("external/jquery"),e=a("basic/oop/Class"),f=e.extend({init:function(){this.openedMedia=null},bindEvent:function(a){this.elem=a,d(a).delegate(".js-tweet","open.MediaBox",d.proxy(this.onMediaOpen,this)).delegate(".js-tweet","close.MediaBox",d.proxy(this.onMediaClose,this)),d(document).delegate(".icon-music-pause","mousedown",d.proxy(this.closeMusic,this)),d(document.body).bind("tweet.closeAllMedia",d.proxy(function(){this.openedMedia&&this.openedMedia.onMediaClose()},this))},onMediaOpen:function(a,b,c){this.openedMedia!==null&&this.openedMedia.onMediaClose(),this.openedMedia=c},onMediaClose:function(a,b,c){this.openedMedia===c&&(this.openedMedia=null)},closeMusic:function(){this.openedMedia!==null&&this.openedMedia.onMediaClose(),this.openedMedia=null}});return f});define("tweet/list/ColumnTimelineList",function(a,b,c){var d=a("external/jquery"),e=a("widget/floatBox/sendBox/PublishBox"),f=a("widget/floatBox/FollowBox"),g=a("tweet/NormTweet"),h=a("widget/TipBox"),i=a("tweet/list/basic/NormTimeline"),j=a("model/UserData"),k=i.extend({init:function(a,b){this._super(a,b),this.columnId=this.$elem.attr("data-column-id"),this.columnName=this.$elem.attr("data-column-name"),this.userId=this.$elem.attr("data-user-id"),this.loginUser=j.getLoginUser(),this.columnUser=j.get(this.userId),this.columnNickName=this.columnUser.nickName,this.onWrite()},buildUrl:function(a){return this.columnId?"columnTimeline":"userColumnTimeline"},buildParam:function(a){var b;this.columnId?b=d.extend(this._super(a),{columnId:this.columnId}):b=d.extend(this._super(a),{userId:this.userId});return b},showEmpty:function(){if(this.$empty===null){var a="这位同学暂时没发过";a=this.loginUser.id!==this.userId?this.columnNickName+"暂时没发过":a,this.columnName?a=a+this.columnName+"相关的微博":a=a+"与微专栏相关的微博",this.$empty=(new h({content:a})).render()}this.$empty.appendTo(this.$elem)},newItem:function(a,b){return new g(a,{html:b,hideAvatar:!0})},onSent:function(a,b,c){b.type==="normal"&&b.user.id===this.userId&&this.updateNew(b)},onHash:function(){var a=window.location.href,b=window.location.hash,c=a.indexOf(b);if(c!=-1&&b!="")return a.slice(0,c);return a},onWrite:function(){var a=d(".js-column-btn"),b=d(".js-column-list"),c=this;if(a.size())if(this.loginUser.id!==this.userId)a.bind("onSuccess",function(a){var b=new f({id:c.userId,nickName:c.columnNickName,content:"关注后，即可在首页微专栏处查看Ta的微专栏"});setTimeout(function(){b.show()},1e3)}),a.click(function(){var b="@"+c.columnNickName+" 的微专栏非常不错，推荐大家查看并关注 "+c.onHash();if(c.columnUser.isFollowing===!1){var d=new e(null,{text:b,title:"分享微专栏",onHide:function(){a.trigger("onSuccess")}});d.show()}else(new e(null,{text:b,title:"分享微专栏"})).show()});else{var g=this.columnName?"#"+this.columnName+"#":"";a.click(function(){(new e(null,{text:g,title:"发布微专栏"})).show()})}}});return k});define("widget/floatBox/sendBox/PublishBox",function(a,b,c){var d=a("external/jquery"),e=a("widget/floatBox/Box"),f=a("sendBox/PublishBox"),g=a("utils/tmpl"),h=d(document.body),i=e.extend({defaultConfig:{title:"发微博",text:"",isTopic:!1},init:function(a,b){this._super(a,b),this.config=d.extend(this.defaultConfig,this.config),this.pubbox=null},preRender:function(){return{title:this.config.title,content:g.formatTemplate(a("_tmpl/dialogLayerPublishBox"),this.data)}},postRender:function(){this.$elem.addClass("poplayer-sendbox")},bindEvent:function(){this._super(),this.pubbox=new f(this.$elem.find(".js-publishBox")),this.$elem.bind("sent",d.proxy(this.onSent,this))},onSent:function(){this.config.onSent&&this.config.onSent(),this.hide()},show:function(){this._super(),this.pubbox.render();var a=this.config.isTopic?this.checkTopic(this.config.text):this.config.text;this.pubbox.textarea.clear().appendText(a)},checkTopic:function(a){return a.replace(/^(.{1})?([^#]+?)(.{1})?$/,function(a,b,c,d){var e=[];typeof b!="undefined"&&b!="#"?e.push("#"+b):e.push("#"),e.push(c),d&&d!="#"&&d!=" "?e.push(d+"# "):e.push("# ");return e.join("")})},hide:function(){this._super(),h.trigger("wgtHide"),h.trigger("click"),this.config.onHide&&this.config.onHide()}});return i});define("sendBox/PublishBox",function(a,b,c){var d=a("external/jquery"),e=a("sendBox/BasicSendBox"),f=a("sendBox/SendBoxAction"),g=a("sendBox/widget/PicUploadModule"),h=a("sendBox/widget/Topic"),i=a("sendBox/widget/AtInput"),j=a("utils/DataSource"),k=a("utils/Cookie"),l=a("sendBox/widget/TowerInput"),m=a("sendBox/widget/VoteInput"),n=a("sendBox/widget/VideoInput"),o=a("sendBox/widget/MusicInput"),p=a("sendBox/widget/PoiInput"),q=a("sendBox/widget/TopicGuide"),r=a("sendBox/InputError"),s=a("model/UserData"),t=a("sendBox/widget/picUpload/FloatTextToPic"),u=a("sendBox/widget/WordCounter"),v=e.extend({_timer:null,init:function(a,b){this._super(a,b),this.uploader=null,this.config.showTextCoverPic=!0},bindEvent:function(){this._super();var a=this;this.$textareaElem.bind("focus",function(){a.$elem.removeClass("disabled")}).bind("blur",function(){d.trim(this.value)===""&&a.$elem.addClass("disabled")}),this.picUploadModule=new g({trigger:this.$elem.find(".pic-trigger"),textarea:this.textarea}),this.towerInput=new l({trigger:this.$elem.find(".tower-trigger"),textarea:this.textarea}),this.atInput=i.getInstance(),this.atInput.bind(this.$elem.find(".at-trigger"),this.textarea),this.voteInput=new m({trigger:this.$elem.find(".vote-trigger"),textarea:this.textarea}),this.checkAddColumn(),this.videoInput=new n({trigger:this.$elem.find(".video-trigger"),textarea:this.textarea}),this.musicInput=new o({trigger:this.$elem.find(".music-trigger"),textarea:this.textarea}),this.poiInput=new p({trigger:this.$elem.find(".poi-trigger"),closeTrigger:this.$elem.find(".sendinfo-closePoi")});var b=this.$elem.find(".js-topicGuide");b.size()&&(this.topicGuide=new q({elem:b,textarea:this.textarea,publishBoxInsert:this.$elem.find(".publishBox-insert")})),this.config.saveInput&&this.textarea.$elem.bind("keyup",d.proxy(this.saveInput,this)),this.$elem.delegate(".textToPic-trigger","click",d.proxy(this.onTextToPic,this))},saveInput:function(){k.set("userInput",encodeURIComponent(this.textarea.$elem.val()),1)},onTextToPic:function(a){this.picUploadModule.$trigger.unbind("click").bind("click",d.proxy(this.picUploadModule.showByTextToPicBtn,this.picUploadModule)),this.picUploadModule.$trigger.trigger("click")},checkInput:f.checkInput,onCheckInput:function(){this._checkTimer&&clearTimeout(this._checkTimer);var a=this;this._checkTimer=setTimeout(function(){try{a.checkInput()}catch(b){if(b instanceof r){var c=Math.floor((u.MAX_LEN-u.count(a.textarea.$elem.val()))/2);c<=-10&&a.config.autoText2Pic&&a.config.autoText2Pic==!0&&b.message==="Invalid input length"?a.$btnElem.removeClass("disabled"):a.$btnElem.addClass("disabled");return}throw b}a.$btnElem.removeClass("disabled")},100)},onSubmit:function(a){if(s.getLoginUser()!=null){try{this.checkInput()}catch(b){if(!(b instanceof r))throw b;var c=Math.floor((u.MAX_LEN-u.count(this.textarea.$elem.val()))/2);if(c<=-10&&this.config.autoText2Pic&&this.config.autoText2Pic==!0&&b.message==="Invalid input length"){this.floatTextToPic=this.floatTextToPic||new t(this.textarea.$elem,{$container:d("body"),onSuccess:d.proxy(this.onSuccess,this)}),this.floatTextToPic.show(this.textarea.$elem.val(),c);return}this._super(a)}this._super(a)}},onSuccess:function(a){try{this.picUploadModule.uploader.hide()}catch(b){}try{this.towerInput.hide()}catch(b){}this.textarea.clear(),this.picUploadModule.imageUrl="",this.onBadgeTips(4),this.tip.show({type:"success",text:this.badgeNavTips!==null?this.badgeNavTips:"发布成功！"}),this.picUploadModule.$trigger.bind("click",d.proxy(this.picUploadModule.show,this.picUploadModule)),this.config.saveInput&&k.del("userInput")},checkAddColumn:function(){var b=this.$elem.attr("data-column"),c=b==undefined?!1:!0;if(c){var d=a("sendBox/widget/ColumnBox");this.microColumn=new d({trigger:this.$elem.find(".topic-trigger"),textarea:this.textarea,dataColumn:b=="true"?!0:!1})}else this.topicInputer=new h({trigger:this.$elem.find(".topic-trigger"),textarea:this.textarea})},getParams:function(){var a=this._super();a.imageUrl=this.picUploadModule.imageUrl;var b=this.poiInput.$trigger.data("poiId");b&&(a.poiId=b.substr(4)),this.textarea.$elem.val().indexOf(this.voteInput.voteName)>-1&&this.voteInput.voteUrl?a.voteUrl=this.voteInput.voteUrl:a.voteUrl="",a.gentieId=this.towerInput.gentieId||"";return a}});return v});define("sendBox/widget/PicUploadModule",function(a,b,c){var d=a("external/jquery"),e=a("widget/tinyBox/Box"),f=a("utils/tmpl"),g=a("utils/Utils"),h=a("model/UserData"),i=a("sendBox/widget/Uploader"),j=a("sendBox/widget/picUpload/PicNormal"),k=a("sendBox/widget/picUpload/PicMerge"),l=a("sendBox/widget/picUpload/TextToPic"),m=d(document.body),n=e.extend({init:function(a){this.$elem=null,this.$tab=null,this.$trigger=d(a.trigger),this.textarea=a.textarea,this.$trigger.bind("click",d.proxy(this.show,this)),this.imageUrl="",this.lastTabIndex=-1},uploaderInit:function(){this.uploader=new i({trigger:this.$elem.find(".insertPic-btn"),uploadPic:this.$trigger,elem:this.$elem,addFlashCallback:!0}),this.uploader.render().bind("uploaded",d.proxy(this.onUploaded,this)).bind("deleteUpload",d.proxy(this.onUploadDelete,this)).bind("rotated",d.proxy(this.onRotated,this))},moduleInit:function(){this.uploaderInit();var a={uploader:this.uploader,textarea:this.textarea,container:this.$elem,trigger:this.$trigger};new j(this.$container.find(" > div:eq(0)"),a),new k(this.$container.find(" > div:eq(1)"),a),new l(this.$container.find(" > div:eq(2)"),a)},preRender:function(){return{content:f.formatTemplate(a("_tmpl/insertPic"))}},bindEvent:function(){this.$elem.bind("widget.close",d.proxy(this.hide,this)),this.$elem.delegate(".close-trigger","click",d.proxy(this.hide,this)),this.$elem.delegate(".insertPic-tab a","click",d.proxy(this.changeTab,this)),m.bind("totalPageStart",d.proxy(this.onDelete,this)).bind("singlePageStart",d.proxy(this.onDelete,this))},onDelete:function(a){this.uploader.tmpUrl!==null&&(this.uploader.tmpUrl=null,this.uploader.hide(),this.autoClose(a))},onUploaded:function(a,b,c){var e=this.textarea.$elem.val(),c=c||"分享图片";d.trim(e)===""&&this.textarea.appendText(c),this.imageUrl=b,this.textarea.$elem.keyup(),this.textarea.$elem.focus(),m.unbind("click",d.proxy(this.autoClose,this))},onUploadDelete:function(a){this.textarea.toInputPos();var b=this.textarea.$elem;this.imageUrl="",b.val(b.val().replace(/^分享图片$/,"")),b.keyup()},onRotated:function(a,b){this.imageUrl=b},showByTextToPicBtn:function(a){this.show(),this.$tab.find("a:last").trigger("click"),m.unbind("click",d.proxy(this.autoClose,this)).unbind("wgtHide",d.proxy(this.wgtHide,this)),this.$elem.trigger("TextToPic.show",[a])},changeTab:function(a){var b=d(a.target),c=this.$tab.find("a").index(b);this.$tab.find("li.current").removeClass("current"),b.parent().addClass("current"),this.$container.find(" > div").hide(),this.$container.find(" > div:eq("+c+")").show();if(this.lastTabIndex!==c){this.stopUploading();switch(c){case 0:m.bind("click",d.proxy(this.autoClose,this));break;case 1:this.$elem.trigger("showPicMerge"),m.unbind("click",d.proxy(this.autoClose,this)).bind("wgtHide",d.proxy(this.wgtHide,this));break;case 2:this.$elem.trigger("showTextToPic"),m.unbind("click",d.proxy(this.autoClose,this)).bind("wgtHide",d.proxy(this.wgtHide,this))}this.lastTabIndex=c}},getScreenName:function(){return"t.163.com/"+h.getLoginUser().screenName},postRender:function(){this.$elem.addClass("winlayer-pic"),this.$tab=this.$elem.find(".insertPic-tab"),this.$container=this.$elem.find(".winlayer-pic-bd"),this.moduleInit()},stopUploading:function(){this.uploader.uploader.isUploading&&this.$elem.find("iframe").attr("src","about:blank")},show:function(a){m.unbind("click",d.proxy(this.autoClose,this)).bind("click",d.proxy(this.autoClose,this));var b=this.$trigger.offset();this._super(b),this.$elem.css({top:b.top+this.$trigger.height()+4,left:b.left-16}).show().find(".insertPic-tab a:first").trigger("click"),this.$elem.trigger("container.show"),m.trigger("wgtHide")},wgtHide:function(a){m.unbind("wgtHide",d.proxy(this.wgtHide,this)),this.autoClose(a)},hide:function(a){this.$elem.find("iframe").attr("src","about:blank"),this._super(),m.unbind("click",d.proxy(this.autoClose,this)).unbind("wgtHide",d.proxy(this.wgtHide,this)),clearTimeout(this.textToPicTimeout),this.lastTabIndex=-1,this.textarea.$elem.focus()},autoClose:function(a){if(!this.uploader.uploader.isUploading){var b=d(a.target).parents().andSelf();d.inArray(this.$elem[0],b)===-1&&d.inArray(this.$trigger[0],b)===-1&&this.hide()}}});return n});define("sendBox/widget/Uploader",function(a,b,c){var d=a("external/jquery"),e=a("utils/Utils"),f=a("utils/tmpl"),g=a("utils/log/Logger"),h=a("widget/tinyBox/Box").extend({tmpUrl:null,picMaxWidth:140,init:function(b){this._super.apply(this,arguments),this.config=this.data,delete this.data,this.$trigger=d(this.config.trigger),this.$uploadPic=d(this.config.uploadPic),this.$picUploadModuleElem=d(this.config.elem);var c=a("widget/FileUploader");this.uploader=new c({waterMark:"t.163.com/"+a("model/UserData").getLoginUser().screenName,onSuccess:d.proxy(this.onSuccess,this),onFail:d.proxy(this.onFail,this),onLoading:d.proxy(this.onLoading,this),trigger:this.$trigger,picUploadModuleElem:this.$picUploadModuleElem,addFlashCallback:this.config.addFlashCallback||!1}),this.uploader.$uploadElem.appendTo(this.$trigger);var e=this.$trigger;this.$trigger.unbind("mousemove").hover(function(){e.addClass("uploadPic-hover")},function(){e.removeClass("uploadPic-hover")})},postRender:function(){this.$elem.addClass("winlayer-uploadpic")},show:function(){var a={top:this.$uploadPic.offset().top+this.$uploadPic.height()+4,left:this.$uploadPic.offset().left-16};this._super(a)},onFail:function(a,b){this.$picUploadModuleElem.find(".insertPic-state").show(),this.$picUploadModuleElem.find(".insertPic-area").show(),this.$picUploadModuleElem.find(".insertPic-area-ing").hide()},onSuccess:function(b,c){this.show(),this.uploader.$elem.get(0).reset(),this.$picUploadModuleElem.hide(),this.tmpUrl=c.originalURL;var d=c.picText||"";this.$elem.find(".winlayer-body").html(f.formatTemplate(a("_tmpl/uploadSuccess"),{fileName:b,fileNameShort:e.countChars(b,18)})).trigger("uploaded",[this.tmpUrl,d]),this.rotatePicLoading(!0),this.initRotate(),this.bigImgArray[this.whirl]=this.tmpUrl,this.onPreviewImgLoaded(c)},initRotate:function(){this.whirl=0,this.smallImgArray=[],this.bigImgArray=[]},onPreviewImgLoaded:function(a){var b=this,c=new Image;c.onload=function(){d.browser.msie&&!this.fileSize&&this.load||(this.load=!0,b.$elem.find(".js-img").html(c),this.onload=null,b.rotatePicLoading(!1))},c.src=e.randomOimageUrl(a.originalURL,b.picMaxWidth,b.picMaxWidth),this.smallImgArray[this.whirl]=c.src},onLoading:function(b){this.$elem.find(".winlayer-body").html(f.formatTemplate(a("_tmpl/uploadLoading")))},bindEvent:function(){this.$elem.delegate(".delete-trigger","click",d.proxy(this.hide,this)),this.$elem.delegate(".rotate-trigger","click",d.proxy(this.onRotate,this))},rotatePicLoading:function(a){a?(this.$elem.find(".winlayer-body").addClass("winlayer-uploadpic-loading"),this.$elem.find(".js-rotate").removeClass("rotate-trigger"),this.uploader.isUploading=!0):(this.$elem.find(".winlayer-body").removeClass("winlayer-uploadpic-loading"),this.$elem.find(".js-rotate").addClass("rotate-trigger"),this.uploader.isUploading=!1)},countWhirl:function(a){var b=parseInt(d(a.currentTarget).data("direction"));b===1?this.whirl++:this.whirl--,this.whirl<0&&(this.whirl=4+this.whirl),this.whirl>3&&(this.whirl=0);return b},onRotate:function(a){a.preventDefault();var b=this.countWhirl(a),c=b>0?"rImage":"lImage";g.triggerLog(a.currentTarget,{method:c});if(this.smallImgArray[this.whirl])this.$elem.trigger("rotated",[this.bigImgArray[this.whirl]]),this.$elem.find(".js-img img").attr("src",this.smallImgArray[this.whirl]);else{var e=b>0?90:270,f="http://upload.buzz.163.com/rotate",h={imageUrl:this.tmpUrl,rotatedegree:e};this.rotatePicLoading(!0),this.Request=d.getJSON(f+"?callback=?",h,d.proxy(function(a){a&&a.originalURL&&(this.tmpUrl=a.originalURL,this.bigImgArray[this.whirl]=this.tmpUrl,this.$elem.trigger("rotated",[this.tmpUrl]),this.onPreviewImgLoaded(a))},this))}},hide:function(a){this.uploader.isUploading||(this.$elem.trigger("deleteUpload"),this._super(),g.triggerLog(a.currentTarget,{method:"deleteImage"}))}});return h});define("_tmpl/uploadLoading",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<span class="uploadPic-loadingImg"><span class="loading-icon"></span>正在上传</span>');return p.join("")}});define("sendBox/widget/picUpload/PicNormal",function(a,b,c){var d=a("external/jquery"),e=a("utils/Utils"),f=a("utils/tmpl"),g=a("basic/oop/Class"),h=a("sendBox/widget/Uploader"),i=g.extend({init:function(a,b){this.$elem=d(a),this.uploader=b.uploader,this.$container=d(b.container),this.$trigger=d(b.trigger),this.uploader=b.uploader,this.textarea=b.textarea,this.bindEvent()},bindEvent:function(){this.$container.bind("container.show",d.proxy(this.moduleShow,this))},moduleShow:function(){this.$elem.find(".insertPic-state").hide(),this.$elem.find(".insertPic-area-ing").hide(),this.$elem.find(".insertPic-area").show(),this.$elem.find("input[name=callback]").val("uploadImage"),this.uploader.uploader.$elem.get(0).reset(),window.uploadImageCallback=undefined,this.uploader.uploader.isUploading=!1}});return i});define("sendBox/widget/picUpload/PicMerge",function(a,b,c){var d=a("external/jquery"),e=a("utils/FlashProxy"),f=a("basic/oop/Class"),g=a("utils/Utils"),h=a("utils/log/Logger"),i=a("model/UserData"),j=a("external/swfobject"),k=f.extend({init:function(a,b){this.$elem=a,this.$container=d(b.container),this.$trigger=d(b.trigger),this.textarea=b.textarea,this.bindEvent(),this.lastWinHeight=0},picMergeAnalytics:function(){h.triggerLog(this.$elem,{method:"mImage"})},bindEvent:function(){this.$container.trigger("moduleBindEvent"),this.$container.bind("showPicMerge",d.proxy(this.renderSWF,this)),e.add({changeHeight:d.proxy(this.changeSwfCtnHeight,this)}),e.add({hidePicMergeWin:d.proxy(this.hidePicMergeWin,this)}),e.add({picMergeAnalytics:d.proxy(this.picMergeAnalytics,this)})},renderSWF:function(){this.$elem.attr("height",145);var a=this.getScreenName();j.embedSWF("http://static.t.126.net/frontend/flash/picMerge/picMerge_120720.swf","picMerge",442,68,"10.1.0","#ffffff","",{flashvars:"screenName="+a,allowScriptAccess:"always",wmode:"opaque"},"",function(a){!a.success})},hidePicMergeWin:function(){this.$container.trigger("widget.close");var a=parseInt(this.$container.css("top"))+parseInt(this.$container.css("height")),b=parseInt(g.windowHeight());a>b&&d.scrollTo(0),this.lastWinHeight=0},changeSwfCtnHeight:function(a){this.$elem.find("#picMerge").attr("height",a);if(this.lastWinHeight<a){var b=parseInt(this.$container.css("top"))+parseInt(this.$container.css("height")),c=parseInt(g.windowHeight());b>c&&d.scrollTo(b-c+50)}this.lastWinHeight=a},getScreenName:function(){return"t.163.com/"+i.getLoginUser().screenName}});return k});define("sendBox/widget/picUpload/TextToPic",function(a,b,c){var d=a("external/jquery"),e=a("basic/oop/Class"),f=a("utils/log/Logger"),g=a("external/swfobject"),h=a("sendBox/widget/picUpload/TextToPicElem"),i=e.extend({init:function(a,b){this.$elem=a,this.$container=d(b.container),this.$trigger=d(b.trigger),this.textarea=b.textarea,this.uploader=b.uploader,this.$loading=this.$elem.find(".insertPic-word-loading"),this.$state=this.$elem.find(".insertPic-state").hide(),this.$inputArea=this.$elem.find(".inputArea"),this.bindEvent(),this.$inputArea.val("")},bindEvent:function(){this.$elem.find(".submit-trigger").bind("click",d.proxy(this.onSubmit,this)),this.$elem.find(".cancel-trigger").bind("click",d.proxy(this.onCancel,this)),this.$container.bind("showTextToPic",d.proxy(this.render,this)),this.$container.bind("TextToPic.show",d.proxy(this.showByTextToPicBtn,this))},text2PicHandler:function(a){switch(a.status){case"success.inited":this.flashId=a.id;break;case"success.start":this.$elem.children().not("#"+this.flashId).hide(),this.$loading.show();break;case"success.data":this.uploader.onSuccess(a.data.file,{originalURL:a.data.originalURL,picText:a.data.picSubject+a.data.content}),d(document.body).unbind("wgtHide",d.proxy(this.wgtHide,this)),this.$elem.show().children().show(),this.$inputArea.val(""),this.$state.hide(),this.$loading.hide();break;case"error.invalidTextLength.1":case"error.invalidTextLength.2":case"error.forbidden":case"error.invalidWord":case"error.convertFail":case"error.timeout":this.$elem.children().show(),this.$loading.hide(),this.$state.html('<em class="icon-forbidS"></em>'+a.msg).show();break;case"error.notSupport":this.$elem.children().not(".js-textToPicTips").hide(),this.$elem.find(".js-textToPicTips").removeClass("hidden")}this.status=a.status},render:function(){this.textToPicElem=this.textToPicElem||new h(null,{$container:this.$elem,callBack:d.proxy(this.text2PicHandler,this),textCount:100}),this.$inputArea.focus()},onSubmit:function(a){this.$state.hide();var b=this.$inputArea.val();this.textToPicElem.doTextToPic(b),f.triggerLog(this.$elem.find(".submit-trigger"),{method:"TextToPhotoController"})},onCancel:function(a){this.textToPicElem.removeElem(),this.$container.trigger("widget.close")},showByTextToPicBtn:function(a){var b=this.uploader.$elem.find(".delete-trigger");this.$container.show();var c=this.textarea.$elem.val();this.$inputArea.val(c).focus(),this.textarea.$elem.val("").keyup(),b.length!=0&&b.trigger("click")}});return i});define("sendBox/widget/picUpload/TextToPicElem",function(a,b,c){var d=a("external/jquery"),e=a("basic/oop/Class"),f=a("utils/Utils"),g=a("utils/FlashProxy"),h=a("external/swfobject"),i=a("model/UserData"),j=e.extend({init:function(a,b){this.config=b,this.textToPicElem=null,this.lastId="",this.bindEvent()},bindEvent:function(){clearTimeout(this.textToPicTimeout);var a=f.S4()+f.S4(),b="text2Pic_success_"+a,c="text2Pic_fail_"+a,e="text2Pic_strLengthErr_"+a,h={};h[b]=d.proxy(this.onTextToPicSuccess,this),h[c]=d.proxy(this.onTextToPicFail,this),h[e]=d.proxy(this.onStrLengthErr,this),g.add(h),this.flashParam={flashvars:"onSuccess=flashProxy.callback."+b+"&onFail=flashProxy.callback."+c+"&onStrLengthErr=flashProxy.callback."+e,allowScriptAccess:"always",wmode:"opaque"},this.renderSWF()},renderSWF:function(){if(!this.textToPicElem){var a=this.config.$container.size()?this.config.$container:d("body"),b=this;this.removeElem();var c="textToPic"+f.S4()+f.S4();a.append('<div class="js-textTopic" id="'+c+'"></div>');var e="http://static.t.126.net/frontend/flash/textToPic/textToPic_20130128.swf";h.embedSWF(e,c,1,1,"10.0.0","#ffffff","",this.flashParam,"",function(a){if(a.success){b.textToPicElem=document.getElementById(c),b.textToPicElem.style.cssText+="position:absolute;left:-1000px;top:0;",b.lastId=c;var d={msg:"创建文转图dom成功",status:"success.inited",id:c};setTimeout(function(){b.config.callBack(d)},50)}else{b.textToPicElem=null;var d={msg:"不支持flash",status:"error.notSupport"};b.config.callBack(d)}})}},doTextToPic:function(a){this.renderSWF();var b=this;this.content=a;var c=a;if(d.trim(c)===""){var e={msg:"请输入文字",status:"error.invalidTextLength.0"};this.config.callBack(e)}else{if(f.strLen(c)>j.MAX_CONTENT_LENGTH){var g=Math.round((f.strLen(c)-j.MAX_CONTENT_LENGTH)/2),e={msg:"超出 "+g+" 字，请删减后再发",status:"error.invalidTextLength.1",data:{overflowCount:g}};this.config.callBack(e);return}clearTimeout(this.textToPicTimeout),this.textToPicTimeout=setTimeout(function(){b.onTextToPicTimeout()},6e4);var e={msg:"开始转换",status:"success.start"};this.config.callBack(e);try{setTimeout(function(){var a=i.getLoginUser().nickName||"";b.textToPicElem.drawPic(c,a)},50)}catch(h){}}},onTextToPicSuccess:function(a){clearTimeout(this.textToPicTimeout);var b=f.S4()+f.S4()+f.S4()+f.S4()+".jpg",c={msg:"转换成功",status:"success.data",data:{file:b,originalURL:a,picSubject:"#长文转图#",content:f.countChars(this.content,this.config.textCount)}};this.config.callBack(c),this.textToPicElem=null,this.renderSWF()},onTextToPicFail:function(a){clearTimeout(this.textToPicTimeout);if(a==1)var b="error.forbidden",c="很抱歉，内容含有敏感信息";else if(a==3)var b="error.invalidWord",c="内容含有不被支持的特殊字符";else var b="error.convertFail",c="转换失败，请重新尝试";var d={msg:c,status:b};this.config.callBack(d),clearTimeout(this.textToPicTimeout),this.textToPicElem=null,this.renderSWF()},onTextToPicTimeout:function(){var a={msg:"转换超时，请重试",status:"error.timeout"};this.config.callBack(a),clearTimeout(this.textToPicTimeout)},onStrLengthErr:function(){clearTimeout(this.textToPicTimeout);var a={msg:"请删减一些字符或空余的换行",status:"error.invalidTextLength.2"};this.config.callBack(a),this.textToPicElem=null,this.renderSWF()},removeElem:function(){this.textToPicElem=null,d("#"+this.lastId).remove()}});j.MAX_CONTENT_LENGTH=16e3;return j});define("_tmpl/insertPic",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div class="winlayer-hd"><a class="winlayer-close icon-close close-trigger" title="关闭" href="javascript:;"></a><ul class="winlayer-titleList insertPic-tab"><li class="current"><a hidefocus="true" href="javascript:;">上传图片</a></li><li><a hidefocus="true" href="javascript:;">多图拼接</a></li><li><a hidefocus="true" href="javascript:;">长文转图</a></li></ul></div><div class="winlayer-bd winlayer-pic-bd"><div class="winlayer-pic-area insertPic-con"><p class="winlayer-pic-area-tip text-tips text-tips-error insertPic-state"><em class="icon-forbidS"></em>仅支持jpg、gif、png和bmp格式的图片</p><div class="winlayer-pic-area-content insertPic-area"><span class="winlayer-pic-area-btn btn-middle btn-middle-red insertPic-btn"><em class="add-signS"></em>点击添加图片</span><p>（支持jpg、gif、png、bmp格式图片，不超过20M）</p></div><div class="winlayer-pic-loading insertPic-area-ing"><em class="icon-loadingS"></em>正在上传中，请稍等...</div></div><div class="winlayer-pic-merge insertPic-merge"><p>按住Ctrl键可一次选中并上传多张图片，拖动图片可以调整顺序</p><div id="picMerge" class="picMerge"><a target="_blank" href="http://www.adobe.com/go/getflashplayer"><img alt="获取 flash 播放器" src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif"></a><p>你还未安装 flash 播放器，请先下载安装。</p></div></div><div class="winlayer-pic-text insertPic-word"><p class="winlayer-pic-text-title">可以帮助你把一段文字转成图片发布（<em class="winlayer-num">8000</em>字以内），并保留原来的排版和外观。</p><div class="winlayer-pic-transfer"><textarea class="inputArea"></textarea><p class="winlayer-pic-text-tips"><em class="icon-logo-small"></em>网易微博长文转图</p></div><div class="winlayer-pic-text-ft clearfix insertPic-word-check"><p class="text-tips text-tips-error insertPic-state"><em class="icon-forbidS"></em>上传失败，请重新尝试！</p><div class="winlayer-btnbox"><a class="winlayer-btn-cancel submit-trigger" href="javascript:;">确定</a><a class="winlayer-btn-cancel cancel-trigger" href="javascript:;">取消</a></div></div><div class="winlayer-pic-loading insertPic-word-loading"><em class="icon-loadingS"></em>正在上传中，请稍等...</div><div class="textToPic js-textToPicTips hidden"><a target="_blank" href="http://www.adobe.com/go/getflashplayer"><img alt="获取 flash 播放器" src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif"></a><p>你还未安装 flash 播放器，请先下载安装。</p></div></div></div>');return p.join("")}});define("sendBox/widget/TowerInput",function(a,b,c){var d=a("external/jquery"),e=a("widget/tinyBox/Box"),f=a("utils/DataSource"),g=a("utils/tmpl"),h=a("utils/log/Logger"),i=d(document.body),j=e.extend({init:function(a){this.$elem=null,this.$trigger=d(a.trigger),this.textarea=a.textarea,this.isOpen=!1,this.gentieId="",this.$trigger.bind("click",d.proxy(this.show,this))},preRender:function(){return{content:g.formatTemplate(a("_tmpl/towerInput"))}},postRender:function(){this.$elem.addClass("winlayer-sendbox")},bindEvent:function(){this._super(),this.initSendBox()},initSendBox:function(){var b=a("sendBox/widget/tower/TowerCreateBox"),c=this.$elem.find(".js-publishBox");(new b(c,{target:this.$elem.find(".submit-trigger")})).render().bind("tower.create",d.proxy(this.onTowerCreate,this))},onRest:function(){this.isOpen=!1,this.$elem=null},show:function(a){if(!this.isOpen){var b=this.$trigger,c=b.offset();c.top=c.top+b.height()+4,c.left=c.left-126,this._super(c),this.$elem.find(".js-arrow").css({left:128}),this.$elem.find("textarea").focus().trigger("keyup"),this.isOpen=!0,i.trigger("wgtHide").bind("wgtHide",d.proxy(this.hide,this)),h.triggerLog(a.currentTarget,{method:"affixClick"})}},hide:function(){this._super(),this.onRest(),i.unbind("wgtHide",d.proxy(this.hide,this))},deleteTower:function(){this.hide(),this.gentieId=""},onTowerCreate:function(b,c,e,f){this.gentieId=c,this.$elem.removeClass("winlayer-sendbox").addClass("winlayer-towerPreview js-towerPreview").find(".winlayer-body").html(g.formatTemplate(a("_tmpl/towerIntro"),{txt:e})).delegate(".delete-trigger","click",d.proxy(this.deleteTower,this));var h=this.textarea.$elem,j=h.val();h.val(j+"我发起了一个盖楼："+f+" ").setCaretTo(h.val().length).keyup(),i.unbind("wgtHide",d.proxy(this.hide,this))}});return j});define("_tmpl/towerInput",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div class="winlayer-hd"><h3>发起盖楼</h3><a class="winlayer-close icon-close close-trigger" title="关闭" href="javascript:;"></a></div><div class="winlayer-bd"><h3>发起一个话题和大家一起讨论</h3><div class="tweet-publishBox js-publishBox"><div class="tweet-publishBox-hd"><div class="tweet-publishBox-textareaBox"><label class="tweet-publishBox-defaultTips js-default-tip">在一楼说点什么吧</label><textarea class="tweet-publishBox-textarea"></textarea></div></div><div class="tweet-publishBox-ft"><div class="clearfix"><div class="tweet-publishBox-operate"><div class="tweet-publishBox-btn"><a class="submit-trigger disabled" href="javascript:;">盖楼</a></div><span class="tweet-publishBox-tip js-wordCounter">还可以输<span class="char-constantia">163</span>字</span></div></div></div></div></div>');return p.join("")}});define("sendBox/widget/tower/TowerCreateBox",function(a,b,c){var d=a("external/jquery"),e=a("sendBox/widget/tower/TowerSendBox"),f=a("sendBox/SendBoxAction"),g=a("utils/DataSource"),h=a("utils/log/Logger"),i=e.extend({bindEvent:function(){this._super(),f.bindDefaultTip.apply(this)},doSubmit:function(){var a={content:this.textarea.$elem.val()};g.postJSON("towerCreate",a,d.proxy(this.onSuccess,this)).error(d.proxy(this.onFail,this)),h.triggerLog(this.config.target,{method:"affixAdd"})},onSuccess:function(a){if(this._super(a)){var b=a.simpleTower.gentieId,c=a.simpleTower.content,d=a.simpleTower.textareaContent;this.$elem.trigger("tower.create",[b,c,d])}}});return i});define("_tmpl/towerIntro",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div class="winlayer-bd"><pre class="winlayer-towerPreview-text">',txt,'</pre><div class="winlayer-linkb"><a class="delete-trigger" href="javascript:;">删除盖楼</a></div></div>');return p.join("")}});define("sendBox/widget/VoteInput",function(a,b,c){var d=a("external/jquery"),e=a("widget/tinyBox/Box"),f=a("utils/DataSource"),g=a("utils/tmpl"),h=a("utils/Utils"),i=a("widget/DatePicker"),j=a("utils/log/Logger"),k=a("widget/FileUploader"),l=a("model/UserData"),m=d(document.body),n=e.extend({init:function(a){this.$elem=null,this.$trigger=d(a.trigger),this.textarea=a.textarea,this.voteName="",this.voteUrl="",this.voteDesc="",this.voteCover="",this.smallCoverUrl="",this.timer=null,this.optionIndex=3,this.optionsArr=[],this.isShowDesc=!1,this.isOpen=!1,this.canSubmit=!1,this.$uploading=h.LOADING_SMALL.replace("$text$","上传中..."),this.$trigger.bind("click",d.proxy(this.show,this))},preRender:function(){return{content:g.formatTemplate(a("_tmpl/voteInput"))}},postRender:function(){this.$elem.addClass("winlayer-vote"),this.$title=this.$elem.find(".js-title"),this.$descTri=this.$elem.find(".desc-trigger"),this.$optionBox=this.$elem.find(".js-option-box"),this.$optionTri=this.$elem.find(".option-trigger"),this.$submitTri=this.$elem.find(".submit-trigger"),this.$uploadBox=this.$elem.find(".js-upload-box"),this.$uploadResult=this.$elem.find(".js-upload-result"),i.init(this.$elem.find(".js-date-input"))},bindEvent:function(){this._super(),this.$title.bind("keyup",d.proxy(this.onTitle,this)),this.$elem.delegate(".submit-trigger","click",d.proxy(this.onSubmit,this)).delegate(".desc-trigger","click",d.proxy(this.addDescription,this)).delegate(".option-trigger","click",d.proxy(this.addOptions,this)).delegate(".js-select-date","click",d.proxy(this.selectDate,this)).delegate(".js-option-box > input","keyup",d.proxy(this.onOption,this)).delegate(".js-desc","keyup",d.proxy(this.checkDesc,this)).delegate(".js-upload-close","click",d.proxy(this.deleteUpload,this)).delegate(".js-desc, .js-title, .js-option-box > input","keyup",d.proxy(function(){this.onRight(this.$submitTri)},this)),this.initUploader()},onRecover:function(a){var b=a.find(".js-tips");this.onTextTips(b,"hide")},onError:function(a,b,c){var d=a.parent().find(".js-tips:first"),c=d.attr("data-type")||c;this.onTextTips(d,"error",b),c&&(this.canSubmit=!1)},onRight:function(a,b){var c=a.parent(),b=c.find(".js-tips:first").attr("data-type")||b;this.onRecover(c),b&&(this.canSubmit=!0)},unFold:function(a){a.parent().addClass("winlayer-vote-show")},onFold:function(a){a.parent().removeClass("winlayer-vote-show")},onTitle:function(){var a=this.$title,b=d.trim(a.val()),c=h.strLen(b);if(!b||50<c){var e=50<c?"标题不能超过25个汉字":"请填写投票标题";this.onError(a.parent().parent(),e,!0)}else this.onRight(a.parent().parent(),!0),this.voteName=b},addDescription:function(){var a=this.$descTri;this.isShowDesc?(this.onFold(a),this.isShowDesc=!1):(this.unFold(a),a.parent().find(".js-desc").focus().keyup(),this.isShowDesc=!0)},checkDesc:function(){var a=this.$elem.find(".js-desc"),b=d.trim(a.val()),c=!1;h.strLen(b)>200?(this.onError(a,"说明不能超过100个汉字"),c=!1):(this.onRight(a),this.voteDesc=b,c=!0);return c},addOptions:function(){var a=20;this.optionIndex++,this.optionIndex<=a&&(this.$optionBox.append('<input type="text" class="winlayer-input"/>').find("input:last").focus(),this.optionIndex==a&&this.$optionTri.hide())},selectDate:function(a){var b=d(a.target),c=b.parent();this.timer&&clearTimeout(this.timer),b.prop("checked")?(this.unFold(c),this.timer=setTimeout(function(){c.siblings(".js-date-input").focus()},100)):this.onFold(c)},onOption:function(){this.intervalTime&&clearTimeout(this.intervalTime);var a=this.$optionBox.find("input"),b=this,c=[];this.intervalTime=setTimeout(function(){a.each(function(){var a=d.trim(d(this).val());h.strLen(a)>36&&c.push(0)}),d.inArray(0,c)==-1?b.onRight(b.$optionBox):b.onError(b.$optionBox,"每条选项不能超过18个汉字")},100)},onSubmit:function(a){this.onTitle(),this.isShowDesc&&(this.canSubmit=this.checkDesc()?!0:!1),this.optionsArr=[];var b=this;this.$optionBox.find("input").each(function(){input=d.trim(d(this).val()),input!=""&&b.optionsArr.push(input)}),this.optionsArr.length<2?this.onError(this.$optionBox,"最少填写2项"):this.onOption(),this.canSubmit&&this.doSubmit(a)},doSubmit:function(a){var b=this.$elem,c=d(a.target),e=d.trim(b.find(".js-date-input").val()),g=b.find(".js-type").prop("checked")?0:1,h=e!=""?e:"",i={title:this.voteName,description:this.voteDesc,option:this.optionsArr,voteType:g,endTime:h,coverurl:this.voteCover,smallCoverurl:this.smallCoverUrl};f.setKeyFrom(c).postJSON("voteCreate",i,d.proxy(this.onSuccess,this)).error(d.proxy(this.onFail,this)),j.triggerLog(c,{method:"voteAdd"})},onSuccess:function(a){if(a.status=="badParameter")this.onError(this.$submitTri,"投票发起失败");else{if(a.status=="forbidden"){this.onError(this.$submitTri,"很抱歉，内容含有敏感信息");return}var b=this.textarea.$elem,c=b.val();this.voteName="【"+a.title+"】",this.voteUrl=a.url,b.val(c+"我发起了一个投票"+this.voteName+" ").setCaretTo(b.val().length).keyup(),m.unbind("wgtHide",d.proxy(this.wgtHide,this)),this.isOpen=!1,this.hide()}},onFail:function(){this.onError(this.$submitTri,"投票发起失败，请稍后再试")},onRest:function(){this.voteName="",this.voteUrl="",this.voteDesc="",this.voteCover="",this.smallCoverUrl="",this.optionIndex=3,this.onRecover(this.$elem),this.$elem.find(".js-show").removeClass("winlayer-vote-show"),this.$title.val("").focus(),this.$elem.find(".js-desc, .js-date-input").val(""),this.$optionTri.show(),this.$optionBox.find("input:gt(2)").remove().end().find("input").val(""),this.$elem.find(".js-type").attr("checked","checked").end().find(".js-select-date").removeAttr("checked")},initUploader:function(){var a=this.$elem.find(".js-upload");this.uploader=new k({waterMark:"t.163.com/"+l.getLoginUser().screenName,onSuccess:d.proxy(this.onUploadSuccess,this),onFail:d.proxy(this.onUploadFailed,this),onLoading:d.proxy(this.onUploadLoading,this),trigger:a}),this.uploader.$uploadElem.appendTo(a),a.unbind("mousemove")},onUploadImage:function(a,b){this.$uploadResult.html(b);var c=b.width,d=b.height,e=a.originalURL;if(c<95||d<115)this.onUploadFailed("图片尺寸不得小于95px * 115px");else{this.onRight(this.$uploadBox.parent());if(c>=d){var f=parseInt(c*115/d);b.setAttribute("width",f),b.setAttribute("height",115),this.smallCoverUrl=h.randomOimageUrl(e,f,115)}else{var g=parseInt(d*95/c);b.setAttribute("width",95),b.setAttribute("height",g),this.smallCoverUrl=h.randomOimageUrl(e,95,g)}}},onUploadSuccess:function(a,b){this.voteCover=b.originalURL,this.uploader.$elem.get(0).reset();var c=this,e=new Image;e.src=b.originalURL,e.onload=function(){d.browser.msie&&!this.fileSize&&this.load||(c.onUploadImage(b,e),this.load=!0,this.onload=null)}},onUploadFailed:function(a){var b=a?a:"图片格式错误";this.onError(this.$uploadBox.parent(),b),this.deleteUpload()},onUploadLoading:function(){this.$uploadBox.show(),this.$uploadResult.html(this.$uploading)},deleteUpload:function(){this.voteCover="",this.smallCoverUrl="",this.$uploadResult.html(""),this.$uploadBox.hide()},show:function(a){if(!(this.textarea.$elem.val().indexOf(this.voteName)>-1&&d.trim(this.voteName)!="")){if(this.isOpen)return;var b=this.$trigger.parents(".js-body"),c=b.offset();c.top=c.top+b.outerHeight(),c.left=this.$trigger.offset().left-17,this._super(c),this.onRest(),this.isOpen=!0,m.trigger("wgtHide").bind("wgtHide",d.proxy(this.wgtHide,this))}},hide:function(){this._super(),d(document).trigger("click"),m.unbind("wgtHide",d.proxy(this.wgtHide,this)),this.isOpen=!1,this.deleteUpload()},wgtHide:function(a){m.unbind("wgtHide",d.proxy(this.wgtHide,this)),this.isOpen=!1,this.autoClose(a)},autoClose:function(a){var b=d(a.target).parents().andSelf();d.inArray(this.$elem[0],b)===-1&&d.inArray(this.$trigger[0],b)===-1&&this.hide()}});return n});define("widget/DatePicker",function(a,b,c){var d=a("external/jquery"),e=a("utils/tmpl"),f={$inputElem:null,$elem:null,timer:null,config:{isFillZero:!0,showPosition:"bottom",offsetHeight:0},init:function(a,b){var c=new Date;d.extend(this.config,b),this.year=c.getFullYear(),this.current_year=c.getFullYear(),this.month=c.getMonth()+1,this.current_month=c.getMonth()+1,this.day=c.getDate(),this.current_day=c.getDate(),this.$inputElem=a,d(".calendar").size()==0?this.$elem=d('<div class="calendar"/>').appendTo(document.body):this.$elem=d(".calendar"),this.bindEvent()},bindEvent:function(){this.$inputElem.bind("focus",d.proxy(this.renderCalendar,this)),d(document).bind("click",d.proxy(this.calendarHide,this)),this.$elem.delegate("td:not(.disabled)","click",d.proxy(this.fillInto,this)),this.$elem.delegate(".prev-trigger","click",d.proxy(this.prevMonth,this)),this.$elem.delegate(".next-trigger","click",d.proxy(this.nextMonth,this))},getData:function(){var a=new Date(this.year,this.month-1,1),b=new Date(this.year,this.month,0),c={first_day:a.getDay(),total_day:b.getDate(),current_year:this.current_year,current_month:this.current_month,current_day:this.current_day,year:this.year,month:this.month,day:this.day};return c},renderCalendar:function(){var b=this.getData(),c=this.$inputElem.offset(),f=c.left,g=c.top;this.$elem.html(e.formatTemplate(a("_tmpl/calendar"),b)),this.$elem.css({position:"absolute",left:f,top:g+this.getTop()}),this.$elem.fadeIn("fast",function(){d.browser.msie&&this.style.removeAttribute("filter")})},getTop:function(){var a=0;this.config.showPosition=="top"?a=-this.$elem.height():this.config.offsetHeight!=0&&this.config.showPosition=="bottom"?a=this.config.offsetHeight:a=this.$inputElem.height();return a},fillInto:function(a){var b=d(a.target),c=b.text(),e=String(this.month).length>1?this.month:"0"+this.month,f=c.length>1?c:"0"+c,g=this.year+"-"+e+"-"+f;this.$inputElem.val(g),this.$elem.fadeOut("fast",function(){d.browser.msie&&this.style.removeAttribute("filter")})},calendarHide:function(a){if(!!this.$elem.is(":visible")){var b=this,c=this.$elem.offset(),e=c.left,f=c.top,g=d(a.target),h=g.parent().html()==this.$inputElem.parent().html()?!0:!1,i=g.parents(".calendar").size()!=0?!0:!1,j=typeof g.attr("class")!="undefined"&&g.attr("class").indexOf("prev-trigger")!=-1?!0:!1,k=typeof g.attr("class")!="undefined"&&g.attr("class").indexOf("next-trigger")!=-1?!0:!1;!h&&!i&&!j&&!k&&b.$elem.fadeOut("fast",function(){d.browser.msie&&this.style.removeAttribute("filter")})}},prevMonth:function(a){this.month>1?this.month-=1:(this.year-=1,this.month=12),this.renderCalendar()},nextMonth:function(a){this.month<12?this.month+=1:(this.year+=1,this.month=1),this.renderCalendar()}};return f});define("_tmpl/calendar",function(require){return function(tmplData){var p=[];with(tmplData){p.push("");var day_num=1;p.push("");var className="";p.push('<div class="hd"><a href="javascript:;" class="calendar-prevBtn prev-trigger">&lt;&lt;</a><b class="calendar-dateInfo">',year,"年",month,'月</b><a href="javascript:;" class="calendar-nextBtn next-trigger">&gt;&gt;</a></div><div class="bd"><table><tr><th>日</th><th>一</th><th>二</th><th>三</th><th>四</th><th>五</th><th>六</th></tr><tr>');for(var i=1;i<=42;i++)p.push(""),first_day<i&&i<=total_day+first_day?(p.push(""),day_num=i-first_day,p.push(""),year<current_year||year==current_year&&month<current_month?(p.push(""),className="disabled",p.push("")):year==current_year&&month==current_month&&day_num<current_day?(p.push(""),className="disabled",p.push("")):year==current_year&&month==current_month&&day_num==current_day?(p.push(""),className="current",p.push("")):(p.push(""),className="",p.push("")),p.push('<td class="',className,'"><a hidefocus="true" href="javascript:;">',day_num,"</a></td>")):p.push("<td>&nbsp;</td>"),p.push(""),i%7==0&&i<42&&p.push("</tr><tr>"),p.push("");p.push("</tr></table></div>")}return p.join("")}});define("_tmpl/voteInput",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div class="winlayer-hd"><h3>发起投票</h3><a title="关闭" class="winlayer-close icon-close close-trigger" href="javascript:;"></a></div><div class="winlayer-bd winlayer-vote-bd"><dl class="winlayer-item"><p class="winlayer-tips winlayer-vote-title-tips js-tips"><span class="text-tips js-text"></span></p><dt class="winlayer-item-left">投票标题：</dt><dd class="winlayer-item-right"><div class="winlayer-input"><input type="text" class="js-title"/></div><div title="插入封面图" class="pos-rel js-upload"><em class="icon-pic"></em></div><div class="winlayer-upload js-upload-box"><a title="删除封面" class="icon-close js-upload-close" href="javascript:;"></a><div class="js-upload-result"></div></div></dd></dl><dl class="winlayer-item"><dt class="winlayer-item-left">&nbsp;</dt><dd class="winlayer-vote-desc winlayer-item-right js-show"><a href="javascript:;" class="winlayer-vote-link winlayer-linkb desc-trigger"><em class="add">+添加</em><em class="cancel">-取消</em>说明</a><div class="winlayer-vote-textarea"><p class="winlayer-tips js-tips"><span class="text-tips js-text"></span></p><textarea class="js-desc winlayer-textarea"></textarea></div></dd></dl><dl class="winlayer-item"><dt class="winlayer-item-left">投票选项：</dt><dd class="winlayer-vote-option winlayer-item-right"><div class="js-option-box"><input type="text" class="winlayer-input"/><input type="text" class="winlayer-input"/><input type="text" class="winlayer-input"/></div><p class="winlayer-tips js-tips" data-type="option"><span class="text-tips js-text"></span></p><a href="javascript:;" class="winlayer-vote-link winlayer-linkb option-trigger">+添加选项</a></dd></dl><dl class="winlayer-item"><dt class="winlayer-item-left">投票方式：</dt><dd class="winlayer-vote-type winlayer-item-right"><label><input type="radio" class="js-type" name="voteType" checked>单选</label><label><input type="radio" name="voteType">多选</label><div class="winlayer-vote-date js-show"><label><input type="checkbox" class="js-select-date">截止时间</label><input type="text" class="icon-date js-date-input" readonly="readonly"></div></dd></dl><div class="winlayer-vote-submit clearfix"><a class="winlayer-btn-sure submit-trigger" href="javascript:;">确定</a><p class="winlayer-tips js-tips"><span class="text-tips js-text"></span></p></div></div>');return p.join("")}});define("sendBox/widget/VideoInput",function(a,b,c){var d=a("external/jquery"),e=a("widget/tinyBox/Box"),f=a("utils/tmpl"),g=a("utils/Utils"),h=a("utils/log/Logger"),i=d(document.body),j=e.extend({init:function(a){this.$elem=null,this.$trigger=d(a.trigger),this.textarea=a.textarea,this.$trigger.bind("click",d.proxy(this.show,this))},preRender:function(){return{content:f.formatTemplate(a("_tmpl/videoInput"))}},postRender:function(){this.$elem.addClass("winlayer-video"),this.$searchInput=this.$elem.find(".js-searchInput"),this.$panels=this.$elem.find(".js-panel"),this.initWidgets()},bindEvent:function(){this._super(),this.$elem.delegate(".js-titleList li","click",d.proxy(this.onTabSwitch,this)).delegate(".upload-trigger","click",d.proxy(this.openWin,this))},openWin:function(){var a=726,b=323,c=(screen.availWidth-a)/2,d=(screen.availHeight-b)/2,e=["width="+a,"height="+b,"left="+c,"top="+d,"scrollbars=no,resizable=no"];window.open("/videoUpload/ku6Upload","_blank",e.join(",")),h.triggerLog(this.$elem,{method:"upVideo"})},initWidgets:function(){var b=a("sendBox/widget/video/OnlineVideo"),c=a("sendBox/widget/video/SearchVideo");this.onlineVideo=new b(this.$elem.find(".js-online"),{textarea:this.textarea,parent:this}),this.searchVideo=new c(this.$elem.find(".js-search"),{textarea:this.textarea,parent:this})},onTabSwitch:function(a){var b=d(a.currentTarget).addClass("current").siblings(".current").removeClass("current").end().prevAll().size();this.$panels.eq(b).trigger("show.widget").removeClass("hidden").siblings().addClass("hidden"),h.triggerLog(this.$panels.eq(b),{method:"video"})},show:function(a){i.trigger("wgtHide").bind("wgtHide",d.proxy(this.hide,this));var b=this.$trigger,c=b.offset();c.top=c.top+b.height()+4,c.left=c.left-208,this._super(c),this.$elem.find(".js-titleList li.current").click(),h.triggerLog(this.$elem,{method:"video"})},hide:function(a){this.$elem.find(".js-onlineInput").val("").blur(),this._super(),i.unbind("wgtHide",d.proxy(this.hide,this))}});return j});define("_tmpl/videoInput",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div class="winlayer-hd"><a class="winlayer-close icon-close close-trigger" title="关闭" href="javascript:;"></a><ul class="winlayer-titleList js-titleList"><li class="current"><a href="javascript:;" hidefocus="true">在线视频</a></li><li><a href="javascript:;" hidefocus="true">视频搜索</a></li><li><a href="javascript:;" hidefocus="true">本地上传</a></li></ul></div><div class="winlayer-bd winlayer-video-bd"><div class="winlayer-video-online js-online js-panel" data-keyfrom="online"><div class="video-online-hd"><p class="video-online-desc">支持优酷、土豆、酷6、56等视频站点</p></div><div class="video-online-bd"><input class="winlayer-input js-onlineInput" data-blank="粘贴视频播放页地址" type="text" /><div class="video-icon-right"><a href="javascript:;" title="确定" class="video-online-submit js-submit"><em class="icon-guide-arrow"></em></a></div></div><div class="video-online-ft"><p class="winlayer-tips js-tips"><span class="text-tips js-text text-tips-error"><em class="icon-forbidS"></em>请输入正确的视频地址</span></p></div></div><div class="winlayer-video-search js-search js-panel hidden" data-keyfrom="search"><div class="video-search-bd"><div class="search-hd"><input class="winlayer-input js-searchInput" data-blank="输入视频关键字搜索" type="text" /><ul class="video-searchSuggest-list hidden js-suggestList"></ul><div class="video-icon-right"><a href="javascript:;" title="搜索" class="video-online-search search-trigger js-btn"><em class="icon-search-gray"></em></a></div></div><div class="search-bd"><p class="winlayer-tips js-tips"></p><p class="winlayer-tips gray js-resultTips"></p><ul class="video-list js-list"></ul></div></div><div class="video-search-ft"><p class="video-cooperation-desc">视频服务由<a target="_blank" href="http://www.ku6.com" class="winlayer-linkb">酷6网</a>提供</p><div class="winlayer-page js-page"></div></div></div><div class="winlayer-video-upload js-upload js-panel hidden" data-keyfrom="up"><div class="video-upload-bd"><a href="javascript:;" class="winlayer-btn-sure upload-trigger">上传视频</a></div><div class="video-upload-ft"><p class="video-cooperation-desc">视频存储服务由<a target="_blank" href="http://www.ku6.com" class="winlayer-linkb">酷6网</a>提供</p></div></div><p class="winlayer-tips js-tips"><span class="text-tips text-tips-error js-text"></span></p></div>');return p.join("")}});define("sendBox/widget/video/OnlineVideo",function(a,b,c){var d=a("external/jquery"),e=a("basic/oop/Class"),f=a("utils/DataSource"),g=a("utils/Utils"),h=a("utils/log/Logger"),i=e.extend({init:function(a,b){this.textarea=b.textarea,this.$elem=a,this.config=b,this.bindEvent()},bindEvent:function(){this.$input=this.$elem.find(".js-onlineInput"),this.$tips=this.$elem.find(".js-tips"),g.onBindInputAction(this.$input),this.$elem.delegate(".js-submit","click",d.proxy(this.doSubmit,this)),this.$elem.bind("show.widget",d.proxy(this.onShow,this))},onShow:function(a){var b=this;this.config.parent.onTextTips(this.$tips,"hide")},doSubmit:function(){if(!d.isPlainObject(this.request)||this.request.readyState===4){var a=this.config.parent,b=d.trim(this.$input.val());g.URL_REG.lastIndex=0;if(g.URL_REG.test(b)===!1){a.onTextTips(this.$tips,"error","请输入正确的视频地址");return}this.request=f.setKeyFrom(this.$elem).postJSON("video",{url:b},d.proxy(this.onDataBack,this)).error(d.proxy(function(){a.onTextTips(this.$tips,"error",i.ERROR_INFO)},this)),h.triggerLog(this.config.parent.$elem,{method:"parse"})}},onDataBack:function(a){var b=this.config.parent;a&&a.title&&a.shortUrl?(b.onTextTips(this.$tips,"hide"),this.textarea.appendText(a.title+"："+a.shortUrl),this.textarea.$elem.keyup(),b.hide()):b.onTextTips(this.$tips,"error",i.ERROR_INFO)}});i.DEFAULT_VAL="粘贴视频播放页地址",i.ERROR_INFO="抱歉，没有找到该网址的视频信息，请作为普通链接发布。";return i});define("sendBox/widget/video/SearchVideo",function(a,b,c){var d=a("external/jquery"),e=a("basic/oop/Class"),f=a("utils/DataSource"),g=a("utils/Utils"),h=a("utils/tmpl"),i=a("sendBox/widget/video/VideoSuggest"),j=a("utils/log/Logger"),k=e.extend({init:function(a,b){this.textarea=b.textarea,this.$elem=a,this.config=b,this.$suggest=this.$elem.find(".js-suggestList"),this.videoSuggest=new i(this.$suggest),this.$loading=d(g.LOADING_BIG.replace("$text$","搜索中...")),this.bindEvent()},bindEvent:function(){this.$input=this.$elem.find(".js-searchInput"),this.$tips=this.$elem.find(".js-tips"),this.$rTips=this.$elem.find(".js-resultTips"),this.$list=this.$elem.find(".js-list"),g.onBindInputAction(this.$input,d.proxy(this.onFocus,this),d.proxy(this.onBlur,this)),this.$elem.bind("show.widget",d.proxy(this.onShow,this)).delegate(".search-trigger","click",d.proxy(this.onSearch,this)),this.$list.delegate("li","hover",function(a){a.type==="mouseenter"&&d(this).addClass("hover")||d(this).removeClass("hover");return!1}).delegate("li","click",d.proxy(this.onParseUrl,this)),this.$input.bind("keyup",d.proxy(this.onKeyUp,this)),this.$suggest.bind("select",d.proxy(this.onSuggestSelect,this)),this.$pagerContainer=this.$elem.find(".js-page"),this.$pagerContainer.bind("onPage",d.proxy(this.onPageStart,this)),this.pager=this.initPager(),this.pager.$elem.appendTo(this.$pagerContainer)},onFocus:function(){var a=this.$input.data("blank");d.trim(this.$input.val())!==a&&(this.videoSuggest.bindEvent(),this.suggestJson&&this.$suggest.removeClass("hidden").show())},onBlur:function(){var a=this;setTimeout(function(){a.hideSuggest()},200)},onKeyUp:function(a){this.delay&&clearTimeout(this.delay);var b=this,c=d.trim(this.$input.val());if(!c)this.hideSuggest();else{var e=a.which;if(d.inArray(e,[37,38,39,40])===-1){if(e===13){!this.$suggest.find("li.current").size()&&this.onSearch(c);return}var b=this;this.delay=setTimeout(function(){f.setKeyFrom(b.$elem).postJSON("ku6SuggestKey",{key:c},d.proxy(b.onSuggest,b)).error(d.proxy(b.onSuggestErr,b))},300)}}},onSuggest:function(a){this.suggestJson=a;if(a&&a.keys&&a.keys.length){a.keys=typeof a.keys=="string"?d.parseJSON(a.keys):a.keys;var b=[];for(var c=0,e=a.keys.length;c<e;c++)b.push('<li n="'+a.keys[c].kOld+'">'+a.keys[c].k+"</li>");this.$suggest.removeClass("hidden");var f=b.join("");this.videoSuggest.show(f)&&this.$suggest.html(f),this.$suggest.show(),this.videoSuggest.bindEvent()}else this.hideSuggest(),this.onSuggestErr()},onSuggestErr:function(){this.suggestJson=null},onSuggestSelect:function(a,b){this.$suggest.find("li.current").size()&&(this.$input.val(b),this.onSearch(b)),this.hideSuggest()},onSearch:function(a){this.onTip(),this.keyword=a&&typeof a=="string"?a:d.trim(this.$input.val()),this.hideSuggest(),this.pager.initData(),j.triggerLog(this.config.parent.$elem,{method:"videoSearch"})},onParseUrl:function(a){var b=d(a.currentTarget),c=b.prevAll().size();this.videoInfo=this.searchInfos.videoInfos[c],this.videoInfo&&this.videoInfo.htmUrl&&f.setKeyFrom(this.$elem).postJSON("toShortUrl",{url:this.videoInfo.htmUrl},d.proxy(this.parseUrlData,this)).error(d.proxy(this.parseErr,this))},parseUrlData:function(a){var b=this.config.parent,c=a.result||this.videoInfo.htmUrl;this.textarea.appendText(this.videoInfo.titleOld+"："+c),this.textarea.$elem.keyup(),j.triggerLog(this.config.parent.$elem,{method:"addVideo"}),b.hide()},parseErr:function(a){this.onTip(k.PARSE_URL_ERR)},onShow:function(a){!this.searchInfos&&this.onTip()},onTip:function(a,b){a?b&&b==="success"?this.$rTips.html(a).show():this.$tips.html(a).show():(this.$tips.hide(),this.$rTips.hide())},hideSuggest:function(){this.$suggest.hide().find("li.current").removeClass("current"),this.videoSuggest.unbindEvent()},initPager:function(){var b=a("widget/AjaxPager");return new b('<div class="pages-small"></div>',{buildUrl:d.proxy(this.buildUrl,this),buildParam:d.proxy(this.buildParam,this),onPage:d.proxy(this.onPage,this),showNum:!1})},buildUrl:function(){return"searchKu6"},buildParam:function(){return{key:this.keyword,pageMethod:"page",pageNo:1}},onPageStart:function(){this.onTip(),this.$list.hide().after(this.$loading)},onPage:function(b){this.$loading.detach(),this.searchInfos=b;if(b.videoInfos&&b.videoInfos.length){var c=h.formatTemplate(a("_tmpl/videoItem"),b);this.$list.html(c).show(),this.onTip("找到"+this.searchInfos.page.totalSize+"个相关视频","success")}else this.$list.hide(),this.onTip(k.NO_RESULT)}});k.NO_RESULT="没有找到您需要的视频，换个关键字试试吧",k.PARSE_URL_ERR="网络出错，请稍后再试";return k});define("sendBox/widget/video/VideoSuggest",function(a,b,c){var d=a("external/jquery"),e=a("widget/suggest/SuggestList"),f=e.extend({onEnter:function(a){var b=this.$elem.find("li.current").attr("n");this.$elem.trigger("select",[b])}});return f});define("_tmpl/videoItem",function(require){return function(tmplData){var p=[];with(tmplData){p.push("");for(var i=0,l=videoInfos.length;i<l;i++)p.push('<li class="video-item" title="点击添加"><div class="video-content clearfix"><div class="video-content-left"><img class="video-cover" src="',videoInfos[i].coverUrl,'" title="',videoInfos[i].titleOld,'" /><span class="video-length">',videoInfos[i].videoTime,'</span></div><div class="video-content-right"><h4 class="video-title">',videoInfos[i].title,'</h4><p class="video-info">',videoInfos[i].desc,"</p></div></div></li>");p.push("")}return p.join("")}});define("sendBox/widget/MusicInput",function(a,b,c){var d=a("external/jquery"),e=a("widget/tinyBox/Box"),f=a("utils/DataSource"),g=a("utils/tmpl"),h=a("utils/log/Logger"),i=a("utils/Utils"),j=d(document.body),k=e.extend({init:function(a){this._super(null,a),this.$trigger=d(a.trigger),this.textarea=a.textarea,this.$trigger.bind("click",d.proxy(this.show,this))},preRender:function(){return{content:g.formatTemplate(a("_tmpl/musicInput"))}},postRender:function(){this.$elem.addClass("winlayer-music"),this.$body=this.$elem.find(".js-body"),this.$tips=this.$elem.find(".js-tips"),this.$searchBox=this.$elem.find(".js-search"),this.$input=this.$searchBox.find(".js-input"),this.$count=this.$elem.find(".js-count"),this.$list=this.$elem.find(".js-list"),this.$player=this.$elem.find(".js-player"),this.$pagerContainer=this.$elem.find(".js-page")},bindEvent:function(){this._super();var a=this;i.onBindInputAction(this.$input),this.$input.bind("keyup",d.proxy(this.onInput,this)),this.pager=this.initPager(),this.$pager=this.pager.$elem,this.$pager.appendTo(this.$pagerContainer),this.$pagerContainer.bind("onPage",d.proxy(this.onPageStart,this)),this.$list.delegate("li","click",d.proxy(this.onSelect,this)).delegate(".hearing-trigger","click",d.proxy(this.onHearing,this)),d.browser.msie&&d.browser.version<7&&this.$list.delegate("li","hover",function(a){a.type==="mouseenter"?d(this).addClass("hover"):d(this).removeClass("hover")})},show:function(){j.trigger("wgtHide").bind("wgtHide",d.proxy(this.hide,this)).bind("musicPlaying",d.proxy(this.onCloseCurrentMusicPlayer,this));var a=this.$trigger,b=a.offset();b.top=b.top+a.height()+4,b.left=b.left-18,this._super(b),this.musicInfos=null,this.$input.val("").focus(),this.controlShow("hide"),this.onCloseCurrentMusicPlayer()},hide:function(a){this._super(),j.unbind("wgtHide",d.proxy(this.hide,this)).unbind("musicPlaying",d.proxy(this.onCloseCurrentMusicPlayer,this))},controlShow:function(a){a==="show"?this.$body.addClass("winlayer-show-result"):this.$body.removeClass("winlayer-show-result")},initPager:function(){var b=a("widget/AjaxPager");return new b('<div class="pages-small"></div>',{buildUrl:d.proxy(this.buildUrl,this),buildParam:d.proxy(this.buildParam,this),onPage:d.proxy(this.onPage,this),showNum:!1})},buildUrl:function(){return"music"},buildParam:function(){return{key:this.keyword,pageMethod:"page",pageNo:this.pageSize}},onPageStart:function(){},onPage:function(b){if(b.musicInfos&&b.musicInfos.length>0){this.musicInfos=b.musicInfos,this.$count.text(b.page.totalSize);var c=[];for(var d=0,e=b.musicInfos.length;d<e;d++)c[d]=g.formatTemplate(a("_tmpl/musicItem"),b.musicInfos[d]);this.$list.html(c.join("")),this.controlShow("show")}else this.$count.text(0)},onInput:function(a){this.keyTimer&&clearTimeout(this.keyTimer);var b=this;this.keyTimer=setTimeout(function(){b.onError();var a=d.trim(b.$input.val());a===""?b.controlShow("hide"):(b.controlShow("show"),b.keyword=a,b.onSearch())},200)},onSearch:function(){this.pageSize=1,this.pager.initData(),h.triggerLog(this.$elem,{method:"musicSearch"})},onHearing:function(a){a.stopPropagation();var b=d(a.currentTarget),c=b.data("song-key");this.onError(),j.trigger("musicPlaying"),b.parent().parent().addClass("hearing"),this.renderMusicPlayer(c)},renderMusicPlayer:function(b){if(!this.$musicPlayerElem){var c=i.S4;this.musicId=c()+c(),this.$musicPlayerElem=d('<div><div id="'+this.musicId+'"></div></div>')}this.$player.show(),this.$musicPlayerElem.appendTo(this.$player);var e="http://img.xiami.com/widget/0_"+b+"_/singlePlayer.swf",f={bgColor:"#F3F3F3",name:"tweetXmmp"};a("external/swfobject").embedSWF(e,this.musicId,"257","33","9.0.0","","",f)},onCloseCurrentMusicPlayer:function(){this.$list.find("> .hearing").removeClass("hearing"),this.$musicPlayerElem&&this.$musicPlayerElem.detach(),this.$player.hide()},onSelect:function(a){var b=d(a.currentTarget),c=b.prevAll().size();this.musicInfo=this.musicInfos[c],this.onError(),this.musicInfo&&this.musicInfo.songUrl&&(f.setKeyFrom(b).postJSON("musicToShortURL",{url:this.musicInfo.songUrl},d.proxy(this.onSelectCallBack,this)).error(d.proxy(function(){this.onError("抱歉，该音乐不能分享，请换一首音乐试试:)")},this)),h.triggerLog(self.$elem,{method:"musicAdd"}))},onSelectCallBack:function(a){this.textarea.$elem.val(this.textarea.$elem.val()+this.musicInfo.songName+"—"+this.musicInfo.singer+" "+a.result+" ").setCaretTo(this.textarea.$elem.val().length).keyup(),this.hide()},onError:function(a){a&&a!==""?this.$tips.show().find(".js-text").html('<em class="icon-forbidS"></em>'+a):this.$tips.hide()}});return k});define("_tmpl/musicInput",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div class="winlayer-hd"><a class="winlayer-close icon-close close-trigger" title="关闭" href="javascript:;"></a><h3>搜索音乐</h3></div><div class="winlayer-bd winlayer-music-bd js-body"><div class="winlayer-music-search js-search"><div class="winlayer-music-search-inner"><input class="winlayer-music-search-input js-input" data-blank="输入歌曲名/歌手名" type="text" /><div class="winlayer-music-search-right"><a class="winlayer-music-search-btn js-btn" title="搜索" href="javascript:;"><em class="icon-search-gray"></em></a><em class="icon-loading hidden"></em></div></div></div><div class="winlayer-music-descbox"><p class="winlayer-music-desc">音乐服务由<a class="winlayer-linkb" href="http://www.xiami.com" target="_blank">虾米网</a>提供</p></div><p class="winlayer-tips js-tips"><span class="text-tips text-tips-error js-text"><em class="icon-forbidS"></em>抱歉，该音乐不能分享，请换一首音乐试试:)</span></p><div class="winlayer-music-content"><div class="winlayer-music-result-title"><span class="fl">搜索结果(<em class="js-count"></em>首)</span><span class="fr">试听</span></div><ul class="winlayer-music-list js-list"></ul></div><div class="winlayer-music-ft"><p class="winlayer-music-desc">音乐服务由<a class="winlayer-linkb" href="http://www.xiami.com" target="_blank">虾米网</a>提供</p><div class="winlayer-page js-page"></div></div><div class="winlayer-music-player js-player"></div></div>');return p.join("")}});define("_tmpl/musicItem",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<li title="点击添加-',songName,"-",singer,'"><span class="music-info"><span class="music-name">'),songName.length>18?p.push("",songName.substr(0,18)+"...",""):p.push("",songName,""),p.push('</span><span>-</span><span class="music-singer">'),singer.length>16?p.push("",singer.substr(0,16)+"...",""):p.push("",singer,""),p.push('</span></span><span class="music-status"><a class="music-play-btn icon-music-pause hearing-trigger" data-song-key="',playKey,'" title="播放" href="javascript:;"></a><em class="music-hearing">试听中...</em></span></li>');return p.join("")}});define("sendBox/widget/PoiInput",function(a,b,c){var d=a("external/jquery"),e=a("widget/tinyBox/Box"),f=a("utils/tmpl"),g=a("lbs/CityData").cityData,h=a("utils/DataSource"),i=a("model/UserData"),j=a("widget/AjaxPager"),k=e.extend({defaultTip:"商户名、街道等...",init:function(a){this.$elem=null,this.$trigger=d(a.trigger),this.$closeTrigger=d(a.closeTrigger),this.$trigger.bind("click",d.proxy(this.show,this)),this.$closeTrigger.bind("click",d.proxy(this.onDeletePoi,this));var b=this.$trigger,c=this.$closeTrigger;this.$trigger.parent().bind("mouseover",function(){b.data("poiId")&&c.show()}).bind("mouseout",function(){c.hide()}),this.$provSelecter=null,this.$citySelecter=null,this.$input=null,this.pager=new j('<div class="pager-wrap"></div>',{buildUrl:d.proxy(this.buildUrl,this),buildParam:d.proxy(this.buildParam,this),onPage:d.proxy(this.onSearchData,this)}),this.$pagerContainer=null},onDeletePoi:function(a){this.$trigger.data("poiId",null),this.$trigger.data("poiName",null),this.$trigger.text("地点"),this.$trigger.attr("title","")},onTriggerHover:function(a){this.$trigger.siblings(".sendinfo-closePoi").show()},preRender:function(){return{content:f.formatTemplate(a("_tmpl/poiInput"))}},bindEvent:function(){this.$elem.delegate(".close-trigger","click",d.proxy(this.hide,this)),this.$elem.delegate(".submit-trigger","click",d.proxy(this.doSubmit,this)),this.$provSelecter.bind("change",d.proxy(this.renderCitySelecter,this));var a=i.getLoginUser();a!==null&&h.setKeyFrom(this.$elem).postJSON("latestPoi",{userId:a.id},d.proxy(this.onUserPoiData,this)),this.$elem.find(".poiSet-poiList").delegate("li","hover",function(){d(this).toggleClass("hover")}).delegate("li","click",d.proxy(this.onPoiSelect,this)),this.$pagerContainer.bind("onPage",d.proxy(this.onPageStart,this))},onPageStart:function(a){this.$elem.addClass("poiSet-poiMainBox-loading")},onPoiSelect:function(a){var b=d(a.currentTarget).data("poiId"),c=d(a.currentTarget).data("poiName"),e=c;c.length>3&&(c=c.substr(0,3)+"..."),this.$trigger.data("poiId",b).text(c).attr("title","我在"+e),this.hide()},onUserPoiData:function(b){var c=[];for(var d=0,e=b.list.length;d<e;d++)c[d]=f.formatTemplate(a("_tmpl/userPoiItem"),b.list[d]);this.$elem.find(".poiSet-poiList").html(c.join("")),b.list.length>0&&this.$elem.find(".poiSet-recommend").removeClass("hidden")},onSearchData:function(a){this.$elem.removeClass("poiSet-poiMainBox-loading"),this.onUserPoiData(a),this.$elem.find(".poiSet-recommend").addClass("hidden"),a.list.length===0?this.$elem.find(".poiSet-noresult").show():this.$elem.find(".poiSet-noresult").hide()},renderCitySelecter:function(){var a=this.$provSelecter.children(":selected").text(),b=[];d.each(g[a].city,function(a,c){b[b.length]='<option value="'+c.code+'">'+a+"</option>"}),this.$citySelecter.html(b.join("")),b.length>0?this.$citySelecter.show():this.$citySelecter.hide()},doSubmit:function(){this.searchKey=this.$input.val();this.searchKey.length===0||this.searchKey===this.defaultTip?this.hide():(this.onPageStart(),this.pager.initData(),this.$pagerContainer.append(this.pager.$elem))},buildUrl:function(){return"searchLbs"},buildParam:function(){return{city:this.$citySelecter.val()||undefined,province:this.$provSelecter.val(),keyword:this.searchKey,pageSize:5}},postRender:function(){this.$input=this.$elem.find("input[type=text]"),this.$pagerContainer=this.$elem.find(".pagelistBox"),this.$provSelecter=this.$elem.find(".poiSet-province"),this.$citySelecter=this.$elem.find(".poiSet-city");var a=[];d.each(g,function(b,c){a[a.length]='<option value="'+c.code+'">'+b+"</option>"}),this.$provSelecter.html(a.join("")),this.renderCitySelecter(),this.$elem.addClass("poiSet-layer");var b=this;this.$input.bind("keypress",function(a){a.which===13&&b.doSubmit()})},show:function(a){d(document.body).bind("click",d.proxy(this.autoClose,this)).trigger("wgtHide");var b=this.$trigger.offset();this._super(b),this.$elem.css({top:b.top+this.$trigger.height()+5,left:b.left-30})},hide:function(a){this._super(a),d(document.body).unbind("click",d.proxy(this.autoClose,this))},autoClose:function(a){var b=d(a.target).parents().andSelf();d.inArray(this.$elem[0],b)===-1&&d.inArray(this.$trigger[0],b)===-1&&this.hide()}});return k});define("_tmpl/poiInput",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div class="winlayer-con"><div class="winlayer-titleBar"><span class="titleBar-title">分享你的详细位置</span><a title="关闭" class="winlayer-close close-trigger" href="javascript:;">关闭</a></div><div class="poiSet-content"><div class="poiSet-crumb clearfix"><div class="poiSet-showCurrentPoi hidden clearfix"><span class="poiSet-currentCity">北京</span><a class="poiSet-changePoi cBlue underline" href="javascript:;">切换城市</a></div><div class="poiSet-selectPoi"><select class="poiSet-province"></select><select class="poiSet-city"></select></div><div class="poiSet-searchBar"><input type="text" class="inputtextTag" /><a class="winlayer-btn submit-trigger" href="javascript:;"><em>确定</em></a></div></div><div class="poiSet-poiMainBox"><div class="poiSet-loading"></div><div class="poiSet-dataBox"><p class="poiSet-recommend hidden">最近在这里：</p><ul class="poiSet-poiList"></ul><div class="pagelistBox"></div><p class="poiSet-noresult">没有你查找的地点，去<a class="cBlue underline" target="_blank" href="http://bafang.163.com/addLocation?query=">网易八方</a>创建地点吧</p></div></div></div></div>');return p.join("")}});define("_tmpl/userPoiItem",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<li title="单击确认" data-poi-name="',name,'" data-poi-id="str.',id,'"><h4><span class="poiSet-address">',name,'</span></h4><p class="cDGray">',address,"</p></li>");return p.join("")}});define("sendBox/widget/TopicGuide",function(a,b,c){var d=a("external/jquery"),e=a("utils/Cookie"),f=function(a){this.textarea=a.textarea,this.$elem=d(a.elem),this.$publishBoxInsert=a.publishBoxInsert,this.init()};f.prototype={init:function(){e.set("topicGuide",0,.25),this.bindEvent()},bindEvent:function(){this.$elem.bind("click",d.proxy(this.onShowTopic,this)),this.textarea.$elem.bind("click",d.proxy(this.onShowTopic,this)),this.$publishBoxInsert.bind("click",d.proxy(this.onInsertTriggerClick,this))},onInsertTriggerClick:function(a){a.currentTarget!=a.target&&this.removeEvent()},onShowTopic:function(a){var b=this.$elem.attr("data-guide-subject"),c=b.length,d="#"+b+"#";this.textarea.appendText(d),this.textarea.$elem.setCaretTo(0,c+2),this.removeEvent()},removeEvent:function(){this.textarea.$elem.keyup().unbind("click"),this.unbindEvent()},unbindEvent:function(){this.$elem.unbind("click").remove(),this.$publishBoxInsert.unbind("click")}};return f});define("sendBox/widget/picUpload/FloatTextToPic",function(a,b,c){var d=a("external/jquery"),e=a("basic/oop/Class"),f=a("utils/Utils"),g=a("sendBox/widget/picUpload/TextToPicElem"),h=a("widget/floatBox/ConfirmBox"),i=a("utils/DataSource"),j=a("sendBox/SendBoxAction"),k=a("widget/tip/NaviTip"),l=a("utils/log/Logger"),m=e.extend({init:function(a,b){this.config=b,this.$textarea=a,this.textToPicElem=new g(null,{$container:this.config.$container,callBack:d.proxy(this.callBack,this),textCount:100})},show:function(a,b){this.content=a;var c=this;this.tip=new h({title:"转成图片",content:"已超出字数，是否把所有内容转成图片发出？"},{onConfirm:function(){c.doTextToPic(a)},autoHide:!1,tipText:"发表中..."}),this.textToPicElem.renderSWF(),this.tip.show()},doTextToPic:function(a){l.triggerLog(this.tip.$elem.attr("data-keyfrom","autoConvert"),{method:"TextToPhotoController"}),this.textToPicElem.doTextToPic(a)},callBack:function(a){var b=this.tip.$elem.find(".poplayer-mess");switch(a.status){case"success.start":this.tip.showLoading();break;case"success.data":this.sendTweet(a);break;case"error.invalidTextLength.1":case"error.invalidTextLength.2":case"error.forbidden":case"error.invalidWord":this.tip.onTip({type:"error",text:a.msg}),this.tip.hide();break;case"error.timeout":case"error.convertFail":this.tip.hideLoading(),this.status!==a.status&&b.after('<span class="text-tips js-text text-tips-error"><em class="icon-forbidS"></em>'+a.msg+"</span>")}this.status=a.status},sendTweet:function(b){var c=this,d={content:b.data.picSubject+b.data.content,imageUrl:b.data.originalURL};this.sendTweetRequest=i.setKeyFrom(this.tip.$elem).postJSON("sendTweet",d,function(b){var d=j.parseResultInfo(b);c.tip.hideLoading();if(d.isSuccess){var e=a("model/TweetData"),f=e.get(e.update(b));c.tip.$elem.trigger("sent",[f,c]),c.removeElem(),c.config.onSuccess&&c.config.onSuccess(b)}else{c.tip.onTip({type:"error",text:d.tip});if(!d.tip){var g=a("widget/floatBox/VerifyBox"),h=g.getInstance();h.show(function(){c.sendTweetRequest.resend()})}}c.tip.hide()})},removeElem:function(){this.textToPicElem.removeElem()}});return m});define("widget/floatBox/ConfirmBox",function(a,b,c){var d=a("external/jquery"),e=a("widget/floatBox/Box"),f=a("utils/tmpl"),g=e.extend({postRender:function(){this.$elem.addClass("poplayer-confirmbox").find(".poplayer-bd").empty().append(a("utils/tmpl").formatTemplate(a("_tmpl/floatBox/confirmBox"),this.data))},preRender:function(){return{title:"请确认操作"}},bindEvent:function(){this._super(),this.$elem.delegate(".confirm-trigger","click",d.proxy(this.onConfirm,this))},onLayerClick:function(){return},onConfirm:function(a){this.config.onConfirm&&this.config.onConfirm(a);var b=typeof this.config.autoHide=="undefined"||this.config.autoHide==!0;b&&this.hide();return!1}});return g});define("_tmpl/floatBox/confirmBox",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<span class="poplayer-mess"><em class="icon-inquireB"></em>',content,'</span><div class="poplayer-btnbox"><a class="poplayer-btn-sure confirm-trigger" href="javascript:;">确定</a><a class="poplayer-btn-cancel close-trigger" href="javascript:;">取消</a></div>');return p.join("")}});define("sendBox/widget/ColumnBox",function(a,b,c){var d=a("external/jquery"),e=a("widget/tinyBox/Box"),f=a("utils/DataSource"),g=a("utils/tmpl"),h=a("model/UserData"),i=a("utils/Utils"),j=a("utils/log/Logger"),k=d(document.body),l=h.getLoginUser(),m=e.extend({init:function(a){this.$elem=null,this.textarea=a.textarea,this.$trigger=d(a.trigger),this.popCreate=a.dataColumn,this.errorType={type1:"创建失败",type8:"微专栏创建超限",type9:"您无权创建微专栏"},this.tipsObj={0:"请输入2-10个全角字符",1:"请选择微专栏所属类别",2:"请正确输入微专栏简介"},this.columnDesc="",this.categoryId="",this.columnName="",this.data={},this.isOpen=!1,this.hasCategory=!1,this.checkObj={name:!1,category:!1,desc:!1},this.$trigger.bind("click",d.proxy(this.showBox,this))},preRender:function(){return{content:g.formatTemplate(a("_tmpl/columnCreateBox"),this.data)}},postRender:function(){this.$elem.addClass("winlayer-column"),this.$container=this.$elem.find(".js-container"),this.$table=this.$elem.find(".js-table"),this.$createBox=this.$elem.find(".js-create-box"),this.$listBox=this.$elem.find(".js-list-box"),this.$submitTri=this.$elem.find(".submit-trigger")},bindEvent:function(){this._super(),this.$elem.bind("hide",d.proxy(this.hide,this)).delegate("input, select, textarea","focus",d.proxy(this.onFocus,this)).delegate(".js-input-name","blur",d.proxy(this.checkName,this)).delegate(".js-category","blur",d.proxy(this.checkCategory,this)).delegate(".js-desc","blur",d.proxy(this.checkDesc,this)).delegate(".submit-trigger","click",d.proxy(this.onSubmit,this)).delegate(".create-trigger","click",d.proxy(this.onCreate,this)).delegate(".back-trigger","click",d.proxy(this.onBack,this)).delegate(".js-name","click",d.proxy(this.insertColumn,this)).delegate(".js-create","click",d.proxy(this.createColumn,this))},onRecover:function(a){var b=a.find(".js-tips"),c=a.find(".js-normal-tips");c.show(),this.onTextTips(b,"hide")},onFocus:function(a){this.onRecover(d(a.target).parent())},onError:function(a,b){var c=a.find(".js-tips"),d=a.find(".js-normal-tips"),e=c.attr("data-type");d.hide(),this.onTextTips(c,"error",b),e!==undefined&&(this.checkObj[e]=!1)},onRight:function(a){this.onRecover(a);var b=a.find(".js-tips").attr("data-type");b!==undefined&&(this.checkObj[b]=!0)},showBox:function(){this.isOpen||(this.data.microColumn=h.get(l.id).microColumn,this.len=this.data.microColumn.length,!this.len||this.popCreate?this.showCreateBox():this.showListBox(),this.isOpen=!0,k.trigger("wgtHide").bind("wgtHide",d.proxy(this.wgtHide,this)),j.triggerLog(k,{method:"topic"}))},showCreateBox:function(){this.show(),this.getCategory(),this.$container.append(this.$createBox),this.onReset(),this.$listBox.detach(),this.$elem.css({width:316}).find(".js-title").text("创建微专栏").end().find(".js-input-name").focus()},showListBox:function(){this.show(),this.onBack(),this.$elem.css({width:200}).find(".js-title").text("微专栏"),this.$listBox.html("").append(d(g.formatTemplate(a("_tmpl/columnListBox"),this.data))),this.$container.append(this.$listBox).removeClass("winlayer-column-pop"),this.$createBox.detach()},show:function(){var a=this.$trigger.parents(".js-body"),b=a.offset();b.top=b.top+a.outerHeight(),b.left=this.$trigger.offset().left-17,this._super(b)},getData:function(){f.postJSON("getColumnList",{userId:l.id},d.proxy(function(a){this.data=a,this.data.id=l.id,h.update(this.data),this.showListBox(),a.microColumn.length===1&&this.onFlash()},this))},onReset:function(){this.checkObj={name:!1,category:!1,desc:!1},this.columnDesc="",this.categoryId="",this.columnName="",this.onBack(),this.$elem.find(".js-input-name, .js-category, .js-desc").val(""),this.onRecover(this.$container)},getCategory:function(){this.hasCategory||f.postJSON("getColumnCategory",d.proxy(function(a){var b=this.$elem.find(".js-category >option:eq(0)");d.each(a.columnCategories,function(a,c){var d="<option data-id="+c.categoryId+">"+c.categoryName+"</option>";b=b.add(d)}),this.$elem.find(".js-category").append(b),this.hasCategory=!0},this))},checkName:function(a){var b=d(a.target),c=b.parent(),e=d.trim(b.val()),g=i.strLen(e);if(!e||4>g||20<g)this.onError(c,this.tipsObj[0]);else{if(this.columnName==e){this.onRight(c);return}f.postJSON("checkColumnName",{columnName:e},d.proxy(function(a){a.result?(this.onRight(c),this.columnName=e):this.onError(c,"该微专栏名称已被占用")},this))}},checkCategory:function(a){var b=d(a.target),c=b.parent(),e=b.find("option:selected").attr("data-id");e?(this.onRight(c),this.categoryId=e):this.onError(c,this.tipsObj[1])},checkDesc:function(a){var b=d(a.target),c=b.parent(),e=d.trim(b.val()),g=i.strLen(e);if(!e||50<g){var h=50<g?"简介超过25个字":this.tipsObj[2];this.onError(c,h)}else{if(this.columnDesc==e){this.onRight(c);return}f.postJSON("checkColumnDesc",{columnDesc:e},d.proxy(function(a){a.result?(this.onRight(c),this.columnDesc=e):this.onError(c,this.tipsObj[2])},this))}},onSubmit:function(){if(this.checkObj.name&&this.checkObj.category&&this.checkObj.desc){var a="#"+this.columnName+"#";this.$elem.addClass("winlayer-column-hidden").find(".js-named").text(a)}else{var b=this.$table.find(".js-tips"),c=this;d.each(b,function(a){var b=d(this).attr("data-type");c.checkObj[b]||c.onError(d(this).parent(),c.tipsObj[a])})}},onBack:function(){this.$elem.removeClass("winlayer-column-hidden")},onCreate:function(){f.postJSON("addColumn",{columnDesc:this.columnDesc,categoryId:this.categoryId,columnName:this.columnName},d.proxy(function(a){this.onCreateBack(a)},this))},onCreateBack:function(b){if(b.result){var c=a("widget/tip/NaviTip");c.show({type:"success",text:"创建成功"}),this.getData()}else this.onBack(),this.onError(this.$submitTri.parent(),this.errorType["type"+b.desc])},createColumn:function(a){this.showCreateBox(),this.onLog(d(a.target),"addColumn")},insertColumn:function(a){var b=!0,c=d(a.target),e="#"+c.text()+"#",f=this.textarea.$elem.val(),g=f.match(i.CONV_REG);g!==null&&d.inArray(e,g)!==-1&&(b=!1),b&&this.textarea.appendTextToEnd(e),this.hide(),this.onLog(c,"addTopic")},onFlash:function(){this.$container.addClass("winlayer-column-pop");var a=this.$elem.find(".js-insert"),b=this.$elem.find(".js-start"),c=this;this.interval=setInterval(function(){b.stop().animate({opacity:1},500,function(){b.animate({opacity:0},700)})},2e3),this.$listBox.find("a").click(function(){c.stopInterVal(),c.$container.removeClass("winlayer-column-pop")})},hide:function(a){this._super(),this.stopInterVal(),this.isOpen=!1,k.unbind("wgtHide",d.proxy(this.wgtHide,this))},wgtHide:function(a){this.stopInterVal(),this.isOpen=!1,this.autoClose(a),k.unbind("wgtHide",d.proxy(this.wgtHide,this))},autoClose:function(a){var b=d(a.target).parents().andSelf();d.inArray(this.$elem[0],b)===-1&&d.inArray(this.$trigger[0],b)===-1&&this.hide()},stopInterVal:function(){this.interval&&clearInterval(this.interval)},onLog:function(a,b){var c=j.keyFrom(k)+"."+j.keyFrom(a);i.analytics.send("/page.do?keyfrom="+c+"&method="+b)}});return m});define("_tmpl/columnCreateBox",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div class="winlayer-hd"><h3 class="js-title">微专栏</h3><h3 class="winlayer-column-title">创建确认</h3><a title="关闭" class="winlayer-close icon-close close-trigger" href="javascript:;"></a></div><div class="winlayer-bd winlayer-column-bd js-container"><div class="js-create-box"><div class="winlayer-column-input"><p class="winlayer-column-desc">每人最多可创建三个微专栏，创建后的微专栏将不可修改和删除，请用心创建与经营。</p><div class="winlayer-column-table js-table"><dl class="winlayer-item"><dt class="winlayer-item-left"><em>*</em>微专栏名称：</dt><dd class="winlayer-item-right"><input type="text" class="js-input-name winlayer-input"/><p class="winlayer-column-tips js-normal-tips">名称唯一，2-10个汉字、字母或数字</p><p class="winlayer-tips js-tips" data-type="name"><span class="text-tips js-text"></span></p></dd></dl><dl class="winlayer-item"><dt class="winlayer-item-left"><em>*</em>微专栏类别：</dt><dd class="winlayer-column-category winlayer-item-right"><select class="js-category winlayer-select"><option>请选择类型</option></select><p class="winlayer-column-tips js-normal-tips"></p><p class="winlayer-tips js-tips" data-type="category"><span class="text-tips js-text"></span></p></dd></dl><dl class="winlayer-item"><dt class="winlayer-item-left"><em>*</em>微专栏介绍：</dt><dd class="winlayer-column-infos winlayer-item-right"><textarea class="js-desc winlayer-textarea"></textarea><p class="winlayer-column-tips js-normal-tips">最多可输入25个字</p><p class="winlayer-tips js-tips" data-type="desc"><span class="text-tips js-text"></span></p></dd></dl></div><div class="winlayer-column-submit clearfix"><a class="fr winlayer-btn-sure submit-trigger" href="javascript:;">创建</a><p class="winlayer-tips js-tips"><span class="text-tips js-text"></span></p></div></div><div class="winlayer-column-confirm"><em class="icon-inquireB"></em><p>微专栏一经创建，不可删除和修改。<br />您确定将<span class="winlayer-linka js-named"></span>创建为自己的微专栏吗？</p><div class="winlayer-btnbox"><a class="winlayer-btn-sure create-trigger" href="javascript:;">确定</a><a class="winlayer-btn-cancel back-trigger" href="javascript:;">返回再想想</a></div></div></div><div class="js-list-box"></div></div>');return p.join("")}});define("_tmpl/columnListBox",function(require){return function(tmplData){var p=[];with(tmplData){p.push("");if(microColumn.length>0){p.push('<ul class="winlayer-column-list js-list" data-keyfrom="topic">');for(var i=0;i<microColumn.length;i++)p.push('<li><a href="javascript:;" class="winlayer-column-link js-name" data-keyfrom="column">',microColumn[i].columnName,"</a></li>");p.push(""),microColumn.length<=2&&p.push('<li class="winlayer-column-create"><a href="javascript:;" class="winlayer-linka js-create"><em>+</em>创建微专栏</a></li>'),p.push("</ul>")}p.push(""),microColumn.length==1&&p.push('<div class="winlayer-column-insert js-insert"><div class="tipslayer js-start"><em class="tipslayer-arrow-down"></em>点击插入</div><div class="tipslayer tip-opacity"><em class="tipslayer-arrow-down"></em>点击插入</div></div>'),p.push("")}return p.join("")}});define("_tmpl/dialogLayerPublishBox",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div class="tweet-publishBox js-publishBox"><div class="tweet-publishBox-hd"><div class="tweet-publishBox-textareaBox"><textarea class="tweet-publishBox-textarea"></textarea></div></div><div class="tweet-publishBox-ft"><div class="clearfix"><div class="tweet-publishBox-operate"><div class="tweet-publishBox-btn"><a class="submit-trigger disabled" href="javascript:;">发布</a></div><span class="tweet-publishBox-tip js-wordCounter">还可以输入<span class="char-constantia">163</span>字</span></div><div class="poplayer-publishBox-insert"><div class="insert-list"><a class="insert-pic pic-trigger" title="图片" href="javascript:;"><em class="icon-pic"></em></a><a class="insert-face face-trigger" title="表情" href="javascript:;"><em class="icon-face"></em></a></div></div></div></div></div>');return p.join("")}});define("widget/floatBox/FollowBox",function(a,b,c){var d=a("external/jquery"),e=a("user/UserAction"),f=a("widget/floatBox/Box"),g=a("utils/tmpl"),h=f.extend({init:function(a,b){this._super(a,b),this.data=a},postRender:function(){this.$elem.addClass("poplayer-followbox"),this.$elem.find(".poplayer-bd").empty().append(g.formatTemplate(a("_tmpl/followBox"),this.data))},preRender:function(){return{title:"加关注提示"}},hide:function(a){this._super(a)},bindEvent:function(){this._super(),this.$elem.delegate(".follow-trigger","click",d.proxy(e.doFollow,this)),this.$elem.bind("followed",d.proxy(this.onFollow,this))},onFollow:function(){this.hide()}});return h});define("_tmpl/followBox",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<span class="poplayer-mess"><em class="icon-inquireB"></em><span>确定将<b class="poplayer-keyword">',nickName,'</b>加关注？</span></span><p class="poplayer-desc">',content,'</p><div class="poplayer-btnbox"><a class="poplayer-btn-sure follow-trigger" href="javascript:;">确定</a><a class="poplayer-btn-cancel close-trigger" href="javascript:;">取消</a></div>');return p.join("")}});define("task/widget/rollAd",function(a,b,c){var d=a("task/Task");(new d("rollAd",function(){var b=a("utils/Cookie"),c=a("external/jquery");c(".roll-close .default-close-icon").click(function(){c(".roll-ad").remove(),b.set("noRollAd","true","today")})})).add()});define("task/widget/hotTweet",function(a,b,c){var d=a("task/Task");(new d("hotTweet",function(){if(document.getElementById("userHotTweet")){var b=a("user/widget/hotTweet"),c=new b("#userHotTweet");return c}})).add()});define("user/widget/hotTweet",function(a,b,c){var d=a("external/jquery"),e=a("model/UserData"),f=a("utils/DataSource"),g=a("utils/tmpl"),h=a("utils/Utils"),i=a("widget/floatBox/login/LoginBox"),e=a("model/UserData"),j=function(a){this.$elem=d(a),this.$nextHotTweets=this.$elem.find(".switch-trigger"),this.$hotTweetTitle=this.$elem.find(".js-title"),this.$hotTweets=this.$elem.find(".js-content"),this.tweetsData={},this.initHotTweets(),this.bindEvent()};j.prototype={constructor:j,initHotTweets:function(){this.getHotTweetJsonData("hotTweetsJsonData",this.onHotTweetDataBack)},getHotTweetJsonData:function(a,b){var c=this.$elem.attr("data-userId");this.jaXHR=f.ajax("getHotTweets",{data:{userId:c},type:"POST",timeout:3e3,dataType:"JSON",success:d.proxy(function(a){this.onHotTweetDataBack(a)},this)})},onHotTweetDataBack:function(b){if(!b)this.$elem.hide();else{if(b.type==0){var c=this.$elem.data("gender");this.$hotTweetTitle.text(c+"的热门微博")}else b.tweet.length>1&&this.$nextHotTweets.removeClass("hidden"),this.$hotTweetTitle.text("热门微博");var e=d();d.each(b.tweet,d.proxy(function(c,d){d.id=d.butterId,d.itemId=d.butterId;var f="tweet-"+d.id;e=e.add(g.formatTemplate(a("_tmpl/hotTweets"),{hotTweet:d,idx:c,type:b.type,tweetId:f,tweetContent:h.countChars(b.newContent[c],96)})),this.tweetsData[f]=d},this)),this.$hotTweets.html(e),this.$currentTweet=this.$elem.find(".current"),this.$replyCount=this.$currentTweet.find(".reply-counter"),this.$retweetCount=this.$currentTweet.find(".retweet-counter"),this.currentHotTweetId=this.$currentTweet.data("hottweetid"),this.$userScreenName=this.$currentTweet.find(".tweet-user"),this.$currentTweetId=this.tweetsData[this.currentHotTweetId].id}},changeReCount:function(a,b){this.$replyCount.text(parseInt(b.relatedTweet.root.replyCount)),this.$retweetCount.text(parseInt(b.relatedTweet.root.retweetCount))},bindEvent:function(){this.$elem.delegate(".switch-trigger","click",d.proxy(this.nextHotTweet,this)).delegate(".js-retweet","click",d.proxy(this.openForWardTweetFbox,this)).delegate(".js-reply","click",d.proxy(this.openReplyTweetFbox,this)),this.$elem.bind("send",d.proxy(this.changeReCount,this))},nextHotTweet:function(){var a=this.$hotTweets.children(),b=a.filter(".current").removeClass("current").addClass("hidden"),c=this.getNextElem(b,a);c.removeClass("hidden").addClass("current"),this.refreshData(c)},refreshData:function(a){this.$currentTweet=a,this.$replyCount=this.$currentTweet.find(".reply-counter"),this.$retweetCount=this.$currentTweet.find(".retweet-counter"),this.$userScreenName=this.$currentTweet.find(".tweet-user"),this.currentHotTweetId=this.$currentTweet.data("hottweetid"),this.$currentTweetId=this.tweetsData[this.currentHotTweetId].id},getNextElem:function(a,b){var c=a.next();c=c.size()>0?c:b.first();return c},openForWardTweetFbox:function(b){if(e.getLoginUser()===null)box=i.getInstance(),box.show();else{var c=this.tweetsData[this.currentHotTweetId],d=this.$elem,f=a("widget/floatBox/sendBox/RetweetBox"),g=new f({id:c.id,nickName:c.user.nickName},{trigger:d});g.show()}},openReplyTweetFbox:function(b){if(e.getLoginUser()===null)box=i.getInstance(),box.show();else{var c=this.tweetsData[this.currentHotTweetId],d=this.$elem,f=a("widget/floatBox/sendBox/ReplyBox"),g=new f({id:c.id,nickName:c.user.nickName},{trigger:d});g.show()}}};return j});define("_tmpl/hotTweets",function(require){return function(tmplData){var p=[];with(tmplData)p.push(""),idx==0?p.push('<div class="right-module-spread current" data-hottweetid="',tweetId,'">'):p.push('<div class="right-module-spread hidden" data-hottweetid="',tweetId,'">'),p.push('<div class="module-spread-bd"><p>'),type==0?p.push('<em class="cDGray">',hotTweet.user.nickName,'</em>：<a href="/',hotTweet.user.screenName,"/status/",hotTweet.id,'" target="_blank" class="module-hotTweets-content">',tweetContent,"</a>"):p.push('<a class="link-ra tweet-user" data-userscreenName="',hotTweet.user.screenName,'" target="_blank" href="/',hotTweet.user.screenName,'" >',hotTweet.user.nickName,'</a>：<a href="/',hotTweet.user.screenName,"/status/",hotTweet.id,'" target="_blank" class="module-hotTweets-content">',tweetContent,"</a>"),p.push('<a class="link-ra" target="_blank" href="/',hotTweet.user.screenName,"/status/",hotTweet.id,'">&nbsp;[原文]</a></p>'),hotTweet.imageInfos.length!=0&&p.push('<div class="module-hotTweets-img"><a target="_blank" href="/',hotTweet.user.screenName,"/status/",hotTweet.id,'"><img src="http://oimagea3.ydstatic.com/image?w=120&amp;h=120&amp;url=',hotTweet.imageInfos[0],'" /></a></div>'),p.push('<div class="module-hotTweets-operate link-rb"><a class="js-retweet" href="javascript:;">转发(<span class="retweet-counter">',hotTweet.retweetCount,'</span>)</a><a class="js-reply" href="javascript:;">评论(<span class="reply-counter">',hotTweet.replyCount,"</span>)</a></div></div></div>");return p.join("")}});define("widget/floatBox/sendBox/RetweetBox",function(a,b,c){var d=a("external/jquery"),e=a("widget/floatBox/Box"),f=a("utils/tmpl"),g=a("sendBox/talkBox/RetweetBox"),h=e.extend({init:function(a,b){this._super(a,b),this.data.id=a.id,this.data.nickName=a.nickName,this.config.type="retweet",this.$trigger=this.config.trigger||null},postRender:function(){this.$elem.addClass("poplayer-sendbox")},preRender:function(){return{title:"转发微博",content:f.formatTemplate(a("_tmpl/floatSendBox"),{config:this.config,data:this.data})}},show:function(){this._super(),this.$elem.find("textarea").focus().trigger("keyup")},bindEvent:function(){this._super();var a=this,b=new g(this.data,{isAutoHeight:!1,elem:this.$elem.find(".js-publishbox"),successCallBack:function(b){a.onSuccess(b)}});b.bindEvent()},hide:function(){this._super(),this.config.hideCallBack&&this.config.hideCallBack()},onSuccess:function(a){this.hide(),this.onTip({type:"success",text:"转发成功！"}),this.$trigger&&this.$trigger.trigger("send",[a])}});return h});define("_tmpl/floatSendBox",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div class="tweet-publishBox js-publishbox"><div class="tweet-publishBox-hd"><div class="tweet-publishBox-textareaBox"><label class="tweet-publishBox-defaultTips js-default-tip">'),config.type==="reply"?p.push("点击添加评论"):config.type==="retweet"&&p.push("转发微博"),p.push('</label><textarea class="tweet-publishBox-textarea"></textarea></div></div><div class="tweet-publishBox-ft js-publishBoxFt"><div class="clearfix"><span class="fl">'),config.type==="reply"&&p.push('<label class="label-tag"><input name="isRetweet" type="checkbox">同时转发到我的微博</label>'),p.push(""),config.type==="retweet"&&p.push('<label class="label-tag"><input name="replyOriginal" type="checkbox">同时评论给',data.nickName,"</label>"),p.push('</span><div class="tweet-publishBox-operate"><div class="tweet-publishBox-btn"><a class="submit-trigger '),config.type==="reply"&&p.push("disabled"),p.push('" href="javascript:;">'),config.type==="reply"?p.push("评论"):p.push("转发"),p.push('</a></div><span class="tweet-publishBox-tip js-wordCounter">还可以输入<span class="char-constantia">163</span>字</span><div class="tweet-publishBox-insert"><div class="insert-list"><a class="insert-at at-trigger" title="@Ta的昵称或备注可以提到Ta" href="javascript:;"><em class="icon-at"></em></a><a class="insert-face face-trigger" title="表情" href="javascript:;"><em class="icon-face"></em></a></div></div></div></div></div></div>');return p.join("")}});define("widget/floatBox/sendBox/ReplyBox",function(a,b,c){var d=a("external/jquery"),e=a("widget/floatBox/Box"),f=a("utils/tmpl"),g=a("sendBox/talkBox/ReplyBox"),h=e.extend({init:function(a,b){this._super(a,b),this.data.id=a.id,this.data.nickName=a.nickName,this.config.type="reply",this.$trigger=this.config.trigger||null},postRender:function(){this.$elem.addClass("poplayer-sendbox")},preRender:function(){return{title:"评论微博",content:f.formatTemplate(a("_tmpl/floatSendBox"),{config:this.config,data:this.data})}},show:function(){this._super(),this.$elem.find("textarea").focus().trigger("keyup")},bindEvent:function(){this._super();var a=this,b=new g(this.data,{isAutoHeight:!1,elem:this.$elem.find(".js-publishbox"),successCallBack:function(b){a.onSuccess(b)}});b.bindEvent()},hide:function(){this._super(),this.config.hideCallBack&&this.config.hideCallBack()},onSuccess:function(a){this.hide(),this.onTip({type:"success",text:"评论成功！"}),this.$trigger&&this.$trigger.trigger("send",[a])}});return h});define("task/user/widget/guessList",function(a,b,c){var d=a("task/Task");(new d("guessList",function(){var b=a("external/jquery"),c="#userGuessContainer";if(b(c).size()!=0){var d=a("user/list/GuessYouLikeList"),e=new d("#userGuessContainer .js-list",{container:c,requestUrl:"guessYouLikeList"});b(c).data("waitfortrigger")?b(c).bind("userGuess.show",function(){e.render()}):e.render()}})).add()});define("user/list/GuessYouLikeList",function(a,b,c){var d=a("external/jquery"),e=a("user/list/RandGuessList"),f=a("utils/DataSource"),g=a("utils/log/Logger"),h=a("user/Recommend"),i=a("model/UserData"),j=a("widget/floatBox/ProfileBox"),k=a("widget/floatBox/TagBox"),l=e.extend({SearchCount:0,isBind:!1,init:function(a,b){this._super(a,b),this.$profileTrigger=this.$container.find(".profile-trigger"),this.$tagTrigger=this.$container.find(".tags-trigger"),this.loginUser=i.getLoginUser()},bindEvent:function(){this.isBind||(this.isBind=!0,this._super(),this.$moreTrigger.unbind("click",d.proxy(this.analytics,this)),d(document).bind("guessUserList.updateDataReady",d.proxy(this.updateUserList,this)),this.$profileTrigger.bind("click",d.proxy(this.showProfileBox,this)),this.$tagTrigger.bind("click",d.proxy(this.showTagBox,this)))},updateUserList:function(a,b){this.$container.find(".js-list").empty(),this.onAllCallBack(b)},checkRemain:function(){this._super(),g.triggerLog(this.$container,{method:"completeInfo"})},showProfileBox:function(){var a=j.getInstance();a.onshow()},showTagBox:function(){var a=k.getInstance();a.onshow()},refreshAll:function(a,b){this._super(a,b),g.triggerLog(this.$elem,{method:"refresh"})}});return l});define("user/list/RandGuessList",function(a,b,c){var d=a("external/jquery"),e=a("utils/DataSource"),f=a("user/Guess"),g=a("utils/Utils"),h=a("widget/list/RenderableList"),i=h.extend({init:function(a,b){this._super(a,b),this.$container=d(this.config.container),this.$refreshTrigger=this.$container.find(".switch-trigger"),this.$moreTrigger=this.$container.find(".more-trigger"),this.$guessTip=this.$container.find(".js-tip"),this.params={recommendType:b.recommendType?b.recommendType:"SEPECIAL_RECOMMEND_TOP"},this.config.maxLength=b.maxLength?b.maxLength:5,this.requestUrl=b.requestUrl?b.requestUrl:"guessList",this.moreData=!1,this.notInited=!0},render:function(){!this.$container.length||(this.getData("onAllCallBack"),this.bindEvent())},getData:function(a){if(!d.isPlainObject(this.Request)||this.Request.readyState===4)this.Request=e.postJSON(this.requestUrl,this.params,d.proxy(this,a))},onAllCallBack:function(a){this.$elem.empty();if(!!this.checkData(a)){for(var b=0,c=a.list.length,d=this.config.maxLength;b<c;b++){var e=new f(a.list[b]);b<d&&this.add(e,this.notInited)}this.notInited&&(this.$container.removeClass("hidden"),this.notInited=!1),this.checkRemain(),this.onFirst()}},onSingleCallBack:function(a){this.checkData(a)?this.$fade=this.$old.fadeOut("slow",d.proxy(function(){var b=this.add(new f(a.list[0]));b.insertBefore(this.$old),this.unwrap(this.$old),this.checkRemain(),this.onFirst()},this)):this.$old.fadeOut("slow")},bindEvent:function(){this.$elem.bind("onFollowed",d.proxy(this.refresh,this)).bind("unlike",d.proxy(this.refresh,this)),this.$refreshTrigger.bind("click",d.proxy(this.refreshAll,this)),this.$moreTrigger.bind("click",d.proxy(this.analytics,this))},add:function(a,b){var c=this._super(a);b||c.hide().fadeIn("fast");return c},wrap:function(a){return a.wrap("<li>").parent()},unwrap:function(a){a.detach()},checkData:function(a){if(!a)return!1;if(a.list.length===0||!a.more||this.$elem.children("li").is(":hidden")){this.moreData=!1,this.checkRemain();return!1}this.moreData=!0;return!0},stopFade:function(a){this.$fade&&this.$fade.stop(!0,!0),a&&d(a).css("visibility","hidden")},refresh:function(a,b,c){this.stopFade(c&&c.currentTarget);var d=b.render();this.$old=d.parent(),this.params.dataType=d.data("type"),this.params.filterUserIds=this.getShowedUserIds(),this.getData("onSingleCallBack")},refreshAll:function(a,b){this.stopFade(),typeof this.params.dataType!="undefined"&&delete this.params.dataType,this.params.filterUserIds=this.getShowedUserIds(),this.getData("onAllCallBack")},getShowedUserIds:function(){var a=[];this.$elem.find(".js-parent").each(function(){var b=d(this);a.push(b.attr("data-user-id"))});return a.join(",")},checkRemain:function(){this.moreData?(this.$refreshTrigger.removeClass("hidden"),this.$moreTrigger.removeClass("hidden")):(this.$refreshTrigger.addClass("hidden"),this.$moreTrigger.addClass("hidden"),this.$elem.html()===""&&this.$guessTip.removeClass("hidden"))},onFirst:function(){var a=this.$container.find(".reason-trigger");a.each(function(a){var b=d(this),c=b.attr("data-fold");a==0&&b.attr("data-fold","true").parents(".js-parent").addClass("expanded"),a!=0&&c=="true"&&b.attr("data-fold","false").parents(".js-parent").removeClass("expanded")})},analytics:function(){g.analytics.send("/page.do?keyfrom=guess.more&method=click")}});return i});define("user/Guess",function(a,b,c){var d=a("external/jquery"),e=a("utils/DataSource"),f=a("utils/log/Logger"),g=a("utils/tmpl"),h=a("user/UserAction"),i=a("model/UserData"),j=a("user/UserTemplate"),k=a("utils/Utils"),l=i.getLoginUser(),m=j.extend({init:function(a,b){a.user.avatarSize=40,this._super(a,b)},initVariable:function(){this._super(),this.$closeIcon=null,this.$parents=d("#userGuessContainer"),this.analyObj={1:"friend",2:"confollow",3:"indifollow",7:"gentie",8:"school",9:"company",10:"label",11:"ip",12:"blog",13:"mail",14:"guessIn",16:"daRen"},this.tmpData.countNickName=k.countChars(this.tmpData.user.nickName,8,!0)},onData:function(){if(this.tmpData.reason.length!=0){var a=this.tmpData.reason[0],b=k.encodeSpecialHtmlChar(this.$parents.data("school").toString()),c=k.encodeSpecialHtmlChar(this.$parents.data("comp").toString()),e=[],f=null,g=a.recommendCount;this.tmpData.reason.length>1&&(g=this.tmpData.reason[1].recommendCount);var h=a.tagName?"“"+a.tagName+"”":"",i=b?'学校：<a target="_blank" class="link-rb" href="/guess#RT1">'+k.countChars(b,16)+"</a>":"",j=c?'公司：<a target="_blank" class="link-rb" href="/guess#RT2">'+k.countChars(c,16)+"</a>":"";d.each(a.sameTags,function(a){e.push('<a target="_blank" class="link-rb" href="/search/tag/'+this+'">'+this+"</a>")}),e.length?e="标签："+e.join("、"):(f="",e=""),this.tmpData.reasonObj={1:[g+"个共同好友","：","",""],2:[g+"个相同关注","：","都关注了",""],3:[g+"个间接关注","：","你关注的","都关注Ta"],4:["你经常和Ta联系","","",""],5:[g+"个间接联系人","：","你关注的","经常跟Ta联系"],6:["和你同时被提到","：","","同时提到了你们"],7:["你的跟贴好友","","",""],8:["可能是同学",null,i,""],9:["可能是同事",null,j,""],10:["有相同标签",f,e,""],11:["Ta在你附近","","",""],12:["你的博客好友","","",""],13:["你的邮箱联系人","","",""],14:["你可能感兴趣","","",""],15:[g+"个相似关注","：","关注了","的人都关注Ta"],16:[h+"达人","","",""]}}},render:function(){this.onData(),this.$elem===null&&(this.$elem=d(g.formatTemplate(a("_tmpl/guess"),d.extend({config:this.config},this.tmpData))),this.bindEvent(),this.onReason());return this.$elem},bindEvent:function(){this.$closeIcon=this.$elem.find(".close-trigger"),this.renderFollow(),this.bindTrigger()},onReason:function(){var a=this;this.$elem.delegate(".reason-trigger","click",function(){var a=d(this).attr("data-fold")=="true"?!0:!1;a?d(this).attr("data-fold","false").parents(".js-parent").removeClass("expanded"):d(this).attr("data-fold","true").parents(".js-parent").addClass("expanded")})},bindTrigger:function(){this.$elem.delegate(".follow-trigger","click",d.proxy(this.follow,this)).delegate(".close-trigger","click",d.proxy(this.unlike,this)).hover(d.proxy(this.onHover,this)),i.bindUpdate(this.data.id,d.proxy(this.onUpdate,this));var a=this;this.$elem.bind("followed",function(b){clearTimeout(a.triggerTimer)})},onUpdate:function(a,b){d.inArray("isFollowing",b)!==-1&&this.renderFollow()},renderFollow:function(){var a=this.$elem.find(".close-trigger");if(this.data.isFollowing===!1)this.$elem.find(".js-add-focus").show().end().find(".js-remove-focus").hide(),this.$closeIcon=a;else{this.$elem.find(".js-remove-focus").show().end().find(".js-add-focus").hide(),this.$closeIcon=null,a.css("visibility","hidden");var b=this;this.triggerTimer=setTimeout(function(){b.$elem.trigger("onFollowed",[b])},500)}},erase:function(){},follow:function(a){if(!this.request||this.request.readyState===4)this.request=h.doFollow.call(this,a,d.proxy(function(){this.$elem.trigger("onFollowed",[this])},this)),this.analytics()},unlike:function(a){var b=this;if(!this.request||this.request.readyState===4){this.request=e.setKeyFrom(this.$elem).post("unlike",{userId:this.data.id},function(c){c.status=="ok"&&b.$elem.trigger("unlike",[b,a])});var c=f.keyFrom(this.$elem);k.analytics.send("/page.do?method=suggestBlock&keyfrom="+c)}},analytics:function(){var a=this.$elem.find("p[data-reason]"),b=this.analyObj[a.attr("data-reason")];b!==undefined&&k.analytics.send("/page.do?method=follow&fr="+b)},onHover:function(a){var b=a.type==="mouseenter"?"visible":"hidden";this.$closeIcon&&this.$closeIcon.css("visibility",b)}});return m});define("_tmpl/guess",function(require){return function(tmplData){var p=[];with(tmplData){p.push('<div class="js-parent" data-type="',dataType,'" data-user-id="',user.id,'"><div class="item clearfix"><div class="left"><a href="/',user.screenName,'" class="avatar js-float-intro" target="_blank" data-keyfrom="avatar" data-user-nickname="',user.nickName,'"><img alt="',user.nickName,'" title="',user.nickName,'" src="',user.avatar,'" /></a></div>'),(recommendType=="SEPECIAL_RECOMMEND_TOP"||recommendType=="REPLY_RECOMMEND"||recommendType=="INDIRECT_RECOMMEND")&&p.push('<a class="icon-close close-trigger" title="不感兴趣" href="javascript:;"></a>'),p.push('<span class="followBoxS"><a class="add-focusS follow-trigger js-add-focus" href="javascript:;" style="display:inline-block"><em class="add-signS">+</em>关注</a><em class="remove-focusS js-remove-focus">已关注</em></span><h3><a class="link-ra js-float-intro" href="/',user.screenName,'" target="_blank" title="',user.nickName,'" data-keyfrom="nickName" data-user-nickname="',user.nickName,'">',countNickName,"</a>",require("_tmpl/itag")(user),"</h3>");if((recommendType=="SEPECIAL_RECOMMEND_TOP"||recommendType=="REPLY_RECOMMEND"||recommendType=="INDIRECT_RECOMMEND")&&reason.length>0){p.push("");if(reason.length==2){var rcount=reason[1].recommendCount,len=reason[1].templateUser.length,index0=reason[0].templateNum,index1=reason[1].templateNum;p.push('<p data-reason="',index0,'"><a class="link-rb reason-trigger" href="javascript:;" data-fold="false">',reasonObj[index0][0],'<span class="right-userlist-btn"><em class="icon-expand"></em><em class="icon-shrink"></em></span></a></p></div><div class="right-module-spread"><div class="module-spread-bd"><p class="text-ra">'),reasonObj[index0][2]!==""&&p.push("",reasonObj[index0][2],"<br />"),p.push("",reasonObj[index1][0],"",reasonObj[index1][1],"",reasonObj[index1][2],"");for(var i=0;i<len;i++)p.push('<a href="/',reason[1].templateUser[i].screenName,'" target="_blank" class="link-rb">',reason[1].templateUser[i].nickName,"</a>"),i!==len-1&&p.push("、"),p.push("");p.push(""),rcount>3&&len>1&&p.push("等"),p.push("",reasonObj[index1][3],"</p></div></div>")}p.push("");if(reason.length==1){var rcount=reason[0].recommendCount,len=reason[0].templateUser.length,index0=reason[0].templateNum;p.push("");if(reasonObj[index0][1]==""&&dataType!="0")p.push('<p data-reason="',index0,'" class="text-ra">',reasonObj[index0][0],"</p></div>");else{p.push('<p data-reason="',index0,'">'),introduction!=""||reasonObj[index0][2]!=""||reasonObj[index0][1]!=""?p.push('<a class="link-rb reason-trigger" href="javascript:;" data-fold="false">',reasonObj[index0][0],'<span class="right-userlist-btn"><em class="icon-expand"></em><em class="icon-shrink"></em></span></a>'):p.push('<a class="link-rb">',reasonObj[index0][0],"</a>"),p.push("</p></div>");if(introduction!=""||reasonObj[index0][2]!=""||reasonObj[index0][1]!=""){p.push('<div class="right-module-spread"><div class="module-spread-bd">');if(dataType=="0"&&introduction!="")p.push('<p class="text-ra">',introduction,"</p>");else{p.push('<p class="text-ra">',reasonObj[index0][2],"");for(var i=0;i<len;i++)p.push('<a href="/',reason[0].templateUser[i].screenName,'" target="_blank" class="link-rb">',reason[0].templateUser[i].nickName,"</a>"),i!==len-1&&p.push("、"),p.push("");p.push(""),rcount>3&&len>1&&p.push("等"),p.push("",reasonObj[index0][3],"</p>")}p.push("</div></div>")}p.push("")}p.push("")}p.push("")}p.push("</div>")}return p.join("")}});define("user/Recommend",function(a,b,c){var d=a("external/jquery"),e=a("user/Guess"),f=a("model/UserData"),g=a("user/UserAction"),h=a("utils/tmpl"),i=a("utils/Utils"),j=a("utils/log/Logger"),k=e.extend({initVariable:function(){this._super(),this.tmpData.countReason=i.countChars(this.tmpData.reason,21)},render:function(){this.$elem===null&&(this.$elem=d(h.formatTemplate(a("_tmpl/userTemplate"),d.extend({config:this.config},this.tmpData))),this.bindEvent());return this.$elem},follow:function(a){if(!this.request||this.request.readyState===4)this.request=g.doFollow.call(this,a,d.proxy(function(){this.$elem.trigger("onFollowed",[this])},this))},unlike:function(){this._super(),j.triggerLog(this.$elem,{method:"close"})}});return k});define("widget/floatBox/ProfileBox",function(a,b,c){var d=a("external/jquery"),e=a("widget/floatBox/Box"),f=a("utils/tmpl"),g=a("utils/DataSource"),h=a("utils/Utils"),i=a("widget/tip/NaviTip"),j=a("utils/Cookie"),k=a("model/UserData"),l=a("utils/School"),m=a("utils/log/Logger"),n=e.extend({init:function(a,b){this._super(a,b);var c={},d=["school","showSchool","company","showCompany"],e={};this.tagReg=/^[a-zA-Z0-9\u4e00-\u9fa5]*$/,e=k.getLoginUser(),this.userData={};for(var f in d){var g=d[f];this.userData[g]=e[g]}},preRender:function(){return{title:"完善基本资料",content:f.formatTemplate(a("_tmpl/profileBox"),this.userData)}},postRender:function(){this.$elem.addClass("poplayer-profilebox"),this.$elem.data("keyfrom","wGuess.complete")},bindEvent:function(){this._super(),d(document).delegate("#poplayer-profile-school","blur",d.proxy(this.schoolBlur,this)).delegate("#poplayer-profile-corp","blur",d.proxy(this.companyBlur,this)).delegate("#poplayer-profile-corp","keypress",d.proxy(this.preCheck,this)).delegate(".js-input","click",d.proxy(this.hideLabel,this)).delegate(".poplayer-input-tips","click",d.proxy(this.hideLabel,this)).delegate(".js-school-trigger","click",d.proxy(this.emptySchool,this)).delegate("#poplayer-profile-submit","click",d.proxy(this.preCheck,this)).delegate(".poplayer-la","click",d.proxy(this.showSelect,this)).delegate(".poplayer-la","mouseleave",d.proxy(this.onSelectOut,this)).delegate(".choiceBox-selectList","mouseenter",d.proxy(this.onSelectHover,this)).delegate(".choiceBox-selectList","mouseleave",d.proxy(this.hideSelect,this)).delegate(".choiceBox-selectList li","click",d.proxy(this.changeSelectVal,this))},show:function(){this._super(),this.$schoolLabelTip=d("#poplayer-profile-schooltips").find(".poplayer-input-tips"),this.$companyLabelTip=d("#poplayer-profile-companytips").find(".poplayer-input-tips"),this.$schoolTriger=d(".js-school-trigger"),this.$poplayerProfileSchool=d("#poplayer-profile-school"),this.$poplayerProfileCorp=d("#poplayer-profile-corp"),this.$companyTextTips=d("#poplayer-profile-companytips").find(".text-tips"),this.initLabel(),l.init("#poplayer-profile-school")},onshow:function(a){this.show(),this.oriData=this.getFormData(),this.callback=a,this.callback&&this.callback.call(),m.triggerLog(this.$elem,{method:"click"})},initLabel:function(){this.$poplayerProfileSchool.val()==""?(this.$schoolLabelTip.show(),this.$schoolTriger.hide()):(this.$schoolLabelTip.hide(),this.$schoolTriger.show()),this.$poplayerProfileCorp.val()==""?this.$companyLabelTip.show():this.$companyLabelTip.hide()},hideLabel:function(a){var b=d(a.target);b.parents(".js-item").find(".poplayer-input-tips").hide()},schoolBlur:function(a){var b=d(a.target);b.val()!=""?this.$schoolTriger.show():this.$schoolTriger.hide()},companyBlur:function(a){var b=d(a.target);b.val()==""?(b.parents(".js-item").find(".poplayer-input-tips").show(),b.parents(".js-item").find(".js-tips").hide()):this.companyVerify()},checkTagFormat:function(a){return a.match(this.tagReg)?!0:!1},companyVerify:function(){var a=this.$poplayerProfileCorp.val(),b;a.length>40?(this.$companyTextTips.addClass("text-tips-error"),this.$companyTextTips.html('<em class="icon-forbidS"></em>不能超过40个字'),b=!1):this.checkTagFormat(a)?(this.$companyTextTips.removeClass("text-tips-error"),this.$companyTextTips.html('<em class="icon-correctS "></em>'),b=!0):(this.$companyTextTips.addClass("text-tips-error"),this.$companyTextTips.html('<em class="icon-forbidS"></em>包含特殊字符'),b=!1),this.$companyTextTips.parent().show();return b},emptySchool:function(a){var b=d(a.target);this.$poplayerProfileSchool.val(""),b.parents(".js-item").find(".poplayer-input-tips").show(),this.$schoolTriger.hide()},onSelectHover:function(a){clearTimeout(this.timer)},onSelectOut:function(a){var b=this,c=d(a.target).parent().find(".choiceBox-selectList");this.timer=setTimeout(function(){c.addClass("hidden")},500)},showSelect:function(a){var b=d(a.target);b.parent().find(".choiceBox-selectList").removeClass("hidden")},changeSelectVal:function(a){var b=d(a.target),c=b.attr("data-value"),e=b.html(),f=b.parents(".poplayer-choiceBox").find(".poplayer-la");f.html(e+'<em class="icon-choiceBox-arrow"></em>'),f.attr("data-secrecy",c),b.parent().addClass("hidden")},hideSelect:function(a){var b=null;d(a.target).attr("class")&&d(a.target).attr("class").search("choiceBox-selectList")>-1?b=d(a.target):b=d(a.target).parent(),b.addClass("hidden")},preCheck:function(a){(a.keyCode==13||a.type=="click")&&this.companyVerify()&&this.submit()},getFormData:function(){var a={school:this.escapeHtml(this.$poplayerProfileSchool.val()),corp:this.$poplayerProfileCorp.val(),showSchool:d("#poplayer-profile-schooltips .poplayer-la").attr("data-secrecy"),showCorp:d("#poplayer-profile-companytips .poplayer-la").attr("data-secrecy")};return a},escapeHtml:function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},submit:function(a){var b=this.getFormData();if(b.school!=this.oriData.school||b.corp!=this.oriData.corp||b.showCorp!=this.oriData.showCorp||b.showSchool!=this.oriData.showSchool){var c=d("#userGuessContainer");d.data(c[0],"school",b.school),d.data(c[0],"corp",b.corp),g.post("updateUserSchool",b,d.proxy(this.submitCallBack,this)),m.triggerLog(this.$elem,{method:"save"})}else this.submitSuccess()},submitCallBack:function(a){a.updateState===!0?this.submitSuccess(a):this.submitError(a)},submitSuccess:function(a){i.show({type:"success",text:"个人信息保存成功"}),this.hide(),this.renderList()},submitError:function(a){typeof a.updateDesc!="undefined"?message=a.updateDesc:message="后台繁忙，请稍后重试",i.show({type:"error",text:message})},renderList:function(){var a="searchUserSimilar",b={};g.postJSON(a,b,d.proxy(this.renderListCallBack,this))},renderListCallBack:function(a){d(document).trigger("guessUserList.updateDataReady",[a])}}),o=new n;return{getInstance:function(){return o}}});define("utils/School",function(a,b,c){var d=a("external/jquery"),e=a("utils/Utils"),f={$inputElem:null,$elem:null,$pElem:null,data:[{location:"北京市",school:["清华大学","北京大学","中国人民大学","北京航空航天大学","北京邮电大学","北京师范大学","中国传媒大学","北京语言大学","北京科技大学","中国农业大学","北京理工大学","北京林业大学","北京交通大学","中国矿业大学（北京）","北京信息科技大学","北京工业大学","北京化工大学","中国政法大学","对外经贸大学","中央民族大学","中国地大（北京）","中科院","北京中医药大学","首都经济贸易大学","中央财经大学","北方工业大学","中国石油大学（北京）","外交学院","首都师范大学","中央戏剧学院","中国青年政治学院","北京外国语大学","华北电力大学（北京）","中国人民公安大学","中国协和医科大学","北京体育大学","北京工商大学","北京联合大学","首都医科大学","国际关系学院","中央美术学院","北京电子科技学院","中国劳动关系学院","中华女子学院","北京建筑工程学院","北京印刷学院","北京石油化工学院","首钢工学院","北京农学院","首都体育学院","北京第二外国语学院","北京物资学院","北京警察学院","中央音乐学院","中国戏曲学院","北京舞蹈学院","北京城市学院","北京电影学院","北京服装学院","北京工商大学嘉华学院","首都师范大学科德学院","北京工业大学耿丹学院","北京化工大学北方学院","北京联合大学广告学院","北京大学医学部","北京政法职业学院","北京信息职业技术学院","北京现代职业技术学院","北京现代音乐研修学院","北京培黎职业学院","北京农业职业学院","北京科技职业学院","北京科技经营管理学院","北京经贸职业学院","北京经济技术职业学院","北京京北职业技术学院","北京交通职业技术学院","北京吉利大学","北京汇佳职业学院","北京工业职业技术学院","北京工商管理专修学院","北京电子科技职业学院","北京财贸职业学院","北京北大方正软件职业技术学院","北大资源美术学院","北京人文大学","北京高等秘书学院","北京应用技术大学","中国防卫科技学院","中国音乐学院","中国信息大学","北京青年政治学院","北京财经专修学院","北京经济管理职业学院","北京美国英语语言学院","中国管理软件学院","财政部财政科学研究所","北大资源学院","网络销售大学","朝阳二外"]},{location:"上海市",school:["复旦大学","上海交通大学","同济大学","华东师大","上海财经","华东理工","上海商学院","东华大学","上海理工","上海大学","上外","上海海事","上海工程","上海水产","上海中医药","上海师大","建桥学院","上海政法","上海电机","上海二工大","上海应用技术学院","上海电力","上海外贸","上海金融","上海立信会计学院","上海体院","上海音乐学院","上戏","杉达学院","华东政法","复旦大学上海视觉艺术学院","复旦大学上海医学院","复旦大学太平洋金融学院","上海邦德职业技术学院","上海出版印刷高等专科学校","上海电影艺术职业学院","上海电子信息职业技术学院","上海东海职业技术学院","上海工会管理职业学院","上海工商外国语学院","上海工商外国语职业学院","上海工艺美术职业学院","上海海关学院","上海海事职业技术学院","上海济光职业技术学院","上海建峰职业技术学院","上海交通职业技术学院","上海科学技术职业学院","上海立达职业技术学院","上海旅游高等专科学校","上海农林职业技术学院","上海欧华职业技术学院","上海思博职业技术学院","上海托普信息技术学院","上海新侨职业技术学院","上海行健职业学院","上海医疗器械高等专科学校","上海医药高等专科学校","上海震旦职业学院","上海中华职业技术学院","上海中侨职业技术学院","上海纺织工业职工大学  "]},{location:"天津市",school:["天津大学","南开大学","河北工大","天津师大","天津工大","天津科大","天津理工","天津医大","天津中医药","天津财经","中国民航大学","天津城市建设学院","天津农院","天津工程师范","天外","天津商业大学","天津体院","天津音乐学院","天津美院","民办天狮职业技术学院","天津滨海学院","天津渤海职业技术学院","天津城市建设管理职业技术学院","天津城市职业学院","天津电子信息职业技术学院","天津对外经济贸易职业学院","天津工程职业技术学院","天津工商职业技术学院","天津工业职业技术学院","天津工艺美术职业学院","天津公安警官职业学院","天津海运职业学院","天津机电职业技术学院","天津交通职业学院","天津开发区职业技术学院","天津青年职业学院","天津轻工职业技术学院","天津生物工程职业技术学院","天津石油职业技术学院","天津铁道职业技术学院","天津现代职业技术学院","天津冶金职业技术学院","天津医学高等专科学校","天津职业大学","天津中德职业技术学院","天津市工会管理干部学院"]},{location:"重庆市",school:["重庆大学","西南大学","重庆师大","西南政法","重庆交大","重庆邮电大学","重庆医大","重庆工商","重庆科技学院","重庆工学院","长江师范学院","四川外国语","四川美院","重庆三峡学院","重庆文理","涪陵职业技术学院","重庆巴渝职业技术学院","重庆城市职业学院","重庆电力高等专科学校","重庆电子科技职业学院","重庆电子职业技术学院","重庆工程职业技术学院","重庆工商职业学院","重庆工业职业技术学院","重庆光彩职业技术学院","重庆海联职业技术学院","重庆机电职业技术学院","重庆警官职业学院","重庆三峡医药高等专科学校","重庆三峡职业学院","重庆社会工作职业学院","重庆水利电力职业技术学院","重庆信息技术职业学院","重庆医药高等专科学校","重庆正大软件职业技术学院","重庆职业技术学院","重庆教育学院","重庆应用外国语专修学院"]},{location:"浙江省",school:["浙江大学","浙江理工","浙江工大","杭州电子科大","浙江中医药","浙江工商","中国计量","浙江科技","浙江林院","杭州师范","浙江传媒","浙江财经","中国美术学院","树人大学","宁波大学","宁波工程","万里学院","诺丁汉大学","嘉兴学院","浙江海洋","温州大学","温州医学院","湖州师范","台州学院","绍兴文理学院","丽水学院","浙江师大","长征职业技术学院","公安海警高等专科学校","杭州万向职业技术学院","杭州职业技术学院","湖州职业技术学院","嘉兴职业技术学院","金华职业技术学院","科技求是学院","丽水职业技术学院","宁波城市职业技术学院","宁波大红鹰职业技术学院","宁波大学科技学院","宁波天一职业技术学院","宁波职业技术学院","衢州职业技术学院","绍兴托普信息职业技术学院","绍兴越秀外国语职业学院","台州职业技术学院","温州职业技术学院","义乌工商职业技术学院","浙江大学城市学院","浙江大学宁波理工学院","浙江东方职业技术学院","浙江纺织服装职业技术学院","浙江工贸职业技术学院","浙江工商职业技术学院","浙江工业职业技术学院","浙江警察学院","浙江广厦建设职业技术学院","浙江机电职业技术学院","浙江建设职业技术学院","浙江交通职业技术学院","浙江教育学院","浙江金融职业学院","浙江经济职业技术学院","浙江经贸职业技术学院","浙江警官职业学院","浙江旅游职业学院","浙江商业职业技术学院","浙江水利水电专科学校","浙江医学高等专科学校","浙江医药高等专科学校","浙江艺术职业学院","浙江育英职业技术学院","浙江电力职业技术学院","浙江国际海运职业技术学校"]},{location:"江苏省",school:["南京大学","河海大学","南京师大","南京理工","东南大学","南航","南京财经","南京医科大","南京工大","南京农大","南京林大","南邮","南京信息工程大学","南京中医药","南京工程","金陵科技学院","晓庄学院","南京审计学院","江苏警官学院","南京体院","南京艺术学院","三江学院","中国药科大","苏州大学","江南大学","中国矿大（徐州）","徐州师大","徐州工程","徐州医学院","扬州大学","江苏大学","江苏科大","南通大学","江苏工业","常州工学院","江苏技术师范","淮阴工学院","淮阴师范","淮海工学院","盐城工学院","盐城师范学院","常熟理工","常州纺织服装职业技术学院","常州工程职业技术学院","常州机电职业技术学院","常州轻工职业技术学院","常州信息职业技术学院","硅湖职业技术学院","河海大学常州校区","淮安信息职业技术学院","建东职业技术学院","健雄职业技术学院","江海职业技术学院","江南影视艺术职业学院","江苏财经职业技术学院","江苏海事职业技术学院","江苏经贸职业技术学院","江苏联合职业技术学院","江苏农林职业技术学院","江苏食品职业技术学院","江苏信息职业技术学院","江苏畜牧兽医职业技术学院","江阴职业技术学院","金肯职业技术学院","金山职业技术学院","九州职业技术学院","昆山登云科技职业学院","连云港师范高等专科学校","连云港职业技术学院","民办明达职业技术学院","南京工业职业技术学院","南京化工职业技术学院","南京交通职业技术学院","南京人口管理干部学院","南京森林公安高等专科学校","南京视觉艺术职业学院","南京特殊教育职业技术学院","南京铁道职业技术学院","南京信息职业技术学院","南通纺织职业技术学院","南通航运职业技术学院","南通农业职业技术学院","南通职业大学","培尔职业技术学院","沙洲职业工学院","苏州港大思培科技职业学院","苏州工业园区职业技术学院","苏州工业职业技术学院","苏州工艺美术职业技术学院","苏州经贸职业技术学院","苏州科技大学","苏州农业职业技术学院","苏州托普信息职业技术学院","苏州职业大学","宿迁学院","泰州师范高等专科学校","泰州职业技术学院","无锡城市职业技术学院","无锡工艺职业技术学院","无锡科技职业学院","无锡南洋职业技术学院","无锡轻工大学","无锡商业职业技术学院","无锡职业技术学院","徐州工业职业技术学院","徐州广播电视大学","徐州建筑职业技术学院","徐州教育学院","徐州工程学院","炎黄职业技术学院","盐城纺织职业技术学院","扬州工业职业技术学院","扬州环境资源管理学院","扬州环境资源职业技术学院","扬州教育学院","扬州职业大学","应天职业技术学院","镇江市高等专科学校","正德职业技术学院","中国传媒大学南广学院","钟山职业技术学院","紫琅职业技术学院","江苏广播电视大学","江苏教育学院","徐州师范高等专科学校","江苏省省级机关管理干部学院","江苏职工医科大学","苏州卫生职业技术学院","盐城卫生职业技术学院","金陵旅馆管理干部学院","南京市广播电视大学"]},{location:"广东省",school:["华南理工大学","广东石油化工职业技术学校","广东科学技术职业学院国防工大","肇庆工商职业技术学院","湛江技师学院","汕尾职业技术学院","广东工贸职业技术学院","罗定职业技术学院","中山大学","暨南大学","华南师范大学","广东工业大学","华南农业大学","广州大学","广东外语外贸大学","广州中医药大学","南方医科大学","仲恺农业技术学院","广州医学院","广东药学院","广东金融学院","广东商学院","广东警官学院","广州体育学院","广州美术学院","星海音乐学院","广东技术师范学院","广东培正学院","广东白云学院","深圳大学","汕头大学","五邑大学","肇庆学院","茂名学院","东莞理工","广东医学院","湛江师范","广东海洋","韶关学院","韩山师范","嘉应学院","惠州学院","佛山科技学院","北京理工大学珠海学院","北京师范大学珠海分校","电子科技大学中山学院","东莞理工学院城市学院","东莞南博职业技术学院","番禺职业技术学院","佛山职业技术学院","广东财经职业学院","广东潮汕职业技术学院","广东纺织职业技术学院","广东工程职业技术学院","广东工业大学华立学院","广东海洋大学寸金学院","广东海洋大学海滨学院","广东化工制药职业技术学院","广东机电职业技术学院","广东技术师范学院北校区","广东建设职业技术学院","广东交通职业技术学院","广东教育学院","广东科学技术职业学院","广东岭南职业技术学院","广东农工商职业技术学院","广东女子职业技术学院","广东轻工职业技术学院","广东省新闻出版技师学院","广东水利电力职业技术学院","广东司法警官职业学院","广东松山职业技术学院","广东外语外贸大学公开学院","广东外语艺术职业学院","广东文艺职业学院","广东行政职业学院","广东亚视演艺职业学院","广东邮电职业技术学院","广州城市职业学院","广州大学城建学院","广州大学华软软件学院","广州大学市政技术学院","广州大学松田学院","广州工程技术职业学院","广州工商职业技术学院","广州航海高等专科学校","广州华立科技职业学院","广州华南商贸职业学院","广州康大职业技术学院","广州科技贸易职业学院","广州民航职业技术学院","广州南洋理工职业学院","广州涉外经济职业技术学院","广州铁路职业技术学院","河源职业技术学院","华澳国际会计学院","华南农业大学珠江学院","华南师范大学增城学院","惠州经济职业技术学院","吉林大学珠海学院","江门职业技术学院","揭阳职业技术学院","茂名职业技术学院","南华工商学院","南海东软信息技术学院","清远职业技术学院","汕头职业技术学院","深圳信息职业技术学院","深圳振西科技学院","深圳职业技术学院","顺德职业技术学院","私立华联学院","阳江职业技术学院","湛江教育学院","湛师基础教育学院","肇庆科技职业技术学院","中山火炬职业技术学院","珠海城市职业技术学院","珠海艺术职业学院","遵义医学院珠海校区","广东技术师范天河分院","茂名广播电视大学","中山大学新华学院","广东商学院华商学院"]},{location:"福建省",school:["厦门大学","集美大学","厦门理工学院","福州大学","福建师范大学","福建农林大学","福建医科大学","福建工程学院","福建中医学院","闽江学院","华侨大学","仰恩大学","泉州师范学院","漳州师范","莆田学院","三明学院","龙岩学院","集美大学诚毅学院","福州大学阳光学院","福州大学至诚学院","福建农林大学东方学院","福建农林大学金山学院","福建电力职业技术学院","福建对外经济贸易职业技术学院","福建警察学院","福建广播电视大学","福建华南女子职业学院","福建交通职业技术学院","福建教育学院","福建金融职业技术学院","福建警官职业学院","福建林业职业技术学院","福建农业职业技术学院","福建商业高等专科学校","福建生物工程职业技术学院","福建水利电力职业技术学院","福建卫生职业技术学院","福建信息职业技术学院","福建行政学院","福建中医学院五洲科技学院","福州海峡职业技术学院","福州科技职业技术学院","福州黎明职业技术学院","福州软件职业技术学院","福州外语外贸职业技术学院","福州英华职业学院","福州职业技术学院","黎明职业大学","湄洲湾职业技术学院","闽北职业技术学院","闽西职业技术学院","南平师范高等专科学校","宁德师范高等专科学校","泉州纺织服装职业学院","泉州光电信息职业学院","泉州华光摄影艺术职业学院","泉州经贸职业技术学院","泉州信息职业技术学院","泉州医学高等专科学校","泉州理工学院","三明职业技术学院","厦门海洋职业技术学院","厦门华天涉外职业技术学院","厦门华厦职业学院","厦门南洋学院","厦门兴才职业技术学院","厦门演艺职业学院","漳州职业技术学院","福建政法管理干部学院","武夷学院","厦门城市职业学院","漳州卫生职业学院"]},{location:"湖南省",school:["湖南师大","湖南九嶷职业技术学院","湖南行政学院","娄底理工学院","娄底市卫生学校","中南大学","湖南大学","长沙理工","湖南农大","湖南中医药","中南林业科大","长沙学院","长沙医学院","湖南涉外经济","湖南商学院","湖南人文科技","湘潭大学","湖南科大","湖南工程学院","南华大学","吉首大学","湖南工大","湖南城市","湖南理工学院","湘南学院","衡阳师院","湖南文理","怀化学院","湖南科技学院","邵阳学院","保险职业学院","长沙电力职业技术学院","长沙航空职业学院","长沙环境保护职业技术学院","长沙民政职业技术学院","长沙南方职业学院","长沙商贸旅游职业技术学院","长沙师范学校","长沙师范专科学校","长沙通信职业技术学院","长沙职工大学","长沙职业技术学院","常德职业技术学院","郴州职业技术学院","衡阳财经工业职业技术学院","湖南安全技术职业学院","湖南财经高等专科学院","湖南城建职业技术学院","湖南大众传媒学院","湖南第一师范","湖南对外经济贸易职业学院","湖南工程职业技术学院","湖南工学院","湖南工业职业技术学院","湖南工艺美术职业学院","湖南公安高等专科学校","湖南广播电视大学","湖南化工职业技术学院","湖南环境生物职业技术学院","湖南机电职业技术学院","湖南建材高等专科学校","湖南交通工程职业技术学院","湖南交通职业技术学院","湖南经济干部管理学院","湖南科技经贸职业学院","湖南科技职业技术学院","湖南理工职业技术学院","湖南娄底远东职业学校","湖南民族职业学院","湖南女子大学","湖南软件职业技术学院","湖南商务职业技术学院","湖南生物环境职业技术学院","湖南生物机电职业技术学院","湖南省第一师范学校","湖南省水利水电职业技术学院","湖南石油化工职业技术学院","湖南税务高等专科学校","湖南司法警官职业技术学院","湖南体育职业学院","湖南铁道职业技术学院","湖南铁路科技职业技术学院","湖南同德职业学院","湖南网络工程职业学院","湖南现代物流职业技术学院","湖南信息科学职业学院","湖南信息职业技术学院","湖南冶金职业技术学院","湖南艺术职业学院","湖南中医药高等专科学校","怀化医学高等专科学校","怀化职业技术学院","娄底职业技术学院","邵阳医学高等专科学校","邵阳职业技术学院","湘潭职业技术学院","潇湘职业学院","益阳职业技术学院","永州职业技术学院","岳阳职业技术学院","张家界航空工业职业技术学院","株洲师范高等专科学校","株洲职业技术学院"]},{location:"湖北省",school:["武汉大学","华中科大","华中农大","武汉理工","中国地大（武汉）","中南财经政法","中南民族大学","华中师大","武汉工业","武汉科技学院","湖北中医学院","湖北经济学院","湖北警官学院","武汉体院","湖北美院","武汉音乐学院","武汉生物工程学院","湖北工大","湖北大学","江汉大学","武汉工大","武汉科大","长江大学","三峡大学","湖北汽院","郧阳医学院","孝感学院","湖北师范学院","黄石理工","黄冈师院","湖北民族学院","襄樊学院","咸宁学院","长江工程职业技术学院","长江职业学院","鄂东职业技术学院","鄂州大学","鄂州职业大学","恩施职业技术学院","湖北财经高等专科学校","湖北财税职业学院","湖北城市建设职业技术学院","湖北工业大学商贸学院","湖北国土资源职业学院","湖北黄石机电职业技术学院","湖北交通职业技术学院","湖北第二师范学院","湖北经济管理干部学院","湖北开放职业学院","湖北民族学院科技学院","湖北轻工职业技术学院","湖北三峡职业技术学院","湖北生态工程职业技术学院","湖北生物科技职业学院","湖北省水利水电职业技术学院","湖北师范学院文理学院","湖北艺术职业学院","湖北职业技术学院","湖北中医药高等专科学校","黄冈科技职业学院","黄冈职业技术学院","江汉艺术职业学院","荆楚理工学院","荆州职业技术学院","沙市职业大学","沙洋师范高等专科学校","十堰职业技术学院","随州职业技术学院","武汉船舶职业技术学院","武汉电力职业技术学院","武汉工程职业技术学院","武汉工业职业技术学院","武汉航海职业技术学院","武汉交通职业学院","武汉警官职业学院","武汉科技职业学院","武汉理工大学华夏学院","武汉民政职业学院","武汉软件工程职业学院","武汉商贸学院","武汉商业服务学院","武汉时代职业学院","武汉铁路职业技术学院","武汉外语外事职业学院","武汉信息传播职业技术学院","武汉职业技术学院","仙桃职业学院","咸宁职业技术学院","襄樊职业技术学院","孝感学院新技术学院","郧阳师范高等专科学校","中南民族大学工商学院","黄冈广播电视大学","华中科技大学文华学院","华中科技大学武昌分校"]},{location:"辽宁省",school:["大连理工","东北大学","辽宁大学","大连海事","东北财经","大连大学","大连交大","大连医大","辽宁师大","大连民族","大连工大","大连水产","大连外国语学院","辽宁外经贸","沈阳大学","沈阳理工","沈阳工大","沈阳建筑","沈阳农大","辽宁中医药","沈阳药科","沈阳师范","中国刑警学院","沈阳化工","沈阳航空工业学院","沈阳工程","沈阳医学院","沈阳体院","鲁迅美院","沈阳音乐学院","中国医科大","辽宁工大","辽宁石化","鞍山科大","鞍山师范学院","渤海大学","辽宁工业大学","辽宁医学院","辽宁科技学院","辽东学院","鞍山市高等职业专科学校","渤海船舶职业学院","渤海大学文理学院","朝阳师范高等专科学校","大连东软信息学院","大连翻译职业技术学院","大连软件职业学院","大连商务职业学院","大连艺术职业学院","大连职业技术学院","抚顺师范高等专科学校","抚顺职业技术学院","阜新高等专科学校","锦州商务职业学院","锦州师范高等专科学校","辽宁广播电视大学","辽宁广告职业学院","辽宁机电职业技术学院","辽宁交通高等专科学校","沈阳大学师范学院","辽宁金融职业学院","辽宁经济职业技术学院","辽宁警官高等专科学校","辽宁科技大学","辽宁林业职业技术学院","辽宁美术职业学院","辽宁农业职业技术学院","辽宁商贸职业学院","辽宁石化职业技术学院","大连广播电视大学","辽宁信息职业技术学院","辽阳职业技术学院","盘锦职业技术学院","沈阳航空职业技术学院","沈阳职业技术学院","辽宁职业学院","铁岭师范高等专科学校","营口职业技术学院","沈阳广播电视大学","辽河石油职业技术学院"]},{location:"吉林省",school:["吉林大学","东北师大","长春大学","吉林农大","长春中医药","东北电力","吉林化工","吉林建筑","长春工程学院","长春师范学院","吉林工程师范","吉林华侨外语","长春税务","吉林体院","吉林艺术学院","长春工大","长春理工","延边大学","北华大学","吉林农科院","吉林医药学院","吉林师范","白城师范学院","通化师范","白城医学高等专科学校","长春东方职业学院","长春金融高等专科学校","长春汽车工业高等专科学校","长春信息技术职业学院","长春医学高等专科学校","长春职业技术学院","东北师范大学人文学院","吉林工商学院—财经校区","吉林电子信息职业技术学院","吉林对外经贸职业学院","吉林工业职业技术学院","吉林公安高等专科学校","吉林交通职业技术学院","吉林工商学院—工程校区","吉林农业工程职业技术学院","吉林工商学院—商贸校区","吉林司法警官职业学院","辽源职业技术学院","四平职业大学","松原职业技术学院","吉林省教育学院","吉林经济管理干部学院"]},{location:"黑龙江省",school:["哈工大","哈工程","东北林大","东北农大","哈尔滨医科大","黑龙江中医药","黑龙江工程学院","黑龙江科技学院","哈尔滨职业技术学院","哈尔滨体院","东方学院","黑龙江大学","哈尔滨商业大学","哈师大","哈理工","佳木斯大学","齐齐哈尔大学","齐齐哈尔医学院","八一农垦","大庆石油","大庆师范学院","牡丹江医学院","牡丹江师范","绥化学院","黑河学院","大庆医学高等专科学校","大庆职业学院","大兴安岭职业学院","哈尔滨电力职业技术学院","哈尔滨华夏计算机职业技术学院","哈尔滨金融高等专科学校","哈尔滨铁道职业技术学院","哈尔滨现代公共关系职业学院","鹤岗师范高等专科学校","黑龙江北开职业技术学院","黑龙江工商职业技术学院","黑龙江公安警官职业学院","黑龙江建筑职业技术学院","黑龙江林业职业技术学院","黑龙江旅游职业技术学院","黑龙江煤炭职业技术学院","黑龙江民族职业学院","黑龙江农垦林业职业技术学院","黑龙江农垦农业职业技术学院","黑龙江农垦职业学院","黑龙江农业工程职业学院","黑龙江农业经济职业学院","黑龙江农业职业技术学院","黑龙江三江美术职业学院","黑龙江商业职业学院","黑龙江生态工程职业学院","黑龙江生物科技职业学院","黑龙江司法警官职业学院","黑龙江信息技术职业学院","黑龙江畜牧兽医职业学院","鸡西大学","牡丹江大学","七台河职业学院","齐齐哈尔高等师范专科学校","齐齐哈尔职业学院","伊春职业学院","哈尔滨师范大学阿城学院","黑龙江省政法管理干部学院","黑龙江交通职业技术学院","哈尔滨应用职业技术学院","黑龙江省教育学院","哈尔滨理工大学远东学院","哈尔滨师范大学呼兰学院"]},{location:"河北省",school:["河北大学","河北农大","中央司法警官学院","石家庄铁院","石家庄经院","河北师大","河北科技","河北医科","河北经贸","河北体院","石家庄学院","燕山大学","河北科师","河北理工","华北煤炭医学","唐山学院","唐山师范","华北航工","廊坊师范","防灾科技学院","华北科技","河北建工","北方学院","承德医学院","邢台学院","河北工程","邯郸学院","衡水学院","保定电力职业技术学院","保定科技职业学院","河北金融学院","保定师范专科学校","保定职业技术学院","渤海石油职业学院","沧州师范专科学校","沧州医学高等专科学校","沧州职业技术学院","河北旅游职业学院","承德民族师范高等专科学校","承德石油高等专科学校","大庆石油学院秦皇岛分院","东北大学秦皇岛校区","邯郸职业技术学院","河北大学医学部","河北工程技术高等专科学校","河北工业职业技术学院","河北公安警察职业学院","河北化工医药职业技术学院","河北机电职业技术学院","河北建材职业技术学院","河北交通职业技术学院","河北农业大学","河北农业大学海洋学院","河北女子职业技术学院","河北软件职业技术学院","河北省艺术职业学院","河北石油职业技术学院","河北司法警官职业学院","河北通信职业技术学院","河北政法管理干部学院","河北职业技术学院","衡水职业技术学院","华北电力大学(保定)","廊坊大学城北大方正软件学院","廊坊东方大学城北京财经学院","廊坊东方大学城北京城市学院","廊坊东方大学城北京传媒学院","廊坊东方大学城北京经济技术职业学院","廊坊东方大学城北京经贸职业学院航空服务学院","廊坊东方大学城北京联合大学","廊坊东方大学城北京中医药大学中专部","廊坊东方大学城河北体育学院","廊坊东方大学城廊坊职业技术学院","秦皇岛教育学院","秦皇岛外国语职业学院","秦皇岛职业技术学院","石家庄东方美术职业学院","石家庄法商职业学院","石家庄工商职业学院","石家庄计算机职业学院","石家庄科技信息职业学院","石家庄联合技术职业学院","石家庄铁路职业技术学院","石家庄外国语职业学院","石家庄外经贸职业学院","石家庄外语翻译职业学院","石家庄信息工程职业学院","石家庄医学高等专科学校","河北传媒学院","石家庄邮电职业技术学院","石家庄职业技术学院","唐山工业职业技术学院","唐山广播电视大学","唐山科技职业技术学院","唐山职业技术学院","邢台医学高等专科学校","邢台职业技术学院","张家口职业技术学院","中国地质大学长城学院","中国环境管理干部学院","中国民航管理干部学院","张家口教育学院","河北能源职业技术学院"]},{location:"河南省",school:["郑州大学","河南工业","河南农大","华北水利水电","郑州轻工","郑州航空工业","黄河科技","中原工学院","河南中医学院","河南财经","河南大学","河南科技大学","洛阳师院","安阳工学院","安阳师院","南阳理工","南阳师院","平顶山工学院","平顶山学院","新乡医学院","河南科技学院","河南师大","信阳师院","商丘师院","周口师院","黄淮学院","许昌学院","河南理工","河南财政税务高等专科学校","河南工程学院","河南工业贸易职业学院","河南工业职业技术学院","河南公安高等专科学校","河南广播影视学院","河南机电高等专科学校","河南检察职业学院","河南交通职业技术学院","河南教育学院","河南经贸职业学院","河南农业职业学院","河南商业高等专科学校","河南省工商行政管理广播电视大学","河南省政法管理干部学院","河南司法警官职业学院","河南新华电脑学院","河南职业技术学院","河南质量工程职业学院","鹤壁职业技术学院","黄河水利职业技术学院","济源职业技术学院","焦作大学","焦作师范高等专科学校","开封大学","开封市电子科技专修学校","洛阳大学","洛阳理工学院","漯河医学高等专科学校","漯河职业技术学院","南阳医学高等专科学校","平顶山教育学院","平顶山职业技术学院","平原大学","濮阳职业技术学院","三门峡职业技术学院","商丘科技职业学院","商丘医学高等专科学校","商丘职业技术学院","嵩山少林武术职业学院","铁道警官高等专科学校","新乡师范高等专科学校","新乡市教育学院","信阳农业高等专科学校","信阳职业技术学院","许昌职业技术学院","永城职业学院","郑州大学西亚斯国际学院","郑州电力高等专科学校","郑州电子信息职业技术学院","郑州工业安全职业学院","郑州华信职业技术学院","郑州交通学院","郑州经贸职业学院","郑州科技职业学院","郑州旅游职业学院","郑州牧业工程高等专科学校","郑州师范高等专科学校","郑州澍青医学高等专科学校","郑州铁路职业技术学院","郑州信息科技职业学院","郑州职业技术学院","中州大学","周口职业技术学院","郑州大学升达经贸管理学院","河南建筑职工大学","洛阳工业高等专科学校","河南职工医学院"]},{location:"山东省",school:["山东大学","中国海洋大学","济南大学","山东建筑大学","山东师大","山东经济学院","山东中医药","山东轻工","山东交通学院","山东警院","山东体院","山东艺术学院","山东工美","曲阜师大","烟台大学","鲁东大学","山东工商","南山学院","青岛大学","山东科大","青岛科大","青岛理工","青岛农业大学","滨海学院","中国石油大学华东","聊城大学","山东理工","潍坊医学院","潍坊学院","泰山医学院","山东财政","泰山学院","山东农大","滨州医学院","滨州学院","济宁医学院","临沂师范","德州学院","枣庄学院","菏泽学院","滨州职业学院","德州科技职业学院","东营职业学院","哈工大(威海)","菏泽医学专科学校","济南工程职业技术学院","济南铁道职业技术学院","济南职业学院","济宁学院","济宁职业技术学院","莱芜职业技术学院","聊城职业技术学院","青岛飞洋职业技术学院","青岛港湾职业技术学院","青岛恒星职业技术学院","青岛黄海职业学院","青岛求实学院","青岛求实职业技术学院","青岛远洋船员学院","青岛职业技术学院","曲阜远东职业技术学院","日照职业技术学院","山东大王职业学院","山东大学威海分校","山东电力高等专科学校","山东电子职业技术学院","山东纺织职业学院","山东服装职业学院","山东工业职业学院","山东华宇职业技术学院","山东化工职业学院","山东交通职业学院","山东经贸职业学院","山东凯文科技职业学院","山东科技职业学院","山东劳动职业技术学院","山东力明科技职业学院","山东旅游职业学院","山东铝业职业学院","山东商业职业技术学院","山东胜利职业学院","山东省青岛酒店管理学院","山东水利职业技术学院","山东省潍坊艺术学校","山东圣翰财贸职业学院","山东水利职业学院","山东水利专科学校","山东丝绸纺织职业学院","山东外国语职业学院","山东外贸职业学院","山东外事翻译学院威海分校","山东外事翻译职业学院","山东万杰医学高等专科学校","山东威海财经专修学院","山东威海外国语进修学院","山东现代职业学院","山东协和职业技术学院","山东信息职业技术学院","山东行政学院(山东经济管理干部学院)","山东杏林科技职业学院","山东畜牧兽医职业学院","山东药品食品职业学院","山东医学高等专科学校","山东英才职业技术学院","山东政法学院","山东中医药高等专科学校","泰山职业技术学院","万杰科技学院","威海市广播电视大学","威海市交通学校","威海职业(技术)学院","威海中加国际工商学院","潍坊工商职业学院","潍坊教育学院","潍坊科技职业学院","潍坊职业学院","文登师范","烟台职业学院","枣庄科技职业学院","中国石油大学(华东)东营校区","淄博广播电视大学","淄博恒星外国语学院","淄博科技职业学院","淄博师专","淄博职业学院","山东省教育学院","山东技师学院","日照广播电视大学","中华女子学院山东分院","山东城市建设职业学院","烟台工程职业技术学院","山东商务职业学院","烟台汽车工程职业学院","山东省农业管理干部学院","山东省青年管理干部学院","山东省工会管理干部学院","山东广播电视大学","德州职业技术学院","中国石油大学胜利学院","烟台大学文经学院","青岛理工大学琴岛学院","山东科技大学泰山科技学院","中国海洋大学青岛学院","山东经济学院燕山学院","青岛农业大学海都学院","曲阜师范大学杏坛学院","山东财政学院东方学院","山东师范大学历山学院","聊城大学东昌学院","济南大学泉城学院","中国农业大学（烟台校区）","日照师范学校","山东艺术设计学院","滨州技术学院","山东省贸易职工大学","山东冶金技术学院","济南广播电视大学"]},{location:"陕西省",school:["西安交大","长安大学","西北工大","西北大学","商洛学院","陕西师大","西安电子科大","西安理工","西安科大","西安工大","西外","西邮","西安医学院","西安财经","西北政法","西安体院","西安美院","西安音乐学院","西安文理学院","西京学院","西安翻译学院","培华学院","欧亚学院","西安外事","西安石油","西安建筑科大","延安大学","陕西中医学院","咸阳师范学院","陕西科大","宝鸡文理学院","渭南师范","陕西理工","榆林学院","安康学院","西北农林科大","安康职业技术学院","宝鸡职业技术学院","陕西财经职业技术学院","陕西电子科技职业学院","陕西电子信息职业技术学院","陕西纺织服装职业技术学院","陕西服装艺术职业学院","陕西工业职业技术学院","陕西国防工业职业技术学院","陕西国际商贸职业学院","陕西航空职业技术学院","陕西交通职业技术学院","陕西经济管理职业技术学院","陕西警官职业学院","陕西旅游烹饪职业学院","陕西能源职业技术学院","陕西青年职业学院","陕西铁路工程职业技术学院","陕西邮电职业技术学院","陕西职业技术学院","铜川职业技术学院","渭南职业技术学院","西安电力高等专科学校","西安高新科技职业学院","西安工程大学","西安海棠职业学院","西安航空技术高等专科学校","西安航空职业技术学院","西安科技商贸职业学院","西安汽车科技职业学院","西安三资职业学院","西安思源学院","西安铁路职业技术学院","西安职业技术学院","咸阳职业技术学院","延安职业技术学院","杨凌职业技术学院","陕西银行学校","西安机电信息技术学院","陕西教育学院","西安航空职业学院","西安铁路工程职工大学","西安高等电子专科学院","西安华西专修大学","西安航空职工大学"]},{location:"甘肃省",school:["兰州大学","西北民大","西北师大","甘肃中医学院","兰州商院","甘肃政法学院","兰州城市学院","甘肃农大","兰州理工","兰州交大","天水师院","陇东学院","河西学院","兰州石化职业技术学院","甘肃工业职业技术学院","甘肃警察职业学院","兰州理工大学技术工程学院","兰州职业技术学院","武威职业学院","张掖医学高等专科学校","甘肃畜牧工程职业技术学院","陇南师范高等专科学校","合作民族师范高等专科学校","甘肃联合大学","甘肃林业职业技术学院","甘肃建筑职业技术学院","酒泉职业技术学院","甘肃农业职业技术学院","平凉医学高等专科学校","兰州资源环境职业技术学院","定西师范高等专科学校","兰州交通大学博文学院","兰州工业高等专科学校","兰州外语职业学院"]},{location:"青海省",school:["青海大学","青海师大","青海民院","青海财经职业学院","青海畜牧兽医职业技术学院","青海建筑职业技术学院","青海警官职业学院","青海交通职业技术学院","青海卫生职业技术学院"]},{location:"新疆维吾尔自治区",school:["新疆大学","伊犁职业技术学院","新疆农大","新疆医科大","新疆师大","新疆财经","新疆艺术学院","石河子大学","塔里木大学","喀什师院","伊犁师院","昌吉学院","阿克苏职业技术学院","巴音郭楞职业技术学院","昌吉职业技术学院","和田师范专科学校","克拉玛依职业技术学院","乌鲁木齐职业大学","新疆兵团警官高等专科学校","新疆工业高等专科学校","新疆机电职业技术学院","新疆建设职业技术学院","新疆交通职业技术学院","新疆警官高等专科学校","新疆能源职业技术学院","新疆农业职业技术学院","新疆轻工职业技术学院","新疆石河子职业技术学院","新疆天山职业技术学院","新疆科信学院","新疆职业大学","新疆石油学院","毕升大学"]},{location:"山西省",school:["山西大学","太原理工","中北大学","山西医大","山西中医学院","太原师范","太原科大","山西财经","山西师大","山西农大","大同大学","长治医学院","长治学院","运城学院","晋中学院","忻州师范","北岳职业技术学院","长治职业技术学院","晋城职业技术学院","晋中职业技术学院","临汾职业技术学院","潞安职业技术学院","吕梁高等专科学校","山西财贸职业技术学院","山西财政税务专科学校","山西电力职业技术学院","山西工程职业技术学院","山西工商职业学院","山西管理职业学院","山西国际商务职业学院","山西华澳商贸职业学院","山西机电职业技术学院","山西建筑职业技术学院","山西交通职业技术学院","山西金融职业技术学院","山西警官高等专科学校","山西警官职业学院","山西林业职业技术学院","山西旅游职业学院","山西煤炭职业技术学院","山西生物应用职业技术学院","山西水利职业技术学院","山西同文外语职业学院","山西戏剧职业学院","山西信息职业技术学院","山西兴华职业学院","山西艺术职业学院","山西运城农业职业技术学院","山西运城学院","山西综合职业技术学院","太原城市职业技术学院","太原大学","太原电力高等专科学校","太原旅游职业学院","忻州职业技术学院","阳泉职业技术学院","山西广播电影电视管理干部学院","山西城市职业技术学院","运城农业学院","山西广播电视大学","太原工业学院","山西经济管理干部学院"]},{location:"四川省",school:["四川大学","四川农大","电子科大","西南交大","成都理工","四川师大","西南民族大学","成都大学","西南财经","西华大学","成都中医药","成都信息工程大学","成都医学院","四川文理学院","成都体院","四川音乐学院","西南石油","中国民航飞行学院","四川理工","泸州医学院","四川警察学院","川北医学院","西华师大","内江师范","乐山师院","绵阳师范","西南科大","西昌学院","宜宾学院","攀枝花学院","阿坝师范高等专科学校","成都电子机械高等专科学校","成都东软信息技术职业学院","成都纺织高等专科学校","成都广播电视大学","成都航空职业技术学院","成都理工大学广播影视学院","成都农业科技职业学院","成都学院","成都艺术职业学院","成都职业技术学院","达州职业技术学院","电子科技大学成都学院","广安职业技术学院","康定民族师范高等专科学校","乐山职业技术学院","泸州职业技术学院","眉山职业技术学院","绵阳职业技术学院","民办四川天一学院","内江职业技术学院","南充职业技术学院","四川大学龙泉校区","四川电力职业技术学院","四川工程职业技术学院","四川工商职业技术学院","四川管理职业学院","四川广播电视大学","四川国际标榜职业学院","四川航天职业技术学院","四川华新现代职业学院","四川化工职业技术学院","四川机电职业技术学院","四川建筑职业技术学院","四川交通职业技术学院","四川教育学院","四川警安职业学院","四川烹饪高等专科学校","四川商务职业学院","四川师范大学绵阳初等教育学院","四川水利职业技术学院","四川司法警官职业学院","四川托普信息技术职业学院","四川外语学院成都学院","四川信息工程学校","四川邮电职业技术学院","四川职业技术学院","四川中医药高等专科学校","雅安职业技术学院","宜宾职业技术学院","四川大学锦城学院","四川大学锦江学院","德阳职业技术学校","四川信息职业技术学院","四川艺术职业学院","四川师范大学成都学院"]},{location:"贵州省",school:["贵州大学","贵阳医学院","贵阳中医学院","贵州财经","贵州民族","贵阳学院","贵州师大","铜仁学院","遵义医学院","遵义师范","毕节学院","黔南师院","安顺学院","凯里学院","安顺职业技术学院","贵州电力职业技术学院","贵州电子信息职业技术学院","贵州航天职业技术学院","贵州交通职业技术学院","贵州警官职业学院","贵州科技工程职业学院","贵州轻工职业技术学院","贵州商业高等专科学校","六盘水师范高等专科学校","黔东南民族职业技术学院","黔南民族医学高等专科学校","黔南民族职业技术学院","黔西南民族师范高等专科学校","黔西南民族职业技术学院"]},{location:"安徽省",school:["中国科大","安徽大学","合肥工大","安徽医科大","安徽建工","安徽中医","合肥学院","安徽农大","安徽工业大学","安徽科技","皖南医学院","安徽师大","安徽工程科技","蚌埠医学院","安徽财经","阜阳师范","淮南师范","安徽理工","淮北煤炭师范","安庆师范","铜陵学院","皖西学院","巢湖学院","滁州学院","宿州学院","黄山学院","新华学院","蚌埠学院","安徽财贸职业学院","安徽城市管理职业学院","安徽电气工程职业技术学院","安徽电子信息职业技术学院","安徽工贸职业技术学院","安徽工商职业学院","安徽工业经济职业技术学院","安徽公安职业学院","安徽广播影视职业技术学院","安徽国防科技职业学院","安徽国际商务职业学院","安徽机电职业技术学院","安徽交通职业技术学院","安徽教育学院","安徽经济管理学院","安徽警官职业学院","安徽林业职业技术学院","安徽明星科技职业学院","安徽商贸职业技术学院","安徽审计职业学院","安徽省三联职业技术学院","安徽水利水电职业技术学院","安徽体育运动职业技术学院","安徽文达信息技术职业学院","安徽新闻出版职业技术学院","安徽冶金科技职业学院","安徽医学高等专科学校","安徽艺术职业学院","安徽邮电职业技术学院","安徽职业技术学院","安徽中澳科技职业学院","安徽中医药高等专科学校","安庆职业技术学院","亳州师范高等专科学校","亳州职业技术学院","巢湖职业技术学院","池州师范专科学校","池州职业技术学院","滁州职业技术学院","阜阳科技职业学院","阜阳职业技术学院","合肥市万博科技职业学院","合肥通用职业技术学院","淮北职业技术学院","淮南联合大学","淮南职业技术学院","六安职业技术学院","马鞍山师范高等专科学校","民办安徽外国语职业技术学院","民办合肥经济技术职业学院","宿州职业技术学院","铜陵职业技术学院","芜湖信息技术职业学院","芜湖职业技术学院","宣城职业技术学院"]},{location:"江西省",school:["江西财经","南昌大学","华东交通大学","南昌航空大学","南昌工程","南昌理工","江西中医学院","江西科技师范学院","蓝天学院","江西农大","江西师大","东华理工大学","景德镇陶瓷学院","赣南医学院","赣南师范学院","江西理工","上饶师范学院","井冈山学院","宜春学院","九江学院","赣南教育学院","赣西科技职业学院","江西财经职业学院","江西城市学院","江西大宇学院","江西电力职业技术学院","江西服装职业技术学院","江西赣江职业技术学院","江西工程职业学院","江西工业工程职业技术学院","江西工业贸易职业技术学院","江西工业职业技术学院","江西公安专科学校","江西航空职业技术学院","江西护理职业技术学院","江西环境工程职业学院","江西机电职业技术学院","江西建设职业技术学院","江西交通职业技术学院","江西教育学院","江西经济管理干部学院","江西经济管理职业学院","江西科技职业学院","江西旅游商贸职业学院","江西南昌教育学院","江西农业工程职业学院","江西青年职业学院","江西轻工职业技术学院","江西生物科技职业学院","江西省广播电视大学","江西司法警官职业学院","江西陶瓷工艺美术职业学院","江西外语外贸职业学院","江西先锋软件职业技术学院","江西现代职业技术学院","江西信息应用职业技术学院","江西行政管理干部学院","江西艺术职业学院","江西应用技术职业学院","江西渝州科技职业学院","江西制造职业技术学院","江西中医药高等专科学校","景德镇高等专科学校","九江职业大学","九江职业技术学院","南昌师范高等专科学校","南昌市职工科技大学","萍乡高等专科学校","上饶职业技术学院","新余高等专科学校","宜春职业技术学院","鹰潭职业技术学院","江西应用工程职业学院"]},{location:"云南省",school:["昆明理工","云南农大","云南师大","云南财经","云南民大","西南林学院","昆明医学院","云南中医学院","红河学院","云南警官学院","云南艺术","云南大学","曲靖师范","玉溪师院","楚雄师院","大理学院","保山师范高等专科学校","楚雄医药高等专科学校","德宏师范高等专科学校","云南大学滇池学院","昆明大学","昆明工业职业技术学院","昆明师范高等专科学校","昆明扬帆职业技术学院","昆明冶金高等专科学校","昆明艺术职业学院","丽江师范高等专科学校","曲靖医学高等专科学校","思茅师范高等专科学校","文山师范高等专科学校","西双版纳职业技术学院","玉溪农业职业技术学院","云南爱因森软件职业学院","云南广播电视大学","云南国防工业职业技术学院","云南国土资源职业学院","云南机电职业技术学院","云南交通职业技术学院","云南经济管理学院","云南经济管理职业学院","云南科技信息职业技术学院","云南林业职业技术学院","云南能源职业技术学院","云南农业职业技术学院","云南热带作物职业学院","云南省林业科学院","云南师范大学商学院","云南司法警官职业学院","云南体育运动职业技术学院","云南医学高等专科学校","云南昭通师范专科学校","昭通师范高等专科学校"]},{location:"内蒙古自治区",school:["内蒙古大学","内蒙古工业大学","内蒙古农大","内蒙古师大","内蒙古医学院","内蒙古财经","内蒙古科大","内蒙古民族大学","赤峰学院","呼伦贝尔学院","包头钢铁职业技术学院","包头轻工职业技术学院","包头职业技术学院","河套大学","呼和浩特职业学院","集宁师范高等专科学校","内蒙古财税职业学院","内蒙古电子信息职业技术学院","内蒙古化工职业学院","内蒙古机电职业技术学院","内蒙古建筑职业技术学院","内蒙古交通职业技术学院","内蒙古民族高等专科学校","内蒙古商贸职业学院","通辽职业学院","乌海职业技术学院","乌兰察布职业学院","锡林郭勒职业学院","内蒙古警察职业学院","内蒙古体育职业学院","内蒙古青城大学","鄂尔多斯教育学院"]},{location:"广西壮族自治区",school:["广西大学","广西轻工高级技工学校","广西医科大学","广西民族大学","广西中医学院","广西师范学院","广西财经学院","广西艺术学院","桂林电子科大","广西师范大学","桂林工学院","桂林医学院","广西工学院","右江民族医学院","百色学院","河池学院","玉林师范学院","钦州学院","贺州学院","梧州学院","广西师范大学漓江学院","北海宏源足球职业学院","北海艺术设计职业学院","北海职业学院","广西城市职业学院","广西电力职业技术学院","广西东方外语职业学院","广西工商职业技术学院","广西工业职业技术学院","广西国际商务职业技术学院","广西机电职业技术学院","广西建设职业技术学院","广西交通职业技术学院","广西经济管理干部学院","广西经贸职业技术学院","广西警管高等专科学校","广西农业职业技术学院","广西生态工程职业技术学院","广西水利电力职业技术学院","广西体育高等专科学校","广西英华国际职业学院","广西邕江大学","广西职业技术学院","桂林航天工业高等专科学校","桂林旅游高等专科学校","桂林山水职业学院","桂林师范高等专科学校","河池职业学院","柳州师范高等专科学校","柳州医学高等专科学校","柳州运输职业技术学院","柳州职业技术学院","南宁师范高等专科学校","南宁职业技术学院","南宁地区教育学院","北京航空航天大学北海学院","桂林航天科技学院","广西政法学院","广西广播电视大学","贵港职业学院","桂林高级技校","百色职业学院","广西河池学院","桂林旅专"]},{location:"西藏自治区",school:["西藏大学","西藏藏医学院","西藏民院","拉萨师范高等专科学校","西藏警官高等专科学校"]},{location:"宁夏回族自治区",school:["宁夏大学","北方民大","宁夏医学院","宁夏理工","宁夏师范","吴忠职业技术学院","宁夏职业技术学院","宁夏财经职业技术学院","宁夏司法警官职业学院","宁夏师范学院","宁夏经贸职业技术学院","宁夏建设职业技术学院","银川科技职业学院","宁夏吴忠民族学院","吴忠民族学院","宁夏工商职业技术学院"]},{location:"海南省",school:["海南大学","海南医学院","海南师范大学","华南热带农大","琼州大学","海口经济职业技术学院","海南经贸职业技术学院","海南软件职业技术学院","海南外国语职业学院","海南万和信息职业技术学院","海南政法职业学院","海南职业技术学院","琼台师范高等专科学校","三亚航空旅游职业学院","三亚卓达旅游职业学院","海南大学三亚学院"]},{location:"香港特别行政区",school:["香港大学","香港中文大学","香港科技大学","香港理工大学","香港城市大学","香港浸会大学","香港岭南大学","香港珠海学院","香港教育学院","香港演艺学院","香港国际商学院","香港维多利亚工商管理学院"]},{location:"澳门特别行政区",school:["澳门大学","澳门理工学院","澳门科技大学","澳门旅游学院"]},{location:"台湾省",school:["国立台湾大学","国立中正大学","国立台湾艺术大学","国立清华大学","国立中山大学","国立政治大学","国立成功大学","国立中央大学","国立阳明大学","国立东华大学","国立中兴大学","国立台湾师范大学","国立台湾海洋大学","国立高雄大学","国立嘉义大学","国立台湾科技大学","国立空中大学","国立台北大学","国立高雄师范大学","国立联合大学","国立暨南国际大学","国立屏东科技大学","国立彰化师范大学","国立台北科技大学","国立台东大学","国立宜蓝大学"]},{location:"海外",school:["AucklandInstituteofStudy","CarrickInstituteofEducation","ElCaminoCollege","ElmwoodCollege","KaplanFinancialSingapore","LaTrobeUniversity","MonashUniversity","PasadenaCityCollege","RoyalHolloway，UniversityofLondon","SantaBarbaraCityCollege","simonfraseruniversity","SouthDevonCollege","TheUniversityofAdelaide","theUniversityofEdinburgh，UK","theUniversityofEdinburgh，UK","TulaneUniversity","uofyork","UniversityofLiverpool","UniversityofMaryland，CollegePark(CollegePark)","universityofminnesota，morris","universityofNewBrunsiwck","universityofNewBrunswick","UniversityofTechnology，Sydney","UniversityofWisconsin-Madison","Российский;университет;дружбынародов","大邱韩医大学","东西大学","京テクノロジーコミュニケーション専門学校","顿涅茨克经济管理大学","俄罗斯防空军事学院","法国里尔第三大学","韩国东洋大学","韩国汉阳大学","韩国建阳大学","汉阳大学","建国大学","建阳大学","金浦大學","康奈尔大学(梦想中的大学)","空军防空兵军事学院","美国高级职业白痴大学[UT]","明治大学","莫斯科大学","莫斯科国立师范大学","目标日本早稻田大学","日本北九州ymca日本语专门学校","日本国北陆大学","日本国国立北陆先端大","日本国国立北陆先端科技大学","日本流通经济大学","日本早稻田大学","神田外語大学","圣克鲁司大学","外語ビジネス専門学校","信州大学"]}],init:function(a){this.$inputElem=d(a),this.bindEvent()},bindEvent:function(){this.$inputElem.bind("click",d.proxy(this.popWindow,this))},popWindow:function(b){var c=a("widget/floatBox/SchoolBox"),d=c.getInstance();this.schoolBox=d;var e=this;d.show(function(){e.initSchool()})},schoolBindEvent:function(){this.$elem.delegate(".js-select-province","change",d.proxy(this.showSchool,this)).delegate(".js-list li","click",d.proxy(this.schoolSelected,this)).delegate(".js-list li","mouseover",d.proxy(this.schoolHover,this)).delegate(".js-list li","mouseout",d.proxy(this.schoolOut,this)).delegate(".click-trigger","click",d.proxy(this.showOtherForm,this)).delegate(".submit-trigger","click",d.proxy(this.otherSchool,this)).find(".js-select-province option:eq(1)").change(),setTimeout(function(){d(".js-select-province option:eq(1)").attr("selected",!0)},1)},initSchool:function(){this.$elem=this.schoolBox.$elem,this.$pElem=this.$elem.find(".js-select-province").focus(),this.$schoolListElem=this.$elem.find(".js-list"),this.buildSelect(),this.$schoolListElem.empty(),this.schoolBindEvent()},buildSelect:function(){var a='<option value="请选择">-请选择-</option>';for(var b=0;b<this.data.length;b++)a+='<option value="'+this.data[b].location+'">'+this.data[b].location+"</option>";this.$pElem.html(a)},schoolSelected:function(a){var b=this,c=d(a.target).attr("title");this.schoolBox.hide(),this.fillIn(c)},schoolHover:function(a){d(a.target).addClass("current")},schoolOut:function(a){d(a.target).removeClass("current")},showSchool:function(a){this.buildSchool(a.target.value)},showOtherForm:function(a){this.$elem.find(".js-manual-tip").hide(),this.$elem.find(".js-manual-form").fadeIn("fast")},otherSchool:function(a){var b=this.$elem.find("#schoolName").val();if(b==="")return!1;this.$elem.find(".js-manual-tip").show(),this.$elem.find(".js-manual-form").hide(),this.schoolBox.hide(),this.fillIn(b)},fillIn:function(a){this.$inputElem.focus(),this.$inputElem.val(a),this.$inputElem.blur()},buildSchool:function(a){var b="";for(var c=0;c<this.data.length;c++)if(this.data[c].location===a){var d=this.data[c].school;for(var f=0;f<d.length;f++)b+='<li title="'+d[f]+'"><span class="square"></span>'+e.countChars(String(d[f]),20)+"</li>";break}this.$schoolListElem.html(b)}};return f});define("widget/floatBox/SchoolBox",function(a,b,c){var d=a("external/jquery"),e=a("widget/floatBox/Box"),f=a("utils/tmpl"),g=e.extend({init:function(a,b){this._super(a,b)},preRender:function(){return{title:"选择毕业院校",content:f.formatTemplate(a("_tmpl/schoolBox"))}},postRender:function(){this.$elem.addClass("poplayer-schoolbox")},bindEvent:function(){this._super()},show:function(a){this._super(),this.callback=a,this.callback.call()}}),h=new g;return{getInstance:function(){return h}}});define("_tmpl/schoolBox",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div class="poplayer-schoolbox-select"><span>请选择省市：</span><select class="js-select-province" name="select"><option value="">-请选择-</option></select><span class="poplayer-schoolbox-select-tip js-manual-tip">没有自己的学校？&nbsp;<a class="poplayer-linkb click-trigger" href="javascript:;">点击直接输入</a></span><span class="poplayer-schoolbox-select-form js-manual-form"><label for="schoolName">输入学校名称：</label><input id="schoolName" class="poplayer-input" type="text" /><a class="poplayer-btn-cancel submit-trigger" href="javascript:;">提交</a></span></div><div class="poplayer-schoolbox-list"><ul class="js-list clearfix"></ul></div>');return p.join("")}});define("_tmpl/profileBox",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div class="poplayer-item js-item" id="poplayer-profile-schooltips"><label class="poplayer-item-left">学校：</label><div class="poplayer-item-right"><div class="poplayer-inputBox"><label class="poplayer-input-tips ">点击选择学校</label><a href="javascript:;" class="poplayer-input-clear icon-close js-school-trigger" title="清空"></a><input class="poplayer-input js-input" type="text" value="',school,'" id="poplayer-profile-school"/></div><div class="poplayer-choiceBox choiceBox-index" >'),showSchool==1?p.push('<a href="javascript:;" class="poplayer-la viewType-current" data-secrecy="1">公开<em class="icon-choiceBox-arrow"></em></a>'):p.push('<a href="javascript:;" class="poplayer-la viewType-current" data-secrecy="0">私密<em class="icon-choiceBox-arrow"></em></a>'),p.push('<ul class="choiceBox-selectList hidden  choiceBox-index"><li data-value="0">私密</li><li data-value="1">公开</li></ul></div></div></div><div class="poplayer-item js-item" id="poplayer-profile-companytips"><label class="poplayer-item-left">公司：</label><div class="poplayer-item-right"><div class="poplayer-inputBox"><label class="poplayer-input-tips ">请输入公司名称</label><input class="poplayer-input js-input" type="text" value="',company,'" id="poplayer-profile-corp"/></div><div class="poplayer-choiceBox ">'),showCompany==1?p.push('<a href="javascript:;" class="poplayer-la" data-secrecy="1">公开<em class="icon-choiceBox-arrow"></em></a>'):p.push('<a href="javascript:;" class="poplayer-la" data-secrecy="0">私密<em class="icon-choiceBox-arrow"></em></a>'),p.push('<ul class="choiceBox-selectList hidden"><li data-value="0">私密</li><li data-value="1">公开</li></ul></div><p class="poplayer-tips js-tips"><span class="text-tips js-text"></span></p></div></div><div class="poplayer-item"><label class="poplayer-item-left"></label><div class="poplayer-item-right"><a href="javascript:;" class="poplayer-btn-sure js-profile-btn-sure" id="poplayer-profile-submit" onclick="this.blur()">保存</a></div></div>');return p.join("")}});define("widget/floatBox/TagBox",function(a,b,c){var d=a("external/jquery"),e=a("widget/floatBox/Box"),f=a("utils/tmpl"),g=a("utils/DataSource"),h=a("utils/Utils"),i=a("widget/TabSwitch"),j=a("widget/tip/NaviTip"),k=a("utils/log/Logger"),l=a("model/UserData"),m=e.extend({init:function(a,b){this._super(a,b),this.$recClickTag,this.currentTag,this.hasInited=!1,this.config={},this.loadingTriggerTime=300,this._timer,this.tagReg=/^[a-zA-Z0-9\u4e00-\u9fa5]*$/,this.myTagsArr=[],this.oriTagsArr=[],this.tagsData=this.ajaxGetTags();for(var c=this.tagsData.userTags.length-1;c>=0;c--)this.myTagsArr[c]=this.tagsData.userTags[c],this.oriTagsArr[c]=this.tagsData.userTags[c]},preRender:function(){return{title:"个人标签",content:f.formatTemplate(a("_tmpl/tagBox"),this.tagsData)}},postRender:function(){this.$elem.addClass("poplayer-tagsBox"),this.$elem.data("keyfrom","wGuess.tag")},bindEvent:function(){this._super(),d(document).delegate(".poplayer-tagsBox-sysTagsList li a[class!=selected]","click",d.proxy(this.onTagAdd,this)).delegate(".poplayer-tagsBox-myTagsList em","click",d.proxy(this.onTagDel,this)).delegate(".poplayer-tagsBox-addMyTags a","click",d.proxy(this.userFillTag,this)).delegate(".poplayer-tagsBox-sysTagsList li a[class*=selected]","click",d.proxy(this.onSelDagDel,this)).delegate(".poplayer-tagsBox-addMyTags input","keypress",d.proxy(this.userFillTag,this)).delegate(".js-tagBox-btn-sure","click",d.proxy(this.onSubmit,this))},show:function(a){this._super(),this.tab=new i(".poplayer-tabBox-tabList",{}),this.tab.show(),this.$tagInputElem=d(".poplayer-tagsBox-addMyTags input"),this.$recTagsArr=d(".poplayer-tagsBox-sysTagsList a"),this.$introElem=d(".poplayer-tagsBox-myContent .poplayer-tagsBox-tips"),this.$tabSwitchElem=d(".poplayer-tabBox-tabList li"),this.renderMyTags(),this.grayAdded()},onshow:function(){this.show(),k.triggerLog(this.$elem,{method:"click"})},onTagAdd:function(a){var b=d.trim(a.target.innerHTML);this.currentTag=b,this.tagValidate(b)&&this.addTagAjax(b)},onTagDel:function(a){this.currentTag=d.trim(d(a.target).parent().find(".js-tag").text()),this.delTagAjax(this.currentTag)},onSelDagDel:function(a){this.currentTag=d(a.target).text(),this.delTagAjax(this.currentTag)},delTagAjax:function(a){g.postJSON("delTag",{tag:a},d.proxy(this.delTagCallBack,this)),this._timer=setTimeout(d.proxy(this.showLoading,this),this.loadingTriggerTime)},delTagCallBack:function(a){this._timer&&clearTimeout(this._timer),this.hideLoading();var b=this.currentTag;a.updateState===!0?this.removeTagElem(b):this.popTip("删除标签失败")},hideLoading:function(){!this.$loadingLayer||this._super()},removeTagElem:function(a){var b=d.inArray(a,this.myTagsArr);this.myTagsArr.splice(b,1),this.myTagsArr.length<1&&this.$introElem.removeClass("hidden"),this.renderMyTags(),this.resumeIt(a)},grayAdded:function(){for(n in this.myTagsArr)this.grayIt(this.myTagsArr[n]);this.grayAdded=function(){var a=this.myTagsArr.length;this.grayIt(this.myTagsArr[a-1])}},userFillTag:function(a){if(a.keyCode==13||a.type=="click"){var b=d.trim(this.$tagInputElem.val());this.currentTag=b,this.tagValidate(b)&&this.addTagAjax(b)}},tagValidate:function(a){var b=a.replace(h.FULLWIDTH_REG,"**");if(a===""){this.popTip("不能为空或全是空格");return!1}if(b.length>20){this.popTip("不能超过10个汉字");return!1}if(!this.checkTagFormat(a)){this.popTip("不能包含特殊字符，只能是字母、数字、或中文");return!1}if(this.myTagsArr.length>=10){this.popTip("不能再添加了，你最多可以有十个标签");return!1}if(this.checkExist(a)){this.popTip("该标签已经存在");return!1}return!0},tagSuggest:function(a){this.tagValidate(a.target.value)},checkTagFormat:function(a){return a.match(this.tagReg)?!0:!1},checkExist:function(a){a=d.trim(a);var b=d.inArray(a,this.myTagsArr);if(b!==-1)return!0},popTip:function(a){j.show({type:"error",text:a})},addTagAjax:function(a){g.postJSON("addTag",{tag:a,rec:0},d.proxy(this.addTagCallBack,this)),this._timer=setTimeout(d.proxy(this.showLoading,this),this.loadingTriggerTime)},addTagCallBack:function(a){var b=this.currentTag;this._timer&&clearTimeout(this._timer),this.hideLoading();if(a.updateState===!0)this.myTagsArr.push(b),this.renderMyTags(),this.grayAdded(),this.$tagInputElem.val("");else{var c=typeof a.updateDesc!="undefined"?a.updateDesc:"添加标签失败";this.popTip(c)}},renderMyTags:function(){var a=d(".poplayer-tagsBox-myTagsList"),b="";a.html("");if(this.myTagsArr.length>0){for(var c=0,e=this.myTagsArr.length;c<e;c++)b+='<li><span class="js-tag">'+this.myTagsArr[c]+'</span><em class="icon-close"></em></li>';this.$introElem.addClass("hidden")}else this.$introElem.removeClass("hidden");a.html(b)},onSubmit:function(){var a=!0,b=0,c="searchUserSimilar",e={};this.hide();for(var f in this.myTagsArr)for(var h in this.oriTagsArr)this.myTagsArr[f]==this.oriTagsArr[h]&&b++;this.myTagsArr.length==this.oriTagsArr.length&&b==this.oriTagsArr.length?j.show({type:"success",text:"个人标签保存成功"}):(g.postJSON(c,e,d.proxy(this.submitCallBack,this)),k.triggerLog(this.$elem,{method:"save"}))},submitCallBack:function(a){a.list?this.submitSuccess(a):this.submitError(a)},submitSuccess:function(a){j.show({type:"success",text:"个人标签保存成功"}),this.hide(),d(document).trigger("guessUserList.updateDataReady",[a])},submitError:function(a){typeof a.updateDesc!="undefined"?message=a.updateDesc:message="后台繁忙，请稍后重试",j.show({type:"error",text:message})},ajaxGetTags:function(){var a=[];return{userTags:l.getLoginUser().userTag,recTags:{"我是达人":["亲子达人","健康达人","原创达人","宠物达人","心理达人","思想达人","摄影达人","旅游达人","时尚达人","星座达人","漫画达人","电影达人","相声达人","美食达人","财经达人","音乐达人"],"个人名片":["60后","70后","80后","85后","90后","IT民工","OL","乐活族","伪文青","外貌协会","大龄青年","学生","宅女","宅男","愤青","文青","月光族","潮人","球迷","白领","自由主义者","自由职业","蚁族","麦霸"],"兴趣爱好":["偶像剧","动漫","听音乐","户外旅游","打篮球","摄影","日剧","港台剧","游戏","爱上网","爱做饭","爱狗","爱猫","爱睡觉","看书","看电影","经济学","美剧","美容","美食","踢足球","逛论坛"],"我个性":["三分钟热度","乐观","低调","内敛","冷漠杀手","善良温顺","囧","宅","害羞","幽默","张扬","执着","搞笑","木讷","槑","温柔杀手","直率","腼腆害羞","邪恶","雷人","青春阳光"],"我在做啥":["交友ING","减肥ING","发呆ING","增肥ING","失恋ING","奋斗ING","幸福ING","恋爱ING","感冒ING","成长ING","无聊ING","痛苦ING","缺爱ING","颓废ING"]}}},grayIt:function(a){for(var b=0;b<this.$recTagsArr.length;b++)this.$recTagsArr[b].innerHTML===a&&d(this.$recTagsArr[b]).addClass("selected")},resumeIt:function(a){for(var b=0;b<this.$recTagsArr.length;b++)this.$recTagsArr[b].innerHTML===a&&d(this.$recTagsArr[b]).removeClass("selected")}}),o=new m;return{getInstance:function(){return o}}});define("widget/TabSwitch",function(a,b,c){var d=a("external/jquery"),e=a("basic/oop/Class"),f=e.extend({$elem:null,_timer:null,DEFAULT:{animate:!1,animateTime:500,animateGapTime:0,tabList:"li",tabListContainer:"ul",tabContent:"li",classCurrent:"current",triggerContext:""},init:function(a,b){this.$elem=d(a),this.$tabList=this.$elem.find("li"),this.config=d.extend({},this.DEFAULT,b),this.bindEvent()},bindEvent:function(){this.$elem.delegate(this.tabList,"click",d.proxy(this.onTabClick,this))},onTabClick:function(a){var b,c=this.config;this.$target=d(a.target),b=this.$target.attr("data-toggleTab");this.$target.hasClass(c.classCurrent)||(this._timer&&clearTimeout(this._timer),this.$target.parents(c.tabListContainer).children(c.tabList).removeClass(c.classCurrent),this.$target.addClass(c.classCurrent),this.renderContent(b))},renderContent:function(a){this.$TabContent=d(a),this._timer=setTimeout(d.proxy(function(){this.$TabContent.parent().children(this.config.tabContent).addClass("hidden"),this.$TabContent.removeClass("hidden"),this.$elem.trigger("tabSwitched"+this.config.triggerContext)},this),this.config.animateGapTime)},show:function(){}});return f});define("_tmpl/tagBox",function(require){return function(tmplData){var p=[];with(tmplData){p.push('<div class="poplayer-tagsBox-myContent"><h3>我的标签</h3><p class="poplayer-tagsBox-tips hidden ">您还未设置标签</p><ul class="poplayer-tagsBox-myTagsList">');for(var i=0;i<userTags.length;i++)p.push('<li><span class="js-tag">',userTags[i],'</span><em class="icon-close"></em></li>');p.push('</ul></div><div class="poplayer-tagsBox-tabBox"><ul class="poplayer-tabBox-tabList"><!--   ');var count=1;p.push("");for(var item in recTags)p.push("<li "),count++==1&&p.push('class="current"'),p.push(">",item,"</li>");p.push('--><li data-toggleTab="#poplayer-tagsBox-tab-1" class="current">我是达人</li><li data-toggleTab="#poplayer-tagsBox-tab-2">个人名片</li><li data-toggleTab="#poplayer-tagsBox-tab-3">兴趣爱好</li><li data-toggleTab="#poplayer-tagsBox-tab-4">我个性</li><li data-toggleTab="#poplayer-tagsBox-tab-5">我现在做啥</li></ul><div class="poplayer-tagsBox-addMyTags"><input type="text"/><a href="javascript:;" class="poplayer-linkb">贴上</a></div></div><p class="poplayer-tagsBox-tips">点击设置我的标签</p><ul class="poplayer-tagsBox-sysTagsList">');var count=1;p.push("");for(var item in recTags){p.push("<li "),count!=1&&p.push('class="hidden"'),p.push('id="poplayer-tagsBox-tab-',count,'" >'),count++;for(var one in recTags[item])recTags[item].hasOwnProperty(one)&&p.push('<a href="javascript:;">',recTags[item][one],"</a>"),p.push("");p.push("</li>")}p.push('</ul></div><div class="poplayer-ft"><a class="poplayer-btn-sure js-tagBox-btn-sure" href="javascript:;">完成</a></div>')}return p.join("")}});define("task/user/widget/relationList",function(a,b,c){var d=a("task/Task");(new d("relationList",function(){var b=a("user/list/FollowingList"),c=document.getElementById("relationList"),d=null;if(!!c){var e=c.getAttribute("uid"),f=c.getAttribute("relationType"),g=c.getAttribute("isDaren"),h={container:"#relationList",maxLength:6};f==="similar"?(h.requestUrl="recommendFollowee",h.hasFocusBox=!0,h.params={similarityUserId:e,recommendType:"SIMILARITY_RECOMMEND",size:18,isDaren:g}):(h.requestUrl="followRelationList",h.params={followUserId:e}),d=new b("#relationList ul",h),d.render();return d}})).add()});define("user/list/FollowingList",function(a,b,c){var d=a("external/jquery"),e=a("user/Following"),f=a("user/list/GuessList"),g=a("utils/DataSource"),h=a("utils/log/Logger"),i=f.extend({init:function(a,b){this._super(a,b),this.requestUrl=b.requestUrl?b.requestUrl:"following",this.params=b.params?b.params:{},this.hasFocusBox=b.hasFocusBox?b.hasFocusBox:!1},onCallBack:function(a){if(!!a){a.list.length>0&&this.$container.removeClass("hidden");for(var b=0,c=a.list.length,d=this.config.maxLength;b<c;b++){var f=this.config.container!=="#neteaseRecommend"?a.list[b].user:a.list[b],g=new e(f,{hasFocusBox:this.hasFocusBox});b<d?this.add(g,!0):this.outList.push(g)}this.checkRemain()}},bindEvent:function(){this._super(),this.$container.find(".js-all").removeClass("hidden")},refreshAll:function(a,b){this._super(a,b),h.triggerLog(this.$elem,{method:"refresh"})}});return i});define("user/Following",function(a,b,c){var d=a("external/jquery"),e=a("utils/tmpl"),f=a("user/User"),g=a("utils/Utils"),h=a("user/UserAction"),i=a("model/UserData"),j=f.extend({init:function(a,b){this._super(a,b),this.data.shortNickName=g.countChars(this.data.nickName,7,!0),this.data.hasFocusBox=this.config.hasFocusBox?this.config.hasFocusBox:!1},render:function(){this.$elem===null&&(this.$elem=d(e.formatTemplate(a("_tmpl/following"),this.data)),this.bindEvent());return this.$elem},bindEvent:function(){this.renderFollow(),this.$elem.delegate(".follow-trigger","click",d.proxy(this.follow,this)),i.bindUpdate(this.data.id,d.proxy(this.renderFollow,this))},follow:function(a){if(!this.request||this.request.readyState===4)this.request=h.doFollow.call(this,a,d.proxy(function(){this.$elem.trigger("onFollowed",[this])},this))},renderFollow:function(){this.data.isFollowing===!1?this.$elem.find(".js-add-focus").show().end().find(".js-remove-focus").hide():this.$elem.find(".js-remove-focus").show().end().find(".js-add-focus").hide()},erase:function(){this.$elem.remove()}});return j});define("_tmpl/following",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div><a class="avatar js-float-intro" data-keyfrom="avatar" href="/',screenName,'" data-user-nickname="',nickName,'"><img alt="',nickName,'" title="',nickName,'" src="',avatar,'" /></a><p><a class="link-rb js-float-intro" data-keyfrom="user.nickName" href="/',screenName,'" title="',nickName,'" data-user-nickname="',nickName,'">',shortNickName,"</a></p>"),hasFocusBox&&p.push('<span class="focusBox"><a href="javascript:;" style="display:inline-block" class="add-focusS follow-trigger js-add-focus"><em class="add-signS">+</em>关注</a><em class="remove-focusS js-remove-focus" style="display: none;">已关注</em></span>'),p.push("</div>");return p.join("")}});define("user/list/GuessList",function(a,b,c){var d=a("external/jquery"),e=a("utils/DataSource"),f=a("user/Guess"),g=a("utils/Utils"),h=a("widget/list/RenderableList"),j=h.extend({init:function(a,b){this._super(a,b),this.$container=d(this.config.container),this.$refreshTrigger=this.$container.find(".switch-trigger"),this.$moreTrigger=this.$container.find(".more-trigger"),this.$guessTip=this.$container.find(".js-tip"),this.params={recommendType:b.recommendType?b.recommendType:"SEPECIAL_RECOMMEND_TOP",pageSize:20,pageNo:1},this.config.maxLength=b.maxLength?b.maxLength:3,this.requestUrl=b.requestUrl?b.requestUrl:"guessList",this.inList=[],this.outList=[]},render:function(){!this.$container.length||this.getData()},getData:function(){this.inList.length===0&&(e.postJSON(this.requestUrl,this.params,d.proxy(this.onCallBack,this)),this.bindEvent())},onCallBack:function(a){if(!!a){this.$container.removeClass("hidden");var b=this.config.container.replace("#","");if(a.list.length===0){this.checkRemain(),d(document).trigger("guessDataReady",[b,a.list.length]);return}d(document).trigger("guessDataReady",[b,a.list.length]);for(var c=0,e=a.list.length,g=this.config.maxLength;c<e;c++){var h=new f(a.list[c]);c<g?this.add(h,!0):this.outList.push(h)}this.checkRemain(),this.onFirst()}},bindEvent:function(){this.$elem.bind("onFollowed",d.proxy(this.refresh,this)).bind("unlike",d.proxy(this.reload,this)),this.$refreshTrigger.bind("click",d.proxy(this.refreshAll,this)),this.$moreTrigger.bind("click",d.proxy(this.analytics,this))},add:function(a,b){this.inList.push(a);var c=this._super(a);b||c.hide().fadeIn("fast");return c},deleteItem:function(a){var b=d.inArray(a,this.inList);if(b!==-1){this.inList.splice(b,1);if(this.outList.length==0){var c=this;a.$elem.parent().fadeOut("slow",function(){c.unwrap(a.render())})}}},remove:function(a){var b=d.inArray(a,this.inList);if(b!==-1){this.inList.splice(b,1);if(this.outList.length>0)this._super(a);else{var c=this,e=this._super;this._super(a),a.$elem.parent().fadeOut("slow",function(){e.call(c,a)})}}},wrap:function(a){return a.wrap("<li>").parent()},unwrap:function(a){a.parent().detach()},refresh:function(a,b){if(this.outList.length>0){var c=b.render().parent(),d=this,e=d.outList.shift();c.fadeOut("slow",function(){var a=d.add(e);a.insertBefore(c),d.unwrap(b.render())})}this.deleteItem(b),this.checkRemain(),this.onFirst()},reload:function(a,b){if(this.outList.length>0){var c=this.add(this.outList.shift());c.insertBefore(b.render().parent())}this.remove(b),this.checkRemain(),this.onFirst()},refreshAll:function(a,b){var c=[];while(this.inList.length>0)c.push(this.inList[0]),this.remove(this.inList[0]);if(this.outList.length>0)for(i=0,l=this.outList.length;i<l&&i<this.config.maxLength;++i)this.add(this.outList.shift());while(c.length>0)this.outList.push(c.shift());this.checkRemain(),this.onFirst()},checkRemain:function(){this.outList.length===0?(this.$refreshTrigger.addClass("hidden"),this.$moreTrigger.addClass("hidden"),this.inList.length===0&&this.$guessTip.removeClass("hidden")):(this.$refreshTrigger.removeClass("hidden"),this.$moreTrigger.removeClass("hidden"))},onFirst:function(){var a=this.$container.find(".reason-trigger");a.each(function(a){var b=d(this),c=b.attr("data-fold");a==0&&b.attr("data-fold","true").parents(".js-parent").addClass("expanded"),a!=0&&c=="true"&&b.attr("data-fold","false").parents(".js-parent").removeClass("expanded")})},analytics:function(){g.analytics.send("/page.do?keyfrom=guess.more&method=click")}});return j});define("task/user/widget/followingList",function(a,b,c){var d=a("task/Task");(new d("followingList",function(){var b=a("external/jquery"),c=a("user/list/FollowingList");this.user=b("#userFollowing ul").attr("data-user-id");var d={requestUrl:"following",container:"#userFollowing",maxLength:9,params:{userId:this.user,pageSize:9}},e=new c("#userFollowing ul",d);e.render();return e})).add()});define("task/widget/StatusBar",function(a,b,c){var d=a("external/jquery"),e=a("user/User"),f=a("user/UserAction"),g=null,h=e.extend({init:function(a,b){this._super(a,b),this.$elem=d(".userInfo-num"),this.$followBotton=d(".follow-trigger"),g=d(".conL .userInfo"),this.bindEvent()},bindEvent:function(){this.$followBotton.bind("click",d.proxy(this.follow,this));var a=this;g.bind("followed",function(){a.switchToClass("user-followed")}),g.bind("unfollowed",function(){a.switchToClass("user-unfollowed")}),g.bind("blocked",function(){a.switchToClass("user-blocked")}),g.bind("unblocked",function(){a.switchToClass("user-unfollowed")})},follow:function(){if(!this.request||this.request.readyState===4)this.request=f.doFollow.call(this)},unBlock:function(){if(!this.request||this.request.readyState===4)this.request=f.doUnBlock.call(this)},switchToClass:function(a){var b=["user-blocked","user-followed","user-unfollowed"],c=d.inArray(a,b);c!==-1&&(b.splice(c,1),g.addClass(a),g.removeClass(b.join(" ")))}});return h});define("task/widget/regGuide",function(a,b,c){var d=a("task/Task");(new d("regGuide",function(){var b=a("external/jquery"),c=a("model/UserData"),d=a("guide/RegisterGuide");if(b("#regGuide").size())return d.getInstance("#regGuide")})).add()});define("task/widget/appointPerson",function(a,b,c){var d=a("task/Task");(new d("appointPerson",function(){var b=a("external/jquery"),c=a("model/UserData"),d=a("utils/Utils"),e=b("#timelineSearch"),f=e.find("input[type=text]"),g=e.find(".js-btn"),h=e.data("type"),i=e.attr("data-nickName"),j=function(a){var c=b.trim(f.val());if(c===""||c==f.data("blank"))return!1;var d="";h=="homeTimeline"?(d="/search/ftweet/",d+=encodeURIComponent(c),d=d+"?keyfrom=pHometl.mainList"):(d="/search/stweet/",d+=encodeURIComponent(c),d=d+"?an="+encodeURIComponent(i)+"&keyfrom=pUsertl.mainList"),location.href=d;return!1},k=function(a){if(a.which===13||a.which===9)j(a),a.preventDefault()},l=function(){c.getLoginUser()===null?b(document).trigger("error",["needLogin"]):b(document.body).bind("keydown",k)},m=function(){b(document.body).unbind("keydown",k)},n=function(){d.onBindInputAction(f,l,m),g.click(j)};n()})).add()});define("task/widget/needLogin",function(a,b,c){var d=a("task/Task");(new d("needLogin",function(){var b=a("external/jquery"),c=a("model/UserData");b(document).delegate(".need-login","click",function(a){c.getLoginUser()===null&&(b(document).trigger("error",["needLogin"]),a.preventDefault())})})).add()});define("task/badge/badge",function(a,b,c){var d=a("task/Task"),e=a("task/TaskManager");(new d("badge",function(){var b=a("badge/Badge");(new b("#userBadgeContainter")).render()})).add()});define("badge/Badge",function(a,b,c){var d=a("external/jquery"),e=a("badge/widget/BadgeFloat"),f=a("basic/oop/Class"),g=a("utils/Cookie"),h=a("utils/DataSource"),i=a("widget/ExpandShrink"),j=a("utils/log/Logger"),k=a("utils/tmpl"),l=f.extend({init:function(a){this.$elem=d(a),this.$tipElem=this.$elem.find(".js-flick-tip"),this.userId=this.$elem.attr("data-user-id"),this.badgeNameObj={0:"完饰大吉",1:"易如反掌",2:"驿寄梅花",3:"流水不腐",4:"笔耕不辍",5:"斗转星移",6:"跟贴局",7:"夏小家族"},this.cache={},this.delay=500,this.$badgeIntroElem=null,this.$currentBadgeIntro=null,this.mouseInTimer=null,this.mouseOutTimer=null,this.clickTimeOut=null},render:function(){this.$elem.find("ul >li").length==0?this.$elem.remove():(this.onFlick(),new i({$trigger:this.$elem.find(".js-btn")}),this.$elem.find(".js-extra .js-flick").size()&&this.$elem.find(".js-btn").trigger("click"),this.bindEvent())},bindEvent:function(){this.$elem.bind("badgeFlick",d.proxy(this.onFlick,this)).delegate(".js-badge-intro","hover",d.proxy(this.onHover,this)).delegate(".js-flick","click",d.proxy(this.onClick,this)),d(document).bind("sent clearBadgeCache",function(){this.cache={}})},onHide:function(){var a=this;this.mouseOutTimer=setTimeout(function(){a.$currentBadgeIntro?(a.$badgeIntroElem.hide(),a.$currentBadgeIntro.hide(),a.$currentBadgeIntro=null):a.$badgeIntroElem.hide()},this.delay)},onFlick:function(){var a=this,b=this.$elem.find(".js-flick"),c=this.$tipElem;b.each(function(){var a=d(this),b=a.children("span:last"),c=setInterval(function(){a.click(function(){clearInterval(c),b.stop()}),b.stop().animate({opacity:1},500,function(){b.animate({opacity:0},700)})},1500)}),b.size()&&g.get("flick")!=="true"&&c.removeClass("hidden").delegate(".js-close","click",function(){c.fadeOut("fast",function(){c.remove()}),g.set("flick","true",30)}),this.$badgeIntroElem!==null&&b.mouseover(function(){a.$badgeIntroElem.hide()})},onHover:function(b){var c=this,f=d(b.currentTarget),g=f.attr("data-code");badgeIntro=this.cache[g],this.$badgeIntroElem==null&&(this.$badgeIntroElem=d(k.formatTemplate(a("_tmpl/winlayer"),{content:""})).appendTo("body").addClass("winlayer-badgebox"),this.$badgeIntroElem.hover(function(a){clearTimeout(c.mouseOutTimer)},function(){c.onHide()})),badgeIntro||(badgeIntro=new e(g,{$wrapper:this.$badgeIntroElem,$target:f,userId:this.userId}),this.cache[g]=badgeIntro),b.type==="mouseenter"?(clearTimeout(this.mouseOutTimer),this.mouseInTimer=setTimeout(function(){c.$currentBadgeIntro=badgeIntro,badgeIntro.getData()},this.delay)):(clearTimeout(this.mouseInTimer),this.onHide())},onClick:function(b){var c=this;clearTimeout(this.clickTimeOut),this.clickTimeOut=setTimeout(function(){var e=d(b.currentTarget),f=e.attr("data-code"),g=c.badgeNameObj[f],i="勋章"+e.attr("title").substring(2,4)+"成功，发条微博",k=e.children("span:first"),l=e.children("span:last");h.postJSON("lightBadge",{badgeCode:f},function(b){var d=b.result;if(d){c.cache={},k.remove(),e.removeClass("js-flick").removeAttr("title").html(""),l.html('<em class="num"></em>').appendTo(e).css({opacity:0}).animate({opacity:1},500,"linear",function(){var b=e.attr("data-rank")!==undefined?e.attr("data-rank"):0,c=a("badge/widget/BadgeBox");(new c(null,{title:i,keyword:g,badgeCode:f,badgeRank:b})).show(),e.addClass("js-badge-intro")}),c.$tipElem.addClass("hidden");var h=e.attr("data-rank")!==undefined?"medalUpdate":"medalTurnon";j.triggerLog(e,{method:h})}})},300)}});return l});define("badge/widget/BadgeFloat",function(a,b,c){var d=a("external/jquery"),e=a("widget/Box"),f=a("utils/DataSource"),g=a("utils/Cookie"),h=a("utils/log/Logger"),i=a("utils/tmpl"),j=a("utils/Utils"),k=e.extend({init:function(a,b){this.$elem=null,this.config=b||{},this.data={},this.badgeStatus=!1,this.badgeCode=a,this.$parents=d("#userBadgeContainter"),this.userId=b.userId,this.$target=b.$target,this.$wrapper=b.$wrapper,this.$body=this.$wrapper.find(".winlayer-body"),this.$arrow=this.$wrapper.find(".js-arrow")},renderTmpl:function(){return d(j.LOADING_SMALL.replace("$text$","加载中..."))},getData:function(){this.show(),this.badgeStatus?this.showInfo():f.postJSON("badgeIntro",{userId:this.userId,badgeCode:this.badgeCode},d.proxy(function(a){a.isHome=this.$parents.attr("data-home")=="true"?!0:!1;var b=a.code-0,c="clickLight"+a.code+this.userId;b>5&&(a.isLight=g.get(c)=="true"?!0:!1),this.data=a,this.showInfo(),this.badgeStatus=!0},this))},show:function(){this._super();var a=this.$target,b=a.offset(),c=a.width(),d=this.$parents.offset().left-this.$parents.width()+21,e=b.top+a.outerHeight(!0),f=b.left-d+c/2-7;this.$wrapper.css({left:d,top:e,display:"block"}),this.$arrow.css({left:f}),this.$body.empty().append(this.$elem)},bindTrigger:function(){this.$body.empty().append(d(i.formatTemplate(a("_tmpl/badgeFloat"),this.data)));var b=this.$wrapper.find(".js-ft");b.children().size()||b.remove(),this.$wrapper.delegate(".apply-trigger","click",d.proxy(this.onClick,this)).delegate(".logger-trigger","click",d.proxy(this.onLog,this))},showInfo:function(){this.bindTrigger();var a=this.data.code-0+1,b=this.data.status,c=this.$target;if(this.data.isHome&&!this.badgeStatus){if(b=="3"){var e=c.children("span[class*=-on]");e.size()&&c.children("span:first").removeClass("medal0"+a+"-on").addClass("medal0"+a)}if(b=="2"){var e=c.children("span[class*=-on]");e.size()||c.children("span:first").removeClass("medal0"+a).addClass("medal0"+a+"-on")}if(b=="1"){c.removeClass("js-badge-intro").addClass("js-flick").attr("title","点击点亮"+this.data.name+"勋章");var f=c.children("span:first").attr("class")+" medal0"+a+"-on";a>1&&a<7&&!d.browser.msie&&(c.children("span:first").addClass("level01"),f=f+" level01");var g=d('<span style="opacity:0;z-index:1"><em class="num"></em></span>');g.addClass(f).removeClass("medal0"+a).appendTo(c),this.$parents.trigger("badgeFlick")}if(b=="2"&&this.data.isUpGrade){c.removeClass("js-badge-intro").addClass("js-flick").attr("title","点击升级"+this.data.name+"勋章").attr("data-rank",this.data.rankNum).children("span:first").addClass("medal0"+a+"-upgrade").addClass("level0"+this.data.rankNum+"-upgrade");var f="medal0"+a+"-on level0"+this.data.rankNum+1,g=d('<span style="opacity:0;z-index:1"><em class="num"></em></span>');g.addClass(f).appendTo(c),this.$parents.trigger("badgeFlick")}}},onClick:function(a){var b=this.$wrapper.find(".js-loading"),c=d(a.currentTarget),e=this;b.css("display","inline-block"),f.postJSON("applyFamilyBadge",{badgeCode:this.badgeCode},function(a){var b=a.result;if(b){c.parent().remove(),e.$wrapper.find(".js-tips").html("审核中，第二天告知申请结果。");var d="clickLight"+e.data.code+e.userId;if(g.get(d)!=="true"){var f=new Date,i=f.getFullYear(),j=f.getMonth()+1,k=f.getDate(),l=new Date(i+"/"+j+"/"+k+" 23:00:00"),m=(l-f)/1e3/60/60/24+11/24;g.set(d,"true",m),e.data.isLight=!0}h.triggerLog(e.$target,{method:"medalTurnon"})}})},onLog:function(){var a=h.keyFrom(this.$target);j.analytics.send("/page.do?keyfrom="+a)}});return k});define("_tmpl/badgeFloat",function(require){return function(tmplData){var p=[];with(tmplData){p.push("");var badgeClass=code-0+1;p.push('<div class="winlayer-bd"><div class="winlayer-badgebox-info clearfix"><em class="winlayer-badgebox-icon medal0',badgeClass,'-big"></em><h3 class="winlayer-badgebox-name">'),typeof score!="undefined"&&isHome&&p.push('<span class="fr">成长度：<em class="winlayer-num">',score,"</em></span>"),p.push("",name,""),typeof rank!="undefined"&&p.push("（",rank,"级）"),p.push('</h3><p class="winlayer-badgebox-tips">'),isHome?p.push("",rule,""):p.push("",userOtherRule,""),p.push("</p>"),status==2&&p.push('<p class="winlayer-badgebox-time"><em class="icon-correctS"></em>',grantTime,"第一次点亮</p>"),p.push(""),status==3&&p.push('<p class="winlayer-badgebox-endtime"><em class="icon-forbidS"></em>',snuffTime,"熄灭</p>"),p.push('</div></div><div class="winlayer-ft js-ft winlayer-linkb">'),isHome&&typeof light!="undefined"&&p.push('<div class="winlayer-badgebox-intro"><span class="left"><b>勋章升级：</b></span><p>',light,'</p></div><div class="winlayer-badgebox-intro winlayer-badgebox-group"><span class="left"><b>获取成长度：</b></span><p>',lightRule,"</p></div>"),p.push(""),isHome&&typeof snuffReason!="undefined"&&p.push('<div class="winlayer-badgebox-intro"><span class="left"><b>熄灭原因：</b></span><p>',snuffReason,"</p></div>"),p.push(""),isHome&&typeof reasonRule!="undefined"&&p.push('<div class="winlayer-badgebox-intro"><span class="left"><b>勋章点亮：</b></span><p>',reasonRule,"</p></div>"),p.push(""),isHome&&typeof appFamily!="undefined"&&(p.push('<div class="winlayer-badgebox-intro clearfix"><span class="left"><b>勋章点亮：</b></span><div><span class="js-tips">'),isLight?p.push("审核中，第二天告知申请结果。"):p.push("",appFamily,""),p.push("</span>"),isLight||p.push('<div class="winlayer-badgebox-apply clearfix"><a class="winlayer-btn-sure apply-trigger" href="javascript:;">点亮申请</a><em class="icon-loadingS js-loading"></em></div>'),p.push("</div></div>")),p.push("</div>")}return p.join("")}});define("widget/ExpandShrink",function(a,b,c){var d=a("external/jquery"),e=a("basic/oop/Class"),f=a("utils/tmpl"),g=a("utils/Utils"),h=e.extend({defaultConfig:{expandClass:"expanded",isExpand:!1},init:function(a){this.config=d.extend(this.defaultConfig,a),this.$trigger=a.$trigger,this.isExpand=a.isExpand,this.$classElem=a.$classElem==undefined?this.$trigger.parent():a.$classElem,this.callBack=a.callBack,this.bindEvent()},bindEvent:function(){this.$trigger.bind("click",d.proxy(this.onClick,this))},onClick:function(a){this.isExpand?this.remove():this.add(),this.callBack!==undefined&&this.callBack(a)},remove:function(){this.$classElem.removeClass(this.config.expandClass),this.isExpand=!1},add:function(){this.$classElem.addClass(this.config.expandClass),this.isExpand=!0}});return h});define("badge/widget/BadgeBox",function(a,b,c){var d=a("external/jquery"),e=a("widget/floatBox/sendBox/PublishBox"),f=a("sendBox/BadgeFloatPublishBox"),g=a("utils/tmpl"),h=e.extend({init:function(a,b){this._super(a,b),this.badgeCode=this.config.badgeCode-0+1,this.badgeRank=this.config.badgeRank-0+1,this.badgeChineseNum=["零","一","二","三","四","五","六","七","八","九","十"],this.sentImageObj={1:"G7PMz",2:"2Os2tP",3:"2AmM1o",4:"1IkAF0",5:"8smZS",6:"43uazA",7:"2yjl50",8:"hK2t2"},this.badgeDec=this.badgeRank>1?"我的微博勋章【"+this.config.keyword+"】升到"+this.badgeChineseNum[this.badgeRank]+"级啦！":"我获得了【"+this.config.keyword+"】勋章一枚。",this.sentTxtObj={1:"我的微博有头有脸，个人资料详尽完备，添加的标签个性鲜明，轻松获得【完饰大吉】勋章一枚，从此“证照齐全”，行走微博意盎然。",2:"神机在手，天下我有。爱随手拍，更爱手机刷微博。"+this.badgeDec+"精彩内容掌中尽赏，微言大义指尖流淌。",3:"鸿雁在云鱼在水，鱼传尺素，鸿雁传书。作为邮箱微博的超级信使，"+this.badgeDec+"红笺小字，说尽平生意。",4:"孔子曰：登东山而小鲁，登微博而小天下。天天风雨无阻到微博来打卡，"+this.badgeDec+"细水长流，幸甚至哉。",5:"不用读书破万卷，也能下笔如有神。兢兢业业勤勉有加，"+this.badgeDec+"我不是话痨，只是文思如泉涌。",6:"关注就是力量，转发改变孤独。爱评论、勤转发，"+this.badgeDec+"微博连接你我他，让信息爆炸。",7:"无跟贴，不新闻。一边辛勤盖楼，一边微博分享，功夫不负有心人，我获得了【跟贴局】勋章一枚，打酱油也有态度。",8:"啸聚微博，坐而论道。同气连枝，复姓夏小。我获得了【夏小家族】勋章一枚，众人拾柴火焰高，从此不再无依靠。"},this.config.text=this.sentTxtObj[this.badgeCode]},preRender:function(){return{content:g.formatTemplate(a("_tmpl/badgePublishBox"),this.data),title:this.config.title}},bindEvent:function(){this._super(),this.pubbox=new f(this.$elem.find(".js-publishBox"),{picPreview:!0,image:'<img src="http://static.t.126.net/frontend/image/medal/medal0'+this.badgeCode+'.png"/>',sentImage:"http://126.fm/"+this.sentImageObj[this.badgeCode]})},hide:function(){this._super(),this.pubbox.picPreview&&this.pubbox.picPreview.hide()}});return h});define("sendBox/BadgeFloatPublishBox",function(a,b,c){var d=a("external/jquery"),e=a("sendBox/FloatPublishBox"),f=a("sendBox/SendBoxAction"),g=e.extend({bindEvent:function(){this._super();if(this.config.picPreview){var b=a("sendBox/widget/PicPreview");this.picPreview=new b({trigger:this.$elem.find(".preview-trigger"),content:this.config.image}),this.picPreview.show()}},getParams:function(){var a=this._super();this.config.picPreview&&!this.picPreview.isClose&&this.config.sentImage&&(a.content=a.content+this.config.sentImage);return a}});return g});define("sendBox/widget/PicPreview",function(a,b,c){var d=a("external/jquery"),e=a("widget/tinyBox/Box"),f=a("utils/Utils"),g=a("utils/tmpl"),h=e.extend({init:function(a){this._super.apply(this,arguments),this.config=this.data,delete this.data,this.$trigger=d(this.config.trigger),this.timeOut=null,this.isClose=!1},preRender:function(){return{content:this.config.content}},postRender:function(){this.$elem.addClass("winlayer-badge-cover")},show:function(){var a={top:this.$trigger.offset().top+25,left:this.$trigger.offset().left};this._super(a)},bindEvent:function(){var a=this;this.timeOut=setTimeout(function(){a.$elem.hide()},3e3),this.$trigger.delegate(".js-hover-pic","hover",d.proxy(this.onHover,this)).delegate(".js-close-pic","click",d.proxy(this.onClose,this))},onClose:function(){this.$trigger.remove(),this.$elem.remove(),this.isClose=!0},onHover:function(a){clearTimeout(this.timeOut),a.type==="mouseenter"?this.$elem.show():this.$elem.hide()}});return h});define("_tmpl/badgePublishBox",function(require){return function(tmplData){var p=[];with(tmplData)p.push('<div class="tweet-publishBox js-publishBox"><div class="tweet-publishBox-hd"><div class="tweet-publishBox-textareaBox"><textarea class="tweet-publishBox-textarea"></textarea></div></div><div class="tweet-publishBox-ft"><div class="clearfix"><div class="tweet-publishBox-operate"><div class="tweet-publishBox-btn"><a class="submit-trigger disabled" href="javascript:;">发布</a></div><span class="tweet-publishBox-tip js-wordCounter">还可以输入<span class="char-constantia">163</span>字</span></div><div class="poplayer-publishBox-insert"><div class="insert-list"><div class="preview-trigger poplayer-badge-preview"><a class="insert-pic js-hover-pic" href="javascript:;"><em class="icon-pic"></em>勋章图片</a><b class="icon-close js-close-pic"></b></div><a class="insert-face face-trigger" href="javascript:;"><em class="icon-face"></em></a></div></div></div></div></div>');return p.join("")}});define("page/userTweet",function(a,b,c){a("task/group/common"),a("task/singleUser"),a("task/user/setGroup"),a("task/filter"),a("task/userTimeline"),a("task/widget/rollAd"),a("task/widget/hotTweet"),a("task/user/widget/guessList"),a("task/user/widget/relationList"),a("task/user/widget/followingList"),a("task/widget/StatusBar"),a("task/widget/regGuide"),a("task/widget/appointPerson"),a("task/widget/needLogin"),a("task/badge/badge"),a("task/TaskManager").run()});