(function(){var y=document;var t=y.documentElement,u=y.body;var p=navigator.userAgent.toLowerCase();var h=/msie/.test(p);var c=1;var q={getBy:function(F,A,B){A=A||"*";if(!B){return[]}var C=[],E=B.getElementsByTagName(A);for(var D=0,z=E.length;D<z;++D){if(F(E[D])){C[C.length]=E[D]}}return C},setStyle:function(z,A,B){if(h){switch(A){case"opacity":z.style.filter="alpha(opacity="+(B*100)+")";if(!z.currentStyle||!z.currentStyle.hasLayout){z.style.zoom=1}break;case"float":A="styleFloat"}}else{if(A=="float"){A="cssFloat"}}z.style[A]=B},getStyle:function(z,C){if(h){var B=z.currentStyle?z.currentStyle[C]:null;switch(C){case"opacity":var E=100;try{E=z.filters["DXImageTransform.Microsoft.Alpha"].opacity}catch(D){try{E=z.filters("alpha").opacity}catch(D){}}return E/100;case"float":C="styleFloat";case"height":return(B=="auto")?"0px":z.style[C];case"width":return(B=="auto")?"0px":z.style[C];default:var B=z.currentStyle?z.currentStyle[C]:null;return(z.style[C]||B)}}else{if(C=="float"){C="cssFloat"}try{var A=y.defaultView.getComputedStyle(z,"")}catch(D){traceError(D)}return z.style[C]||A?(A[C]=="auto"?"0":A[C]):null}},getScreen:function(){if(h){return{w:t.clientWidth,h:t.clientHeight}}else{return{w:window.innerWidth,h:window.innerHeight}}},getScroll:function(){var B,A,z,C;if(t&&t.scrollTop){B=t.scrollTop;A=t.scrollLeft;z=t.scrollWidth;C=t.scrollHeight}else{if(u){B=u.scrollTop;A=u.scrollLeft;z=u.scrollWidth;C=u.scrollHeight}}return{t:B,l:A,w:z,h:C}},contains:function(z,A){if(z===A){return false}else{if(z.compareDocumentPosition){return((z.compareDocumentPosition(A)&16)===16)}else{if(z.contains&&A.nodeType===1){return z.contains(A)}else{while(A=A.parentNode){if(z===A){return true}}}}}return false}};var o={_isCollection:function(A){try{return(A&&typeof A!=="string"&&A.length&&!A.tagName&&!A.alert&&typeof A[0]!=="undefined")}catch(z){return false}},_addEvent:function(){if(window.addEventListener){return function(A,B,z){A.addEventListener(B,z,false)}}else{if(window.attachEvent){return function(A,B,z){A.attachEvent("on"+B,z)}}else{return function(){}}}}(),_removeEvent:function(){if(window.removeEventListener){return function(A,B,z){A.removeEventListener(B,z,false)}}else{if(window.detachEvent){return function(A,B,z){A.detachEvent("on"+B,z)}}else{return function(){}}}}(),_stopPropagation:function(z){if(z.stopPropagation){z.stopPropagation()}else{z.cancelBubble=true}},_preventDefault:function(z){if(z.preventDefault){z.preventDefault()}else{z.returnValue=false}},on:function(C,D,B){if(this._isCollection(C)){for(var A=0,z=C.length;A<z;++A){this._addEvent(C[A],D,B)}}else{this._addEvent(C,D,B)}},removeEvent:function(C,D,B){if(this._isCollection(C)){for(var A=0,z=C.length;A<z;++A){this._removeEvent(C[A],D,B)}}else{this._removeEvent(C,D,B)}},getEvent:function(){if(window.event){return window.event}var A=arguments.callee.caller;var z;var B=0;while(A!=null&&B<40){z=A.arguments[0];if(z&&(z.constructor==Event||z.constructor==MouseEvent||z.constructor==KeyboardEvent)){return z}B++;A=A.caller}return z},getTarget:function(A){var z=A.target||A.srcElement;return z},stopEvent:function(z){this._stopPropagation(z);this._preventDefault(z)}};var r={trim:function(C){if(typeof C!=="string"){throw"trim need a string as parameter"}var z=C.length;var B=0;var A=/(\u3000|\s|\t|\u00A0)/;while(B<z){if(!A.test(C.charAt(B))){break}B+=1}while(z>B){if(!A.test(C.charAt(z-1))){break}z-=1}return C.slice(B,z)},isArray:function(z){return Object.prototype.toString.call(z)==="[object Array]"},getUniqueId:function(){return(new Date().getTime()+Math.round(Math.random()*100000000)).toString()+(c++)},removeNode:function(z){z&&z.parentNode&&z.parentNode.removeChild(z)},URL:function(E,B){var D=r.parseParam({isEncodeQuery:false,isEncodeHash:false},B||{});var z=function(J){var I=/^(?:([A-Za-z]+):(\/{0,3}))?([0-9.\-A-Za-z]+\.[0-9A-Za-z]+)?(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/;var N=["url","scheme","slash","host","port","path","query","hash"];var L=I.exec(J);var M={};for(var K=0,H=N.length;K<H;K+=1){M[N[K]]=L[K]||""}return M};var C={};var G=z(E);var A=r.queryToJson(G.query);var F=r.queryToJson(G.hash);C.setParam=function(H,I){A[H]=I;return this};C.getParam=function(H){return A[H]};C.setParams=function(I){for(var H in I){C.setParam(H,I[H])}return this};C.setHash=function(H,I){F[H]=I;return this};C.getHash=function(H){return F[H]};C.valueOf=function(){var H=[];var I=r.jsonToQuery(A,D.isEncodeQuery);var J=r.jsonToQuery(F,D.isEncodeQuery);if(G.scheme!=""){H.push(G.scheme+":");H.push(G.slash)}if(G.host!=""){H.push(G.host);if(G.port!=""){H.push(":");H.push(G.port)}}H.push("/");H.push(G.path);if(I!=""){H.push("?"+I)}if(J!=""){H.push("#"+J)}return H.join("")};return C},merge:function(A,z){var C={};for(var B in A){C[B]=A[B]}for(var B in z){C[B]=z[B]}return C},parseParam:function(B,A,z){var C,D={};A=A||{};for(C in B){D[C]=B[C];if(A[C]!=null){if(z){if(B.hasOwnProperty[C]){D[C]=A[C]}}else{D[C]=A[C]}}}return D},parse:function(B,A,z){var C,D={};A=A||{};for(C in B){D[C]=B[C];if(A[C]!=null){if(z){if(B.hasOwnProperty[C]){D[C]=A[C]}}else{D[C]=A[C]}}}return D},jsonToQuery:function(E,B){var D=function(H,G){H=H==null?"":H;H=r.trim(H.toString());if(G){return encodeURIComponent(H)}else{return H}};var F=[];if(typeof E=="object"){for(var A in E){if(E[A] instanceof Array){for(var C=0,z=E[A].length;C<z;C++){F.push(A+"="+D(E[A][C],B))}}else{if(typeof E[A]!="function"){F.push(A+"="+D(E[A],B))}}}}if(F.length){return F.join("&")}else{return""}},queryToJson:function(B,F){var H=r.trim(B).split("&");var G={};var A=function(J){if(F){return decodeURIComponent(J)}else{return J}};for(var D=0,E=H.length;D<E;D++){if(H[D]){var C=H[D].split("=");var z=C[0];var I=C[1];if(C.length<2){I=z;z="$nullName"}if(!G[z]){G[z]=A(I)}else{if(r.isArray(G[z])!=true){G[z]=[G[z]]}G[z].push(A(I))}}}return G},scriptLoader:function(B){var z={url:"",charset:"UTF-8",timeout:30*1000,args:{},onComplete:function(){},onTimeout:null,isEncode:false,uniqueID:null};var E={},D,A;var C=r.parseParam(z,B);if(C.url==""){throw"scriptLoader: url is null"}var F=C.uniqueID||r.getUniqueId();D=E[F];if(D!=null&&h!=true){r.removeNode(D);D=null}if(D==null){D=E[F]=y.createElement("script")}D.charset=C.charset;D.id="scriptRequest_script_"+F;D.type="text/javascript";if(C.onComplete!=null){if(h){D.onreadystatechange=function(){if(D.readyState.toLowerCase()=="loaded"||D.readyState.toLowerCase()=="complete"){try{clearTimeout(A);y.getElementsByTagName("head")[0].removeChild(D)}catch(G){}C.onComplete()}}}else{D.onload=function(){try{clearTimeout(A);r.removeNode(D)}catch(G){}C.onComplete()}}}D.src=r.URL(C.url,{isEncodeQuery:C.isEncode}).setParams(C.args).valueOf();y.getElementsByTagName("head")[0].appendChild(D);if(C.timeout>0&&C.onTimeout!=null){A=setTimeout(function(){try{y.getElementsByTagName("head")[0].removeChild(D)}catch(G){}C.onTimeout()},C.timeout)}return D},jsonp:function(D){var B=r.parseParam({url:"",charset:"UTF-8",timeout:30*1000,args:{},onComplete:null,onTimeout:null,responseName:null,isEncode:false,varkey:"callback"},D);var E=-1;var C=B.responseName||("wbad_"+r.getUniqueId());B.args[B.varkey]=C;B.args.rnd=r.getUniqueId();var z=B.onComplete;var A=B.onTimeout;window[C]=function(F){if(E!=2&&z!=null){E=1;z(F,D.id)}};B.onComplete=null;B.onTimeout=function(){if(E!=1&&A!=null){E=2;A()}};return r.scriptLoader(B)},getEvtAttribute:function(B,A,C){C=C||u;var z=B.getAttribute(A);while(B!=C&&!z){B=B.parentNode;z=B.getAttribute(A)}return{el:B,value:z||""}}};var j=function(){var A={};var z={};A.add=function(C,D,B){z[D]=z[D]||{};z[D][C]=B};A.hash=function(B){return z[B]};A.clear=function(){for(var B in z){delete z[B]}z={}};return A}();var w,d;var b=["third"];var v={items:{bd:null,close:null},getWin:function(){var A=q.getScroll(),C=q.getScreen(),B=w;var D=Math.max(B.clientHeight,B.offsetHeight,q.getStyle(B,"height").replace("px",""));var z=Math.max(B.clientWidth,B.offsetWidth,q.getStyle(B,"width").replace("px",""));return{w:C.w,h:C.h,t:Math.round(D>C.h?(C.h/5+A.t):((C.h-D)/3+A.t)),l:Math.round(z>C.w?(C.w/5+A.l):((C.w-z)/2+A.l))}},setPos:function(){var z=v.getWin();q.setStyle(w,"top",z.t+"px");q.setStyle(w,"left",z.l+"px");return this},bind:function(){o.on(v.items.close,"click",function(z){w.style.display="none"})},show:function(z,A){if(!z.height){throw"layer height is null"}if(!z.width){throw"layer width is null"}if(!z.src){throw"iframe src is null"}if(!w){w=y.createElement("div");w.style.cssText="position:absolute;padding:4px;-moz-border-radius:4px;-webkit-border-radius:4px;background:url(http://img.t.sinajs.cn/t4/style/images/common/layer_bg.png?id=1316690783305) repeat;_background:transparent;";v.items.hd=y.createElement("div");v.items.hd.style.cssText="background:#f3f3f3;height:30px;line-height:30px;padding:0 0 0 20px;color:#595959;font-size:14px;vertical-align:middle;";v.items.bd=y.createElement("div");v.items.bd.style.cssText="border-collapse:collapse;border-spacing:0;";v.items.close=y.createElement("span");v.items.close.innerHTML="X";v.items.close.style.cssText="position:absolute;right:15px;top:10px;cursor:pointer;";w.appendChild(v.items.close);w.appendChild(v.items.hd);w.appendChild(v.items.bd);u.appendChild(w);v.bind()}v.items.hd.innerHTML=z.title||"转发";w.style.width=z.width+"px";v.clear().iframe(z);w.style.zIndex=z.index||1000;v.setPos();w.style.display="";o.on(u,"click",v.hide);d=A;return this},hide:function(A){if(!A){w&&(w.style.display="none")}else{var z=o.getTarget(A);w&&!q.contains(w,z)&&((w.style.display="none")||o.removeEvent(u,"click",v.hide))}return this},clear:function(){v.items.bd.innerHTML="";return this},iframe:function(z){v.items.bd.innerHTML='<iframe id="wbad_iframe" width="'+z.width+'" height="'+z.height+'" allowtransparency="true" name="wbad_iframe" scrolling="no" frameborder="0"></iframe>';var A=y.getElementById("wbad_iframe");A.onload=function(){A.height=z.height};A.src=decodeURIComponent(z.src);return this}};var k=function(){var z={ss:1,mm:60,hh:60*60,dd:60*60*24};return{start:function(B,C){B=B||{};B.loop=B.loop||"ss";C=C||function(){};var E=B.time||0;var D=function(){C&&C({last:E,dd:Math.floor(E/z.dd),hh:Math.floor(E%z.dd/z.hh),mm:Math.floor(E%z.dd%z.hh/z.mm),ss:E%z.mm});if(E<0){clearInterval(A)}E-=z[B.loop]};var A=setInterval(D,z[B.loop]*1000)}}}();var a=window.WBAD||{};window.WBAD=window.WBAD||{};var g={},i=false;g.ids=[];var m={id:"id",url:"url",src:"src",height:"height",width:"width"};var f={get:function(E,C){i=true;var A={};for(var B in E){!m[B]&&(A[B]=decodeURIComponent(E[B]))}var z=0;if((typeof $CONFIG.timeDiff!="undefined")&&(typeof $CONFIG.timeDiff!="undefined")){var F=new Date($CONFIG.timeDiff+$CONFIG.servertime*1000).getTime();var D=(new Date()).getTime();z=(new Date(D-F)).getTime();z=(z/1000).toFixed(2)}A.eData=[z,e].join(",");E.args=r.merge(A,a);E.onComplete=function(G,H){i=false;g[H].innerHTML=G;C&&C()};E.onTimeout=function(){i=false;C&&C()};r.jsonp(E)},queue:function(){var z=g.ids.shift();if(z){f.get(r.queryToJson(g[z].getAttribute("ad-data")),function(){f.queue();x(g[z])})}},add:function(A){var z=A.getAttribute("ad-data");var B=r.queryToJson(z||"");if(B.id){g[B.id]=A;g.ids.push(B.id);!i&&f.queue()}}};var s={init:{timer:function(A,B){var z=new Date(parseInt(B.stime)),C=new Date(parseInt(B.etime));if((C-z)>0){k.start({time:Math.floor((C-z)/1000)},function(E){var D="";if(E.dd>0){D="<em>"+E.dd+"</em>天<em>"+E.hh+"</em>小时<em>"}else{D="<em>"+E.hh+"</em>小时<em>"+E.mm+"</em>分钟"}A.innerHTML=D})}else{A.innerHTML="<em>0</em>小时<em>0</em>分钟"}}},click:{trans:function(B,C){s.click.third_extend(B);if(!C.url){return}var z={};for(var A in C){!m[A]&&(z[A]=C[A])}if(!z.uid&&WBAD.uid){z.uid=WBAD.uid}if($CONFIG&&$CONFIG.location){z.page=$CONFIG.location}C.args=z;C.onComplete=function(E){if(C.cid){var D=document.getElementById(C.cid);D&&(D.innerHTML=E)}};C.onTimeout=function(){};r.jsonp(C)},layer:function(z,A){var B=o.getEvent();o.stopEvent(B);v.show(A,z);s.click.trans(z,A)},like:function(z,A){var B=o.getEvent();o.stopEvent(B);z.style.display="none";s.click.third_extend(z);s.click.trans(z,A)},jump:function(B,C){s.click.third_extend(B);if(WBAD.uid){var z=B.href;var A=($CONFIG&&$CONFIG.location)?"&page="+$CONFIG.location:"";if(/\?/.test(z)){if(/(\?|\&)uid=([^&]+)/.test(z)){z.replace(/(\?|\&)uid=([^&]+)/,"$1uid="+WBAD.uid)+A}else{z=z+"&uid="+WBAD.uid+A}}else{z=z+"?uid="+WBAD.uid+A}B.href=z}},third_extend:function(C){var z,B;try{for(var A=0,D=b.length;A<D;A++){z=b[A];B=C.getAttribute(z+"-data")?C.getAttribute(z+"-data"):"";s.click[z](B)}}catch(E){}},third:function(B){if(!B||B.indexOf("imgurl=")==-1){return}var z=new Image();z.onload=z.onerror=function(){};var A=B.replace("imgurl=","");z.src=A}}};var n;var x=function(C){if(!n){n=function(K){var H=o.getTarget(K);var E=r.getEvtAttribute(H,"ad-comp",C);var J=r.queryToJson(E.value);if(J.type){var F=J.type.split("|");var I=j.hash("click");try{for(var G=0,D=F.length;G<D;G++){I[F[G]]&&I[F[G]](E.el,J)}}catch(K){}}}}var A=["layer","trans","like","jump"];j.clear();o.removeEvent(C,"click",n);for(var B=0,z=A.length;B<z;B++){j.add(A[B],"click",s.click[A[B]])}o.on(C,"click",n);q.getBy(function(F){var D=r.getEvtAttribute(F,"ad-comp",C);var G=r.queryToJson(D.value);var E=G.type;E&&s.init[E]&&s.init[E](F,G)},"",C)};var e;var l={start:function(z,A){q.getBy(function(D){var F=r.queryToJson(D.getAttribute("ad-data")||"");if(F.id){if(z){if(D.firstChild){if(D.firstChild.getAttribute("pbc-refresh")!=="true"){return}else{var B={};A=A||{};B.rt=A.rt||"1";var C=r.queryToJson(D.getAttribute("ad-data"));C=r.merge(C,B);var E=r.jsonToQuery(C);D.setAttribute("ad-data",E)}}else{return}}g[F.id]=D;g.ids.push(F.id)}},"div",u);e=(g.ids&&g.ids.length)||0;f.queue()},refresh:function(z){g={};g.ids=[];l.start(true,z)},destroy:function(){for(var z in g){g[z].innerHTML="";delete g[z]}}};window.WBAD["add"]=f.add;window.WBAD["hideLayer"]=v.hide;window.WBAD["destroy"]=l.destroy;window.WBAD["restart"]=l.start;window.WBAD["refresh"]=l.refresh;l.start()})();