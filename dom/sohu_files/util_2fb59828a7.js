kola("app.util.Editor",["kola.lang.Class","jquery.Core","ckeditor.CKEditorLoader"],function(c,d,a){function b(f){var e=this;f=d.extend({toolbar:b.DEFAULT_TOOLBAR},f);d.extend(this,f);d.extend(this,{editor:CKEDITOR.replace(f.target,{toolbar:e.toolbar,resize_enabled:false,removePlugins:"elementspath",enterMode:CKEDITOR.ENTER_BR,forcePasteAsPlainText:true,autoUpdateElement:false})})}b.DEFAULT_TOOLBAR=[["FontSize","TextColor","Bold","Italic","Underline","Link","Unlink","Image","-","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock","-","Preview"]];b.prototype.getText=function(){return d("<div>"+this.getValue()+"</div>").text()};b.prototype.getTextLen=function(){return this.getText().length};b.prototype.getValue=function(){return this.editor.getData()};b.prototype.setValue=function(e){this.editor.setData(e.value)};return{getEditor:function(e){e=d.extend({complete:function(){}},e);(function(f){a.getInstance({complete:function(){f.complete(new b({target:f.target,toolbar:f.toolbar}))}})})(e)}}});kola("app.util.ImgPresize",["jquery.Core","kola.lang.Class"],function(b,a){var c=a.create({_init:function(d){var e=this;e.opts=d||{};if(e.opts.ele){e.opts.ele.onload=null;e.opts.ele.removeAttribute("onload");e.opts.ele.style.msInterpolationMode="bicubic"}e.lock=false;e.img=new Image();e.W=e.img.width;e.H=e.img.height;e.img.src=e.opts.src;e.startTime=new Date();e.interval=e.opts.interval?e.opts.interval:48;e.loop=e.opts.loop?e.opts.loop:30*1000;if(e.img.complete){if(!e.lock){e.cache=true;e.die().resize().finish()}return}e.img.onerror=e.img.onabort=function(){if(!e.lock){e.die().img=null}};e.img.onload=function(){if(!e.lock){e.die().resize().finish()}};e.grepSize()},grepSize:function(){var f=this;if(f.lock){return}var d=f.img.width,e=f.img.height;if(d!=f.W||e!=f.H||d*e>f.W*f.H){f.die().resize().finish()}else{if(new Date()-f.startTime<f.loop){setTimeout(function(){f.grepSize()},f.interval)}else{f.die()}}},resize:function(){var f=this,d=f.img.width,e=f.img.height;if(f.opts.maxW&&f.img.width>f.opts.maxW){f.img.width=f.opts.maxW;f.img.height=f.opts.maxW*e/d}if(f.opts.maxH&&f.img.height>f.opts.maxH){f.img.height=f.opts.maxH;f.img.width=f.opts.maxH*d/e}f.W=f.img.width;f.H=f.img.height;return f},die:function(){var d=this;d.lock=true;d.img.onload=d.img.onerror=null;return d},finish:function(){var d=this,e;e=d.opts.ele?d.opts.ele:d.img;if(d.opts.ele){e.src=d.opts.src;e.width=d.W;e.height=d.H;if(!d.cache){var f=b(e);e=f.clone(true);f.replaceWith(e);e=e.get(0);f=null}}if(d.opts.callback&&typeof(d.opts.callback)=="function"){d.opts.callback(e)}d=d.img=null}});return c});kola("app.util.Loading",["kola.lang.Class","jquery.Core"],function(a,b){var c=a.create({_init:function(){var d=this;if(b("#t-lay div.sysLoading").length==0){var e=document.createDocumentFragment();var g=document.createElement("div");g.className="Lay";g.id="t-lay";g.innerHTML=['<p style="display: none;" class="gotop"> ','<a href="javascript:void(0)" title="回顶部"><i class="ii"></i>',"</a>","</p> ",'<div class="Cloud">','<div class="sysLoading noVis"><p class="png"></p><p class="c">加载中...</p></div> ','<div class="cloud"></div> ',"</div> "].join("");e.appendChild(g);var f=document.getElementById("t-sky");if(b("#t-lay div.Cloud div.cloud").length!=0){}if(b("#t-lay").length!=0){f.appendChild(e)}}},isShowing:function(){return !b("#t-lay div.sysLoading").hasClass("noVis")},show:function(){var d=this;b("#t-lay div.sysLoading").removeClass("noVis")},hide:function(){var d=this;var e=b("#t-lay div.sysLoading");if(!e.hasClass("noVis")){e.addClass("noVis")}}});return c});kola("app.util.SimplePaging",["kola.lang.Class","jquery.Core"],function(b){var d="btn_loading",a="btn_dis",e="actSOL";var c=b.create({params:{pageNo:"pageNo",pageSize:"pageSize",pageCount:"totalPageCount",totalCount:"totalCount"},_init:function(f){$.extend(this,f);this.getBody=this.getBody||function(){};this.ct=$(this.ctSelector);if(this.ct.length==0){return}this.body=this.ct.find(this.bodySelector);this.bar=this.ct.find(this.barSelector);this.current=1;this.pageCount=($(this.bar[1]).hasClass(a)?1:2);this.bar.click(this,this.onBarClick)},onBarClick:function(h){var f=$(this),g=h.data;if(!f.hasClass(a)){if(f.hasClass(e)){g.current--}else{g.current++}g.bar.removeClass(a);if(g.pageCount==0){$(g.bar).addClass(a)}else{if(g.current==1){$(g.bar[0]).addClass(a)}else{if(g.current==g.pageCount){$(g.bar[1]).addClass(a)}}}g.doRequest(f)}},doRequest:function(f){var g=this;if(f.hasClass(d)){return}f.addClass(d);var h=g.data||{};h[g.params.pageNo]=g.current;h[g.params.pageSize]=g.pageSize;$.ajax({url:g.url,type:"POST",data:h,success:function(j){j=($.type(j)==="string")?$.parseJSON(j):j;if(j.status==0){g.pageCount=j.data[g.params.pageCount];g.totalCount=j.data[g.params.totalCount];g.bar.removeClass(a);if(g.pageCount==0){$(g.bar).addClass(a)}else{if(g.current==1){$(g.bar[0]).addClass(a)}else{if(g.current==g.pageCount){$(g.bar[1]).addClass(a)}}}var i=g.getBody.call(g,j.data);g.body.html(i);if(g.onSuccess){g.onSuccess()}}},error:function(){if(g.onError){g.onError()}},complete:function(){f.removeClass(d);if(g.onComplete){g.onComplete()}}})}});return c});kola("app.util.TimeEvent",["jquery.Core"],function(b){function a(c){b.extend(this,c);this.origTime=new Date().getTime()}a.TIMENAME={SECOND:1000,MINUTE:1000*60,HOUR:1000*60*60,DAY:1000*60*60*24};a.STATE={OVER:"over",WAIT:"wait",PROCESS:"process"};a.prototype.getState=function(){var c=this;var e;if(typeof c.serverTime!="undefined"){e=c.serverTime+(new Date().getTime()-this.origTime)}else{e=new Date().getTime()}var d=null;var g=new Date();if(e<c.startTime){d=a.STATE.WAIT;g.setTime(c.startTime-e)}else{if(e>c.endTime){d=a.STATE.OVER;g.setTime(e-c.endTime)}else{d=a.STATE.PROCESS;g.setTime(e-c.startTime)}}var f=g.getTime();return{state:d,curTime:e,timeInfo:{day:parseInt(f/a.TIMENAME.DAY),hour:parseInt(f/a.TIMENAME.HOUR%24),minute:parseInt(f/a.TIMENAME.MINUTE%60),second:parseInt(f/a.TIMENAME.SECOND%60)}}};return a});kola("app.util.TimePanel",["jquery.Core","app.util.TimeEvent"],function(b,a){function c(f){var d=this;f=b.extend({stateChange:function(){},change:function(){}},f);b.extend(this,f);var g=new a({startTime:f.startTime,endTime:f.endTime,serverTime:f.serverTime});var h=null;function e(){var i=g.getState();if(h!=null&&h!=i.state){d.stateChange(i.state)}else{h=i.state}switch(i.state){case a.STATE.WAIT:d.draw(i.timeInfo);break;case a.STATE.PROCESS:d.draw(i.timeInfo);break;case a.STATE.OVER:break}d.change(i)}e();d.iid=setInterval(e,1000)}c.prototype.stop=function(){clearInterval(this.iid)};c.prototype.switchView=function(d){switch(d){case"day":this.p1.txt.html("天");this.p2.txt.html("时");this.p3.txt.html("分");break;case"time":this.p1.txt.html("时");this.p2.txt.html("分");this.p3.txt.html("秒");break}};c.prototype.draw=function(d){if(d.day>=1){this.switchView("day");this.p1.val.html(d.day);this.p2.val.html(d.hour);this.p3.val.html(d.minute)}else{this.switchView("time");this.p1.val.html(d.hour);this.p2.val.html(d.minute);this.p3.val.html(d.second)}};return c});kola("app.util.Timer",["kola.lang.Class","app.util.TimeEvent"],function(b,a){var c=b.create({_init:function(d){var e=this;e.handler=d.handler;e.scope=d.scope;e.millisec=d.millisec||1000;e.te=new a({startTime:d.start,serverTime:d.serverTime||new Date().getTime()});e.repeat()},repeat:function(){var d=this;d.handler.call(d.scope||window,d.te.getState());if(d.task){clearTimeout(d.task)}d.task=setTimeout(function(){d.repeat()},d.millisec)}});return c});