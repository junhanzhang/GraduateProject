kola("app.medal.JoinStarWin",["jquery.Core","kola.lang.Class","newt.window.Window"],function(d,a,c){var b=a.create({win:null,_init:function(e){win=tw.window.getWindow("notice_confirm");var h=win.getElement();win.setTitle("提示信息");d(h).find(".mwBd em.confirm_text").text("加入微博之星，专享闪耀勋章！");var g=d(h).find(".mwFt");var f=d('<a class="btn crjs_yes" href="javascript:void(0);"><b>立即加入</b></a>');d(g).empty();d(g).append(f);f.click(function(){window.location.href=e.starlink||"http://t.sohu.com/addstar/"})},show:function(){win.show()},close:function(){win.destory()}});return b});kola("app.medal.MedalCard",["newt.cr.crEvent","newt.service.UserService","newt.group.action.GrpAct","newt.group.action.TwGrpActionMenu","sohu.ctrl.Tips","newt.Config","newt.service.StatisticService","newt.black.blacklist","app.medal.MedalTool","newt.util.Browser"],function(d,a,b,f,l,j,h,g,i,k){var e=function(){var m=this;m.box=null;m.st=0;m.t=0;m.t2=0;m.cache={};m.id_name_map={};m.fire_el_st=null;m._hasRegEvt=false;$.extend(m,{init:function(){if(!isLogin){return}var n=$("#t-sys");if(!n.data("tw_medalcard_init")){$("#t-sys").mouseover(m.evtCache).mousedown(m.hideMe).data("tw_medalcard_init",true)}m.regEvent()},regEvent:function(){if(m._hasRegEvt){return}else{m._hasRegEvt=true}var n=$("#t-medal-card")},evtCache:function(o){var n=function(){m.t=0;var u=$(o.target);var s=(function(){var v=o.target.tagName;if(!/^(a|b|i)$/i.test(v)){return false}if(u.closest("#t-medal-card").length>0){return false}return true})();if(!s){return}var q=null;var r=u.closest("a");var p=null;try{q=r.attr("medal-card");p=r.attr("look-uid")}catch(t){}if(q){m.showCard({name:q,lookUid:p,dom:r})}};if(m.t>0){clearTimeout(m.t);m.t=setTimeout(n,500)}else{m.t=setTimeout(n,500)}},getData:function(n,o,p){i.getDetail({mid:n,lookUid:o,callback:function(r){var q='<div class="BdT"><i title="'+r.medal_name+'" class="img" style="background-image:url('+r.medal_img+')"></i><b class="mnm"><a href="">'+r.medal_name+'</a></b></div><div class="BdC"><p class="tit">'+r.medal_des+"</p>";if(r.medal_create_time.length>0){q+='<b class="tm" title="获得时间"><a href="javascript:void(0);"><i class="i iS iTime"></i><b class="k1">获得时间：'+r.medal_create_time+"</b></a></b>"}q+="</div>";p(q)}})},buildCard:function(o,q,r){if(!m.box){var p=['<div class="ncard ncard_br medcard" style="left: 729px; top: 197px;">','<div class="ncardC medcardC">','<a class="close" title="关闭" href="javascript:function(){return false}"><i class="sign signX"><q>×</q><q class="k2">×</q></i></a>   <i class="sign signArr"><q>◆</q><q class="k2">◇</q><q class="k3">◆</q></i>',"<div>",'<div class="ncardBd">',"<em>正在加载…</em>","</div>","</div>","</div>","</div>"];var n=$("div.LAND");if(n.length==0){n=$("body")}m.land=n;m.box=$(p.join("")).appendTo(n);m.box.bind({mouseenter:function(){m.stopHide()},mouseleave:function(){m.delayHide()}});m.boxBy=m.box.find("div.ncardBd")}m.getData(o,q,function(s){m.boxBy.html(s).removeClass("ncardloading");r()})},showCard:function(n){m.stopHide();m.buildCard(n.name,n.lookUid,function(){m.show(n.dom)});var o=function(){m.delayHide();n.dom.unbind("mouseout",o)};n.dom.bind("mouseout",o)},show:function(n){m.box.css(m.getPos(n));m.st=1},hideMe:function(n){if(!$(n.target).closest("#t-medal-card").length){if(m.t){clearTimeout(m.t);m.t=0}m.hide()}},hide:function(){if(m.st!=0&&m.box){m.box.css("left",-500);m.st=0}},delayHide:function(){if(m.t2>0){m.stopHide()}m.t2=setTimeout(m.hide,500)},stopHide:function(){clearTimeout(m.t2);m.t2=0},getPos:function(u){var s=u.offset();var x=u.width();var t=u.height();if(!s.top){return{top:0,left:-500}}var w=m.box.find(".ncardC").width(),v=m.box.find(".ncardC").height(),y=$("body").width(),p=m.land.scrollLeft(),n=m.land.scrollTop(),r=s.top-(CRTWCONFIG.SCROLL_DOM.get(0)==window?CRTWCONFIG.SCROLL_DOM.scrollTop():0),q=30;fixed_v=5;if(k.isIE6){fixed_v=25}m.box.removeClass("ncard_tl ncard_tr ncard_bl ncard_br");var o=s.left+p-w+q+x*0.5;if(r>v+70){if(o<0){m.box.addClass("ncard_bl");o=s.left+p+x*0.5-q}else{m.box.addClass("ncard_br")}return{top:s.top+n-v-20+fixed_v,left:o}}else{if(o<0){m.box.addClass("ncard_tl");o=s.left+p+x*0.5-q}else{m.box.addClass("ncard_tr")}return{top:s.top+n+u.height()+10,left:o}}}})};var c=new e();tw.medalcard=c;return c});kola("app.medal.MedalDetailWindow",["jquery.Core","kola.lang.Class","newt.window.Window","app.medal.MedalTool","app.medal.ObtainMedalSuccessWin"],function(f,a,c,e,b){var d=a.create({winId:"medal_detail_win",cfg:null,delegate:null,render:function(){f("#medal_detail_win").remove();var h=this;var g=this.getUngetStatusBody;if(this.cfg.medal_status==1){g=this.getGetStatusBody}else{if(this.cfg.medal_status==2){g=this.getBody}else{if(this.cfg.medal_status==3){g=this.getOutDateStatusBody}}}this.win=tw.window.build(this.winId,g,null,{prefixHtml:c.prototype.winNoFootBtnPrefix(),suffixHtml:c.prototype.winNoFootBtnSuffix()},this.cfg);var i=this.win.getElement();if(this.cfg.medal_status==1&&this.cfg.star===true){f(i).find(".btns a.btnB6").live("click",function(){e.obtainMedal({mid:h.cfg.mid,callback:f.proxy(h.showObtainSuccessWin,h)})})}else{f(i).find(".btns a.btnB6").addClass("btn_dis")}f(i).addClass("mwMedal");f(i).find("a.close").click(function(){h.win.destory();return false})},showObtainSuccessWin:function(i){var h=this;f('[mid="'+i.mid+'"]').removeClass("undo");f('[mid="'+i.mid+'"]').addClass("do");if(h.delegate){h.delegate.obtainSuccess.call(h,i.mid)}i.medal_img=this.cfg.medal_img;var g=new b(i);g.show()},getUngetStatusBody:function(g){return['<div class="mwBd">','<div class="hint hintMed">','<div class="medT"><a href="javascript:void(0);"><img title="'+g.medal_name+'" class="img" src="'+g.medal_img+'"></a></div>','<div class="medC">',"<h4>"+g.medal_name+'</h4><p class="tit">'+g.medal_des+'</p><em class="redM">'+g.medal_need+"</em>",'<p class="btns"><a href="javascript:void(0);" class="btn btnB6 btn_dis"><b>马上领取</b></a></p>',"</div>","</div>","</div>"]},getOutDateStatusBody:function(g){return['<div class="mwBd">','<div class="hint hintMed">','<div class="medT"><a href="javascript:void(0);"><img title="'+g.medal_name+'" class="img" src="'+g.medal_img+'"></a></div>','<div class="medC">',"<h4>"+g.medal_name+'</h4><p class="tit">'+g.medal_des+'</p><em class="redM">'+g.medal_need+"</em>",'<p class="btns"><a href="javascript:void(0);" class="btn btnB6 btn_dis"><b>已过期</b></a></p>',"</div>","</div>","</div>"]},getGetStatusBody:function(g){return['<div class="mwBd">','<div class="hint hintMed">','<div class="medT">','<a href="javascript:void(0);">','<img title="'+g.medal_name+'" class="img" src="'+g.medal_img+'">',"</a>","</div>",'<div class="medC"><h4>'+g.medal_name+'</h4><p class="tit">'+g.medal_des+"</p>",'<p class="btns"><a href="javascript:void(0);" class="btn btnB6"><b>马上领取</b></a></p></div>',"</div>","</div>"]},getBody:function(g){return['<div class="mwBd">','<div class="hint hintMed">','<div class="medT">','<a href="javascript:void(0);">','<img title="'+g.medal_name+'" class="img" src="'+g.medal_img+'">',"</a>","</div>",'<div class="medC">',"<h4>"+g.medal_name+"</h4>",'<p class="tit">'+g.medal_des+"</p>",'<b class="tm" title="获得时间">','<a href="javascript:void(0);">','<i class="i iS iTime"></i>','<b class="k1">获得时间：'+g.medal_create_time+"</b>","</a>","</b>","</div>","</div>","</div>"]},show:function(){this.win.show()},_init:function(g){this.cfg=g;this.delegate=g.delegate;this.render();this.win.setTitle("勋章详情")}});return d});kola("app.medal.MedalPage",["jquery.Core","app.medal.MedalTool","app.medal.MedalDetailWindow","newt.util.Tool","newt.Config","app.medal.JoinStarWin","newt.tool.Copy"],function(h,g,d,c,b,e,f){var a={init:function(){b.GLOBAL_UNLOGIN_BEHAVIOR="modal_login";this.bindEvents();var k=document.URL;var i=/[?|&]mid=([0-9]+)/;var j=k.match(i);if(j==null||j.length==0){return false}g.getDetail({mid:j[1],callback:a.showDetailWin})},bindEvents:function(){var i=this;var k=h("div.allmedal");h(k).find(".medal").live("click",function(l){i.getDetail(h(this).attr("mid"));return false});h("li.highs b.nm>a").click(function(){i.getDetail(h(this).attr("medal-card"));return false});h(".tabs a#mylist").live("click",function(){if(!isLogin){c.iNoLogin();return false}});var j=h(".aside .usr3").find(".fucs a.fuc").click(function(){j.toggleClass("noDis")}).end().find(".mcopy").find(".close").click(function(){h(this).parent().addClass("noDis")}).end().find(".btns3 a.btn").click(function(){var l=f.copy2Clipboard(h(this).parent().siblings(".txt").find("input").val());if(l.type=="ok"){tw.notice.alert("复制成功，快去邀请好友吧！");j.addClass("noDis")}else{tw.notice.alert("您当前所使用的浏览器不支持复制功能，请使用快捷键[Ctrl+C]或者鼠标右键复制链接内容。")}}).end()},getDetail:function(i){if(!isLogin){c.iNoLogin();return}g.getDetail({mid:i,callback:a.showDetailWin})},showDetailWin:function(i){if(i.star==true){var j=new d(i);j.show()}else{var j=new e();j.show()}}};return a});kola("app.medal.MedalTool",["jquery.Core"],function(b){var a={getDetail:function(c){var d={mid:c.mid,a:Math.random()};if(c.lookUid){d.lookUid=c.lookUid}b.ajax({url:"/medal/medalDetail",type:"get",dataType:"json",data:d,success:function(e){if(e.status==0){e.data.mid=c.mid;c.callback.call(this,e.data)}else{tw.notice.showErrTip(e.statusText)}},error:function(e){if(console&&console!=undefined){console.log(e)}}})},obtainMedal:function(c){b.ajax({url:"./obtainMedal",type:"post",dataType:"json",data:{mid:c.mid},success:function(e){if(e.status==0){var f={msg:e.data,mid:c.mid};c.callback.call(this,f)}else{tw.notice.showErrTip(e.statusText)}},error:function(d){if(console&&console!=undefined){console.log(d)}}})}};return a});kola("app.medal.NewYearMedalPage",["jquery.Core","app.medal.MedalTool","app.medal.MedalDetailWindow","newt.util.Tool","newt.Config","app.medal.JoinStarWin","app.widget.Topic"],function(g,f,c,b,a,d,h){var e={init:function(){a.GLOBAL_UNLOGIN_BEHAVIOR="modal_login";this.bindEvents();this.initTopic()},bindEvents:function(){var i=this;g("div.spe .spec>a.btn").live("click",function(j){if(g(this).hasClass("btn_done")||g(this).hasClass("btndone_dis")){return false}i.getDetail(g(this).attr("medal-card"));return false})},initTopic:function(){new h({container:"div.main",composerAction:"/medal/newyearstar/insertTw",action:"/medal/newyearstar/comment",baseParams:{type:0}})},getDetail:function(j){var i=this;if(!isLogin){b.iNoLogin();return}f.getDetail({mid:j,callback:i.showDetailWin})},showDetailWin:function(i){if(i.star==true){i.delegate={obtainSuccess:function(k){var l=g("a.btnM2[medal-card='"+k+"']");l.addClass("btn_done");l.html("<b>已领取</b>")}};var j=new c(i);j.show()}else{var j=new d({starlink:"http://t.sohu.com/twstar/"});j.show()}}};return e});kola("app.medal.ObtainMedalSuccessWin",["jquery.Core","kola.lang.Class","newt.window.Window"],function(e,b,d){var a=function(f){return['<div class="mwBd">','<div class="hint hintOk">','<div class="hintT"><i class="i"></i><em>恭喜，您的勋章领取成功！</em></div>',"</div>",'<div class="post">','<div class="ttl">',"<h6><q>把喜讯分享给大家：</q></h6>","</div>",'<div class="tarea blur"><div class="atFake">搜狐</div><textarea>'+f.msg+"</textarea></div>",'<p class="postSub"><a class="btn" href="#"><b>发 送</b></a></p>',"</div>","</div>"]};var c=b.create({win:null,_init:function(f){var g=this;if(e("#obtain_success_win").size()>0){e("#obtain_success_win").remove()}win=tw.window.build("obtain_success_win",a,null,{prefixHtml:d.prototype.winNoFootBtnPrefix(),suffixHtml:d.prototype.winNoFootBtnSuffix()},f);var h=win.getElement();e(h).addClass("mwMedal1");e(h).find(".postSub a.btn").click(function(){var i=e(h).find(".tarea textarea").val();if(e.trim(i).length>0){tw.build({type:"add_tw",content:i,pic:f.medal_img,success:function(j){win.destory();tw.notice.showTip("发布成功")},error:function(){win.destory();tw.notice.showErrTip("通讯错误")}})}});e(h).addClass("mwMedal");e(h).find("a.close").click(function(){win.destory();return false})},show:function(){win.show()},close:function(){win.destory()}});return c});