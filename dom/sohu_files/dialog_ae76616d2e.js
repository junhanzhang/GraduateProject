kola("app.exp.dialog.GuestAutoRegDone",["jquery.Core","newt.ui.window.Modal","newt.util.FormValidator","newt.service.StatisticService"],function(f,b,c,d){var e=null;var g=false;var a={sendCC:function(){},openCount:0,show:function(h){if(g==true){return}++a.openCount;g=true;h.loginUrl=h.loginUrl||"/guide/discover/puLogin";if(e==null){e=new b({template:"template.yunying.exp.dialog.guest_do_ugc_done",className:"mwSele8",templateData:h,handle:{defClose:function(i){kola("newt.ca.ca",function(j){j.q("Autoreg_Quick_Press")});location.href=h.loginUrl+"?passport="+encodeURIComponent(h.passport)+"&srcUrl="+encodeURIComponent(location.href)},defShow:function(i){kola("newt.ca.ca",function(j){j.q("Autoreg_show_Savelocal")});g=false},defInit:function(i){var j=i.getDOM();j.find("h4.crJs_window_title").html("<em>"+h.opName+"</em>")}}});e.show()}else{e.show()}}};return a});kola("app.exp.dialog.GuestReply",["jquery.Core","newt.ui.window.dialog.SimpleSendMsg"],function(a,b){return{show:function(c){b.show({title:"评论微博",poster:function(d){kola("app.exp.sohuhome.service.SohuHomeWBExp, app.exp.dialog.GuestWriteNickName",function(f,e){e.show({opName:"评论",complete:function(g){f.guestReply({params:{server:c.server?c.server:"app",msgId:c.msgId,content:d,guestNickName:g},success:function(h){if(h.status==0){kola("app.exp.dialog.GuestAutoRegDone",function(i){i.show({nickName:h.data.userName,passport:h.data.passport,password:h.data.password,fileUrl:h.data.fileUrl,opName:"评论",loginUrl:c.loginUrl})})}else{kola("newt.dialog.Notice",function(){tw.notice.alert(h.statusText)})}},fail:function(){kola("newt.dialog.Notice",function(){tw.notice.alert("服务器爆炸,请稍后再试。")})}})}})})}})}}});kola("app.exp.dialog.GuestWriteNickName",["jquery.Core","newt.ui.window.Modal","newt.util.FormValidator","mvc.Event","newt.service.StatisticService"],function(f,c,d,b,e){var g=false;var a={sendCC:function(){},openCount:0,show:function(h){if(g==true){return}++a.openCount;g=true;if(true){(new c({template:"template.yunying.exp.dialog.guest_write_nickname_for_do_ugc",className:"mwSele9",handle:{defClose:function(i){kola("newt.ca.ca",function(j){j.q("Autoreg_Closed_nickname")});if(i.__submit!=true){kola("newt.dialog.Notice",function(){tw.notice.alert(h.opName+"失败，登录后才可进行"+h.opName+"操作")});if(typeof(h.fail)=="function"){h.fail()}}i.destroy()},defInit:function(j){var k=j.getDOM();var l=new d({form:k.find("form.js-form"),triggers:"blur|keyup"});k.find("h4.crJs_window_title").html("<em>"+h.opName+"</em>");k.find("input[name='nickName']:first").focus();var i=k.find("a.js-submit");i.bind("click",function(m){if(i.data("_disabled")==true){return}kola("newt.ca.ca",function(n){n.q("Autoreg_Quick_Press")});l.validate({pass:function(){j.__submit=true;if(h.complete){h.complete(k.find("input[name='nickName']:first").val(),j);kola("newt.ca.ca",function(n){n.q("Autoreg_Closed_nickname")});j.destroy()}}});m.preventDefault();m.stopPropagation();return false});k.bind("keydown",function(m){if(m.keyCode==13){i.trigger("click");m.preventDefault();m.stopPropagation();return false}})},defShow:function(){kola("newt.ca.ca",function(i){i.q("Autoreg_show_nickname")});g=false}}})).show()}else{wnd.show()}}};return a});kola("app.exp.dialog.Login",["jquery.Core","newt.widget.plus.Input","newt.widget.plus.Form","mvc.view.TemplateEngine","newt.net.interface.user","newt.util.Validator","newt.dialog.Notice","newt.ca.ca","newt.component.PassportSC","newt.service.Account","newt.data.Rule"],function(c,m,d,q,b,e,o,f,j,k,h){var g=null;var r=null;h.add("eqpassword",function(t){var s=r.find("input[name='password']").val();if(h.test("required",s)==false){return true}return s==t});h.add("eqpasswordtoo",function(t){var s=r.find("input[name='password_too']").val();if(h.test("required",s)==false){return true}return s==t});var i={};function l(s){var t=i[s.VID];t=t?t:{};c.extend(t,s);i[s.VID]=t}function p(s){return i[s]}var a=false;var n={init:function(s){if(a==true){return}c.extend(s,{view:"regist"});if(!r){a=true;q.getTemplate({name:"template.main.regist.dialog.exp.headtab",complete:function(t){g=tw.window.getWindow("tw_empty_window",{head:t.render()});g.setId("tw_expregist");r=g.getElement();r.find("div.mwFt").remove();r.addClass("mw mobReg");r.find("a.js-exlogin-viewregist").bind("click",function(){n.switchView({view:"regist"})}).trigger("click");r.find("a.js-exlogin-viewlogin").bind("click",function(){n.switchView({view:"login"})});a=false}})}else{g.show()}},switchView:function(s){r.find("a.js-exlogin-viewtab").removeClass("on");switch(s.view){case"regist":n.renderRegist(s);break;case"login":n.renderLogin(s);break}},renderLogin:function(t){r.find("a.js-exlogin-viewlogin").addClass("on");var s=r.find("div.js-explogin-loginform");if(s.size()>0){r.find("div.js-explogin-form").hide();s.show()}else{a=true;q.getTemplate({name:"template.main.regist.dialog.exp.login",complete:function(v){r.find("div.js-explogin-form").hide();var u=v.render();j._drawLoginForm=function(){c(j.cElement).html(u)};j.drawPassportWait=function(w){PassportSC.cElement.innerHTML='<div id="ppcontid" class="ppcontent"><div class="ppWaitMsg">'+w+"</div></div>"};j.loginFailCall=function(){j.drawPassport(g.getBodyWrapper().get(0));c("#pperrmsg").html("用户名或密码错误")};j.drawPassport(g.getBodyWrapper().get(0));g.show();a=false}})}},renderRegist:function(t){r.find("a.js-exlogin-viewregist").addClass("on");var s=r.find("div.js-explogin-registform");if(s.size()>0){r.find("div.js-explogin-form").hide();s.show()}else{a=true;q.getTemplate({name:"template.main.regist.dialog.exp.regist",complete:function(y){r.find("div.js-explogin-form").hide();g.appendHtml(y.render({data:{returnUrl:location.href+"&trans=1"}}));g.show();var w=r.find("form.js-submitform:first");var u=new d({form:w,model:k.registByPhoneNumber,modelOptions:{success:function(B){if(B.status==0){q.getTemplate({name:"template.main.regist.dialog.exp.regist_success",complete:function(C){r.find("div.js-explogin-registform").html(C.render());setTimeout(function(){location.href=B.statusText},3000)}})}else{kola("newt.dialog.Notice",function(){tw.notice.alert(B.statusText,function(){n.show()})})}}}});var x={phoneNumber:"",vCode:""};var z=new e({form:w,validateTriggers:"submit|blur",beforeSubmit:function(){r.find("a.js-submit").addClass("btn_loading btn_dis").data("dis",true)},formPassValidate:function(B){u.ajaxSubmit()},rules:{phoneNumber:{remote:{enabled:true,url:"/settings/bindMobile/registIsMobileBound",params:"{mobileNumber}",dataType:"json",test:function(B){x.phoneNumber=B.statusText;return B.status==0}}},vCode:{remote:{enabled:true,url:"/settings/bindMobile/registCheckVerificationCode",getters:{getPhoneNumber:function(){return r.find("input[name='phoneNumber']").val()}},params:"{verificationCode}&mobileNumber={=getPhoneNumber}",dataType:"json",test:function(C){var B=(C.status==0);x.vCode=(B==false)?"验证码错误":"";return B}}}},validateListener:function(B,K,G,F){l(K);var H=K.VID;var E=p(H);if(E){c.extend(K,E)}var J=true;for(var L in K){if(L=="VID"){continue}var D=false;for(var I in K[L]){if(D==true){break}switch(I){case"required":if(K[L][I]==false){switch(L){case"phoneNumber":v(L,"请输入手机号");break;case"vCode":v(L,"请输入手机验证码");break;case"password":v(L,"请输入密码");break;case"password_too":v(L,"请在此再次输入密码");break}J=false;D=true}else{if(K[L][I]==true){v(L,null)}}break;case"number":if(K[L][I]==false){switch(L){case"phoneNumber":v(L,"手机号需为数字");break;case"vCode":v(L,"验证码为数字");break}J=false;D=true}else{if(K[L][I]==true){v(L,null)}}break;case"l11l11":if(K[L][I]==false){switch(L){case"phoneNumber":v(L,"手机号长度为11位");break}J=false;D=true}else{if(K[L][I]==true){v(L,null)}}break;case"l6l16":if(K[L][I]==false){switch(L){case"password":v(L,"密码长度为6~16位");break;case"password_too":v(L,"密码长度为6~16位");break}J=false;D=true}else{if(K[L][I]==true){v(L,null)}}break;case"eqpassword":if(K[L][I]==false){switch(L){case"password_too":v(L,"两段密码须一致","password");break}J=false;D=true}else{if(K[L][I]==true){var C=c("input[name='password']").val();v(L,null,(h.test("required",C)&&h.test("l6l16",C))?"password":null)}}break;case"eqpasswordtoo":if(K[L][I]==false){switch(L){case"password":v(L,"两段密码须一致","password_too");break}J=false;D=true}else{if(K[L][I]==true){var C=c("input[name='password_too']");v(L,null,(h.test("required",C)&&h.test("l6l16",C))?"password_too":null)}}break;case"remote":if(K[L][I]==false){switch(L){case"phoneNumber":v(L,x.phoneNumber);break;case"vCode":v(L,x.vCode);break}J=false;D=true}else{if(K[L][I]==true){v(L,null)}}break}}}}});function v(D,B,C){if(B==null){w.find("div.js-field-"+D).removeClass("frm_err").addClass("frm_ok");w.find("div.js-"+D+"-default-view").show();w.find("div.js-"+D+"-err-view").hide();w.find("b.js-"+D+"-tiptxt").html("");if(C){v(C,B)}}else{w.find("div.js-field-"+D).removeClass("frm_ok").addClass("frm_err");w.find("div.js-"+D+"-default-view").hide();w.find("div.js-"+D+"-err-view").show();w.find("b.js-"+D+"-tiptxt").html(B);if(C){v(C,B)}}}r.find("a.js-submit").bind("click",function(){var B=c(this);if(B.data("dis")==true){return}B.addClass("btn_loading btn_dis").data("dis",true);z.remoteAllDone(function(){B.removeClass("btn_loading btn_dis").data("dis",false)});w.submit()});r.find("a.js-get-vcode").bind("click",function(){var B=c(this);if(B.data("locked")==true){return}kola("newt.service.Account",function(C){C.getPhoneNumberVCode({params:{phoneNumber:r.find("input[name='phoneNumber']:first").val()},success:function(D){if(D.status!=0){B.data("locked",false);v("phoneNumber",D.statusText)}else{A(50)}},beforeCall:function(){B.data("locked",true)},fail:function(){B.data("locked",false)}})})});function A(F){var C=r.find("a.js-get-vcode");var B=new Date().getTime();C.data("lock_time",B);C.data("locked",true);var E=C.find("b:first");var D=setInterval(function(){var G=Math.floor((new Date().getTime()-B)/1000);if(G<=F){E.html("("+(F-G)+"秒后)重新获取验证码")}else{C.data("locked",false);E.html("免费获取验证码");clearInterval(D);return}},1000)}r.bind("keyup",function(B){if(B.keyCode==13){r.find("a.js-submit").trigger("click")}});a=false}})}},destory:function(){if(g){g.destory()}},show:function(s){n.init(s||{})}};return n});kola("app.exp.dialog.ModifyNickName",["jquery.Core","newt.window.Window","newt.service.Account","newt.tool.validator.User","mvc.view.TemplateEngine","newt.ca.ca"],function(h,f,b,e,a,c){var d=new e();var g={tpl:"template.yunying.exp.dialog.ModifyNickNameBlue",nickname:"",show:function(k){k=k||{};var i=this;var j=k.tpl||i.tpl;i.nickname=k.nickname||"";var l="tw_win_editUName";a.getTemplate({name:j,complete:function(o){var n=function(){return[o.render({data:i})]};var q=i.win=tw.window.build(l,n,{parentFixed:false,expose:{opacity:0.5,color:"#000000"}},{prefixHtml:f.prototype.winNoFootBtnPrefix(),suffixHtml:f.prototype.winNoFootBtnSuffix()});var m=h(q.getElement());m.attr("class","mw");m.addClass(k.cls||"mwNC");var p=i.winEl=h("#"+l);if(k.hideClose){p.find("a.close").hide()}else{p.find("a.close").show()}p.find("a.jsClose").bind("click",function(){if(k.from&&k.from=="home"){c.q("readuser_nickname2_skip")}else{c.q("readuser_nickname_skip")}q.close()});q.getControl().onClose(function(){if(k.onClose){k.onClose()}q.destory()});i.saveBtn=p.find("a.jsSave");i.saveBtn.click(function(r){if(!h(this).hasClass("btn_dis")){i.save(i.uName.val(),k);if(k.from&&k.from=="home"){c.q("readuser_nickname2_success")}else{c.q("readuser_nickname_success")}}r.preventDefault();r.stopPropagation();return false});p.find("form:first").bind("keydown",function(r){if(r.keyCode==13){r.preventDefault();r.stopPropagation();i.saveBtn.trigger("click");return false}});i.win=q;i.initName(p);q=i.win;if(k.from&&k.from=="home"){c.q("readuser_nickname2_show")}else{c.q("readuser_nickname_show")}q.show()}})},initName:function(j){var i=this;i.uNameDiv=j.find("div.frm");i.uName=i.uNameDiv.find("input:eq(0)");d.showTip("focus",{ele:i.uNameDiv,msg:"2―12位，由中文、数字、字母组成"});i.uName.bind("focus",function(){if(h(this).val()!=""){d.showTip("focus",{ele:i.uNameDiv,msg:"2―12位，由中文、数字、字母组成"})}}).bind("keyup",function(){i.checkName(h(this).val())}).bind("blur",function(){i.checkName(h(this).val())})},checkName:function(j){var i=this;var k=d.checkName(j);if(k.type!="ok"){d.showTip(k.type,{ele:i.uNameDiv,msg:k.data});i.saveBtn.addClass("btn_dis")}else{i.checkNameAjax(j)}},checkNameAjax:function(j){var i=this;b.validUserName({params:{uName:h.trim(j)},success:function(k){if(k.status==0){d.showTip("ok",{ele:i.uNameDiv,msg:"该昵称可用"});i.saveBtn.removeClass("btn_dis")}else{d.showTip("err",{ele:i.uNameDiv,msg:k.statusText});i.saveBtn.addClass("btn_dis")}},fail:function(){d.showTip("err",{ele:i.uNameDiv,msg:"服务器出错了"});i.saveBtn.addClass("btn_dis")}})},save:function(l,k){var j=this,i=true,m={};l=h.trim(l);m=d.checkName(l);if(m.type!="ok"){d.showTip(m.type,{ele:j.uNameDiv,msg:m.data});j.saveBtn.addClass("btn_dis");i=false}if(!i){return}b.setUserName({params:{uName:l},success:function(n){if(n.status==0){kola("app.exp.task.TA",function(r){r.q("changenickname_weibo_change")});var p=h("b#username");if(p.size()>0){p=p.find("a");p.attr("title",l);p.attr("data-content",'{"type":"nick","nick":"'+l+'"}');p.html(l)}var q=k&&k.onNicknameChanged;if(q instanceof Function){try{q(l)}catch(o){}}j.win.close()}else{d.showTip("err",{ele:j.uNameDiv,msg:n.statusText});j.saveBtn.addClass("btn_dis")}},fail:function(){d.showTip("err",{ele:j.uNameDiv,msg:"服务器出错了"})}})}};return g});kola("app.exp.dialog.Register",["jquery.Core","newt.widget.plus.Input","newt.widget.plus.Form","mvc.view.TemplateEngine","newt.net.interface.user","newt.util.Validator","newt.dialog.Notice","newt.ca.ca","newt.component.PassportSC","newt.service.Account","newt.data.Rule","newt.Config","newt.widget.AutoComplete","newt.iploc.CrIploc1"],function(c,p,d,t,b,e,r,g,m,n,i,f,k){var l=b;var h=null;var u=null;i.add("eqpassword_exp_reg",function(w){var v=u.find("input[name='password']").val();if(i.test("required",v)==false){return true}return v==w});i.add("eqpasswordtoo_exp_reg",function(w){var v=u.find("input[name='password_too']").val();if(i.test("required",v)==false){return true}return v==w});var j={};function o(v){var w=j[v.VID];w=w?w:{};c.extend(w,v);j[v.VID]=w}function s(v){return j[v]}var a=false;var q={init:function(v){if(a==true){return}c.extend(v,{view:"regist"});if(!u){a=true;t.getTemplate({name:"template.main.regist.dialog.exp.expregister.headtab",complete:function(w){h=tw.window.getWindow("tw_empty_window",{head:w.render(),expose:{opacity:0.5,color:"#000000"}});h.setId("tw_expregist");u=h.getElement();u.find("div.mwFt").remove();u.addClass("mw mobReg");u.find("a.js-exlogin-viewregist").bind("click",function(){q.switchView({view:"regist"})});u.find("a.js-exlogin-viewlogin").bind("click",function(){q.switchView({view:"login"})}).trigger("click");a=false}})}else{h.show()}},switchView:function(v){u.find("a.js-exlogin-viewtab").removeClass("on");switch(v.view){case"regist":q.renderRegist(v);break;case"login":q.renderLogin(v);break}},renderLogin:function(w){u.find("a.js-exlogin-viewlogin").addClass("on");var v=u.find("div.js-explogin-loginform");if(v.size()>0){u.find("div.js-explogin-form").hide();v.show()}else{a=true;t.getTemplate({name:"template.main.regist.dialog.exp.expregister.email",complete:function(M){u.find("div.js-explogin-form").hide();h.appendHtml(M.render({data:{returnUrl:location.href+"&trans=1"}}));h.show();u.find("#_tw_rw_field_captchaCode").show();i.add("包含搜狐",function(U){return U.indexOf("搜狐")==-1});i.add("包含搜狐微博",function(U){return U.indexOf("搜狐微博")==-1});i.add("包含sohu",function(U){return U.indexOf("sohu")==-1});i.add("包含souhu",function(U){return U.indexOf("souhu")==-1});i.add("开头微博",function(U){return U.indexOf("微博")!=0});i.add("开头weibo",function(U){return U.indexOf("weibo")!=0});i.add("开头官方",function(U){return U.indexOf("官方")!=0});var y=c("#_tw_rw_reg_form");function L(V){V=c.extend({success:function(){c("#_tw_rw_captchaCode_tip").html("")}},V||{});var U=y.find("#_tw_rw_validCode");if(U.size()<=0){return}l.flushValidCode(U,{beforeSend:function(){R.set("captchaCode",{remote:{enabled:false}})},success:function(W){y.find("#_tw_rw_field_captchaCode").removeClass("frm_ok frm_err").find(".txt input").val("");if(typeof(V.success)=="function"){V.success()}y.find("#_tw_rw_captchaSeed").val(W.data);R.set("captchaCode",{remote:{enabled:true,url:l.URL.VALID_VALIDCODE,params:"{captchaCode}&captchaSeed="+W.data,dataType:"json",test:function(X){return X.status==0}}})}})}c("#_tw_rw_field_captchaCode").find(".txt input").bind("focus",function(){if(c("#_tw_rw_field_captchaCode").hasClass("frm_err")){L({success:function(){}})}});var O=y.find("#_tw_rw_field_local");var x=[1,8];x[0]=O.find("i.select:eq(0)").attr("val");x[1]=O.find("i.select:eq(1)").attr("val");if(!x[0]||x[0]==""){x=[1,8]}if(x[0]=="请选择"){O.find("i.select:eq(0)").attr("val","0");O.find("i.select:eq(1)").attr("val","0")}if(O.find("#_tw_rw_province_hidden").size()==0){O.append('<input type="hidden" id="_tw_rw_province_hidden"   class="validate-criploc" name="province" value="'+x[0]+'">');O.append('<input type="hidden" id="_tw_rw_city_hidden"  class="validate-criploc"  name="city" value="'+x[1]+'">')}var G=y.find("#_tw_rw_field_local").crIploc1({changePro:function(U){var V=y.find("#_tw_rw_province_hidden").val();if(V!=U){y.find("#_tw_rw_province_hidden").val(U);y.find("#_tw_rw_city_hidden").val(0);N("local")}},changeCity:function(U){y.find("#_tw_rw_city_hidden").val(U);z()},onLoad:function(U,V){y.find("#_tw_rw_province_hidden").val(U);y.find("#_tw_rw_city_hidden").val(V)}}).data("crIploc1");function z(){var U=c("#_tw_rw_province_hidden").val();var V=c("#_tw_rw_city_hidden").val();if(U>0&&V>0){S("local")}else{B("local","请选择您的所在地")}}var H;function F(U){U.getTemplate({name:"template.main.regist.step1.nickname_recommend",complete:function(V){H.getData({num:6,complete:function(X){var W=c("#nickname_recommend");if(!X||X.length<=0){W.find("p.tip").html("");return}var Y=(c.trim(W.html())=="");W.html(V.render({data:X})).hide();if(X.length<6){W.find("p.tip").html("")}if(Y){W.slideDown(100)}else{W.show()}W.find("a.js-next").bind("click",function(){F(U)});W.find("input.js-nickname").bind("click",function(){c("input[name='nickname']").val(c(this).attr("data-nickname"));c("#field_nickname").removeClass("frm_err").addClass("frm_ok");N("nickname");W.fadeOut(100,function(){c("#nickname_recommend").html("")})})}})}})}function C(U){kola("util.data.DataBuffer, mvc.view.TemplateEngine",function(W,V){H=new W({bufferSize:U.length,filler:function(Y,Z,X){X(U.splice(0,6))}});F(V)})}var P="";var A="";var T=null;var R=new e({form:y,rules:{mail:{remote:{enabled:true,url:l.URL.VALID_EMAIL,params:"{mail}",dataType:"json",test:function(U){A=U.statusText;return U.status==0}}},nickname:{"包含搜狐":{enabled:true},"包含搜狐微博":{enabled:true},"包含sohu":{enabled:true},"包含souhu":{enabled:true},"开头微博":{enabled:true},"开头weibo":{enabled:true},"开头官方":{enabled:true},remote:{enabled:true,url:l.URL.VALID_NICKNAME,getters:{getMail:function(){return I()}},params:"{nickname}&mail={=getMail}",dataType:"json",test:function(U){P=U.statusText;return U.status==0}}}},validateListener:function(X,W,Y){if(W){delete W.VID}var ab=false;for(var U in W){if(Y&&R.localPass(U)==false){break}var aa=W[U];var V=false;for(var Z in aa){if(V){break}switch(Z){case"包含搜狐":if(aa[Z]==false){B(U,"不能含有“搜狐”");V=true}break;case"包含搜狐微博":if(aa[Z]==false){B(U,"不能含有“搜狐微博”");V=true}break;case"包含sohu":if(aa[Z]==false){B(U,"不能含有“sohu”");V=true}break;case"包含souhu":if(aa[Z]==false){B(U,"不能含有“souhu”");V=true}break;case"开头微博":if(aa[Z]==false){B(U,"不能以“微博”开头");V=true}break;case"开头weibo":if(aa[Z]==false){B(U,"不能以“weibo”开头");V=true}break;case"开头官方":if(aa[Z]==false){B(U,"不能以“官方”开头");V=true}break;case"criploc":if(aa[Z]==false){B("local","请选择您的所在地");V=true}break;case"l2l12":if(aa[Z]==false){B(U,"2-12位，由中文、字母、数字组成");V=true}break;case"l4l16":if(aa[Z]==false){B(U,"长度需要在4-16位之间");V=true}break;case"l6l16":if(aa[Z]==false){B(U,"长度需要在6-16位之间");V=true}break;case"required":if(aa[Z]==false){V=true;switch(U){case"mail":if(J==false){if(y.find("#_tw_rw_field_mail b.frm_suffix").size()==1){D(U,'<a href="javascript: void(0);" class="no-mail jsSohu">已有邮箱？</a>',false)}else{D(U,'填写常用邮箱作为微博账号。<a href="javascript: void(0);" class="no-mail ">没有邮箱？</a>',false)}}else{B(U,"请填写邮箱")}break;case"nickname":if(J==false){D(U,"昵称由中文、字母或数字组成");return}else{B(U,"请填写昵称")}break;case"password":if(J==false){D(U,"6-16位，由字母(区分大小写)、数字、符号组成");return}else{B(U,"请填写密码")}break;case"captchaCode":if(J==false){D(U,"输入验证码");return}else{B(U,"请填写验证码")}break}}break;case"email":if(aa[Z]==false){B(U,"邮箱格式不正确");V=true}break;case"remote":if(aa[Z]==false){V=true;switch(U){case"mail":B(U,A);break;case"nickname":B(U,P);break;case"captchaCode":B(U,"验证码错误");break}}break;case"sohumailnamel4l16":if(aa[Z]==false){B(U,"邮箱名长度需要在4-16位之间");V=true}break;case"sohumail":if(aa[Z]==false){B(U,"只能使用字母、数字、减号、点号和下划线");V=true}break;case"lowercaseStart":if(aa[Z]==false){B(U,"只能以小写字母开头");V=true}break;case"nec":if(aa[Z]==false){B(U,"昵称只能使用中文、字母或数字");V=true}break;case"sohumailname":if(aa[Z]==false){B(U,"只能使用字母、数字、减号、点号和下划线");V=true}break;case"password":if(aa[Z]==false){B(U,"密码必须是字母(区分大小写)、数字、符号");V=true}break}}if(V==false){N(U);if(U=="province"||U=="city"){y.find("#_tw_rw_field_local").removeClass("frm_err").addClass("frm_ok")}else{y.find("#_tw_rw_field_"+U).removeClass("frm_err").addClass("frm_ok")}}else{y.find("#_tw_rw_field_"+U).removeClass("frm_ok")}}if(J){J=false}},validateTriggers:"submit|blur|focus",beforeSubmit:function(){K=true;y.find("#_tw_rw_registerStart").addClass("btnOLoad");var W=y.find("b.frm_suffix:first");if(W&&W.size()>0){var V=y.find("#_tw_rw_field_mail_input");y.append("<input type='hidden' name='"+V.attr("name")+"' value='"+V.val()+"@sohu.com'/>");V.removeAttr("name")}else{}var U=y.find("input[name='password']:first");y.append("<input type='hidden' name='"+U.attr("name")+"' value='"+c.cr.encodeUTF(U.val())+"'/>");U.removeAttr("name")}});function I(){var W=R.getValidateResults("mail")["mail"];for(var V in W){if(W[V]==false){return""}}var U=y.find("b.frm_suffix:first");if(U&&U.size()>0){return y.find("#_tw_rw_field_mail_input").val()+"@sohu.com"}else{return y.find("input[name='mail']:first").val()}}y.find("input[name='nickname']").data("parser",{remote:function(U){return c.cr.encodeUTF(U)}});y.find("input[name='captchaCode']").data("parser",{remote:function(U){return c.cr.encodeUTF(U)}});y.find("input[type='text'], input[type='password']").bind("blur",function(V){if(T){var U=y.find("#_tw_rw_"+this.name+"_tip");if(U.get(0)==T.get(0)){T.html("");T=null}}});function B(U,V){T=null;y.find("#_tw_rw_field_"+U).addClass("frm_err").removeClass("frm_ok");y.find("#_tw_rw_"+U+"_tip").html(V)}function S(U){T=null;c("#_tw_rw_field_"+U).addClass("frm_ok").removeClass("frm_err")}function N(U){c("#_tw_rw_field_"+U).removeClass("frm_err frm_ok");y.find("#_tw_rw_"+U+"_tip").html("")}function D(V,W,U){y.find("#_tw_rw_field_"+V).removeClass("frm_err frm_ok");if(U!=false){T=y.find("#_tw_rw_"+V+"_tip").html(W)}else{y.find("#_tw_rw_"+V+"_tip").html(W)}}y.find("#_tw_rw_field_mail_input").bind("blur focus",function(){var V=c(this);var U=V.val();if(U&&U.length>0){if(i.test("atsohucommail",U)||y.find("b.frm_suffix").size()>0){R.set("mail",{sohumailnamel4l16:{enabled:false},sohumail:{enabled:false}})}else{if(i.test("atsohumail",U)){R.set("mail",{lowercaseStart:{enabled:true,priority:10},sohumailnamel4l16:{enabled:true},sohumail:{enabled:true}})}else{R.set("mail",{sohumail:{enabled:false},lowercaseStart:{enabled:false,priority:10},sohumailnamel4l16:{enabled:false}})}}}R.validate("mail")});var K=false;L();y.find("#_tw_rw_flushValidCode").bind("click",function(){L()});var J=false;y.find("#_tw_rw_registerStart").bind("click",function(){var U=c(this);if(U.hasClass("btnOLoad")){return}J=true;U.addClass("btnOLoad");R.remoteAllDone(function(){if(K==false){U.removeClass("btnOLoad")}});y.submit()});c("#_tw_rw_reg_form").bind("keydown",function(U){if(U.keyCode==13){y.find("#_tw_rw_registerStart").trigger("click")}});var Q=new k({list:["@sohu.com","@163.com","@qq.com","@126.com","@hotmail.com","@gmail.com","@chinaren.com","@sogou.com","@focus.cn"],title:"请选择您的用户帐号类型",input:y.find("#_tw_rw_field_mail_input"),mode:"tip"});c("#_tw_rw_reg_form").before(Q.getDOM().hide());function E(){var V=c("b.frm_suffix");var X=c("input[name='mail']");var W=X.parents("i.txtLg:first");var Y=y.find("#_tw_rw_mail_tip");var U=V.size()>0;R.set("mail",{email:{enabled:U},lowercaseStart:{enabled:U==false,priority:10},l4l16:{enabled:U==false},sohumailname:{enabled:U==false}});if(U){V.remove();X.removeData("parser");c("#_tw_rw_field_mail").removeClass("frm_nomail");if(y.find("#_tw_rw_field_mail").hasClass("frm_err")==false){Y.html('<a href="javascript: void(0);" class="no-mail">没有邮箱？</a>')}y.attr("action","/regist/otherDomainRegist");Q.enabled()}else{W.after("<b class='frm_suffix'>@sohu.com</b>");c("#_tw_rw_field_mail").addClass("frm_nomail");if(y.find("#_tw_rw_field_mail").hasClass("frm_err")==false){Y.html('<a href="javascript: void(0);" class="no-mail">已有邮箱？</a>')}X.data("parser",{remote:function(Z){return Z+"@sohu.com"}});y.attr("action","/regist/newSohuRegist");Q.disabled()}R.validate("mail")}y.find("#_tw_rw_field_mail a.no-mail").live("click",E);y.find("input[name='mail']:first").bind("blur",function(){var U=c(this);if(U.val().length>0&&i.test("atsohucommail",U.val())&&y.find("b.frm_suffix").size()<=0){U.val(U.val().split("@")[0]);E()}});y.bind("submit",function(){var U=y.find("input[name='mail']").val();if(U&&U.length>0){if(i.test("atsohumail",U)){y.attr("action","/regist/newSohuRegist")}else{y.attr("action","/regist/otherDomainRegist")}}});u.find("a.js-shexp-regskip").bind("click",function(){u.find("a.js-shexp-register").trigger("click")});a=false}})}},renderRegist:function(w){u.find("a.js-exlogin-viewregist").addClass("on");var v=u.find("div.js-explogin-registform");if(v.size()>0){u.find("div.js-explogin-form").hide();v.show()}else{var x=1;a=true;t.getTemplate({name:"template.main.regist.dialog.exp.expregister.phone_step1",complete:function(C){u.find("div.js-explogin-form").hide();h.appendHtml(C.render({data:{returnUrl:location.href+"&trans=1"}}));h.show();var A=u.find("form.js-submitform:first");var y=new d({form:A,model:n.registByPhoneNumber,modelOptions:{success:function(I){if(I.status==0){var F=I.statusText.split("?");var H=F[1];H=H.split("&");var K=[];var N="";for(var J=0,G=H.length;J<G;++J){var L=H[J].split("=");if(L[0]=="userid"){N=L[1]}if(L[0]=="ru"){continue}K.push(L[0]+"="+L[1])}F[1]=K.join("&");var M=F.join("?");t.getTemplate({name:w.registSuccess||"template.main.regist.dialog.exp.regist_success",complete:function(O){u.find("div.js-explogin-registform").html(O.render({data:{hasVideoCard:true}}));u.find("a.js-tomymail-link").attr("href",M+"&ru=http://t.sohu.com/inbox");u.find("a.js-shexp-close").css("visibility","visible").bind("click",function(){location.href=M+"&ru="+location.href});setTimeout(function(){location.href=M+"&ru="+location.href},10000)}})}else{kola("newt.dialog.Notice",function(){tw.notice.alert(I.statusText,function(){q.show()})})}}}});var B={phoneNumber:"",vCode:""};var D=new e({form:A,validateTriggers:"submit|blur",beforeSubmit:function(){u.find("a.js-submit").addClass("btn_loading btn_dis").data("dis",true)},formPassValidate:function(F){switch(x){case 1:kola("newt.service.Account",function(G){G.getPhoneNumberVCode({params:{phoneNumber:u.find("input[name='phoneNumber']:first").val()},success:function(H){if(H.status!=0){z("phoneNumber",H.statusText)}else{u.find("div.js-explogin-registform").find("fieldset.js-step1").hide();u.find("div.js-explogin-registform").find("fieldset.js-step2").show();D.set("vCode",{remote:{enabled:true,url:"/settings/bindMobile/registCheckVerificationCode",getters:{getPhoneNumber:function(){return u.find("input[name='phoneNumber']").val()}},params:"{verificationCode}&mobileNumber={=getPhoneNumber}",dataType:"json",test:function(J){var I=(J.status==0);B.vCode=(I==false)?"验证码错误":"";return I}},required:{enabled:true},number:{enabled:true}});u.find("div.js-explogin-registform").find("em.js-phonenumber-view").html(A.find("input[name='phoneNumber']").val());x=2}}})});break;case 2:y.ajaxSubmit();break}},rules:{phoneNumber:{remote:{enabled:true,url:"/settings/bindMobile/registIsMobileBound",params:"{mobileNumber}",dataType:"json",test:function(F){B.phoneNumber=F.statusText;return F.status==0}}}},validateListener:function(F,O,K,J){o(O);var L=O.VID;var I=s(L);if(I){c.extend(O,I)}var N=true;for(var P in O){if(P=="VID"){continue}var H=false;for(var M in O[P]){if(H==true){break}switch(M){case"required":if(O[P][M]==false){switch(P){case"phoneNumber":z(P,"请输入手机号");break;case"vCode":z(P,"请输入手机验证码");break;case"password":z(P,"请输入密码");break;case"password_too":z(P,"请在此再次输入密码");break}N=false;H=true}else{if(O[P][M]==true){z(P,null)}}break;case"number":if(O[P][M]==false){switch(P){case"phoneNumber":z(P,"手机号需为数字");break;case"vCode":z(P,"验证码为数字");break}N=false;H=true}else{if(O[P][M]==true){z(P,null)}}break;case"l11l11":if(O[P][M]==false){switch(P){case"phoneNumber":z(P,"手机号长度为11位");break}N=false;H=true}else{if(O[P][M]==true){z(P,null)}}break;case"l6l16":if(O[P][M]==false){switch(P){case"password":z(P,"密码长度为6~16位");break;case"password_too":z(P,"密码长度为6~16位");break}N=false;H=true}else{if(O[P][M]==true){z(P,null)}}break;case"eqpassword_exp_reg":if(O[P][M]==false){switch(P){case"password_too":z(P,"两段密码须一致","password");break}N=false;H=true}else{if(O[P][M]==true){var G=c("input[name='password']").val();z(P,null,(i.test("required",G)&&i.test("l6l16",G))?"password":null)}}break;case"eqpasswordtoo_exp_reg":if(O[P][M]==false){switch(P){case"password":z(P,"两段密码须一致","password_too");break}N=false;H=true}else{if(O[P][M]==true){var G=c("input[name='password_too']");z(P,null,(i.test("required",G)&&i.test("l6l16",G))?"password_too":null)}}break;case"remote":if(O[P][M]==false){switch(P){case"phoneNumber":z(P,B.phoneNumber);break;case"vCode":z(P,B.vCode);break}N=false;H=true}else{if(O[P][M]==true){z(P,null)}}break}}}}});function z(H,F,G){if(F==null){A.find("div.js-field-"+H).removeClass("frm_err").addClass("frm_ok");A.find("div.js-"+H+"-default-view").show();A.find("div.js-"+H+"-err-view").hide();A.find("b.js-"+H+"-tiptxt").html("");if(G){z(G,F)}}else{A.find("div.js-field-"+H).removeClass("frm_ok").addClass("frm_err");A.find("div.js-"+H+"-default-view").hide();A.find("div.js-"+H+"-err-view").show();A.find("b.js-"+H+"-tiptxt").html(F);if(G){z(G,F)}}}u.find("a.js-submit").bind("click",function(){var F=c(this);if(F.data("dis")==true){return}F.addClass("btn_loading btn_dis").data("dis",true);D.remoteAllDone(function(){F.removeClass("btn_loading btn_dis").data("dis",false)});A.submit()});u.find("a.js-get-vcode").bind("click",function(){var F=c(this);if(F.data("locked")==true){return}kola("newt.service.Account",function(G){G.getPhoneNumberVCode({params:{phoneNumber:u.find("input[name='phoneNumber']:first").val()},success:function(H){if(H.status!=0){F.data("locked",false);z("phoneNumber",H.statusText)}else{E(50)}},beforeCall:function(){F.data("locked",true)},fail:function(){F.data("locked",false)}})})});function E(J){var G=u.find("a.js-get-vcode");var F=new Date().getTime();G.data("lock_time",F);G.data("locked",true);var I=G.find("b:first");var H=setInterval(function(){var K=Math.floor((new Date().getTime()-F)/1000);if(K<=J){I.html("("+(J-K)+"秒后)重新获取验证码")}else{G.data("locked",false);I.html("免费获取验证码");clearInterval(H);return}},1000)}u.find("div.js-explogin-registform").find("a.js-returnstep1").bind("click",function(){u.find("div.js-explogin-registform").find("fieldset.js-step1").show();u.find("div.js-explogin-registform").find("fieldset.js-step2").hide();D.set("vCode",{remote:{enabled:false,url:"/settings/bindMobile/registCheckVerificationCode",getters:{getPhoneNumber:function(){return u.find("input[name='phoneNumber']").val()}},params:"{verificationCode}&mobileNumber={=getPhoneNumber}",dataType:"json",test:function(G){var F=(G.status==0);B.vCode=(F==false)?"验证码错误":"";return F}},required:{enabled:false},number:{enabled:false}});x=1});u.bind("keyup",function(F){if(F.keyCode==13){u.find("a.js-submit").trigger("click")}});u.find("a.js-shexp-regskip").bind("click",function(){u.find("a.js-shexp-register").trigger("click")});a=false}})}},destory:function(){if(h){h.destory()}},show:function(v){g.q("readt_reg_show");q.init(v||{})}};return q});kola("app.exp.dialog.SRegister",["jquery.Core","newt.widget.plus.Input","newt.widget.plus.Form","mvc.view.TemplateEngine","newt.net.interface.user","newt.util.Validator","newt.dialog.Notice","newt.ca.ca","newt.component.PassportSC","newt.service.Account","newt.data.Rule","newt.Config","newt.widget.AutoComplete","newt.iploc.CrIploc1"],function(c,p,d,t,b,e,r,g,m,n,i,f,k){var l=b;var h=null;var u=null;i.add("eqpassword_exp_reg",function(w){var v=u.find("input[name='password']").val();if(i.test("required",v)==false){return true}return v==w});i.add("eqpasswordtoo_exp_reg",function(w){var v=u.find("input[name='password_too']").val();if(i.test("required",v)==false){return true}return v==w});var j={};function o(v){var w=j[v.VID];w=w?w:{};c.extend(w,v);j[v.VID]=w}function s(v){return j[v]}var a=false;var q={init:function(v){if(a==true){return}c.extend(v,{view:"regist"});if(!u){a=true;t.getTemplate({name:"template.main.regist.dialog.exp.expregister.s_headtab",complete:function(w){h=tw.window.getWindow("tw_empty_window",{head:w.render(),expose:{opacity:0.5,color:"#000000"}});h.setId("tw_expregist");u=h.getElement();u.find("div.mwFt").remove();u.addClass("mw mobReg");u.find("a.js-exlogin-viewregist").bind("click",function(){q.switchView({view:"regist"})}).trigger("click");u.find("a.js-exlogin-viewlogin").bind("click",function(){q.switchView({view:"login"})});a=false}})}else{h.show()}},switchView:function(v){u.find("a.js-exlogin-viewtab").removeClass("on");switch(v.view){case"regist":q.renderRegist(v);break;case"login":q.renderLogin(v);break}},renderLogin:function(w){u.find("a.js-exlogin-viewlogin").addClass("on");var v=u.find("div.js-explogin-loginform");if(v.size()>0){u.find("div.js-explogin-form").hide();v.show()}else{a=true;var x=location.href;if(x.indexOf("?")<=0){x+="?"}x+="&trans=1";t.getTemplate({name:"template.main.regist.dialog.exp.expregister.email",complete:function(N){u.find("div.js-explogin-form").hide();h.appendHtml(N.render({data:{returnUrl:x}}));h.show();u.find("#_tw_rw_field_captchaCode").show();i.add("包含搜狐",function(V){return V.indexOf("搜狐")==-1});i.add("包含搜狐微博",function(V){return V.indexOf("搜狐微博")==-1});i.add("包含sohu",function(V){return V.indexOf("sohu")==-1});i.add("包含souhu",function(V){return V.indexOf("souhu")==-1});i.add("开头微博",function(V){return V.indexOf("微博")!=0});i.add("开头weibo",function(V){return V.indexOf("weibo")!=0});i.add("开头官方",function(V){return V.indexOf("官方")!=0});var z=c("#_tw_rw_reg_form");function M(W){W=c.extend({success:function(){c("#_tw_rw_captchaCode_tip").html("")}},W||{});var V=z.find("#_tw_rw_validCode");if(V.size()<=0){return}l.flushValidCode(V,{beforeSend:function(){S.set("captchaCode",{remote:{enabled:false}})},success:function(X){z.find("#_tw_rw_field_captchaCode").removeClass("frm_ok frm_err").find(".txt input").val("");if(typeof(W.success)=="function"){W.success()}z.find("#_tw_rw_captchaSeed").val(X.data);S.set("captchaCode",{remote:{enabled:true,url:l.URL.VALID_VALIDCODE,params:"{captchaCode}&captchaSeed="+X.data,dataType:"json",test:function(Y){return Y.status==0}}})}})}c("#_tw_rw_field_captchaCode").find(".txt input").bind("focus",function(){if(c("#_tw_rw_field_captchaCode").hasClass("frm_err")){M({success:function(){}})}});var P=z.find("#_tw_rw_field_local");var y=[1,8];y[0]=P.find("i.select:eq(0)").attr("val");y[1]=P.find("i.select:eq(1)").attr("val");if(!y[0]||y[0]==""){y=[1,8]}if(y[0]=="请选择"){P.find("i.select:eq(0)").attr("val","0");P.find("i.select:eq(1)").attr("val","0")}if(P.find("#_tw_rw_province_hidden").size()==0){P.append('<input type="hidden" id="_tw_rw_province_hidden"   class="validate-criploc" name="province" value="'+y[0]+'">');P.append('<input type="hidden" id="_tw_rw_city_hidden"  class="validate-criploc"  name="city" value="'+y[1]+'">')}var H=z.find("#_tw_rw_field_local").crIploc1({changePro:function(V){var W=z.find("#_tw_rw_province_hidden").val();if(W!=V){z.find("#_tw_rw_province_hidden").val(V);z.find("#_tw_rw_city_hidden").val(0);O("local")}},changeCity:function(V){z.find("#_tw_rw_city_hidden").val(V);A()},onLoad:function(V,W){z.find("#_tw_rw_province_hidden").val(V);z.find("#_tw_rw_city_hidden").val(W)}}).data("crIploc1");function A(){var V=c("#_tw_rw_province_hidden").val();var W=c("#_tw_rw_city_hidden").val();if(V>0&&W>0){T("local")}else{C("local","请选择您的所在地")}}var I;function G(V){V.getTemplate({name:"template.main.regist.step1.nickname_recommend",complete:function(W){I.getData({num:6,complete:function(Y){var X=c("#nickname_recommend");if(!Y||Y.length<=0){X.find("p.tip").html("");return}var Z=(c.trim(X.html())=="");X.html(W.render({data:Y})).hide();if(Y.length<6){X.find("p.tip").html("")}if(Z){X.slideDown(100)}else{X.show()}X.find("a.js-next").bind("click",function(){G(V)});X.find("input.js-nickname").bind("click",function(){c("input[name='nickname']").val(c(this).attr("data-nickname"));c("#field_nickname").removeClass("frm_err").addClass("frm_ok");O("nickname");X.fadeOut(100,function(){c("#nickname_recommend").html("")})})}})}})}function D(V){kola("util.data.DataBuffer, mvc.view.TemplateEngine",function(X,W){I=new X({bufferSize:V.length,filler:function(Z,aa,Y){Y(V.splice(0,6))}});G(W)})}var Q="";var B="";var U=null;var S=new e({form:z,rules:{mail:{remote:{enabled:true,url:l.URL.VALID_EMAIL,params:"{mail}",dataType:"json",test:function(V){B=V.statusText;return V.status==0}}},nickname:{"包含搜狐":{enabled:true},"包含搜狐微博":{enabled:true},"包含sohu":{enabled:true},"包含souhu":{enabled:true},"开头微博":{enabled:true},"开头weibo":{enabled:true},"开头官方":{enabled:true},remote:{enabled:true,url:l.URL.VALID_NICKNAME,getters:{getMail:function(){return J()}},params:"{nickname}&mail={=getMail}",dataType:"json",test:function(V){Q=V.statusText;return V.status==0}}}},validateListener:function(Y,X,Z){if(X){delete X.VID}var ac=false;for(var V in X){if(Z&&S.localPass(V)==false){break}var ab=X[V];var W=false;for(var aa in ab){if(W){break}switch(aa){case"包含搜狐":if(ab[aa]==false){C(V,"不能含有“搜狐”");W=true}break;case"包含搜狐微博":if(ab[aa]==false){C(V,"不能含有“搜狐微博”");W=true}break;case"包含sohu":if(ab[aa]==false){C(V,"不能含有“sohu”");W=true}break;case"包含souhu":if(ab[aa]==false){C(V,"不能含有“souhu”");W=true}break;case"开头微博":if(ab[aa]==false){C(V,"不能以“微博”开头");W=true}break;case"开头weibo":if(ab[aa]==false){C(V,"不能以“weibo”开头");W=true}break;case"开头官方":if(ab[aa]==false){C(V,"不能以“官方”开头");W=true}break;case"criploc":if(ab[aa]==false){C("local","请选择您的所在地");W=true}break;case"l2l12":if(ab[aa]==false){C(V,"2-12位，由中文、字母、数字组成");W=true}break;case"l4l16":if(ab[aa]==false){C(V,"长度需要在4-16位之间");W=true}break;case"l6l16":if(ab[aa]==false){C(V,"长度需要在6-16位之间");W=true}break;case"required":if(ab[aa]==false){W=true;switch(V){case"mail":if(K==false){if(z.find("#_tw_rw_field_mail b.frm_suffix").size()==1){E(V,'<a href="javascript: void(0);" class="no-mail jsSohu">已有邮箱？</a>',false)}else{E(V,'填写常用邮箱作为微博账号。<a href="javascript: void(0);" class="no-mail ">没有邮箱？</a>',false)}}else{C(V,"请填写邮箱")}break;case"nickname":if(K==false){E(V,"昵称由中文、字母或数字组成");return}else{C(V,"请填写昵称")}break;case"password":if(K==false){E(V,"6-16位，由字母(区分大小写)、数字、符号组成");return}else{C(V,"请填写密码")}break;case"captchaCode":if(K==false){E(V,"输入验证码");return}else{C(V,"请填写验证码")}break}}break;case"email":if(ab[aa]==false){C(V,"邮箱格式不正确");W=true}break;case"remote":if(ab[aa]==false){W=true;switch(V){case"mail":C(V,B);break;case"nickname":C(V,Q);break;case"captchaCode":C(V,"验证码错误");break}}break;case"sohumailnamel4l16":if(ab[aa]==false){C(V,"邮箱名长度需要在4-16位之间");W=true}break;case"sohumail":if(ab[aa]==false){C(V,"只能使用字母、数字、减号、点号和下划线");W=true}break;case"lowercaseStart":if(ab[aa]==false){C(V,"只能以小写字母开头");W=true}break;case"nec":if(ab[aa]==false){C(V,"昵称只能使用中文、字母或数字");W=true}break;case"sohumailname":if(ab[aa]==false){C(V,"只能使用字母、数字、减号、点号和下划线");W=true}break;case"password":if(ab[aa]==false){C(V,"密码必须是字母(区分大小写)、数字、符号");W=true}break}}if(W==false){O(V);if(V=="province"||V=="city"){z.find("#_tw_rw_field_local").removeClass("frm_err").addClass("frm_ok")}else{z.find("#_tw_rw_field_"+V).removeClass("frm_err").addClass("frm_ok")}}else{z.find("#_tw_rw_field_"+V).removeClass("frm_ok")}}if(K){K=false}},validateTriggers:"submit|blur|focus",beforeSubmit:function(){L=true;z.find("#_tw_rw_registerStart").addClass("btnOLoad");var X=z.find("b.frm_suffix:first");if(X&&X.size()>0){var W=z.find("#_tw_rw_field_mail_input");z.append("<input type='hidden' name='"+W.attr("name")+"' value='"+W.val()+"@sohu.com'/>");W.removeAttr("name")}else{}var V=z.find("input[name='password']:first");z.append("<input type='hidden' name='"+V.attr("name")+"' value='"+c.cr.encodeUTF(V.val())+"'/>");V.removeAttr("name")}});function J(){var X=S.getValidateResults("mail")["mail"];for(var W in X){if(X[W]==false){return""}}var V=z.find("b.frm_suffix:first");if(V&&V.size()>0){return z.find("#_tw_rw_field_mail_input").val()+"@sohu.com"}else{return z.find("input[name='mail']:first").val()}}z.find("input[name='nickname']").data("parser",{remote:function(V){return c.cr.encodeUTF(V)}});z.find("input[name='captchaCode']").data("parser",{remote:function(V){return c.cr.encodeUTF(V)}});z.find("input[type='text'], input[type='password']").bind("blur",function(W){if(U){var V=z.find("#_tw_rw_"+this.name+"_tip");if(V.get(0)==U.get(0)){U.html("");U=null}}});function C(V,W){U=null;z.find("#_tw_rw_field_"+V).addClass("frm_err").removeClass("frm_ok");z.find("#_tw_rw_"+V+"_tip").html(W)}function T(V){U=null;c("#_tw_rw_field_"+V).addClass("frm_ok").removeClass("frm_err")}function O(V){c("#_tw_rw_field_"+V).removeClass("frm_err frm_ok");z.find("#_tw_rw_"+V+"_tip").html("")}function E(W,X,V){z.find("#_tw_rw_field_"+W).removeClass("frm_err frm_ok");if(V!=false){U=z.find("#_tw_rw_"+W+"_tip").html(X)}else{z.find("#_tw_rw_"+W+"_tip").html(X)}}z.find("#_tw_rw_field_mail_input").bind("blur focus",function(){var W=c(this);var V=W.val();if(V&&V.length>0){if(i.test("atsohucommail",V)||z.find("b.frm_suffix").size()>0){S.set("mail",{sohumailnamel4l16:{enabled:false},sohumail:{enabled:false}})}else{if(i.test("atsohumail",V)){S.set("mail",{lowercaseStart:{enabled:true,priority:10},sohumailnamel4l16:{enabled:true},sohumail:{enabled:true}})}else{S.set("mail",{sohumail:{enabled:false},lowercaseStart:{enabled:false,priority:10},sohumailnamel4l16:{enabled:false}})}}}S.validate("mail")});var L=false;M();z.find("#_tw_rw_flushValidCode").bind("click",function(){M()});var K=false;z.find("#_tw_rw_registerStart").bind("click",function(){var V=c(this);if(V.hasClass("btnOLoad")){return}K=true;V.addClass("btnOLoad");S.remoteAllDone(function(){if(L==false){V.removeClass("btnOLoad")}});z.submit()});c("#_tw_rw_reg_form").bind("keydown",function(V){if(V.keyCode==13){z.find("#_tw_rw_registerStart").trigger("click")}});var R=new k({list:["@sohu.com","@163.com","@qq.com","@126.com","@hotmail.com","@gmail.com","@chinaren.com","@sogou.com","@focus.cn"],title:"请选择您的用户帐号类型",input:z.find("#_tw_rw_field_mail_input"),mode:"tip"});c("#_tw_rw_reg_form").before(R.getDOM().hide());function F(){var W=c("b.frm_suffix");var Y=c("input[name='mail']");var X=Y.parents("i.txtLg:first");var Z=z.find("#_tw_rw_mail_tip");var V=W.size()>0;S.set("mail",{email:{enabled:V},lowercaseStart:{enabled:V==false,priority:10},l4l16:{enabled:V==false},sohumailname:{enabled:V==false}});if(V){W.remove();Y.removeData("parser");c("#_tw_rw_field_mail").removeClass("frm_nomail");if(z.find("#_tw_rw_field_mail").hasClass("frm_err")==false){Z.html('<a href="javascript: void(0);" class="no-mail">没有邮箱？</a>')}z.attr("action","/regist/otherDomainRegist");R.enabled()}else{X.after("<b class='frm_suffix'>@sohu.com</b>");c("#_tw_rw_field_mail").addClass("frm_nomail");if(z.find("#_tw_rw_field_mail").hasClass("frm_err")==false){Z.html('<a href="javascript: void(0);" class="no-mail">已有邮箱？</a>')}Y.data("parser",{remote:function(aa){return aa+"@sohu.com"}});z.attr("action","/regist/newSohuRegist");R.disabled()}S.validate("mail")}z.find("#_tw_rw_field_mail a.no-mail").live("click",F);z.find("input[name='mail']:first").bind("blur",function(){var V=c(this);if(V.val().length>0&&i.test("atsohucommail",V.val())&&z.find("b.frm_suffix").size()<=0){V.val(V.val().split("@")[0]);F()}});z.bind("submit",function(){var V=z.find("input[name='mail']").val();if(V&&V.length>0){if(i.test("atsohumail",V)){z.attr("action","/regist/newSohuRegist")}else{z.attr("action","/regist/otherDomainRegist")}}});u.find("a.js-shexp-regskip").bind("click",function(){u.find("a.js-shexp-register").trigger("click")});a=false}})}},renderRegist:function(w){u.find("a.js-exlogin-viewregist").addClass("on");var v=u.find("div.js-explogin-registform");if(v.size()>0){u.find("div.js-explogin-form").hide();v.show()}else{var x=1;a=true;a=true;var y=location.href;if(y.indexOf("?")<=0){y+="?"}y+="&trans=1";t.getTemplate({name:"template.main.regist.dialog.exp.expregister.s_phone_step1",complete:function(D){u.find("div.js-explogin-form").hide();h.appendHtml(D.render({data:{returnUrl:y}}));h.show();var B=u.find("form.js-submitform:first");var z=new d({form:B,model:n.registByPhoneNumber,modelOptions:{success:function(J){if(J.status==0){var G=J.statusText.split("?");var I=G[1];I=I.split("&");var L=[];var O="";for(var K=0,H=I.length;K<H;++K){var M=I[K].split("=");if(M[0]=="userid"){O=M[1]}if(M[0]=="ru"){continue}L.push(M[0]+"="+M[1])}G[1]=L.join("&");var N=G.join("?");t.getTemplate({name:w.registSuccess||"template.main.regist.dialog.exp.normal_regist_success",complete:function(R){u.find("div.js-explogin-registform").html(R.render({data:{hasVideoCard:true}}));u.find("a.js-tomymail-link").attr("href",N+"&ru=http://t.sohu.com/inbox");u.find("a.js-shexp-close").css("visibility","visible").bind("click",function(){location.href=N+"&ru="+location.href});setTimeout(function(){location.href=N+"&ru="+location.href},10000);u.find(".btns a#closeNow").click(function(){q.destory();location.href=N+"&ru="+location.href});var Q=3;var P=setInterval(function(){if(Q>=0){u.find("p.Ts").html("（本页面将在"+Q+"秒后自动关闭）");Q--}else{clearInterval(P);q.destory()}},1000)}})}else{kola("newt.dialog.Notice",function(){tw.notice.alert(J.statusText,function(){q.show()})})}}}});var C={phoneNumber:"",vCode:""};var E=new e({form:B,validateTriggers:"submit|blur",beforeSubmit:function(){u.find("a.js-submit").addClass("btn_loading btn_dis").data("dis",true)},formPassValidate:function(G){switch(x){case 1:kola("newt.service.Account",function(H){H.getPhoneNumberVCode({params:{phoneNumber:u.find("input[name='phoneNumber']:first").val()},success:function(I){if(I.status!=0){A("phoneNumber",I.statusText)}else{u.find("div.js-explogin-registform").find("fieldset.js-step1").hide();u.find("div.js-explogin-registform").find("fieldset.js-step2").show();E.set("vCode",{remote:{enabled:true,url:"/settings/bindMobile/registCheckVerificationCode",getters:{getPhoneNumber:function(){return u.find("input[name='phoneNumber']").val()}},params:"{verificationCode}&mobileNumber={=getPhoneNumber}",dataType:"json",test:function(K){var J=(K.status==0);C.vCode=(J==false)?"验证码错误":"";return J}},required:{enabled:true},number:{enabled:true}});u.find("div.js-explogin-registform").find("em.js-phonenumber-view").html(B.find("input[name='phoneNumber']").val());x=2}}})});break;case 2:z.ajaxSubmit();break}},rules:{phoneNumber:{remote:{enabled:true,url:"/settings/bindMobile/registIsMobileBound",params:"{mobileNumber}",dataType:"json",test:function(G){C.phoneNumber=G.statusText;return G.status==0}}}},validateListener:function(G,P,L,K){o(P);var M=P.VID;var J=s(M);if(J){c.extend(P,J)}var O=true;for(var Q in P){if(Q=="VID"){continue}var I=false;for(var N in P[Q]){if(I==true){break}switch(N){case"required":if(P[Q][N]==false){switch(Q){case"phoneNumber":A(Q,"请输入手机号");break;case"vCode":A(Q,"请输入手机验证码");break;case"password":A(Q,"请输入密码");break;case"password_too":A(Q,"请在此再次输入密码");break}O=false;I=true}else{if(P[Q][N]==true){A(Q,null)}}break;case"number":if(P[Q][N]==false){switch(Q){case"phoneNumber":A(Q,"手机号需为数字");break;case"vCode":A(Q,"验证码为数字");break}O=false;I=true}else{if(P[Q][N]==true){A(Q,null)}}break;case"l11l11":if(P[Q][N]==false){switch(Q){case"phoneNumber":A(Q,"手机号长度为11位");break}O=false;I=true}else{if(P[Q][N]==true){A(Q,null)}}break;case"l6l16":if(P[Q][N]==false){switch(Q){case"password":A(Q,"密码长度为6~16位");break;case"password_too":A(Q,"密码长度为6~16位");break}O=false;I=true}else{if(P[Q][N]==true){A(Q,null)}}break;case"eqpassword_exp_reg":if(P[Q][N]==false){switch(Q){case"password_too":A(Q,"两段密码须一致","password");break}O=false;I=true}else{if(P[Q][N]==true){var H=c("input[name='password']").val();A(Q,null,(i.test("required",H)&&i.test("l6l16",H))?"password":null)}}break;case"eqpasswordtoo_exp_reg":if(P[Q][N]==false){switch(Q){case"password":A(Q,"两段密码须一致","password_too");break}O=false;I=true}else{if(P[Q][N]==true){var H=c("input[name='password_too']");A(Q,null,(i.test("required",H)&&i.test("l6l16",H))?"password_too":null)}}break;case"remote":if(P[Q][N]==false){switch(Q){case"phoneNumber":A(Q,C.phoneNumber);break;case"vCode":A(Q,C.vCode);break}O=false;I=true}else{if(P[Q][N]==true){A(Q,null)}}break}}}}});function A(I,G,H){if(G==null){B.find("div.js-field-"+I).removeClass("frm_err").addClass("frm_ok");B.find("div.js-"+I+"-default-view").show();B.find("div.js-"+I+"-err-view").hide();B.find("b.js-"+I+"-tiptxt").html("");if(H){A(H,G)}}else{B.find("div.js-field-"+I).removeClass("frm_ok").addClass("frm_err");B.find("div.js-"+I+"-default-view").hide();B.find("div.js-"+I+"-err-view").show();B.find("b.js-"+I+"-tiptxt").html(G);if(H){A(H,G)}}}u.find("a.js-submit").bind("click",function(){var G=c(this);if(G.data("dis")==true){return}G.addClass("btn_loading btn_dis").data("dis",true);E.remoteAllDone(function(){G.removeClass("btn_loading btn_dis").data("dis",false)});B.submit()});u.find("a.js-get-vcode").bind("click",function(){var G=c(this);if(G.data("locked")==true){return}kola("newt.service.Account",function(H){H.getPhoneNumberVCode({params:{phoneNumber:u.find("input[name='phoneNumber']:first").val()},success:function(I){if(I.status!=0){G.data("locked",false);A("phoneNumber",I.statusText)}else{F(50)}},beforeCall:function(){G.data("locked",true)},fail:function(){G.data("locked",false)}})})});function F(K){var H=u.find("a.js-get-vcode");var G=new Date().getTime();H.data("lock_time",G);H.data("locked",true);var J=H.find("b:first");var I=setInterval(function(){var L=Math.floor((new Date().getTime()-G)/1000);if(L<=K){J.html("("+(K-L)+"秒后)重新获取验证码")}else{H.data("locked",false);J.html("免费获取验证码");clearInterval(I);return}},1000)}u.find("div.js-explogin-registform").find("a.js-returnstep1").bind("click",function(){u.find("div.js-explogin-registform").find("fieldset.js-step1").show();u.find("div.js-explogin-registform").find("fieldset.js-step2").hide();E.set("vCode",{remote:{enabled:false,url:"/settings/bindMobile/registCheckVerificationCode",getters:{getPhoneNumber:function(){return u.find("input[name='phoneNumber']").val()}},params:"{verificationCode}&mobileNumber={=getPhoneNumber}",dataType:"json",test:function(H){var G=(H.status==0);C.vCode=(G==false)?"验证码错误":"";return G}},required:{enabled:false},number:{enabled:false}});x=1});u.bind("keyup",function(G){if(G.keyCode==13){u.find("a.js-submit").trigger("click")}});u.find("a.js-shexp-regskip").bind("click",function(){u.find("a.js-shexp-register").trigger("click")});a=false}})}},destory:function(){if(h){h.destory()}},show:function(v){g.q("readt_reg_show");q.init(v||{})}};return q});